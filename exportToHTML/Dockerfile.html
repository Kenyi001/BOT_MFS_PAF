<html>
<head>
<title>Dockerfile</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #7a7e85;}
.s1 { color: #bcbec4;}
.s2 { color: #cf8e6d;}
.s3 { color: #2aacb8;}
.s4 { color: #6aab73;}
.s5 { color: #bcbec4;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
Dockerfile</font>
</center></td></tr></table>
<pre><span class="s0"># syntax=docker/dockerfile:1</span>

<span class="s0"># Comments are provided throughout this file to help you get started.</span>
<span class="s0"># If you need more help, visit the Dockerfile reference guide at</span>
<span class="s0"># https://docs.docker.com/engine/reference/builder/</span>

<span class="s2">ARG </span><span class="s1">PYTHON_VERSION=</span><span class="s3">3.10</span>
<span class="s2">FROM </span><span class="s1">python:${PYTHON_VERSION}</span><span class="s2">-</span><span class="s1">slim as base</span>

<span class="s0"># Prevents Python from writing pyc files.</span>
<span class="s2">ENV </span><span class="s1">PYTHONDONTWRITEBYTECODE=</span><span class="s3">1</span>

<span class="s0"># Keeps Python from buffering stdout and stderr to avoid situations where</span>
<span class="s0"># the application crashes without emitting any logs due to buffering.</span>
<span class="s2">ENV </span><span class="s1">PYTHONUNBUFFERED=</span><span class="s3">1</span>

<span class="s2">WORKDIR /</span><span class="s1">app</span>

<span class="s2">RUN </span><span class="s1">apt-get update </span><span class="s2">--</span><span class="s1">fix-missing </span><span class="s2">&amp;&amp; </span><span class="s1">apt-get install </span><span class="s2">-</span><span class="s1">y \ 
    libgl1-mesa-glx \ 
    </span><span class="s2">&amp;&amp; </span><span class="s1">rm </span><span class="s2">-</span><span class="s1">rf </span><span class="s2">/</span><span class="s1">var</span><span class="s2">/</span><span class="s1">lib</span><span class="s2">/</span><span class="s1">apt</span><span class="s2">/</span><span class="s1">lists</span><span class="s2">/*</span>


<span class="s0"># Create a non-privileged user that the app will run under.</span>
<span class="s0"># See https://docs.docker.com/develop/develop-images/dockerfile_best-practices/#user</span>
<span class="s2">ARG </span><span class="s1">UID=</span><span class="s3">10001</span>
<span class="s2">RUN </span><span class="s1">adduser \ 
    </span><span class="s2">--</span><span class="s1">disabled-password \ 
    </span><span class="s2">--</span><span class="s1">gecos </span><span class="s4">&quot;&quot; </span><span class="s1">\ 
    </span><span class="s2">--</span><span class="s1">home </span><span class="s4">&quot;/nonexistent&quot; </span><span class="s1">\ 
    </span><span class="s2">--</span><span class="s1">shell </span><span class="s4">&quot;/sbin/nologin&quot; </span><span class="s1">\ 
    </span><span class="s2">--</span><span class="s1">no-create-home \ 
    </span><span class="s2">--</span><span class="s1">uid </span><span class="s4">&quot;</span><span class="s1">${UID}</span><span class="s4">&quot; </span><span class="s1">\ 
    appuser</span>

<span class="s0"># Download dependencies as a separate step to take advantage of Docker's caching.</span>
<span class="s0"># Leverage a cache mount to /root/.cache/pip to speed up subsequent builds.</span>
<span class="s0"># Leverage a bind mount to requirements.txt to avoid having to copy them into</span>
<span class="s0"># into this layer.</span>


<span class="s2">RUN --</span><span class="s1">mount=type=cache</span><span class="s5">,</span><span class="s1">target=</span><span class="s2">/</span><span class="s1">root</span><span class="s2">/</span><span class="s5">.</span><span class="s1">cache</span><span class="s2">/</span><span class="s1">pip \ 
    </span><span class="s2">--</span><span class="s1">mount=type=bind</span><span class="s5">,</span><span class="s1">source=requirements</span><span class="s5">.</span><span class="s1">txt</span><span class="s5">,</span><span class="s1">target=requirements</span><span class="s5">.</span><span class="s1">txt \ 
    python </span><span class="s2">-</span><span class="s1">m pip install </span><span class="s2">-</span><span class="s1">r requirements</span><span class="s5">.</span><span class="s1">txt</span>

<span class="s0"># Switch to the non-privileged user to run the application.</span>
<span class="s2">USER </span><span class="s1">appuser</span>

<span class="s0"># Copy the source code into the container.</span>
<span class="s2">COPY </span><span class="s5">. .</span>

<span class="s0"># Expose the port that the application listens on.</span>
<span class="s2">EXPOSE </span><span class="s3">8000</span>

<span class="s0"># Run the application.</span>
<span class="s2">CMD </span><span class="s5">[</span><span class="s4">&quot;python&quot;</span><span class="s5">, </span><span class="s4">&quot;main.py&quot;</span><span class="s5">]</span></pre>
</body>
</html>