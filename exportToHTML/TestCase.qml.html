<html>
<head>
<title>TestCase.qml</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #5f826b; font-style: italic;}
.s1 { color: #bcbec4;}
.s2 { color: #cf8e6d;}
.s3 { color: #2aacb8;}
.s4 { color: #bcbec4;}
.s5 { color: #7a7e85;}
.s6 { color: #6aab73;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
TestCase.qml</font>
</center></td></tr></table>
<pre><span class="s0">/****************************************************************************</span>
<span class="s0">**</span>
<span class="s0">** Copyright (C) 2016 The Qt Company Ltd.</span>
<span class="s0">** Contact: https://www.qt.io/licensing/</span>
<span class="s0">**</span>
<span class="s0">** This file is part of the test suite of the Qt Toolkit.</span>
<span class="s0">**</span>
<span class="s0">** $QT_BEGIN_LICENSE:LGPL$</span>
<span class="s0">** Commercial License Usage</span>
<span class="s0">** Licensees holding valid commercial Qt licenses may use this file in</span>
<span class="s0">** accordance with the commercial license agreement provided with the</span>
<span class="s0">** Software or, alternatively, in accordance with the terms contained in</span>
<span class="s0">** a written agreement between you and The Qt Company. For licensing terms</span>
<span class="s0">** and conditions see https://www.qt.io/terms-conditions. For further</span>
<span class="s0">** information use the contact form at https://www.qt.io/contact-us.</span>
<span class="s0">**</span>
<span class="s0">** GNU Lesser General Public License Usage</span>
<span class="s0">** Alternatively, this file may be used under the terms of the GNU Lesser</span>
<span class="s0">** General Public License version 3 as published by the Free Software</span>
<span class="s0">** Foundation and appearing in the file LICENSE.LGPL3 included in the</span>
<span class="s0">** packaging of this file. Please review the following information to</span>
<span class="s0">** ensure the GNU Lesser General Public License version 3 requirements</span>
<span class="s0">** will be met: https://www.gnu.org/licenses/lgpl-3.0.html.</span>
<span class="s0">**</span>
<span class="s0">** GNU General Public License Usage</span>
<span class="s0">** Alternatively, this file may be used under the terms of the GNU</span>
<span class="s0">** General Public License version 2.0 or (at your option) the GNU General</span>
<span class="s0">** Public license version 3 or any later version approved by the KDE Free</span>
<span class="s0">** Qt Foundation. The licenses are as published by the Free Software</span>
<span class="s0">** Foundation and appearing in the file LICENSE.GPL2 and LICENSE.GPL3</span>
<span class="s0">** included in the packaging of this file. Please review the following</span>
<span class="s0">** information to ensure the GNU General Public License requirements will</span>
<span class="s0">** be met: https://www.gnu.org/licenses/gpl-2.0.html and</span>
<span class="s0">** https://www.gnu.org/licenses/gpl-3.0.html.</span>
<span class="s0">**</span>
<span class="s0">** $QT_END_LICENSE$</span>
<span class="s0">**</span>
<span class="s0">****************************************************************************/</span>

<span class="s2">import </span><span class="s1">QtQuick </span><span class="s3">2.0</span>
<span class="s2">import </span><span class="s1">QtQuick</span><span class="s4">.</span><span class="s1">Window </span><span class="s3">2.0 </span><span class="s5">// used for qtest_verifyItem</span>
<span class="s2">import </span><span class="s1">QtTest </span><span class="s3">1.2</span>
<span class="s2">import </span><span class="s6">&quot;testlogger.js&quot; </span><span class="s4">as </span><span class="s1">TestLogger</span>
<span class="s2">import </span><span class="s1">Qt</span><span class="s4">.</span><span class="s1">test</span><span class="s4">.</span><span class="s1">qtestroot </span><span class="s3">1.0</span>

<span class="s5">/*! 
    \qmltype TestCase 
    \inqmlmodule QtTest 
    \brief Represents a unit test case. 
    \since 4.8 
    \ingroup qtquicktest 
 
    \section1 Introduction to QML Test Cases 
 
    Test cases are written as JavaScript functions within a TestCase 
    type: 
 
    \code 
    import QtQuick 2.0 
    import QtTest 1.2 
 
    TestCase { 
        name: &quot;MathTests&quot; 
 
        function test_math() { 
            compare(2 + 2, 4, &quot;2 + 2 = 4&quot;) 
        } 
 
        function test_fail() { 
            compare(2 + 2, 5, &quot;2 + 2 = 5&quot;) 
        } 
    } 
    \endcode 
 
    Functions whose names start with &quot;test_&quot; are treated as test cases 
    to be executed.  The \l name property is used to prefix the functions 
    in the output: 
 
    \code 
    ********* Start testing of MathTests ********* 
    Config: Using QTest library 4.7.2, Qt 4.7.2 
    PASS   : MathTests::initTestCase() 
    FAIL!  : MathTests::test_fail() 2 + 2 = 5 
       Actual (): 4 
       Expected (): 5 
       Loc: [/home/.../tst_math.qml(12)] 
    PASS   : MathTests::test_math() 
    PASS   : MathTests::cleanupTestCase() 
    Totals: 3 passed, 1 failed, 0 skipped 
    ********* Finished testing of MathTests ********* 
    \endcode 
 
    Because of the way JavaScript properties work, the order in which the 
    test functions are found is unpredictable.  To assist with predictability, 
    the test framework will sort the functions on ascending order of name. 
    This can help when there are two tests that must be run in order. 
 
    Multiple TestCase types can be supplied.  The test program will exit 
    once they have all completed.  If a test case doesn't need to run 
    (because a precondition has failed), then \l optional can be set to true. 
 
    \section1 Data-driven Tests 
 
    Table data can be provided to a test using a function name that ends 
    with &quot;_data&quot;. Alternatively, the \c init_data() function can be used 
    to provide default test data for all test functions in a TestCase type: 
 
 
    \code 
    import QtQuick 2.0 
    import QtTest 1.2 
 
    TestCase { 
        name: &quot;DataTests&quot; 
 
        function init_data() { 
          return [ 
               {tag:&quot;init_data_1&quot;, a:1, b:2, answer: 3}, 
               {tag:&quot;init_data_2&quot;, a:2, b:4, answer: 6} 
          ]; 
        } 
 
        function test_table_data() { 
            return [ 
                {tag: &quot;2 + 2 = 4&quot;, a: 2, b: 2, answer: 4 }, 
                {tag: &quot;2 + 6 = 8&quot;, a: 2, b: 6, answer: 8 }, 
            ] 
        } 
 
        function test_table(data) { 
            //data comes from test_table_data 
            compare(data.a + data.b, data.answer) 
        } 
 
        function test__default_table(data) { 
            //data comes from init_data 
            compare(data.a + data.b, data.answer) 
        } 
    } 
    \endcode 
 
    The test framework will iterate over all of the rows in the table 
    and pass each row to the test function.  As shown, the columns can be 
    extracted for use in the test.  The \c tag column is special - it is 
    printed by the test framework when a row fails, to help the reader 
    identify which case failed amongst a set of otherwise passing tests. 
 
    \section1 Benchmarks 
 
    Functions whose names start with &quot;benchmark_&quot; will be run multiple 
    times with the Qt benchmark framework, with an average timing value 
    reported for the runs.  This is equivalent to using the \c{QBENCHMARK} 
    macro in the C++ version of QTestLib. 
 
    \code 
    TestCase { 
        id: top 
        name: &quot;CreateBenchmark&quot; 
 
        function benchmark_create_component() { 
            var component = Qt.createComponent(&quot;item.qml&quot;) 
            var obj = component.createObject(top) 
            obj.destroy() 
            component.destroy() 
        } 
    } 
 
    RESULT : CreateBenchmark::benchmark_create_component: 
         0.23 msecs per iteration (total: 60, iterations: 256) 
    PASS   : CreateBenchmark::benchmark_create_component() 
    \endcode 
 
    To get the effect of the \c{QBENCHMARK_ONCE} macro, prefix the test 
    function name with &quot;benchmark_once_&quot;. 
 
    \section1 Simulating Keyboard and Mouse Events 
 
    The keyPress(), keyRelease(), and keyClick() methods can be used 
    to simulate keyboard events within unit tests.  The events are 
    delivered to the currently focused QML item. You can pass either 
    a Qt.Key enum value or a latin1 char (string of length one) 
 
    \code 
    Rectangle { 
        width: 50; height: 50 
        focus: true 
 
        TestCase { 
            name: &quot;KeyClick&quot; 
            when: windowShown 
 
            function test_key_click() { 
                keyClick(Qt.Key_Left) 
                keyClick(&quot;a&quot;) 
                ... 
            } 
        } 
    } 
    \endcode 
 
    The mousePress(), mouseRelease(), mouseClick(), mouseDoubleClickSequence() 
    and mouseMove() methods can be used to simulate mouse events in a 
    similar fashion. 
 
    \b{Note:} keyboard and mouse events can only be delivered once the 
    main window has been shown.  Attempts to deliver events before then 
    will fail.  Use the \l when and windowShown properties to track 
    when the main window has been shown. 
 
    \section1 Managing Dynamically Created Test Objects 
 
    A typical pattern with QML tests is to 
    \l {Dynamic QML Object Creation from JavaScript}{dynamically create} 
    an item and then destroy it at the end of the test function: 
 
    \code 
    TestCase { 
        id: testCase 
        name: &quot;MyTest&quot; 
        when: windowShown 
 
        function test_click() { 
            var item = Qt.createQmlObject(&quot;import QtQuick 2.0; Item {}&quot;, testCase); 
            verify(item); 
 
            // Test item... 
 
            item.destroy(); 
        } 
    } 
    \endcode 
 
    The problem with this pattern is that any failures in the test function 
    will cause the call to \c item.destroy() to be skipped, leaving the item 
    hanging around in the scene until the test case has finished. This can 
    result in interference with future tests; for example, by blocking input 
    events or producing unrelated debug output that makes it difficult to 
    follow the code's execution. 
 
    By calling \l createTemporaryQmlObject() instead, the object is guaranteed 
    to be destroyed at the end of the test function: 
 
    \code 
    TestCase { 
        id: testCase 
        name: &quot;MyTest&quot; 
        when: windowShown 
 
        function test_click() { 
            var item = createTemporaryQmlObject(&quot;import QtQuick 2.0; Item {}&quot;, testCase); 
            verify(item); 
 
            // Test item... 
 
            // Don't need to worry about destroying &quot;item&quot; here. 
        } 
    } 
    \endcode 
 
    For objects that are created via the \l {Component::}{createObject()} function 
    of \l Component, the \l createTemporaryObject() function can be used. 
 
    \sa {QtTest::SignalSpy}{SignalSpy}, {Qt Quick Test} 
*/</span>


<span class="s1">Item </span><span class="s4">{</span>
    <span class="s1">id</span><span class="s4">: </span><span class="s1">testCase</span>
    <span class="s1">visible</span><span class="s4">: </span><span class="s2">false</span>
    <span class="s1">TestUtil </span><span class="s4">{</span>
        <span class="s1">id</span><span class="s4">:</span><span class="s1">util</span>
    <span class="s4">}</span>

    <span class="s5">/*! 
        \qmlproperty string TestCase::name 
 
        This property defines the name of the test case for result reporting. 
        The default value is an empty string. 
 
        \code 
        TestCase { 
            name: &quot;ButtonTests&quot; 
            ... 
        } 
        \endcode 
    */</span>
    <span class="s1">property string name</span>

    <span class="s5">/*! 
        \qmlproperty bool TestCase::when 
 
        This property should be set to true when the application wants 
        the test cases to run.  The default value is true.  In the following 
        example, a test is run when the user presses the mouse button: 
 
        \code 
        Rectangle { 
            id: foo 
            width: 640; height: 480 
            color: &quot;cyan&quot; 
 
            MouseArea { 
                id: area 
                anchors.fill: parent 
            } 
 
            property bool bar: true 
 
            TestCase { 
                name: &quot;ItemTests&quot; 
                when: area.pressed 
                id: test1 
 
                function test_bar() { 
                    verify(bar) 
                } 
            } 
        } 
        \endcode 
 
        The test application will exit once all \l TestCase types 
        have been triggered and have run.  The \l optional property can 
        be used to exclude a \l TestCase type. 
 
        \sa optional, completed 
    */</span>
    <span class="s1">property bool when</span><span class="s4">: </span><span class="s2">true</span>

    <span class="s5">/*! 
        \qmlproperty bool TestCase::completed 
 
        This property will be set to true once the test case has completed 
        execution.  Test cases are only executed once.  The initial value 
        is false. 
 
        \sa running, when 
    */</span>
    <span class="s1">property bool completed</span><span class="s4">: </span><span class="s2">false</span>

    <span class="s5">/*! 
        \qmlproperty bool TestCase::running 
 
        This property will be set to true while the test case is running. 
        The initial value is false, and the value will become false again 
        once the test case completes. 
 
        \sa completed, when 
    */</span>
    <span class="s1">property bool running</span><span class="s4">: </span><span class="s2">false</span>

    <span class="s5">/*! 
        \qmlproperty bool TestCase::optional 
 
        Multiple \l TestCase types can be supplied in a test application. 
        The application will exit once they have all completed.  If a test case 
        does not need to run (because a precondition has failed), then this 
        property can be set to true.  The default value is false. 
 
        \code 
        TestCase { 
            when: false 
            optional: true 
            function test_not_run() { 
                verify(false) 
            } 
        } 
        \endcode 
 
        \sa when, completed 
    */</span>
    <span class="s1">property bool optional</span><span class="s4">: </span><span class="s2">false</span>

    <span class="s5">/*! 
        \qmlproperty bool TestCase::windowShown 
 
        This property will be set to true after the QML viewing window has 
        been displayed.  Normally test cases run as soon as the test application 
        is loaded and before a window is displayed.  If the test case involves 
        visual types and behaviors, then it may need to be delayed until 
        after the window is shown. 
 
        \code 
        Button { 
            id: button 
            onClicked: text = &quot;Clicked&quot; 
            TestCase { 
                name: &quot;ClickTest&quot; 
                when: windowShown 
                function test_click() { 
                    button.clicked(); 
                    compare(button.text, &quot;Clicked&quot;); 
                } 
            } 
        } 
        \endcode 
    */</span>
    <span class="s1">property bool windowShown</span><span class="s4">: </span><span class="s1">QTestRootObject</span><span class="s4">.</span><span class="s1">windowShown</span>

    <span class="s5">// Internal private state.  Identifiers prefixed with qtest are reserved.</span>
    <span class="s5">/*! \internal */</span>
    <span class="s1">property bool qtest_prevWhen</span><span class="s4">: </span><span class="s2">true</span>
    <span class="s5">/*! \internal */</span>
    <span class="s1">property int qtest_testId</span><span class="s4">: -</span><span class="s3">1</span>
    <span class="s5">/*! \internal */</span>
    <span class="s1">property bool qtest_componentCompleted </span><span class="s4">: </span><span class="s2">false</span>
    <span class="s5">/*! \internal */</span>
    <span class="s1">property </span><span class="s2">var </span><span class="s1">qtest_testCaseResult</span>
    <span class="s5">/*! \internal */</span>
    <span class="s1">property </span><span class="s2">var </span><span class="s1">qtest_results</span><span class="s4">: </span><span class="s1">qtest_results_normal</span>
    <span class="s5">/*! \internal */</span>
    <span class="s1">TestResult </span><span class="s4">{ </span><span class="s1">id</span><span class="s4">: </span><span class="s1">qtest_results_normal </span><span class="s4">}</span>
    <span class="s5">/*! \internal */</span>
    <span class="s1">property </span><span class="s2">var </span><span class="s1">qtest_events</span><span class="s4">: </span><span class="s1">qtest_events_normal</span>
    <span class="s1">TestEvent </span><span class="s4">{ </span><span class="s1">id</span><span class="s4">: </span><span class="s1">qtest_events_normal </span><span class="s4">}</span>
    <span class="s5">/*! \internal */</span>
    <span class="s1">property </span><span class="s2">var </span><span class="s1">qtest_temporaryObjects</span><span class="s4">: []</span>

    <span class="s5">/*! 
        \qmlmethod TestCase::fail(message = &quot;&quot;) 
 
        Fails the current test case, with the optional \a message. 
        Similar to \c{QFAIL(message)} in C++. 
    */</span>
    <span class="s2">function </span><span class="s1">fail</span><span class="s4">(</span><span class="s1">msg</span><span class="s4">) {</span>
        <span class="s2">if </span><span class="s4">(</span><span class="s1">msg </span><span class="s4">=== </span><span class="s1">undefined</span><span class="s4">)</span>
            <span class="s1">msg </span><span class="s4">= </span><span class="s6">&quot;&quot;</span><span class="s4">;</span>
        <span class="s1">qtest_results</span><span class="s4">.</span><span class="s1">fail</span><span class="s4">(</span><span class="s1">msg</span><span class="s4">, </span><span class="s1">util</span><span class="s4">.</span><span class="s1">callerFile</span><span class="s4">(), </span><span class="s1">util</span><span class="s4">.</span><span class="s1">callerLine</span><span class="s4">())</span>
        <span class="s2">throw new </span><span class="s1">Error</span><span class="s4">(</span><span class="s6">&quot;QtQuickTest::fail&quot;</span><span class="s4">)</span>
    <span class="s4">}</span>

    <span class="s5">/*! \internal */</span>
    <span class="s2">function </span><span class="s1">qtest_fail</span><span class="s4">(</span><span class="s1">msg</span><span class="s4">, </span><span class="s1">frame</span><span class="s4">) {</span>
        <span class="s2">if </span><span class="s4">(</span><span class="s1">msg </span><span class="s4">=== </span><span class="s1">undefined</span><span class="s4">)</span>
            <span class="s1">msg </span><span class="s4">= </span><span class="s6">&quot;&quot;</span><span class="s4">;</span>
        <span class="s1">qtest_results</span><span class="s4">.</span><span class="s1">fail</span><span class="s4">(</span><span class="s1">msg</span><span class="s4">, </span><span class="s1">util</span><span class="s4">.</span><span class="s1">callerFile</span><span class="s4">(</span><span class="s1">frame</span><span class="s4">), </span><span class="s1">util</span><span class="s4">.</span><span class="s1">callerLine</span><span class="s4">(</span><span class="s1">frame</span><span class="s4">))</span>
        <span class="s2">throw new </span><span class="s1">Error</span><span class="s4">(</span><span class="s6">&quot;QtQuickTest::fail&quot;</span><span class="s4">)</span>
    <span class="s4">}</span>

    <span class="s5">/*! 
        \qmlmethod TestCase::verify(condition, message = &quot;&quot;) 
 
        Fails the current test case if \a condition is false, and 
        displays the optional \a message.  Similar to \c{QVERIFY(condition)} 
        or \c{QVERIFY2(condition, message)} in C++. 
    */</span>
    <span class="s2">function </span><span class="s1">verify</span><span class="s4">(</span><span class="s1">cond</span><span class="s4">, </span><span class="s1">msg</span><span class="s4">) {</span>
        <span class="s2">if </span><span class="s4">(</span><span class="s1">arguments</span><span class="s4">.</span><span class="s1">length </span><span class="s4">&gt; </span><span class="s3">2</span><span class="s4">)</span>
            <span class="s1">qtest_fail</span><span class="s4">(</span><span class="s6">&quot;More than two arguments given to verify(). Did you mean tryVerify() or tryCompare()?&quot;</span><span class="s4">, </span><span class="s3">1</span><span class="s4">)</span>

        <span class="s2">if </span><span class="s4">(</span><span class="s1">msg </span><span class="s4">=== </span><span class="s1">undefined</span><span class="s4">)</span>
            <span class="s1">msg </span><span class="s4">= </span><span class="s6">&quot;&quot;</span><span class="s4">;</span>
        <span class="s2">if </span><span class="s4">(!</span><span class="s1">qtest_results</span><span class="s4">.</span><span class="s1">verify</span><span class="s4">(</span><span class="s1">cond</span><span class="s4">, </span><span class="s1">msg</span><span class="s4">, </span><span class="s1">util</span><span class="s4">.</span><span class="s1">callerFile</span><span class="s4">(), </span><span class="s1">util</span><span class="s4">.</span><span class="s1">callerLine</span><span class="s4">()))</span>
            <span class="s2">throw new </span><span class="s1">Error</span><span class="s4">(</span><span class="s6">&quot;QtQuickTest::fail&quot;</span><span class="s4">)</span>
    <span class="s4">}</span>

    <span class="s5">/*! 
        \since 5.8 
        \qmlmethod TestCase::tryVerify(function, timeout = 5000, message = &quot;&quot;) 
 
        Fails the current test case if \a function does not evaluate to 
        \c true before the specified \a timeout (in milliseconds) has elapsed. 
        The function is evaluated multiple times until the timeout is 
        reached. An optional \a message is displayed upon failure. 
 
        This function is intended for testing applications where a condition 
        changes based on asynchronous events. Use verify() for testing 
        synchronous condition changes, and tryCompare() for testing 
        asynchronous property changes. 
 
        For example, in the code below, it's not possible to use tryCompare(), 
        because the \c currentItem property might be \c null for a short period 
        of time: 
 
        \code 
        tryCompare(listView.currentItem, &quot;text&quot;, &quot;Hello&quot;); 
        \endcode 
 
        Instead, we can use tryVerify() to first check that \c currentItem 
        isn't \c null, and then use a regular compare afterwards: 
 
        \code 
        tryVerify(function(){ return listView.currentItem }) 
        compare(listView.currentItem.text, &quot;Hello&quot;) 
        \endcode 
 
        \sa verify(), compare(), tryCompare(), SignalSpy::wait() 
    */</span>
    <span class="s2">function </span><span class="s1">tryVerify</span><span class="s4">(</span><span class="s1">expressionFunction</span><span class="s4">, </span><span class="s1">timeout</span><span class="s4">, </span><span class="s1">msg</span><span class="s4">) {</span>
        <span class="s2">if </span><span class="s4">(!</span><span class="s1">expressionFunction </span><span class="s4">|| !(</span><span class="s1">expressionFunction </span><span class="s2">instanceof </span><span class="s1">Function</span><span class="s4">)) {</span>
            <span class="s1">qtest_results</span><span class="s4">.</span><span class="s1">fail</span><span class="s4">(</span><span class="s6">&quot;First argument must be a function&quot;</span><span class="s4">, </span><span class="s1">util</span><span class="s4">.</span><span class="s1">callerFile</span><span class="s4">(), </span><span class="s1">util</span><span class="s4">.</span><span class="s1">callerLine</span><span class="s4">())</span>
            <span class="s2">throw new </span><span class="s1">Error</span><span class="s4">(</span><span class="s6">&quot;QtQuickTest::fail&quot;</span><span class="s4">)</span>
        <span class="s4">}</span>

        <span class="s2">if </span><span class="s4">(</span><span class="s1">timeout </span><span class="s4">&amp;&amp; </span><span class="s2">typeof</span><span class="s4">(</span><span class="s1">timeout</span><span class="s4">) !== </span><span class="s6">&quot;number&quot;</span><span class="s4">) {</span>
            <span class="s1">qtest_results</span><span class="s4">.</span><span class="s1">fail</span><span class="s4">(</span><span class="s6">&quot;timeout argument must be a number&quot;</span><span class="s4">, </span><span class="s1">util</span><span class="s4">.</span><span class="s1">callerFile</span><span class="s4">(), </span><span class="s1">util</span><span class="s4">.</span><span class="s1">callerLine</span><span class="s4">())</span>
            <span class="s2">throw new </span><span class="s1">Error</span><span class="s4">(</span><span class="s6">&quot;QtQuickTest::fail&quot;</span><span class="s4">)</span>
        <span class="s4">}</span>

        <span class="s2">if </span><span class="s4">(</span><span class="s1">msg </span><span class="s4">&amp;&amp; </span><span class="s2">typeof</span><span class="s4">(</span><span class="s1">msg</span><span class="s4">) !== </span><span class="s6">&quot;string&quot;</span><span class="s4">) {</span>
            <span class="s1">qtest_results</span><span class="s4">.</span><span class="s1">fail</span><span class="s4">(</span><span class="s6">&quot;message argument must be a string&quot;</span><span class="s4">, </span><span class="s1">util</span><span class="s4">.</span><span class="s1">callerFile</span><span class="s4">(), </span><span class="s1">util</span><span class="s4">.</span><span class="s1">callerLine</span><span class="s4">())</span>
            <span class="s2">throw new </span><span class="s1">Error</span><span class="s4">(</span><span class="s6">&quot;QtQuickTest::fail&quot;</span><span class="s4">)</span>
        <span class="s4">}</span>

        <span class="s2">if </span><span class="s4">(!</span><span class="s1">timeout</span><span class="s4">)</span>
            <span class="s1">timeout </span><span class="s4">= </span><span class="s3">5000</span>

        <span class="s2">if </span><span class="s4">(</span><span class="s1">msg </span><span class="s4">=== </span><span class="s1">undefined</span><span class="s4">)</span>
            <span class="s1">msg </span><span class="s4">= </span><span class="s6">&quot;function returned false&quot;</span>

        <span class="s2">if </span><span class="s4">(!</span><span class="s1">expressionFunction</span><span class="s4">())</span>
            <span class="s1">wait</span><span class="s4">(</span><span class="s3">0</span><span class="s4">)</span>

        <span class="s2">var </span><span class="s1">i </span><span class="s4">= </span><span class="s3">0</span>
        <span class="s2">while </span><span class="s4">(</span><span class="s1">i </span><span class="s4">&lt; </span><span class="s1">timeout </span><span class="s4">&amp;&amp; !</span><span class="s1">expressionFunction</span><span class="s4">()) {</span>
            <span class="s1">wait</span><span class="s4">(</span><span class="s3">50</span><span class="s4">)</span>
            <span class="s1">i </span><span class="s4">+= </span><span class="s3">50</span>
        <span class="s4">}</span>

        <span class="s2">if </span><span class="s4">(!</span><span class="s1">qtest_results</span><span class="s4">.</span><span class="s1">verify</span><span class="s4">(</span><span class="s1">expressionFunction</span><span class="s4">(), </span><span class="s1">msg</span><span class="s4">, </span><span class="s1">util</span><span class="s4">.</span><span class="s1">callerFile</span><span class="s4">(), </span><span class="s1">util</span><span class="s4">.</span><span class="s1">callerLine</span><span class="s4">()))</span>
            <span class="s2">throw new </span><span class="s1">Error</span><span class="s4">(</span><span class="s6">&quot;QtQuickTest::fail&quot;</span><span class="s4">)</span>
    <span class="s4">}</span>

    <span class="s5">/*! 
        \since 5.13 
        \qmlmethod bool TestCase::isPolishScheduled(object item) 
 
        Returns \c true if \l {QQuickItem::}{updatePolish()} has not been called 
        on \a item since the last call to \l {QQuickItem::}{polish()}, 
        otherwise returns \c false. 
 
        When assigning values to properties in QML, any layouting the item 
        must do as a result of the assignment might not take effect immediately, 
        but can instead be postponed until the item is polished. For these cases, 
        you can use this function to ensure that the item has been polished 
        before the execution of the test continues. For example: 
 
        \code 
            verify(isPolishScheduled(item)) 
            verify(waitForItemPolished(item)) 
        \endcode 
 
        Without the call to \c isPolishScheduled() above, the 
        call to \c waitForItemPolished() might see that no polish 
        was scheduled and therefore pass instantly, assuming that 
        the item had already been polished. This function 
        makes it obvious why an item wasn't polished and allows tests to 
        fail early under such circumstances. 
 
        \sa waitForItemPolished(), QQuickItem::polish(), QQuickItem::updatePolish() 
    */</span>
    <span class="s2">function </span><span class="s1">isPolishScheduled</span><span class="s4">(</span><span class="s1">item</span><span class="s4">) {</span>
        <span class="s2">if </span><span class="s4">(!</span><span class="s1">item </span><span class="s4">|| </span><span class="s2">typeof </span><span class="s1">item </span><span class="s4">!== </span><span class="s6">&quot;object&quot;</span><span class="s4">) {</span>
            <span class="s1">qtest_results</span><span class="s4">.</span><span class="s1">fail</span><span class="s4">(</span><span class="s6">&quot;Argument must be a valid Item; actual type is &quot; </span><span class="s4">+ </span><span class="s2">typeof </span><span class="s1">item</span><span class="s4">,</span>
                <span class="s1">util</span><span class="s4">.</span><span class="s1">callerFile</span><span class="s4">(), </span><span class="s1">util</span><span class="s4">.</span><span class="s1">callerLine</span><span class="s4">())</span>
            <span class="s2">throw new </span><span class="s1">Error</span><span class="s4">(</span><span class="s6">&quot;QtQuickTest::fail&quot;</span><span class="s4">)</span>
        <span class="s4">}</span>

        <span class="s2">return </span><span class="s1">qtest_results</span><span class="s4">.</span><span class="s1">isPolishScheduled</span><span class="s4">(</span><span class="s1">item</span><span class="s4">)</span>
    <span class="s4">}</span>

    <span class="s5">/*! 
        \since 5.13 
        \qmlmethod bool waitForItemPolished(object item, int timeout = 5000) 
 
        Waits for \a timeout milliseconds or until 
        \l {QQuickItem::}{updatePolish()} has been called on \a item. 
 
        Returns \c true if \c updatePolish() was called on \a item within 
        \a timeout milliseconds, otherwise returns \c false. 
 
        \sa isPolishScheduled(), QQuickItem::polish(), QQuickItem::updatePolish() 
    */</span>
    <span class="s2">function </span><span class="s1">waitForItemPolished</span><span class="s4">(</span><span class="s1">item</span><span class="s4">, </span><span class="s1">timeout</span><span class="s4">) {</span>
        <span class="s2">if </span><span class="s4">(!</span><span class="s1">item </span><span class="s4">|| </span><span class="s2">typeof </span><span class="s1">item </span><span class="s4">!== </span><span class="s6">&quot;object&quot;</span><span class="s4">) {</span>
            <span class="s1">qtest_results</span><span class="s4">.</span><span class="s1">fail</span><span class="s4">(</span><span class="s6">&quot;First argument must be a valid Item; actual type is &quot; </span><span class="s4">+ </span><span class="s2">typeof </span><span class="s1">item</span><span class="s4">,</span>
                <span class="s1">util</span><span class="s4">.</span><span class="s1">callerFile</span><span class="s4">(), </span><span class="s1">util</span><span class="s4">.</span><span class="s1">callerLine</span><span class="s4">())</span>
            <span class="s2">throw new </span><span class="s1">Error</span><span class="s4">(</span><span class="s6">&quot;QtQuickTest::fail&quot;</span><span class="s4">)</span>
        <span class="s4">}</span>

        <span class="s2">if </span><span class="s4">(</span><span class="s1">timeout </span><span class="s4">!== </span><span class="s1">undefined </span><span class="s4">&amp;&amp; </span><span class="s2">typeof</span><span class="s4">(</span><span class="s1">timeout</span><span class="s4">) != </span><span class="s6">&quot;number&quot;</span><span class="s4">) {</span>
            <span class="s1">qtest_results</span><span class="s4">.</span><span class="s1">fail</span><span class="s4">(</span><span class="s6">&quot;Second argument must be a number; actual type is &quot; </span><span class="s4">+ </span><span class="s2">typeof </span><span class="s1">timeout</span><span class="s4">,</span>
                <span class="s1">util</span><span class="s4">.</span><span class="s1">callerFile</span><span class="s4">(), </span><span class="s1">util</span><span class="s4">.</span><span class="s1">callerLine</span><span class="s4">())</span>
            <span class="s2">throw new </span><span class="s1">Error</span><span class="s4">(</span><span class="s6">&quot;QtQuickTest::fail&quot;</span><span class="s4">)</span>
        <span class="s4">}</span>

        <span class="s2">if </span><span class="s4">(!</span><span class="s1">timeout</span><span class="s4">)</span>
            <span class="s1">timeout </span><span class="s4">= </span><span class="s3">5000</span>

        <span class="s2">return </span><span class="s1">qtest_results</span><span class="s4">.</span><span class="s1">waitForItemPolished</span><span class="s4">(</span><span class="s1">item</span><span class="s4">, </span><span class="s1">timeout</span><span class="s4">)</span>
    <span class="s4">}</span>

    <span class="s5">/*! 
        \since 5.9 
        \qmlmethod object TestCase::createTemporaryQmlObject(string qml, object parent, string filePath) 
 
        This function dynamically creates a QML object from the given \a qml 
        string with the specified \a parent. The returned object will be 
        destroyed (if it was not already) after \l cleanup() has finished 
        executing, meaning that objects created with this function are 
        guaranteed to be destroyed after each test, regardless of whether or 
        not the tests fail. 
 
        If there was an error while creating the object, \c null will be 
        returned. 
 
        If \a filePath is specified, it will be used for error reporting for 
        the created object. 
 
        This function calls 
        \l {QtQml::Qt::createQmlObject()}{Qt.createQmlObject()} internally. 
 
        \sa {Managing Dynamically Created Test Objects} 
    */</span>
    <span class="s2">function </span><span class="s1">createTemporaryQmlObject</span><span class="s4">(</span><span class="s1">qml</span><span class="s4">, </span><span class="s1">parent</span><span class="s4">, </span><span class="s1">filePath</span><span class="s4">) {</span>
        <span class="s2">if </span><span class="s4">(</span><span class="s2">typeof </span><span class="s1">qml </span><span class="s4">!== </span><span class="s6">&quot;string&quot;</span><span class="s4">) {</span>
            <span class="s1">qtest_results</span><span class="s4">.</span><span class="s1">fail</span><span class="s4">(</span><span class="s6">&quot;First argument must be a string of QML; actual type is &quot; </span><span class="s4">+ </span><span class="s2">typeof </span><span class="s1">qml</span><span class="s4">,</span>
                <span class="s1">util</span><span class="s4">.</span><span class="s1">callerFile</span><span class="s4">(), </span><span class="s1">util</span><span class="s4">.</span><span class="s1">callerLine</span><span class="s4">());</span>
            <span class="s2">throw new </span><span class="s1">Error</span><span class="s4">(</span><span class="s6">&quot;QtQuickTest::fail&quot;</span><span class="s4">);</span>
        <span class="s4">}</span>

        <span class="s2">if </span><span class="s4">(!</span><span class="s1">parent </span><span class="s4">|| </span><span class="s2">typeof </span><span class="s1">parent </span><span class="s4">!== </span><span class="s6">&quot;object&quot;</span><span class="s4">) {</span>
            <span class="s1">qtest_results</span><span class="s4">.</span><span class="s1">fail</span><span class="s4">(</span><span class="s6">&quot;Second argument must be a valid parent object; actual type is &quot; </span><span class="s4">+ </span><span class="s2">typeof </span><span class="s1">parent</span><span class="s4">,</span>
                <span class="s1">util</span><span class="s4">.</span><span class="s1">callerFile</span><span class="s4">(), </span><span class="s1">util</span><span class="s4">.</span><span class="s1">callerLine</span><span class="s4">());</span>
            <span class="s2">throw new </span><span class="s1">Error</span><span class="s4">(</span><span class="s6">&quot;QtQuickTest::fail&quot;</span><span class="s4">);</span>
        <span class="s4">}</span>

        <span class="s2">if </span><span class="s4">(</span><span class="s1">filePath </span><span class="s4">!== </span><span class="s1">undefined </span><span class="s4">&amp;&amp; </span><span class="s2">typeof </span><span class="s1">filePath </span><span class="s4">!== </span><span class="s6">&quot;string&quot;</span><span class="s4">) {</span>
            <span class="s1">qtest_results</span><span class="s4">.</span><span class="s1">fail</span><span class="s4">(</span><span class="s6">&quot;Third argument must be a file path string; actual type is &quot; </span><span class="s4">+ </span><span class="s2">typeof </span><span class="s1">filePath</span><span class="s4">,</span>
                <span class="s1">util</span><span class="s4">.</span><span class="s1">callerFile</span><span class="s4">(), </span><span class="s1">util</span><span class="s4">.</span><span class="s1">callerLine</span><span class="s4">());</span>
            <span class="s2">throw new </span><span class="s1">Error</span><span class="s4">(</span><span class="s6">&quot;QtQuickTest::fail&quot;</span><span class="s4">);</span>
        <span class="s4">}</span>

        <span class="s2">var </span><span class="s1">object </span><span class="s4">= </span><span class="s1">Qt</span><span class="s4">.</span><span class="s1">createQmlObject</span><span class="s4">(</span><span class="s1">qml</span><span class="s4">, </span><span class="s1">parent</span><span class="s4">, </span><span class="s1">filePath</span><span class="s4">);</span>
        <span class="s1">qtest_temporaryObjects</span><span class="s4">.</span><span class="s1">push</span><span class="s4">(</span><span class="s1">object</span><span class="s4">);</span>
        <span class="s2">return </span><span class="s1">object</span><span class="s4">;</span>
    <span class="s4">}</span>

    <span class="s5">/*! 
        \since 5.9 
        \qmlmethod object TestCase::createTemporaryObject(Component component, object parent, object properties) 
 
        This function dynamically creates a QML object from the given 
        \a component with the specified optional \a parent and \a properties. 
        The returned object will be destroyed (if it was not already) after 
        \l cleanup() has finished executing, meaning that objects created with 
        this function are guaranteed to be destroyed after each test, 
        regardless of whether or not the tests fail. 
 
        If there was an error while creating the object, \c null will be 
        returned. 
 
        This function calls 
        \l {QtQml::Component::createObject()}{component.createObject()} 
        internally. 
 
        \sa {Managing Dynamically Created Test Objects} 
    */</span>
    <span class="s2">function </span><span class="s1">createTemporaryObject</span><span class="s4">(</span><span class="s1">component</span><span class="s4">, </span><span class="s1">parent</span><span class="s4">, </span><span class="s1">properties</span><span class="s4">) {</span>
        <span class="s2">if </span><span class="s4">(</span><span class="s2">typeof </span><span class="s1">component </span><span class="s4">!== </span><span class="s6">&quot;object&quot;</span><span class="s4">) {</span>
            <span class="s1">qtest_results</span><span class="s4">.</span><span class="s1">fail</span><span class="s4">(</span><span class="s6">&quot;First argument must be a Component; actual type is &quot; </span><span class="s4">+ </span><span class="s2">typeof </span><span class="s1">component</span><span class="s4">,</span>
                <span class="s1">util</span><span class="s4">.</span><span class="s1">callerFile</span><span class="s4">(), </span><span class="s1">util</span><span class="s4">.</span><span class="s1">callerLine</span><span class="s4">());</span>
            <span class="s2">throw new </span><span class="s1">Error</span><span class="s4">(</span><span class="s6">&quot;QtQuickTest::fail&quot;</span><span class="s4">);</span>
        <span class="s4">}</span>

        <span class="s2">if </span><span class="s4">(</span><span class="s1">properties </span><span class="s4">&amp;&amp; </span><span class="s2">typeof </span><span class="s1">properties </span><span class="s4">!== </span><span class="s6">&quot;object&quot;</span><span class="s4">) {</span>
            <span class="s1">qtest_results</span><span class="s4">.</span><span class="s1">fail</span><span class="s4">(</span><span class="s6">&quot;Third argument must be an object; actual type is &quot; </span><span class="s4">+ </span><span class="s2">typeof </span><span class="s1">properties</span><span class="s4">,</span>
                <span class="s1">util</span><span class="s4">.</span><span class="s1">callerFile</span><span class="s4">(), </span><span class="s1">util</span><span class="s4">.</span><span class="s1">callerLine</span><span class="s4">());</span>
            <span class="s2">throw new </span><span class="s1">Error</span><span class="s4">(</span><span class="s6">&quot;QtQuickTest::fail&quot;</span><span class="s4">);</span>
        <span class="s4">}</span>

        <span class="s2">var </span><span class="s1">object </span><span class="s4">= </span><span class="s1">component</span><span class="s4">.</span><span class="s1">createObject</span><span class="s4">(</span><span class="s1">parent</span><span class="s4">, </span><span class="s1">properties </span><span class="s4">? </span><span class="s1">properties </span><span class="s4">: ({}));</span>
        <span class="s1">qtest_temporaryObjects</span><span class="s4">.</span><span class="s1">push</span><span class="s4">(</span><span class="s1">object</span><span class="s4">);</span>
        <span class="s2">return </span><span class="s1">object</span><span class="s4">;</span>
    <span class="s4">}</span>

    <span class="s5">/*! 
        \internal 
 
        Destroys all temporary objects that still exist. 
    */</span>
    <span class="s2">function </span><span class="s1">qtest_destroyTemporaryObjects</span><span class="s4">() {</span>
        <span class="s2">for </span><span class="s4">(</span><span class="s2">var </span><span class="s1">i </span><span class="s4">= </span><span class="s3">0</span><span class="s4">; </span><span class="s1">i </span><span class="s4">&lt; </span><span class="s1">qtest_temporaryObjects</span><span class="s4">.</span><span class="s1">length</span><span class="s4">; ++</span><span class="s1">i</span><span class="s4">) {</span>
            <span class="s2">var </span><span class="s1">temporaryObject </span><span class="s4">= </span><span class="s1">qtest_temporaryObjects</span><span class="s4">[</span><span class="s1">i</span><span class="s4">];</span>
            <span class="s5">// ### the typeof check can be removed when QTBUG-57749 is fixed</span>
            <span class="s2">if </span><span class="s4">(</span><span class="s1">temporaryObject </span><span class="s4">&amp;&amp; </span><span class="s2">typeof </span><span class="s1">temporaryObject</span><span class="s4">.</span><span class="s1">destroy </span><span class="s4">=== </span><span class="s6">&quot;function&quot;</span><span class="s4">)</span>
                <span class="s1">temporaryObject</span><span class="s4">.</span><span class="s1">destroy</span><span class="s4">();</span>
        <span class="s4">}</span>
        <span class="s1">qtest_temporaryObjects </span><span class="s4">= [];</span>
    <span class="s4">}</span>

    <span class="s5">/*! \internal */</span>
    <span class="s5">// Determine what is o.</span>
    <span class="s5">// Discussions and reference: http://philrathe.com/articles/equiv</span>
    <span class="s5">// Test suites: http://philrathe.com/tests/equiv</span>
    <span class="s5">// Author: Philippe Rath√© &lt;prathe@gmail.com&gt;</span>
    <span class="s2">function </span><span class="s1">qtest_typeof</span><span class="s4">(</span><span class="s1">o</span><span class="s4">) {</span>
        <span class="s2">if </span><span class="s4">(</span><span class="s2">typeof </span><span class="s1">o </span><span class="s4">=== </span><span class="s6">&quot;undefined&quot;</span><span class="s4">) {</span>
            <span class="s2">return </span><span class="s6">&quot;undefined&quot;</span><span class="s4">;</span>

        <span class="s5">// consider: typeof null === object</span>
        <span class="s4">} </span><span class="s2">else if </span><span class="s4">(</span><span class="s1">o </span><span class="s4">=== </span><span class="s2">null</span><span class="s4">) {</span>
            <span class="s2">return </span><span class="s6">&quot;null&quot;</span><span class="s4">;</span>

        <span class="s4">} </span><span class="s2">else if </span><span class="s4">(</span><span class="s1">o</span><span class="s4">.</span><span class="s1">constructor </span><span class="s4">=== </span><span class="s1">String</span><span class="s4">) {</span>
            <span class="s2">return </span><span class="s6">&quot;string&quot;</span><span class="s4">;</span>

        <span class="s4">} </span><span class="s2">else if </span><span class="s4">(</span><span class="s1">o</span><span class="s4">.</span><span class="s1">constructor </span><span class="s4">=== </span><span class="s1">Boolean</span><span class="s4">) {</span>
            <span class="s2">return </span><span class="s6">&quot;boolean&quot;</span><span class="s4">;</span>

        <span class="s4">} </span><span class="s2">else if </span><span class="s4">(</span><span class="s1">o</span><span class="s4">.</span><span class="s1">constructor </span><span class="s4">=== </span><span class="s1">Number</span><span class="s4">) {</span>

            <span class="s2">if </span><span class="s4">(</span><span class="s1">isNaN</span><span class="s4">(</span><span class="s1">o</span><span class="s4">)) {</span>
                <span class="s2">return </span><span class="s6">&quot;nan&quot;</span><span class="s4">;</span>
            <span class="s4">} </span><span class="s2">else </span><span class="s4">{</span>
                <span class="s2">return </span><span class="s6">&quot;number&quot;</span><span class="s4">;</span>
            <span class="s4">}</span>
        <span class="s5">// consider: typeof [] === object</span>
        <span class="s4">} </span><span class="s2">else if </span><span class="s4">(</span><span class="s1">o </span><span class="s2">instanceof </span><span class="s1">Array</span><span class="s4">) {</span>
            <span class="s2">return </span><span class="s6">&quot;array&quot;</span><span class="s4">;</span>

        <span class="s5">// consider: typeof new Date() === object</span>
        <span class="s4">} </span><span class="s2">else if </span><span class="s4">(</span><span class="s1">o </span><span class="s2">instanceof </span><span class="s1">Date</span><span class="s4">) {</span>
            <span class="s2">return </span><span class="s6">&quot;date&quot;</span><span class="s4">;</span>

        <span class="s5">// consider: /./ instanceof Object;</span>
        <span class="s5">//           /./ instanceof RegExp;</span>
        <span class="s5">//          typeof /./ === &quot;function&quot;; // =&gt; false in IE and Opera,</span>
        <span class="s5">//                                          true in FF and Safari</span>
        <span class="s4">} </span><span class="s2">else if </span><span class="s4">(</span><span class="s1">o </span><span class="s2">instanceof </span><span class="s1">RegExp</span><span class="s4">) {</span>
            <span class="s2">return </span><span class="s6">&quot;regexp&quot;</span><span class="s4">;</span>

        <span class="s4">} </span><span class="s2">else if </span><span class="s4">(</span><span class="s2">typeof </span><span class="s1">o </span><span class="s4">=== </span><span class="s6">&quot;object&quot;</span><span class="s4">) {</span>
            <span class="s2">if </span><span class="s4">(</span><span class="s6">&quot;mapFromItem&quot; </span><span class="s2">in </span><span class="s1">o </span><span class="s4">&amp;&amp; </span><span class="s6">&quot;mapToItem&quot; </span><span class="s2">in </span><span class="s1">o</span><span class="s4">) {</span>
                <span class="s2">return </span><span class="s6">&quot;declarativeitem&quot;</span><span class="s4">;  </span><span class="s5">// @todo improve detection of declarative items</span>
            <span class="s4">} </span><span class="s2">else if </span><span class="s4">(</span><span class="s6">&quot;x&quot; </span><span class="s2">in </span><span class="s1">o </span><span class="s4">&amp;&amp; </span><span class="s6">&quot;y&quot; </span><span class="s2">in </span><span class="s1">o </span><span class="s4">&amp;&amp; </span><span class="s6">&quot;z&quot; </span><span class="s2">in </span><span class="s1">o</span><span class="s4">) {</span>
                <span class="s2">return </span><span class="s6">&quot;vector3d&quot;</span><span class="s4">; </span><span class="s5">// Qt 3D vector</span>
            <span class="s4">}</span>
            <span class="s2">return </span><span class="s6">&quot;object&quot;</span><span class="s4">;</span>
        <span class="s4">} </span><span class="s2">else if </span><span class="s4">(</span><span class="s1">o </span><span class="s2">instanceof </span><span class="s1">Function</span><span class="s4">) {</span>
            <span class="s2">return </span><span class="s6">&quot;function&quot;</span><span class="s4">;</span>
        <span class="s4">} </span><span class="s2">else </span><span class="s4">{</span>
            <span class="s2">return </span><span class="s1">undefined</span><span class="s4">;</span>
        <span class="s4">}</span>
    <span class="s4">}</span>

    <span class="s5">/*! \internal */</span>
    <span class="s5">// Test for equality</span>
    <span class="s5">// Large parts contain sources from QUnit or http://philrathe.com</span>
    <span class="s5">// Discussions and reference: http://philrathe.com/articles/equiv</span>
    <span class="s5">// Test suites: http://philrathe.com/tests/equiv</span>
    <span class="s5">// Author: Philippe Rath√© &lt;prathe@gmail.com&gt;</span>
    <span class="s2">function </span><span class="s1">qtest_compareInternal</span><span class="s4">(</span><span class="s1">act</span><span class="s4">, </span><span class="s1">exp</span><span class="s4">) {</span>
        <span class="s2">var </span><span class="s1">success </span><span class="s4">= </span><span class="s2">false</span><span class="s4">;</span>
        <span class="s2">if </span><span class="s4">(</span><span class="s1">act </span><span class="s4">=== </span><span class="s1">exp</span><span class="s4">) {</span>
            <span class="s1">success </span><span class="s4">= </span><span class="s2">true</span><span class="s4">; </span><span class="s5">// catch the most you can</span>
        <span class="s4">} </span><span class="s2">else if </span><span class="s4">(</span><span class="s1">act </span><span class="s4">=== </span><span class="s2">null </span><span class="s4">|| </span><span class="s1">exp </span><span class="s4">=== </span><span class="s2">null </span><span class="s4">|| </span><span class="s2">typeof </span><span class="s1">act </span><span class="s4">=== </span><span class="s6">&quot;undefined&quot; </span><span class="s4">|| </span><span class="s2">typeof </span><span class="s1">exp </span><span class="s4">=== </span><span class="s6">&quot;undefined&quot;</span><span class="s4">) {</span>
            <span class="s1">success </span><span class="s4">= </span><span class="s2">false</span><span class="s4">; </span><span class="s5">// don't lose time with error prone cases</span>
        <span class="s4">} </span><span class="s2">else </span><span class="s4">{</span>
            <span class="s2">var </span><span class="s1">typeExp </span><span class="s4">= </span><span class="s1">qtest_typeof</span><span class="s4">(</span><span class="s1">exp</span><span class="s4">), </span><span class="s1">typeAct </span><span class="s4">= </span><span class="s1">qtest_typeof</span><span class="s4">(</span><span class="s1">act</span><span class="s4">)</span>
            <span class="s2">if </span><span class="s4">(</span><span class="s1">typeExp </span><span class="s4">!== </span><span class="s1">typeAct</span><span class="s4">) {</span>
                <span class="s5">// allow object vs string comparison (e.g. for colors)</span>
                <span class="s5">// else break on different types</span>
                <span class="s2">if </span><span class="s4">((</span><span class="s1">typeExp </span><span class="s4">=== </span><span class="s6">&quot;string&quot; </span><span class="s4">&amp;&amp; (</span><span class="s1">typeAct </span><span class="s4">=== </span><span class="s6">&quot;object&quot;</span><span class="s4">) || </span><span class="s1">typeAct </span><span class="s4">== </span><span class="s6">&quot;declarativeitem&quot;</span><span class="s4">)</span>
                 <span class="s4">|| ((</span><span class="s1">typeExp </span><span class="s4">=== </span><span class="s6">&quot;object&quot; </span><span class="s4">|| </span><span class="s1">typeExp </span><span class="s4">== </span><span class="s6">&quot;declarativeitem&quot;</span><span class="s4">) &amp;&amp; </span><span class="s1">typeAct </span><span class="s4">=== </span><span class="s6">&quot;string&quot;</span><span class="s4">)) {</span>
                    <span class="s1">success </span><span class="s4">= (</span><span class="s1">act </span><span class="s4">== </span><span class="s1">exp</span><span class="s4">)</span>
                <span class="s4">}</span>
            <span class="s4">} </span><span class="s2">else if </span><span class="s4">(</span><span class="s1">typeExp </span><span class="s4">=== </span><span class="s6">&quot;string&quot; </span><span class="s4">|| </span><span class="s1">typeExp </span><span class="s4">=== </span><span class="s6">&quot;boolean&quot; </span><span class="s4">||</span>
                       <span class="s1">typeExp </span><span class="s4">=== </span><span class="s6">&quot;null&quot; </span><span class="s4">|| </span><span class="s1">typeExp </span><span class="s4">=== </span><span class="s6">&quot;undefined&quot;</span><span class="s4">) {</span>
                <span class="s2">if </span><span class="s4">(</span><span class="s1">exp </span><span class="s2">instanceof </span><span class="s1">act</span><span class="s4">.</span><span class="s1">constructor </span><span class="s4">|| </span><span class="s1">act </span><span class="s2">instanceof </span><span class="s1">exp</span><span class="s4">.</span><span class="s1">constructor</span><span class="s4">) {</span>
                    <span class="s5">// to catch short annotaion VS 'new' annotation of act declaration</span>
                    <span class="s5">// e.g. var i = 1;</span>
                    <span class="s5">//      var j = new Number(1);</span>
                    <span class="s1">success </span><span class="s4">= (</span><span class="s1">act </span><span class="s4">== </span><span class="s1">exp</span><span class="s4">)</span>
                <span class="s4">} </span><span class="s2">else </span><span class="s4">{</span>
                    <span class="s1">success </span><span class="s4">= (</span><span class="s1">act </span><span class="s4">=== </span><span class="s1">exp</span><span class="s4">)</span>
                <span class="s4">}</span>
            <span class="s4">} </span><span class="s2">else if </span><span class="s4">(</span><span class="s1">typeExp </span><span class="s4">=== </span><span class="s6">&quot;nan&quot;</span><span class="s4">) {</span>
                <span class="s1">success </span><span class="s4">= </span><span class="s1">isNaN</span><span class="s4">(</span><span class="s1">act</span><span class="s4">);</span>
            <span class="s4">} </span><span class="s2">else if </span><span class="s4">(</span><span class="s1">typeExp </span><span class="s4">=== </span><span class="s6">&quot;number&quot;</span><span class="s4">) {</span>
                <span class="s5">// Use act fuzzy compare if the two values are floats</span>
                <span class="s2">if </span><span class="s4">(</span><span class="s1">Math</span><span class="s4">.</span><span class="s1">abs</span><span class="s4">(</span><span class="s1">act </span><span class="s4">- </span><span class="s1">exp</span><span class="s4">) &lt;= </span><span class="s3">0.00001</span><span class="s4">) {</span>
                    <span class="s1">success </span><span class="s4">= </span><span class="s2">true</span>
                <span class="s4">}</span>
            <span class="s4">} </span><span class="s2">else if </span><span class="s4">(</span><span class="s1">typeExp </span><span class="s4">=== </span><span class="s6">&quot;array&quot;</span><span class="s4">) {</span>
                <span class="s1">success </span><span class="s4">= </span><span class="s1">qtest_compareInternalArrays</span><span class="s4">(</span><span class="s1">act</span><span class="s4">, </span><span class="s1">exp</span><span class="s4">)</span>
            <span class="s4">} </span><span class="s2">else if </span><span class="s4">(</span><span class="s1">typeExp </span><span class="s4">=== </span><span class="s6">&quot;object&quot;</span><span class="s4">) {</span>
                <span class="s1">success </span><span class="s4">= </span><span class="s1">qtest_compareInternalObjects</span><span class="s4">(</span><span class="s1">act</span><span class="s4">, </span><span class="s1">exp</span><span class="s4">)</span>
            <span class="s4">} </span><span class="s2">else if </span><span class="s4">(</span><span class="s1">typeExp </span><span class="s4">=== </span><span class="s6">&quot;declarativeitem&quot;</span><span class="s4">) {</span>
                <span class="s1">success </span><span class="s4">= </span><span class="s1">qtest_compareInternalObjects</span><span class="s4">(</span><span class="s1">act</span><span class="s4">, </span><span class="s1">exp</span><span class="s4">) </span><span class="s5">// @todo improve comparison of declarative items</span>
            <span class="s4">} </span><span class="s2">else if </span><span class="s4">(</span><span class="s1">typeExp </span><span class="s4">=== </span><span class="s6">&quot;vector3d&quot;</span><span class="s4">) {</span>
                <span class="s1">success </span><span class="s4">= (</span><span class="s1">Math</span><span class="s4">.</span><span class="s1">abs</span><span class="s4">(</span><span class="s1">act</span><span class="s4">.</span><span class="s1">x </span><span class="s4">- </span><span class="s1">exp</span><span class="s4">.</span><span class="s1">x</span><span class="s4">) &lt;= </span><span class="s3">0.00001 </span><span class="s4">&amp;&amp;</span>
                           <span class="s1">Math</span><span class="s4">.</span><span class="s1">abs</span><span class="s4">(</span><span class="s1">act</span><span class="s4">.</span><span class="s1">y </span><span class="s4">- </span><span class="s1">exp</span><span class="s4">.</span><span class="s1">y</span><span class="s4">) &lt;= </span><span class="s3">0.00001 </span><span class="s4">&amp;&amp;</span>
                           <span class="s1">Math</span><span class="s4">.</span><span class="s1">abs</span><span class="s4">(</span><span class="s1">act</span><span class="s4">.</span><span class="s1">z </span><span class="s4">- </span><span class="s1">exp</span><span class="s4">.</span><span class="s1">z</span><span class="s4">) &lt;= </span><span class="s3">0.00001</span><span class="s4">)</span>
            <span class="s4">} </span><span class="s2">else if </span><span class="s4">(</span><span class="s1">typeExp </span><span class="s4">=== </span><span class="s6">&quot;date&quot;</span><span class="s4">) {</span>
                <span class="s1">success </span><span class="s4">= (</span><span class="s1">act</span><span class="s4">.</span><span class="s1">valueOf</span><span class="s4">() === </span><span class="s1">exp</span><span class="s4">.</span><span class="s1">valueOf</span><span class="s4">())</span>
            <span class="s4">} </span><span class="s2">else if </span><span class="s4">(</span><span class="s1">typeExp </span><span class="s4">=== </span><span class="s6">&quot;regexp&quot;</span><span class="s4">) {</span>
                <span class="s1">success </span><span class="s4">= (</span><span class="s1">act</span><span class="s4">.</span><span class="s1">source </span><span class="s4">=== </span><span class="s1">exp</span><span class="s4">.</span><span class="s1">source </span><span class="s4">&amp;&amp; </span><span class="s5">// the regex itself</span>
                           <span class="s1">act</span><span class="s4">.</span><span class="s1">global </span><span class="s4">=== </span><span class="s1">exp</span><span class="s4">.</span><span class="s1">global </span><span class="s4">&amp;&amp; </span><span class="s5">// and its modifers (gmi) ...</span>
                           <span class="s1">act</span><span class="s4">.</span><span class="s1">ignoreCase </span><span class="s4">=== </span><span class="s1">exp</span><span class="s4">.</span><span class="s1">ignoreCase </span><span class="s4">&amp;&amp;</span>
                           <span class="s1">act</span><span class="s4">.</span><span class="s1">multiline </span><span class="s4">=== </span><span class="s1">exp</span><span class="s4">.</span><span class="s1">multiline</span><span class="s4">)</span>
            <span class="s4">}</span>
        <span class="s4">}</span>
        <span class="s2">return </span><span class="s1">success</span>
    <span class="s4">}</span>

    <span class="s5">/*! \internal */</span>
    <span class="s2">function </span><span class="s1">qtest_compareInternalObjects</span><span class="s4">(</span><span class="s1">act</span><span class="s4">, </span><span class="s1">exp</span><span class="s4">) {</span>
        <span class="s2">var </span><span class="s1">i</span><span class="s4">;</span>
        <span class="s2">var </span><span class="s1">eq </span><span class="s4">= </span><span class="s2">true</span><span class="s4">; </span><span class="s5">// unless we can proove it</span>
        <span class="s2">var </span><span class="s1">aProperties </span><span class="s4">= [], </span><span class="s1">bProperties </span><span class="s4">= []; </span><span class="s5">// collection of strings</span>

        <span class="s5">// comparing constructors is more strict than using instanceof</span>
        <span class="s2">if </span><span class="s4">(</span><span class="s1">act</span><span class="s4">.</span><span class="s1">constructor </span><span class="s4">!== </span><span class="s1">exp</span><span class="s4">.</span><span class="s1">constructor</span><span class="s4">) {</span>
            <span class="s2">return false</span><span class="s4">;</span>
        <span class="s4">}</span>

        <span class="s2">for </span><span class="s4">(</span><span class="s1">i </span><span class="s2">in </span><span class="s1">act</span><span class="s4">) { </span><span class="s5">// be strict: don't ensures hasOwnProperty and go deep</span>
            <span class="s1">aProperties</span><span class="s4">.</span><span class="s1">push</span><span class="s4">(</span><span class="s1">i</span><span class="s4">); </span><span class="s5">// collect act's properties</span>
            <span class="s2">if </span><span class="s4">(!</span><span class="s1">qtest_compareInternal</span><span class="s4">(</span><span class="s1">act</span><span class="s4">[</span><span class="s1">i</span><span class="s4">], </span><span class="s1">exp</span><span class="s4">[</span><span class="s1">i</span><span class="s4">])) {</span>
                <span class="s1">eq </span><span class="s4">= </span><span class="s2">false</span><span class="s4">;</span>
                <span class="s2">break</span><span class="s4">;</span>
            <span class="s4">}</span>
        <span class="s4">}</span>

        <span class="s2">for </span><span class="s4">(</span><span class="s1">i </span><span class="s2">in </span><span class="s1">exp</span><span class="s4">) {</span>
            <span class="s1">bProperties</span><span class="s4">.</span><span class="s1">push</span><span class="s4">(</span><span class="s1">i</span><span class="s4">); </span><span class="s5">// collect exp's properties</span>
        <span class="s4">}</span>

        <span class="s2">if </span><span class="s4">(</span><span class="s1">aProperties</span><span class="s4">.</span><span class="s1">length </span><span class="s4">== </span><span class="s3">0 </span><span class="s4">&amp;&amp; </span><span class="s1">bProperties</span><span class="s4">.</span><span class="s1">length </span><span class="s4">== </span><span class="s3">0</span><span class="s4">) { </span><span class="s5">// at least a special case for QUrl</span>
            <span class="s2">return </span><span class="s1">eq </span><span class="s4">&amp;&amp; (</span><span class="s1">JSON</span><span class="s4">.</span><span class="s1">stringify</span><span class="s4">(</span><span class="s1">act</span><span class="s4">) == </span><span class="s1">JSON</span><span class="s4">.</span><span class="s1">stringify</span><span class="s4">(</span><span class="s1">exp</span><span class="s4">));</span>
        <span class="s4">}</span>

        <span class="s5">// Ensures identical properties name</span>
        <span class="s2">return </span><span class="s1">eq </span><span class="s4">&amp;&amp; </span><span class="s1">qtest_compareInternal</span><span class="s4">(</span><span class="s1">aProperties</span><span class="s4">.</span><span class="s1">sort</span><span class="s4">(), </span><span class="s1">bProperties</span><span class="s4">.</span><span class="s1">sort</span><span class="s4">());</span>

    <span class="s4">}</span>

    <span class="s5">/*! \internal */</span>
    <span class="s2">function </span><span class="s1">qtest_compareInternalArrays</span><span class="s4">(</span><span class="s1">actual</span><span class="s4">, </span><span class="s1">expected</span><span class="s4">) {</span>
        <span class="s2">if </span><span class="s4">(</span><span class="s1">actual</span><span class="s4">.</span><span class="s1">length </span><span class="s4">!= </span><span class="s1">expected</span><span class="s4">.</span><span class="s1">length</span><span class="s4">) {</span>
            <span class="s2">return false</span>
        <span class="s4">}</span>

        <span class="s2">for </span><span class="s4">(</span><span class="s2">var </span><span class="s1">i </span><span class="s4">= </span><span class="s3">0</span><span class="s4">, </span><span class="s1">len </span><span class="s4">= </span><span class="s1">actual</span><span class="s4">.</span><span class="s1">length</span><span class="s4">; </span><span class="s1">i </span><span class="s4">&lt; </span><span class="s1">len</span><span class="s4">; </span><span class="s1">i</span><span class="s4">++) {</span>
            <span class="s2">if </span><span class="s4">(!</span><span class="s1">qtest_compareInternal</span><span class="s4">(</span><span class="s1">actual</span><span class="s4">[</span><span class="s1">i</span><span class="s4">], </span><span class="s1">expected</span><span class="s4">[</span><span class="s1">i</span><span class="s4">])) {</span>
                <span class="s2">return false</span>
            <span class="s4">}</span>
        <span class="s4">}</span>

        <span class="s2">return true</span>
    <span class="s4">}</span>

    <span class="s5">/*! 
        \qmlmethod TestCase::compare(actual, expected, message = &quot;&quot;) 
 
        Fails the current test case if \a actual is not the same as 
        \a expected, and displays the optional \a message.  Similar 
        to \c{QCOMPARE(actual, expected)} in C++. 
 
        \sa tryCompare(), fuzzyCompare 
    */</span>
    <span class="s2">function </span><span class="s1">compare</span><span class="s4">(</span><span class="s1">actual</span><span class="s4">, </span><span class="s1">expected</span><span class="s4">, </span><span class="s1">msg</span><span class="s4">) {</span>
        <span class="s2">var </span><span class="s1">act </span><span class="s4">= </span><span class="s1">qtest_results</span><span class="s4">.</span><span class="s1">stringify</span><span class="s4">(</span><span class="s1">actual</span><span class="s4">)</span>
        <span class="s2">var </span><span class="s1">exp </span><span class="s4">= </span><span class="s1">qtest_results</span><span class="s4">.</span><span class="s1">stringify</span><span class="s4">(</span><span class="s1">expected</span><span class="s4">)</span>

        <span class="s2">var </span><span class="s1">success </span><span class="s4">= </span><span class="s1">qtest_compareInternal</span><span class="s4">(</span><span class="s1">actual</span><span class="s4">, </span><span class="s1">expected</span><span class="s4">)</span>
        <span class="s2">if </span><span class="s4">(</span><span class="s1">msg </span><span class="s4">=== </span><span class="s1">undefined</span><span class="s4">) {</span>
            <span class="s2">if </span><span class="s4">(</span><span class="s1">success</span><span class="s4">)</span>
                <span class="s1">msg </span><span class="s4">= </span><span class="s6">&quot;COMPARE()&quot;</span>
            <span class="s2">else</span>
                <span class="s1">msg </span><span class="s4">= </span><span class="s6">&quot;Compared values are not the same&quot;</span>
        <span class="s4">}</span>
        <span class="s2">if </span><span class="s4">(!</span><span class="s1">qtest_results</span><span class="s4">.</span><span class="s1">compare</span><span class="s4">(</span><span class="s1">success</span><span class="s4">, </span><span class="s1">msg</span><span class="s4">, </span><span class="s1">act</span><span class="s4">, </span><span class="s1">exp</span><span class="s4">, </span><span class="s1">util</span><span class="s4">.</span><span class="s1">callerFile</span><span class="s4">(), </span><span class="s1">util</span><span class="s4">.</span><span class="s1">callerLine</span><span class="s4">())) {</span>
            <span class="s2">throw new </span><span class="s1">Error</span><span class="s4">(</span><span class="s6">&quot;QtQuickTest::fail&quot;</span><span class="s4">)</span>
        <span class="s4">}</span>
    <span class="s4">}</span>

    <span class="s5">/*! 
        \qmlmethod TestCase::fuzzyCompare(actual, expected, delta, message = &quot;&quot;) 
 
        Fails the current test case if the difference betwen \a actual and \a expected 
        is greater than \a delta, and displays the optional \a message.  Similar 
        to \c{qFuzzyCompare(actual, expected)} in C++ but with a required \a delta value. 
 
        This function can also be used for color comparisons if both the \a actual and 
        \a expected values can be converted into color values. If any of the differences 
        for RGBA channel values are greater than \a delta, the test fails. 
 
        \sa tryCompare(), compare() 
    */</span>
    <span class="s2">function </span><span class="s1">fuzzyCompare</span><span class="s4">(</span><span class="s1">actual</span><span class="s4">, </span><span class="s1">expected</span><span class="s4">, </span><span class="s1">delta</span><span class="s4">, </span><span class="s1">msg</span><span class="s4">) {</span>
        <span class="s2">if </span><span class="s4">(</span><span class="s1">delta </span><span class="s4">=== </span><span class="s1">undefined</span><span class="s4">)</span>
            <span class="s1">qtest_fail</span><span class="s4">(</span><span class="s6">&quot;A delta value is required for fuzzyCompare&quot;</span><span class="s4">, </span><span class="s3">2</span><span class="s4">)</span>

        <span class="s2">var </span><span class="s1">success </span><span class="s4">= </span><span class="s1">qtest_results</span><span class="s4">.</span><span class="s1">fuzzyCompare</span><span class="s4">(</span><span class="s1">actual</span><span class="s4">, </span><span class="s1">expected</span><span class="s4">, </span><span class="s1">delta</span><span class="s4">)</span>
        <span class="s2">if </span><span class="s4">(</span><span class="s1">msg </span><span class="s4">=== </span><span class="s1">undefined</span><span class="s4">) {</span>
            <span class="s2">if </span><span class="s4">(</span><span class="s1">success</span><span class="s4">)</span>
                <span class="s1">msg </span><span class="s4">= </span><span class="s6">&quot;FUZZYCOMPARE()&quot;</span>
            <span class="s2">else</span>
                <span class="s1">msg </span><span class="s4">= </span><span class="s6">&quot;Compared values are not the same with delta(&quot; </span><span class="s4">+ </span><span class="s1">delta </span><span class="s4">+ </span><span class="s6">&quot;)&quot;</span>
        <span class="s4">}</span>

        <span class="s2">if </span><span class="s4">(!</span><span class="s1">qtest_results</span><span class="s4">.</span><span class="s1">compare</span><span class="s4">(</span><span class="s1">success</span><span class="s4">, </span><span class="s1">msg</span><span class="s4">, </span><span class="s1">actual</span><span class="s4">, </span><span class="s1">expected</span><span class="s4">, </span><span class="s1">util</span><span class="s4">.</span><span class="s1">callerFile</span><span class="s4">(), </span><span class="s1">util</span><span class="s4">.</span><span class="s1">callerLine</span><span class="s4">())) {</span>
            <span class="s2">throw new </span><span class="s1">Error</span><span class="s4">(</span><span class="s6">&quot;QtQuickTest::fail&quot;</span><span class="s4">)</span>
        <span class="s4">}</span>
    <span class="s4">}</span>

    <span class="s5">/*! 
        \qmlmethod object TestCase::grabImage(item) 
 
        Returns a snapshot image object of the given \a item. 
 
        The returned image object has the following properties: 
        \list 
        \li width Returns the width of the underlying image (since 5.10) 
        \li height Returns the height of the underlying image (since 5.10) 
        \li size Returns the size of the underlying image (since 5.10) 
        \endlist 
 
        Additionally, the returned image object has the following methods: 
        \list 
        \li \c {red(x, y)} Returns the red channel value of the pixel at \e x, \e y position 
        \li \c {green(x, y)} Returns the green channel value of the pixel at \e x, \e y position 
        \li \c {blue(x, y)} Returns the blue channel value of the pixel at \e x, \e y position 
        \li \c {alpha(x, y)} Returns the alpha channel value of the pixel at \e x, \e y position 
        \li \c {pixel(x, y)} Returns the color value of the pixel at \e x, \e y position 
        \li \c {equals(image)} Returns \c true if this image is identical to \e image - 
            see \l QImage::operator== (since 5.6) 
 
        For example: 
 
        \code 
        var image = grabImage(rect); 
        compare(image.red(10, 10), 255); 
        compare(image.pixel(20, 20), Qt.rgba(255, 0, 0, 255)); 
 
        rect.width += 10; 
        var newImage = grabImage(rect); 
        verify(!newImage.equals(image)); 
        \endcode 
 
        \li \c {save(path)} Saves the image to the given \e path. If the image cannot 
        be saved, an exception will be thrown. (since 5.10) 
 
        This can be useful to perform postmortem analysis on failing tests, for 
        example: 
 
        \code 
        var image = grabImage(rect); 
        try { 
            compare(image.width, 100); 
        } catch (ex) { 
            image.save(&quot;debug.png&quot;); 
            throw ex; 
        } 
        \endcode 
 
        \endlist 
    */</span>
    <span class="s2">function </span><span class="s1">grabImage</span><span class="s4">(</span><span class="s1">item</span><span class="s4">) {</span>
        <span class="s2">return </span><span class="s1">qtest_results</span><span class="s4">.</span><span class="s1">grabImage</span><span class="s4">(</span><span class="s1">item</span><span class="s4">);</span>
    <span class="s4">}</span>

    <span class="s5">/*! 
        \since 5.4 
        \qmlmethod QtObject TestCase::findChild(parent, objectName) 
 
        Returns the first child of \a parent with \a objectName, or \c null if 
        no such item exists. Both visual and non-visual children are searched 
        recursively, with visual children being searched first. 
 
        \code 
        compare(findChild(item, &quot;childObject&quot;), expectedChildObject); 
        \endcode 
    */</span>
    <span class="s2">function </span><span class="s1">findChild</span><span class="s4">(</span><span class="s1">parent</span><span class="s4">, </span><span class="s1">objectName</span><span class="s4">) {</span>
        <span class="s5">// First, search the visual item hierarchy.</span>
        <span class="s2">var </span><span class="s1">child </span><span class="s4">= </span><span class="s1">qtest_findVisualChild</span><span class="s4">(</span><span class="s1">parent</span><span class="s4">, </span><span class="s1">objectName</span><span class="s4">);</span>
        <span class="s2">if </span><span class="s4">(</span><span class="s1">child</span><span class="s4">)</span>
            <span class="s2">return </span><span class="s1">child</span><span class="s4">;</span>

        <span class="s5">// If it's not a visual child, it might be a QObject child.</span>
        <span class="s2">return </span><span class="s1">qtest_results</span><span class="s4">.</span><span class="s1">findChild</span><span class="s4">(</span><span class="s1">parent</span><span class="s4">, </span><span class="s1">objectName</span><span class="s4">);</span>
    <span class="s4">}</span>

    <span class="s5">/*! \internal */</span>
    <span class="s2">function </span><span class="s1">qtest_findVisualChild</span><span class="s4">(</span><span class="s1">parent</span><span class="s4">, </span><span class="s1">objectName</span><span class="s4">) {</span>
        <span class="s2">if </span><span class="s4">(!</span><span class="s1">parent </span><span class="s4">|| </span><span class="s1">parent</span><span class="s4">.</span><span class="s1">children </span><span class="s4">=== </span><span class="s1">undefined</span><span class="s4">)</span>
            <span class="s2">return null</span><span class="s4">;</span>

        <span class="s2">for </span><span class="s4">(</span><span class="s2">var </span><span class="s1">i </span><span class="s4">= </span><span class="s3">0</span><span class="s4">; </span><span class="s1">i </span><span class="s4">&lt; </span><span class="s1">parent</span><span class="s4">.</span><span class="s1">children</span><span class="s4">.</span><span class="s1">length</span><span class="s4">; ++</span><span class="s1">i</span><span class="s4">) {</span>
            <span class="s5">// Is this direct child of ours the child we're after?</span>
            <span class="s2">var </span><span class="s1">child </span><span class="s4">= </span><span class="s1">parent</span><span class="s4">.</span><span class="s1">children</span><span class="s4">[</span><span class="s1">i</span><span class="s4">];</span>
            <span class="s2">if </span><span class="s4">(</span><span class="s1">child</span><span class="s4">.</span><span class="s1">objectName </span><span class="s4">=== </span><span class="s1">objectName</span><span class="s4">)</span>
                <span class="s2">return </span><span class="s1">child</span><span class="s4">;</span>
        <span class="s4">}</span>

        <span class="s2">for </span><span class="s4">(</span><span class="s1">i </span><span class="s4">= </span><span class="s3">0</span><span class="s4">; </span><span class="s1">i </span><span class="s4">&lt; </span><span class="s1">parent</span><span class="s4">.</span><span class="s1">children</span><span class="s4">.</span><span class="s1">length</span><span class="s4">; ++</span><span class="s1">i</span><span class="s4">) {</span>
            <span class="s5">// Try the direct child's children.</span>
            <span class="s1">child </span><span class="s4">= </span><span class="s1">qtest_findVisualChild</span><span class="s4">(</span><span class="s1">parent</span><span class="s4">.</span><span class="s1">children</span><span class="s4">[</span><span class="s1">i</span><span class="s4">], </span><span class="s1">objectName</span><span class="s4">);</span>
            <span class="s2">if </span><span class="s4">(</span><span class="s1">child</span><span class="s4">)</span>
                <span class="s2">return </span><span class="s1">child</span><span class="s4">;</span>
        <span class="s4">}</span>
        <span class="s2">return null</span><span class="s4">;</span>
    <span class="s4">}</span>

    <span class="s5">/*! 
        \qmlmethod TestCase::tryCompare(obj, property, expected, timeout = 5000, message = &quot;&quot;) 
 
        Fails the current test case if the specified \a property on \a obj 
        is not the same as \a expected, and displays the optional \a message. 
        The test will be retried multiple times until the 
        \a timeout (in milliseconds) is reached. 
 
        This function is intended for testing applications where a property 
        changes value based on asynchronous events.  Use compare() for testing 
        synchronous property changes. 
 
        \code 
        tryCompare(img, &quot;status&quot;, BorderImage.Ready) 
        compare(img.width, 120) 
        compare(img.height, 120) 
        compare(img.horizontalTileMode, BorderImage.Stretch) 
        compare(img.verticalTileMode, BorderImage.Stretch) 
        \endcode 
 
        SignalSpy::wait() provides an alternative method to wait for a 
        signal to be emitted. 
 
        \sa compare(), SignalSpy::wait() 
    */</span>
    <span class="s2">function </span><span class="s1">tryCompare</span><span class="s4">(</span><span class="s1">obj</span><span class="s4">, </span><span class="s1">prop</span><span class="s4">, </span><span class="s1">value</span><span class="s4">, </span><span class="s1">timeout</span><span class="s4">, </span><span class="s1">msg</span><span class="s4">) {</span>
        <span class="s2">if </span><span class="s4">(</span><span class="s1">arguments</span><span class="s4">.</span><span class="s1">length </span><span class="s4">== </span><span class="s3">1 </span><span class="s4">|| (</span><span class="s2">typeof</span><span class="s4">(</span><span class="s1">prop</span><span class="s4">) != </span><span class="s6">&quot;string&quot; </span><span class="s4">&amp;&amp; </span><span class="s2">typeof</span><span class="s4">(</span><span class="s1">prop</span><span class="s4">) != </span><span class="s6">&quot;number&quot;</span><span class="s4">)) {</span>
            <span class="s1">qtest_results</span><span class="s4">.</span><span class="s1">fail</span><span class="s4">(</span><span class="s6">&quot;A property name as string or index is required for tryCompare&quot;</span><span class="s4">,</span>
                        <span class="s1">util</span><span class="s4">.</span><span class="s1">callerFile</span><span class="s4">(), </span><span class="s1">util</span><span class="s4">.</span><span class="s1">callerLine</span><span class="s4">())</span>
            <span class="s2">throw new </span><span class="s1">Error</span><span class="s4">(</span><span class="s6">&quot;QtQuickTest::fail&quot;</span><span class="s4">)</span>
        <span class="s4">}</span>
        <span class="s2">if </span><span class="s4">(</span><span class="s1">arguments</span><span class="s4">.</span><span class="s1">length </span><span class="s4">== </span><span class="s3">2</span><span class="s4">) {</span>
            <span class="s1">qtest_results</span><span class="s4">.</span><span class="s1">fail</span><span class="s4">(</span><span class="s6">&quot;A value is required for tryCompare&quot;</span><span class="s4">,</span>
                        <span class="s1">util</span><span class="s4">.</span><span class="s1">callerFile</span><span class="s4">(), </span><span class="s1">util</span><span class="s4">.</span><span class="s1">callerLine</span><span class="s4">())</span>
            <span class="s2">throw new </span><span class="s1">Error</span><span class="s4">(</span><span class="s6">&quot;QtQuickTest::fail&quot;</span><span class="s4">)</span>
        <span class="s4">}</span>
        <span class="s2">if </span><span class="s4">(</span><span class="s1">timeout </span><span class="s4">!== </span><span class="s1">undefined </span><span class="s4">&amp;&amp; </span><span class="s2">typeof</span><span class="s4">(</span><span class="s1">timeout</span><span class="s4">) != </span><span class="s6">&quot;number&quot;</span><span class="s4">) {</span>
            <span class="s1">qtest_results</span><span class="s4">.</span><span class="s1">fail</span><span class="s4">(</span><span class="s6">&quot;timeout should be a number&quot;</span><span class="s4">,</span>
                        <span class="s1">util</span><span class="s4">.</span><span class="s1">callerFile</span><span class="s4">(), </span><span class="s1">util</span><span class="s4">.</span><span class="s1">callerLine</span><span class="s4">())</span>
            <span class="s2">throw new </span><span class="s1">Error</span><span class="s4">(</span><span class="s6">&quot;QtQuickTest::fail&quot;</span><span class="s4">)</span>
        <span class="s4">}</span>
        <span class="s2">if </span><span class="s4">(!</span><span class="s1">timeout</span><span class="s4">)</span>
            <span class="s1">timeout </span><span class="s4">= </span><span class="s3">5000</span>
        <span class="s2">if </span><span class="s4">(</span><span class="s1">msg </span><span class="s4">=== </span><span class="s1">undefined</span><span class="s4">)</span>
            <span class="s1">msg </span><span class="s4">= </span><span class="s6">&quot;property &quot; </span><span class="s4">+ </span><span class="s1">prop</span>
        <span class="s2">if </span><span class="s4">(!</span><span class="s1">qtest_compareInternal</span><span class="s4">(</span><span class="s1">obj</span><span class="s4">[</span><span class="s1">prop</span><span class="s4">], </span><span class="s1">value</span><span class="s4">))</span>
            <span class="s1">wait</span><span class="s4">(</span><span class="s3">0</span><span class="s4">)</span>
        <span class="s2">var </span><span class="s1">i </span><span class="s4">= </span><span class="s3">0</span>
        <span class="s2">while </span><span class="s4">(</span><span class="s1">i </span><span class="s4">&lt; </span><span class="s1">timeout </span><span class="s4">&amp;&amp; !</span><span class="s1">qtest_compareInternal</span><span class="s4">(</span><span class="s1">obj</span><span class="s4">[</span><span class="s1">prop</span><span class="s4">], </span><span class="s1">value</span><span class="s4">)) {</span>
            <span class="s1">wait</span><span class="s4">(</span><span class="s3">50</span><span class="s4">)</span>
            <span class="s1">i </span><span class="s4">+= </span><span class="s3">50</span>
        <span class="s4">}</span>
        <span class="s2">var </span><span class="s1">actual </span><span class="s4">= </span><span class="s1">obj</span><span class="s4">[</span><span class="s1">prop</span><span class="s4">]</span>
        <span class="s2">var </span><span class="s1">act </span><span class="s4">= </span><span class="s1">qtest_results</span><span class="s4">.</span><span class="s1">stringify</span><span class="s4">(</span><span class="s1">actual</span><span class="s4">)</span>
        <span class="s2">var </span><span class="s1">exp </span><span class="s4">= </span><span class="s1">qtest_results</span><span class="s4">.</span><span class="s1">stringify</span><span class="s4">(</span><span class="s1">value</span><span class="s4">)</span>
        <span class="s2">var </span><span class="s1">success </span><span class="s4">= </span><span class="s1">qtest_compareInternal</span><span class="s4">(</span><span class="s1">actual</span><span class="s4">, </span><span class="s1">value</span><span class="s4">)</span>
        <span class="s2">if </span><span class="s4">(!</span><span class="s1">qtest_results</span><span class="s4">.</span><span class="s1">compare</span><span class="s4">(</span><span class="s1">success</span><span class="s4">, </span><span class="s1">msg</span><span class="s4">, </span><span class="s1">act</span><span class="s4">, </span><span class="s1">exp</span><span class="s4">, </span><span class="s1">util</span><span class="s4">.</span><span class="s1">callerFile</span><span class="s4">(), </span><span class="s1">util</span><span class="s4">.</span><span class="s1">callerLine</span><span class="s4">()))</span>
            <span class="s2">throw new </span><span class="s1">Error</span><span class="s4">(</span><span class="s6">&quot;QtQuickTest::fail&quot;</span><span class="s4">)</span>
    <span class="s4">}</span>

    <span class="s5">/*! 
        \qmlmethod TestCase::skip(message = &quot;&quot;) 
 
        Skips the current test case and prints the optional \a message. 
        If this is a data-driven test, then only the current row is skipped. 
        Similar to \c{QSKIP(message)} in C++. 
    */</span>
    <span class="s2">function </span><span class="s1">skip</span><span class="s4">(</span><span class="s1">msg</span><span class="s4">) {</span>
        <span class="s2">if </span><span class="s4">(</span><span class="s1">msg </span><span class="s4">=== </span><span class="s1">undefined</span><span class="s4">)</span>
            <span class="s1">msg </span><span class="s4">= </span><span class="s6">&quot;&quot;</span>
        <span class="s1">qtest_results</span><span class="s4">.</span><span class="s1">skip</span><span class="s4">(</span><span class="s1">msg</span><span class="s4">, </span><span class="s1">util</span><span class="s4">.</span><span class="s1">callerFile</span><span class="s4">(), </span><span class="s1">util</span><span class="s4">.</span><span class="s1">callerLine</span><span class="s4">())</span>
        <span class="s2">throw new </span><span class="s1">Error</span><span class="s4">(</span><span class="s6">&quot;QtQuickTest::skip&quot;</span><span class="s4">)</span>
    <span class="s4">}</span>

    <span class="s5">/*! 
        \qmlmethod TestCase::expectFail(tag, message) 
 
        In a data-driven test, marks the row associated with \a tag as 
        expected to fail.  When the fail occurs, display the \a message, 
        abort the test, and mark the test as passing.  Similar to 
        \c{QEXPECT_FAIL(tag, message, Abort)} in C++. 
 
        If the test is not data-driven, then \a tag must be set to 
        an empty string. 
 
        \sa expectFailContinue() 
    */</span>
    <span class="s2">function </span><span class="s1">expectFail</span><span class="s4">(</span><span class="s1">tag</span><span class="s4">, </span><span class="s1">msg</span><span class="s4">) {</span>
        <span class="s2">if </span><span class="s4">(</span><span class="s1">tag </span><span class="s4">=== </span><span class="s1">undefined</span><span class="s4">) {</span>
            <span class="s1">warn</span><span class="s4">(</span><span class="s6">&quot;tag argument missing from expectFail()&quot;</span><span class="s4">)</span>
            <span class="s1">tag </span><span class="s4">= </span><span class="s6">&quot;&quot;</span>
        <span class="s4">}</span>
        <span class="s2">if </span><span class="s4">(</span><span class="s1">msg </span><span class="s4">=== </span><span class="s1">undefined</span><span class="s4">) {</span>
            <span class="s1">warn</span><span class="s4">(</span><span class="s6">&quot;message argument missing from expectFail()&quot;</span><span class="s4">)</span>
            <span class="s1">msg </span><span class="s4">= </span><span class="s6">&quot;&quot;</span>
        <span class="s4">}</span>
        <span class="s2">if </span><span class="s4">(!</span><span class="s1">qtest_results</span><span class="s4">.</span><span class="s1">expectFail</span><span class="s4">(</span><span class="s1">tag</span><span class="s4">, </span><span class="s1">msg</span><span class="s4">, </span><span class="s1">util</span><span class="s4">.</span><span class="s1">callerFile</span><span class="s4">(), </span><span class="s1">util</span><span class="s4">.</span><span class="s1">callerLine</span><span class="s4">()))</span>
            <span class="s2">throw new </span><span class="s1">Error</span><span class="s4">(</span><span class="s6">&quot;QtQuickTest::expectFail&quot;</span><span class="s4">)</span>
    <span class="s4">}</span>

    <span class="s5">/*! 
        \qmlmethod TestCase::expectFailContinue(tag, message) 
 
        In a data-driven test, marks the row associated with \a tag as 
        expected to fail.  When the fail occurs, display the \a message, 
        and then continue the test.  Similar to 
        \c{QEXPECT_FAIL(tag, message, Continue)} in C++. 
 
        If the test is not data-driven, then \a tag must be set to 
        an empty string. 
 
        \sa expectFail() 
    */</span>
    <span class="s2">function </span><span class="s1">expectFailContinue</span><span class="s4">(</span><span class="s1">tag</span><span class="s4">, </span><span class="s1">msg</span><span class="s4">) {</span>
        <span class="s2">if </span><span class="s4">(</span><span class="s1">tag </span><span class="s4">=== </span><span class="s1">undefined</span><span class="s4">) {</span>
            <span class="s1">warn</span><span class="s4">(</span><span class="s6">&quot;tag argument missing from expectFailContinue()&quot;</span><span class="s4">)</span>
            <span class="s1">tag </span><span class="s4">= </span><span class="s6">&quot;&quot;</span>
        <span class="s4">}</span>
        <span class="s2">if </span><span class="s4">(</span><span class="s1">msg </span><span class="s4">=== </span><span class="s1">undefined</span><span class="s4">) {</span>
            <span class="s1">warn</span><span class="s4">(</span><span class="s6">&quot;message argument missing from expectFailContinue()&quot;</span><span class="s4">)</span>
            <span class="s1">msg </span><span class="s4">= </span><span class="s6">&quot;&quot;</span>
        <span class="s4">}</span>
        <span class="s2">if </span><span class="s4">(!</span><span class="s1">qtest_results</span><span class="s4">.</span><span class="s1">expectFailContinue</span><span class="s4">(</span><span class="s1">tag</span><span class="s4">, </span><span class="s1">msg</span><span class="s4">, </span><span class="s1">util</span><span class="s4">.</span><span class="s1">callerFile</span><span class="s4">(), </span><span class="s1">util</span><span class="s4">.</span><span class="s1">callerLine</span><span class="s4">()))</span>
            <span class="s2">throw new </span><span class="s1">Error</span><span class="s4">(</span><span class="s6">&quot;QtQuickTest::expectFail&quot;</span><span class="s4">)</span>
    <span class="s4">}</span>

    <span class="s5">/*! 
        \qmlmethod TestCase::warn(message) 
 
        Prints \a message as a warning message.  Similar to 
        \c{QWARN(message)} in C++. 
 
        \sa ignoreWarning() 
    */</span>
    <span class="s2">function </span><span class="s1">warn</span><span class="s4">(</span><span class="s1">msg</span><span class="s4">) {</span>
        <span class="s2">if </span><span class="s4">(</span><span class="s1">msg </span><span class="s4">=== </span><span class="s1">undefined</span><span class="s4">)</span>
            <span class="s1">msg </span><span class="s4">= </span><span class="s6">&quot;&quot;</span>
        <span class="s1">qtest_results</span><span class="s4">.</span><span class="s1">warn</span><span class="s4">(</span><span class="s1">msg</span><span class="s4">, </span><span class="s1">util</span><span class="s4">.</span><span class="s1">callerFile</span><span class="s4">(), </span><span class="s1">util</span><span class="s4">.</span><span class="s1">callerLine</span><span class="s4">());</span>
    <span class="s4">}</span>

    <span class="s5">/*! 
        \qmlmethod TestCase::ignoreWarning(message) 
 
        Marks \a message as an ignored warning message.  When it occurs, 
        the warning will not be printed and the test passes.  If the message 
        does not occur, then the test will fail.  Similar to 
        \c{QTest::ignoreMessage(QtWarningMsg, message)} in C++. 
 
        Since Qt 5.12, \a message can be either a string, or a regular 
        expression providing a pattern of messages to ignore. 
 
        For example, the following snippet will ignore a string warning message: 
        \qml 
        ignoreWarning(&quot;Something sort of bad happened&quot;) 
        \endqml 
 
        And the following snippet will ignore a regular expression matching a 
        number of possible warning messages: 
        \qml 
        ignoreWarning(new RegExp(&quot;[0-9]+ bad things happened&quot;)) 
        \endqml 
 
        \note Despite being a JavaScript RegExp object, it will not be 
        interpreted as such; instead, the pattern will be passed to 
        \l QRegularExpression. 
 
        \sa warn() 
    */</span>
    <span class="s2">function </span><span class="s1">ignoreWarning</span><span class="s4">(</span><span class="s1">msg</span><span class="s4">) {</span>
        <span class="s2">if </span><span class="s4">(</span><span class="s1">msg </span><span class="s4">=== </span><span class="s1">undefined</span><span class="s4">)</span>
            <span class="s1">msg </span><span class="s4">= </span><span class="s6">&quot;&quot;</span>
        <span class="s1">qtest_results</span><span class="s4">.</span><span class="s1">ignoreWarning</span><span class="s4">(</span><span class="s1">msg</span><span class="s4">)</span>
    <span class="s4">}</span>

    <span class="s5">/*! 
        \qmlmethod TestCase::wait(ms) 
 
        Waits for \a ms milliseconds while processing Qt events. 
 
        \sa sleep(), waitForRendering() 
    */</span>
    <span class="s2">function </span><span class="s1">wait</span><span class="s4">(</span><span class="s1">ms</span><span class="s4">) {</span>
        <span class="s1">qtest_results</span><span class="s4">.</span><span class="s1">wait</span><span class="s4">(</span><span class="s1">ms</span><span class="s4">)</span>
    <span class="s4">}</span>

    <span class="s5">/*! 
        \qmlmethod TestCase::waitForRendering(item, timeout = 5000) 
 
        Waits for \a timeout milliseconds or until the \a item is rendered by the renderer. 
        Returns true if \c item is rendered in \a timeout milliseconds, otherwise returns false. 
        The default \a timeout value is 5000. 
 
        \sa sleep(), wait() 
    */</span>
    <span class="s2">function </span><span class="s1">waitForRendering</span><span class="s4">(</span><span class="s1">item</span><span class="s4">, </span><span class="s1">timeout</span><span class="s4">) {</span>
        <span class="s2">if </span><span class="s4">(</span><span class="s1">timeout </span><span class="s4">=== </span><span class="s1">undefined</span><span class="s4">)</span>
            <span class="s1">timeout </span><span class="s4">= </span><span class="s3">5000</span>
        <span class="s2">if </span><span class="s4">(!</span><span class="s1">qtest_verifyItem</span><span class="s4">(</span><span class="s1">item</span><span class="s4">, </span><span class="s6">&quot;waitForRendering&quot;</span><span class="s4">))</span>
            <span class="s2">return</span>
        <span class="s2">return </span><span class="s1">qtest_results</span><span class="s4">.</span><span class="s1">waitForRendering</span><span class="s4">(</span><span class="s1">item</span><span class="s4">, </span><span class="s1">timeout</span><span class="s4">)</span>
    <span class="s4">}</span>

    <span class="s5">/*! 
        \qmlmethod TestCase::sleep(ms) 
 
        Sleeps for \a ms milliseconds without processing Qt events. 
 
        \sa wait(), waitForRendering() 
    */</span>
    <span class="s2">function </span><span class="s1">sleep</span><span class="s4">(</span><span class="s1">ms</span><span class="s4">) {</span>
        <span class="s1">qtest_results</span><span class="s4">.</span><span class="s1">sleep</span><span class="s4">(</span><span class="s1">ms</span><span class="s4">)</span>
    <span class="s4">}</span>

    <span class="s5">/*! 
        \qmlmethod TestCase::keyPress(key, modifiers = Qt.NoModifier, delay = -1) 
 
        Simulates pressing a \a key with optional \a modifiers on the currently 
        focused item.  If \a delay is larger than 0, the test will wait for 
        \a delay milliseconds. 
 
        The event will be sent to the TestCase window or, in case of multiple windows, 
        to the current active window. See \l QGuiApplication::focusWindow() for more details. 
 
        \b{Note:} At some point you should release the key using keyRelease(). 
 
        \sa keyRelease(), keyClick() 
    */</span>
    <span class="s2">function </span><span class="s1">keyPress</span><span class="s4">(</span><span class="s1">key</span><span class="s4">, </span><span class="s1">modifiers</span><span class="s4">, </span><span class="s1">delay</span><span class="s4">) {</span>
        <span class="s2">if </span><span class="s4">(</span><span class="s1">modifiers </span><span class="s4">=== </span><span class="s1">undefined</span><span class="s4">)</span>
            <span class="s1">modifiers </span><span class="s4">= </span><span class="s1">Qt</span><span class="s4">.</span><span class="s1">NoModifier</span>
        <span class="s2">if </span><span class="s4">(</span><span class="s1">delay </span><span class="s4">== </span><span class="s1">undefined</span><span class="s4">)</span>
            <span class="s1">delay </span><span class="s4">= -</span><span class="s3">1</span>
        <span class="s2">if </span><span class="s4">(</span><span class="s2">typeof</span><span class="s4">(</span><span class="s1">key</span><span class="s4">) == </span><span class="s6">&quot;string&quot; </span><span class="s4">&amp;&amp; </span><span class="s1">key</span><span class="s4">.</span><span class="s1">length </span><span class="s4">== </span><span class="s3">1</span><span class="s4">) {</span>
            <span class="s2">if </span><span class="s4">(!</span><span class="s1">qtest_events</span><span class="s4">.</span><span class="s1">keyPressChar</span><span class="s4">(</span><span class="s1">key</span><span class="s4">, </span><span class="s1">modifiers</span><span class="s4">, </span><span class="s1">delay</span><span class="s4">))</span>
                <span class="s1">qtest_fail</span><span class="s4">(</span><span class="s6">&quot;window not shown&quot;</span><span class="s4">, </span><span class="s3">2</span><span class="s4">)</span>
        <span class="s4">} </span><span class="s2">else </span><span class="s4">{</span>
            <span class="s2">if </span><span class="s4">(!</span><span class="s1">qtest_events</span><span class="s4">.</span><span class="s1">keyPress</span><span class="s4">(</span><span class="s1">key</span><span class="s4">, </span><span class="s1">modifiers</span><span class="s4">, </span><span class="s1">delay</span><span class="s4">))</span>
                <span class="s1">qtest_fail</span><span class="s4">(</span><span class="s6">&quot;window not shown&quot;</span><span class="s4">, </span><span class="s3">2</span><span class="s4">)</span>
        <span class="s4">}</span>
    <span class="s4">}</span>

    <span class="s5">/*! 
        \qmlmethod TestCase::keyRelease(key, modifiers = Qt.NoModifier, delay = -1) 
 
        Simulates releasing a \a key with optional \a modifiers on the currently 
        focused item.  If \a delay is larger than 0, the test will wait for 
        \a delay milliseconds. 
 
        The event will be sent to the TestCase window or, in case of multiple windows, 
        to the current active window. See \l QGuiApplication::focusWindow() for more details. 
 
        \sa keyPress(), keyClick() 
    */</span>
    <span class="s2">function </span><span class="s1">keyRelease</span><span class="s4">(</span><span class="s1">key</span><span class="s4">, </span><span class="s1">modifiers</span><span class="s4">, </span><span class="s1">delay</span><span class="s4">) {</span>
        <span class="s2">if </span><span class="s4">(</span><span class="s1">modifiers </span><span class="s4">=== </span><span class="s1">undefined</span><span class="s4">)</span>
            <span class="s1">modifiers </span><span class="s4">= </span><span class="s1">Qt</span><span class="s4">.</span><span class="s1">NoModifier</span>
        <span class="s2">if </span><span class="s4">(</span><span class="s1">delay </span><span class="s4">== </span><span class="s1">undefined</span><span class="s4">)</span>
            <span class="s1">delay </span><span class="s4">= -</span><span class="s3">1</span>
        <span class="s2">if </span><span class="s4">(</span><span class="s2">typeof</span><span class="s4">(</span><span class="s1">key</span><span class="s4">) == </span><span class="s6">&quot;string&quot; </span><span class="s4">&amp;&amp; </span><span class="s1">key</span><span class="s4">.</span><span class="s1">length </span><span class="s4">== </span><span class="s3">1</span><span class="s4">) {</span>
            <span class="s2">if </span><span class="s4">(!</span><span class="s1">qtest_events</span><span class="s4">.</span><span class="s1">keyReleaseChar</span><span class="s4">(</span><span class="s1">key</span><span class="s4">, </span><span class="s1">modifiers</span><span class="s4">, </span><span class="s1">delay</span><span class="s4">))</span>
                <span class="s1">qtest_fail</span><span class="s4">(</span><span class="s6">&quot;window not shown&quot;</span><span class="s4">, </span><span class="s3">2</span><span class="s4">)</span>
        <span class="s4">} </span><span class="s2">else </span><span class="s4">{</span>
            <span class="s2">if </span><span class="s4">(!</span><span class="s1">qtest_events</span><span class="s4">.</span><span class="s1">keyRelease</span><span class="s4">(</span><span class="s1">key</span><span class="s4">, </span><span class="s1">modifiers</span><span class="s4">, </span><span class="s1">delay</span><span class="s4">))</span>
                <span class="s1">qtest_fail</span><span class="s4">(</span><span class="s6">&quot;window not shown&quot;</span><span class="s4">, </span><span class="s3">2</span><span class="s4">)</span>
        <span class="s4">}</span>
    <span class="s4">}</span>

    <span class="s5">/*! 
        \qmlmethod TestCase::keyClick(key, modifiers = Qt.NoModifier, delay = -1) 
 
        Simulates clicking of \a key with optional \a modifiers on the currently 
        focused item.  If \a delay is larger than 0, the test will wait for 
        \a delay milliseconds. 
 
        The event will be sent to the TestCase window or, in case of multiple windows, 
        to the current active window. See \l QGuiApplication::focusWindow() for more details. 
 
        \sa keyPress(), keyRelease() 
    */</span>
    <span class="s2">function </span><span class="s1">keyClick</span><span class="s4">(</span><span class="s1">key</span><span class="s4">, </span><span class="s1">modifiers</span><span class="s4">, </span><span class="s1">delay</span><span class="s4">) {</span>
        <span class="s2">if </span><span class="s4">(</span><span class="s1">modifiers </span><span class="s4">=== </span><span class="s1">undefined</span><span class="s4">)</span>
            <span class="s1">modifiers </span><span class="s4">= </span><span class="s1">Qt</span><span class="s4">.</span><span class="s1">NoModifier</span>
        <span class="s2">if </span><span class="s4">(</span><span class="s1">delay </span><span class="s4">== </span><span class="s1">undefined</span><span class="s4">)</span>
            <span class="s1">delay </span><span class="s4">= -</span><span class="s3">1</span>
        <span class="s2">if </span><span class="s4">(</span><span class="s2">typeof</span><span class="s4">(</span><span class="s1">key</span><span class="s4">) == </span><span class="s6">&quot;string&quot; </span><span class="s4">&amp;&amp; </span><span class="s1">key</span><span class="s4">.</span><span class="s1">length </span><span class="s4">== </span><span class="s3">1</span><span class="s4">) {</span>
            <span class="s2">if </span><span class="s4">(!</span><span class="s1">qtest_events</span><span class="s4">.</span><span class="s1">keyClickChar</span><span class="s4">(</span><span class="s1">key</span><span class="s4">, </span><span class="s1">modifiers</span><span class="s4">, </span><span class="s1">delay</span><span class="s4">))</span>
                <span class="s1">qtest_fail</span><span class="s4">(</span><span class="s6">&quot;window not shown&quot;</span><span class="s4">, </span><span class="s3">2</span><span class="s4">)</span>
        <span class="s4">} </span><span class="s2">else </span><span class="s4">{</span>
            <span class="s2">if </span><span class="s4">(!</span><span class="s1">qtest_events</span><span class="s4">.</span><span class="s1">keyClick</span><span class="s4">(</span><span class="s1">key</span><span class="s4">, </span><span class="s1">modifiers</span><span class="s4">, </span><span class="s1">delay</span><span class="s4">))</span>
                <span class="s1">qtest_fail</span><span class="s4">(</span><span class="s6">&quot;window not shown&quot;</span><span class="s4">, </span><span class="s3">2</span><span class="s4">)</span>
        <span class="s4">}</span>
    <span class="s4">}</span>

    <span class="s5">/*! 
        \since 5.10 
        \qmlmethod TestCase::keySequence(keySequence) 
 
        Simulates typing of \a keySequence. The key sequence can be set 
        to one of the \l{QKeySequence::StandardKey}{standard keyboard shortcuts}, or 
        it can be described with a string containing a sequence of up to four key 
        presses. 
 
        Each event shall be sent to the TestCase window or, in case of multiple windows, 
        to the current active window. See \l QGuiApplication::focusWindow() for more details. 
 
        \sa keyPress(), keyRelease(), {GNU Emacs Style Key Sequences}, 
        {QtQuick::Shortcut::sequence}{Shortcut.sequence} 
    */</span>
    <span class="s2">function </span><span class="s1">keySequence</span><span class="s4">(</span><span class="s1">keySequence</span><span class="s4">) {</span>
        <span class="s2">if </span><span class="s4">(!</span><span class="s1">qtest_events</span><span class="s4">.</span><span class="s1">keySequence</span><span class="s4">(</span><span class="s1">keySequence</span><span class="s4">))</span>
            <span class="s1">qtest_fail</span><span class="s4">(</span><span class="s6">&quot;window not shown&quot;</span><span class="s4">, </span><span class="s3">2</span><span class="s4">)</span>
    <span class="s4">}</span>

    <span class="s5">/*! 
        \qmlmethod TestCase::mousePress(item, x = item.width / 2, y = item.height / 2, button = Qt.LeftButton, modifiers = Qt.NoModifier, delay = -1) 
 
        Simulates pressing a mouse \a button with optional \a modifiers 
        on an \a item.  The position is defined by \a x and \a y. 
        If \a x or \a y are not defined the position will be the center of \a item. 
        If \a delay is specified, the test will wait for the specified amount of 
        milliseconds before the press. 
 
        The position given by \a x and \a y is transformed from the co-ordinate 
        system of \a item into window co-ordinates and then delivered. 
        If \a item is obscured by another item, or a child of \a item occupies 
        that position, then the event will be delivered to the other item instead. 
 
        \sa mouseRelease(), mouseClick(), mouseDoubleClickSequence(), mouseMove(), mouseDrag(), mouseWheel() 
    */</span>
    <span class="s2">function </span><span class="s1">mousePress</span><span class="s4">(</span><span class="s1">item</span><span class="s4">, </span><span class="s1">x</span><span class="s4">, </span><span class="s1">y</span><span class="s4">, </span><span class="s1">button</span><span class="s4">, </span><span class="s1">modifiers</span><span class="s4">, </span><span class="s1">delay</span><span class="s4">) {</span>
        <span class="s2">if </span><span class="s4">(!</span><span class="s1">qtest_verifyItem</span><span class="s4">(</span><span class="s1">item</span><span class="s4">, </span><span class="s6">&quot;mousePress&quot;</span><span class="s4">))</span>
            <span class="s2">return</span>

        <span class="s2">if </span><span class="s4">(</span><span class="s1">button </span><span class="s4">=== </span><span class="s1">undefined</span><span class="s4">)</span>
            <span class="s1">button </span><span class="s4">= </span><span class="s1">Qt</span><span class="s4">.</span><span class="s1">LeftButton</span>
        <span class="s2">if </span><span class="s4">(</span><span class="s1">modifiers </span><span class="s4">=== </span><span class="s1">undefined</span><span class="s4">)</span>
            <span class="s1">modifiers </span><span class="s4">= </span><span class="s1">Qt</span><span class="s4">.</span><span class="s1">NoModifier</span>
        <span class="s2">if </span><span class="s4">(</span><span class="s1">delay </span><span class="s4">== </span><span class="s1">undefined</span><span class="s4">)</span>
            <span class="s1">delay </span><span class="s4">= -</span><span class="s3">1</span>
        <span class="s2">if </span><span class="s4">(</span><span class="s1">x </span><span class="s4">=== </span><span class="s1">undefined</span><span class="s4">)</span>
            <span class="s1">x </span><span class="s4">= </span><span class="s1">item</span><span class="s4">.</span><span class="s1">width </span><span class="s4">/ </span><span class="s3">2</span>
        <span class="s2">if </span><span class="s4">(</span><span class="s1">y </span><span class="s4">=== </span><span class="s1">undefined</span><span class="s4">)</span>
            <span class="s1">y </span><span class="s4">= </span><span class="s1">item</span><span class="s4">.</span><span class="s1">height </span><span class="s4">/ </span><span class="s3">2</span>
        <span class="s2">if </span><span class="s4">(!</span><span class="s1">qtest_events</span><span class="s4">.</span><span class="s1">mousePress</span><span class="s4">(</span><span class="s1">item</span><span class="s4">, </span><span class="s1">x</span><span class="s4">, </span><span class="s1">y</span><span class="s4">, </span><span class="s1">button</span><span class="s4">, </span><span class="s1">modifiers</span><span class="s4">, </span><span class="s1">delay</span><span class="s4">))</span>
            <span class="s1">qtest_fail</span><span class="s4">(</span><span class="s6">&quot;window not shown&quot;</span><span class="s4">, </span><span class="s3">2</span><span class="s4">)</span>
    <span class="s4">}</span>

    <span class="s5">/*! 
        \qmlmethod TestCase::mouseRelease(item, x = item.width / 2, y = item.height / 2, button = Qt.LeftButton, modifiers = Qt.NoModifier, delay = -1) 
 
        Simulates releasing a mouse \a button with optional \a modifiers 
        on an \a item.  The position of the release is defined by \a x and \a y. 
        If \a x or \a y are not defined the position will be the center of \a item. 
        If \a delay is specified, the test will wait for the specified amount of 
        milliseconds before releasing the button. 
 
        The position given by \a x and \a y is transformed from the co-ordinate 
        system of \a item into window co-ordinates and then delivered. 
        If \a item is obscured by another item, or a child of \a item occupies 
        that position, then the event will be delivered to the other item instead. 
 
        \sa mousePress(), mouseClick(), mouseDoubleClickSequence(), mouseMove(), mouseDrag(), mouseWheel() 
    */</span>
    <span class="s2">function </span><span class="s1">mouseRelease</span><span class="s4">(</span><span class="s1">item</span><span class="s4">, </span><span class="s1">x</span><span class="s4">, </span><span class="s1">y</span><span class="s4">, </span><span class="s1">button</span><span class="s4">, </span><span class="s1">modifiers</span><span class="s4">, </span><span class="s1">delay</span><span class="s4">) {</span>
        <span class="s2">if </span><span class="s4">(!</span><span class="s1">qtest_verifyItem</span><span class="s4">(</span><span class="s1">item</span><span class="s4">, </span><span class="s6">&quot;mouseRelease&quot;</span><span class="s4">))</span>
            <span class="s2">return</span>

        <span class="s2">if </span><span class="s4">(</span><span class="s1">button </span><span class="s4">=== </span><span class="s1">undefined</span><span class="s4">)</span>
            <span class="s1">button </span><span class="s4">= </span><span class="s1">Qt</span><span class="s4">.</span><span class="s1">LeftButton</span>
        <span class="s2">if </span><span class="s4">(</span><span class="s1">modifiers </span><span class="s4">=== </span><span class="s1">undefined</span><span class="s4">)</span>
            <span class="s1">modifiers </span><span class="s4">= </span><span class="s1">Qt</span><span class="s4">.</span><span class="s1">NoModifier</span>
        <span class="s2">if </span><span class="s4">(</span><span class="s1">delay </span><span class="s4">== </span><span class="s1">undefined</span><span class="s4">)</span>
            <span class="s1">delay </span><span class="s4">= -</span><span class="s3">1</span>
        <span class="s2">if </span><span class="s4">(</span><span class="s1">x </span><span class="s4">=== </span><span class="s1">undefined</span><span class="s4">)</span>
            <span class="s1">x </span><span class="s4">= </span><span class="s1">item</span><span class="s4">.</span><span class="s1">width </span><span class="s4">/ </span><span class="s3">2</span>
        <span class="s2">if </span><span class="s4">(</span><span class="s1">y </span><span class="s4">=== </span><span class="s1">undefined</span><span class="s4">)</span>
            <span class="s1">y </span><span class="s4">= </span><span class="s1">item</span><span class="s4">.</span><span class="s1">height </span><span class="s4">/ </span><span class="s3">2</span>
        <span class="s2">if </span><span class="s4">(!</span><span class="s1">qtest_events</span><span class="s4">.</span><span class="s1">mouseRelease</span><span class="s4">(</span><span class="s1">item</span><span class="s4">, </span><span class="s1">x</span><span class="s4">, </span><span class="s1">y</span><span class="s4">, </span><span class="s1">button</span><span class="s4">, </span><span class="s1">modifiers</span><span class="s4">, </span><span class="s1">delay</span><span class="s4">))</span>
            <span class="s1">qtest_fail</span><span class="s4">(</span><span class="s6">&quot;window not shown&quot;</span><span class="s4">, </span><span class="s3">2</span><span class="s4">)</span>
    <span class="s4">}</span>

    <span class="s5">/*! 
        \qmlmethod TestCase::mouseDrag(item, x, y, dx, dy, button = Qt.LeftButton, modifiers = Qt.NoModifier, delay = -1) 
 
        Simulates dragging the mouse on an \a item with \a button pressed and optional \a modifiers 
        The initial drag position is defined by \a x and \a y, 
        and drag distance is defined by \a dx and \a dy. If \a delay is specified, 
        the test will wait for the specified amount of milliseconds before releasing the button. 
 
        The position given by \a x and \a y is transformed from the co-ordinate 
        system of \a item into window co-ordinates and then delivered. 
        If \a item is obscured by another item, or a child of \a item occupies 
        that position, then the event will be delivered to the other item instead. 
 
        \sa mousePress(), mouseClick(), mouseDoubleClickSequence(), mouseMove(), mouseRelease(), mouseWheel() 
    */</span>
    <span class="s2">function </span><span class="s1">mouseDrag</span><span class="s4">(</span><span class="s1">item</span><span class="s4">, </span><span class="s1">x</span><span class="s4">, </span><span class="s1">y</span><span class="s4">, </span><span class="s1">dx</span><span class="s4">, </span><span class="s1">dy</span><span class="s4">, </span><span class="s1">button</span><span class="s4">, </span><span class="s1">modifiers</span><span class="s4">, </span><span class="s1">delay</span><span class="s4">) {</span>
        <span class="s2">if </span><span class="s4">(!</span><span class="s1">qtest_verifyItem</span><span class="s4">(</span><span class="s1">item</span><span class="s4">, </span><span class="s6">&quot;mouseDrag&quot;</span><span class="s4">))</span>
            <span class="s2">return</span>

        <span class="s2">if </span><span class="s4">(</span><span class="s1">item</span><span class="s4">.</span><span class="s1">x </span><span class="s4">=== </span><span class="s1">undefined </span><span class="s4">|| </span><span class="s1">item</span><span class="s4">.</span><span class="s1">y </span><span class="s4">=== </span><span class="s1">undefined</span><span class="s4">)</span>
            <span class="s2">return</span>
        <span class="s2">if </span><span class="s4">(</span><span class="s1">button </span><span class="s4">=== </span><span class="s1">undefined</span><span class="s4">)</span>
            <span class="s1">button </span><span class="s4">= </span><span class="s1">Qt</span><span class="s4">.</span><span class="s1">LeftButton</span>
        <span class="s2">if </span><span class="s4">(</span><span class="s1">modifiers </span><span class="s4">=== </span><span class="s1">undefined</span><span class="s4">)</span>
            <span class="s1">modifiers </span><span class="s4">= </span><span class="s1">Qt</span><span class="s4">.</span><span class="s1">NoModifier</span>
        <span class="s2">if </span><span class="s4">(</span><span class="s1">delay </span><span class="s4">== </span><span class="s1">undefined</span><span class="s4">)</span>
            <span class="s1">delay </span><span class="s4">= -</span><span class="s3">1</span>
        <span class="s2">var </span><span class="s1">moveDelay </span><span class="s4">= </span><span class="s1">Math</span><span class="s4">.</span><span class="s1">max</span><span class="s4">(</span><span class="s3">1</span><span class="s4">, </span><span class="s1">delay </span><span class="s4">=== -</span><span class="s3">1 </span><span class="s4">? </span><span class="s1">qtest_events</span><span class="s4">.</span><span class="s1">defaultMouseDelay </span><span class="s4">: </span><span class="s1">delay</span><span class="s4">)</span>

        <span class="s5">// Divide dx and dy to have intermediate mouseMove while dragging</span>
        <span class="s5">// Fractions of dx/dy need be superior to the dragThreshold</span>
        <span class="s5">// to make the drag works though</span>
        <span class="s2">var </span><span class="s1">intermediateDx </span><span class="s4">= </span><span class="s1">Math</span><span class="s4">.</span><span class="s1">round</span><span class="s4">(</span><span class="s1">dx</span><span class="s4">/</span><span class="s3">3</span><span class="s4">)</span>
        <span class="s2">if </span><span class="s4">(</span><span class="s1">Math</span><span class="s4">.</span><span class="s1">abs</span><span class="s4">(</span><span class="s1">intermediateDx</span><span class="s4">) &lt; (</span><span class="s1">util</span><span class="s4">.</span><span class="s1">dragThreshold </span><span class="s4">+ </span><span class="s3">1</span><span class="s4">))</span>
            <span class="s1">intermediateDx </span><span class="s4">= </span><span class="s3">0</span>
        <span class="s2">var </span><span class="s1">intermediateDy </span><span class="s4">= </span><span class="s1">Math</span><span class="s4">.</span><span class="s1">round</span><span class="s4">(</span><span class="s1">dy</span><span class="s4">/</span><span class="s3">3</span><span class="s4">)</span>
        <span class="s2">if </span><span class="s4">(</span><span class="s1">Math</span><span class="s4">.</span><span class="s1">abs</span><span class="s4">(</span><span class="s1">intermediateDy</span><span class="s4">) &lt; (</span><span class="s1">util</span><span class="s4">.</span><span class="s1">dragThreshold </span><span class="s4">+ </span><span class="s3">1</span><span class="s4">))</span>
            <span class="s1">intermediateDy </span><span class="s4">= </span><span class="s3">0</span>

        <span class="s1">mousePress</span><span class="s4">(</span><span class="s1">item</span><span class="s4">, </span><span class="s1">x</span><span class="s4">, </span><span class="s1">y</span><span class="s4">, </span><span class="s1">button</span><span class="s4">, </span><span class="s1">modifiers</span><span class="s4">, </span><span class="s1">delay</span><span class="s4">)</span>

        <span class="s5">// Trigger dragging by dragging past the drag threshold, but making sure to only drag</span>
        <span class="s5">// along a certain axis if a distance greater than zero was given for that axis.</span>
        <span class="s2">var </span><span class="s1">dragTriggerXDistance </span><span class="s4">= </span><span class="s1">dx </span><span class="s4">&gt; </span><span class="s3">0 </span><span class="s4">? (</span><span class="s1">util</span><span class="s4">.</span><span class="s1">dragThreshold </span><span class="s4">+ </span><span class="s3">1</span><span class="s4">) : </span><span class="s3">0</span>
        <span class="s2">var </span><span class="s1">dragTriggerYDistance </span><span class="s4">= </span><span class="s1">dy </span><span class="s4">&gt; </span><span class="s3">0 </span><span class="s4">? (</span><span class="s1">util</span><span class="s4">.</span><span class="s1">dragThreshold </span><span class="s4">+ </span><span class="s3">1</span><span class="s4">) : </span><span class="s3">0</span>
        <span class="s1">mouseMove</span><span class="s4">(</span><span class="s1">item</span><span class="s4">, </span><span class="s1">x </span><span class="s4">+ </span><span class="s1">dragTriggerXDistance</span><span class="s4">, </span><span class="s1">y </span><span class="s4">+ </span><span class="s1">dragTriggerYDistance</span><span class="s4">, </span><span class="s1">moveDelay</span><span class="s4">, </span><span class="s1">button</span><span class="s4">)</span>
        <span class="s2">if </span><span class="s4">(</span><span class="s1">intermediateDx </span><span class="s4">!== </span><span class="s3">0 </span><span class="s4">|| </span><span class="s1">intermediateDy </span><span class="s4">!== </span><span class="s3">0</span><span class="s4">) {</span>
            <span class="s1">mouseMove</span><span class="s4">(</span><span class="s1">item</span><span class="s4">, </span><span class="s1">x </span><span class="s4">+ </span><span class="s1">intermediateDx</span><span class="s4">, </span><span class="s1">y </span><span class="s4">+ </span><span class="s1">intermediateDy</span><span class="s4">, </span><span class="s1">moveDelay</span><span class="s4">, </span><span class="s1">button</span><span class="s4">)</span>
            <span class="s1">mouseMove</span><span class="s4">(</span><span class="s1">item</span><span class="s4">, </span><span class="s1">x </span><span class="s4">+ </span><span class="s3">2</span><span class="s4">*</span><span class="s1">intermediateDx</span><span class="s4">, </span><span class="s1">y </span><span class="s4">+ </span><span class="s3">2</span><span class="s4">*</span><span class="s1">intermediateDy</span><span class="s4">, </span><span class="s1">moveDelay</span><span class="s4">, </span><span class="s1">button</span><span class="s4">)</span>
        <span class="s4">}</span>
        <span class="s1">mouseMove</span><span class="s4">(</span><span class="s1">item</span><span class="s4">, </span><span class="s1">x </span><span class="s4">+ </span><span class="s1">dx</span><span class="s4">, </span><span class="s1">y </span><span class="s4">+ </span><span class="s1">dy</span><span class="s4">, </span><span class="s1">moveDelay</span><span class="s4">, </span><span class="s1">button</span><span class="s4">)</span>
        <span class="s1">mouseRelease</span><span class="s4">(</span><span class="s1">item</span><span class="s4">, </span><span class="s1">x </span><span class="s4">+ </span><span class="s1">dx</span><span class="s4">, </span><span class="s1">y </span><span class="s4">+ </span><span class="s1">dy</span><span class="s4">, </span><span class="s1">button</span><span class="s4">, </span><span class="s1">modifiers</span><span class="s4">, </span><span class="s1">delay</span><span class="s4">)</span>
    <span class="s4">}</span>

    <span class="s5">/*! 
        \qmlmethod TestCase::mouseClick(item, x = item.width / 2, y = item.height / 2, button = Qt.LeftButton, modifiers = Qt.NoModifier, delay = -1) 
 
        Simulates clicking a mouse \a button with optional \a modifiers 
        on an \a item.  The position of the click is defined by \a x and \a y. 
        If \a x and \a y are not defined the position will be the center of \a item. 
        If \a delay is specified, the test will wait for the specified amount of 
        milliseconds before pressing and before releasing the button. 
 
        The position given by \a x and \a y is transformed from the co-ordinate 
        system of \a item into window co-ordinates and then delivered. 
        If \a item is obscured by another item, or a child of \a item occupies 
        that position, then the event will be delivered to the other item instead. 
 
        \sa mousePress(), mouseRelease(), mouseDoubleClickSequence(), mouseMove(), mouseDrag(), mouseWheel() 
    */</span>
    <span class="s2">function </span><span class="s1">mouseClick</span><span class="s4">(</span><span class="s1">item</span><span class="s4">, </span><span class="s1">x</span><span class="s4">, </span><span class="s1">y</span><span class="s4">, </span><span class="s1">button</span><span class="s4">, </span><span class="s1">modifiers</span><span class="s4">, </span><span class="s1">delay</span><span class="s4">) {</span>
        <span class="s2">if </span><span class="s4">(!</span><span class="s1">qtest_verifyItem</span><span class="s4">(</span><span class="s1">item</span><span class="s4">, </span><span class="s6">&quot;mouseClick&quot;</span><span class="s4">))</span>
            <span class="s2">return</span>

        <span class="s2">if </span><span class="s4">(</span><span class="s1">button </span><span class="s4">=== </span><span class="s1">undefined</span><span class="s4">)</span>
            <span class="s1">button </span><span class="s4">= </span><span class="s1">Qt</span><span class="s4">.</span><span class="s1">LeftButton</span>
        <span class="s2">if </span><span class="s4">(</span><span class="s1">modifiers </span><span class="s4">=== </span><span class="s1">undefined</span><span class="s4">)</span>
            <span class="s1">modifiers </span><span class="s4">= </span><span class="s1">Qt</span><span class="s4">.</span><span class="s1">NoModifier</span>
        <span class="s2">if </span><span class="s4">(</span><span class="s1">delay </span><span class="s4">== </span><span class="s1">undefined</span><span class="s4">)</span>
            <span class="s1">delay </span><span class="s4">= -</span><span class="s3">1</span>
        <span class="s2">if </span><span class="s4">(</span><span class="s1">x </span><span class="s4">=== </span><span class="s1">undefined</span><span class="s4">)</span>
            <span class="s1">x </span><span class="s4">= </span><span class="s1">item</span><span class="s4">.</span><span class="s1">width </span><span class="s4">/ </span><span class="s3">2</span>
        <span class="s2">if </span><span class="s4">(</span><span class="s1">y </span><span class="s4">=== </span><span class="s1">undefined</span><span class="s4">)</span>
            <span class="s1">y </span><span class="s4">= </span><span class="s1">item</span><span class="s4">.</span><span class="s1">height </span><span class="s4">/ </span><span class="s3">2</span>
        <span class="s2">if </span><span class="s4">(!</span><span class="s1">qtest_events</span><span class="s4">.</span><span class="s1">mouseClick</span><span class="s4">(</span><span class="s1">item</span><span class="s4">, </span><span class="s1">x</span><span class="s4">, </span><span class="s1">y</span><span class="s4">, </span><span class="s1">button</span><span class="s4">, </span><span class="s1">modifiers</span><span class="s4">, </span><span class="s1">delay</span><span class="s4">))</span>
            <span class="s1">qtest_fail</span><span class="s4">(</span><span class="s6">&quot;window not shown&quot;</span><span class="s4">, </span><span class="s3">2</span><span class="s4">)</span>
    <span class="s4">}</span>

    <span class="s5">/*! 
        \qmlmethod TestCase::mouseDoubleClick(item, x = item.width / 2, y = item.height / 2, button = Qt.LeftButton, modifiers = Qt.NoModifier, delay = -1) 
        \deprecated 
 
        Simulates double-clicking a mouse \a button with optional \a modifiers 
        on an \a item.  The position of the click is defined by \a x and \a y. 
        If \a x and \a y are not defined the position will be the center of \a item. 
        If \a delay is specified, the test will wait for the specified amount of 
        milliseconds before pressing and before releasing the button. 
 
        The position given by \a x and \a y is transformed from the co-ordinate 
        system of \a item into window co-ordinates and then delivered. 
        If \a item is obscured by another item, or a child of \a item occupies 
        that position, then the event will be delivered to the other item instead. 
 
        \sa mouseDoubleClickSequence(), mousePress(), mouseRelease(), mouseClick(), mouseMove(), mouseDrag(), mouseWheel() 
    */</span>
    <span class="s2">function </span><span class="s1">mouseDoubleClick</span><span class="s4">(</span><span class="s1">item</span><span class="s4">, </span><span class="s1">x</span><span class="s4">, </span><span class="s1">y</span><span class="s4">, </span><span class="s1">button</span><span class="s4">, </span><span class="s1">modifiers</span><span class="s4">, </span><span class="s1">delay</span><span class="s4">) {</span>
        <span class="s2">if </span><span class="s4">(!</span><span class="s1">qtest_verifyItem</span><span class="s4">(</span><span class="s1">item</span><span class="s4">, </span><span class="s6">&quot;mouseDoubleClick&quot;</span><span class="s4">))</span>
            <span class="s2">return</span>

        <span class="s2">if </span><span class="s4">(</span><span class="s1">button </span><span class="s4">=== </span><span class="s1">undefined</span><span class="s4">)</span>
            <span class="s1">button </span><span class="s4">= </span><span class="s1">Qt</span><span class="s4">.</span><span class="s1">LeftButton</span>
        <span class="s2">if </span><span class="s4">(</span><span class="s1">modifiers </span><span class="s4">=== </span><span class="s1">undefined</span><span class="s4">)</span>
            <span class="s1">modifiers </span><span class="s4">= </span><span class="s1">Qt</span><span class="s4">.</span><span class="s1">NoModifier</span>
        <span class="s2">if </span><span class="s4">(</span><span class="s1">delay </span><span class="s4">== </span><span class="s1">undefined</span><span class="s4">)</span>
            <span class="s1">delay </span><span class="s4">= -</span><span class="s3">1</span>
        <span class="s2">if </span><span class="s4">(</span><span class="s1">x </span><span class="s4">=== </span><span class="s1">undefined</span><span class="s4">)</span>
            <span class="s1">x </span><span class="s4">= </span><span class="s1">item</span><span class="s4">.</span><span class="s1">width </span><span class="s4">/ </span><span class="s3">2</span>
        <span class="s2">if </span><span class="s4">(</span><span class="s1">y </span><span class="s4">=== </span><span class="s1">undefined</span><span class="s4">)</span>
            <span class="s1">y </span><span class="s4">= </span><span class="s1">item</span><span class="s4">.</span><span class="s1">height </span><span class="s4">/ </span><span class="s3">2</span>
        <span class="s2">if </span><span class="s4">(!</span><span class="s1">qtest_events</span><span class="s4">.</span><span class="s1">mouseDoubleClick</span><span class="s4">(</span><span class="s1">item</span><span class="s4">, </span><span class="s1">x</span><span class="s4">, </span><span class="s1">y</span><span class="s4">, </span><span class="s1">button</span><span class="s4">, </span><span class="s1">modifiers</span><span class="s4">, </span><span class="s1">delay</span><span class="s4">))</span>
            <span class="s1">qtest_fail</span><span class="s4">(</span><span class="s6">&quot;window not shown&quot;</span><span class="s4">, </span><span class="s3">2</span><span class="s4">)</span>
    <span class="s4">}</span>

    <span class="s5">/*! 
        \qmlmethod TestCase::mouseDoubleClickSequence(item, x = item.width / 2, y = item.height / 2, button = Qt.LeftButton, modifiers = Qt.NoModifier, delay = -1) 
 
        Simulates the full sequence of events generated by double-clicking a mouse 
        \a button with optional \a modifiers on an \a item. 
 
        This method reproduces the sequence of mouse events generated when a user makes 
        a double click: Press-Release-Press-DoubleClick-Release. 
 
        The position of the click is defined by \a x and \a y. 
        If \a x and \a y are not defined the position will be the center of \a item. 
        If \a delay is specified, the test will wait for the specified amount of 
        milliseconds before pressing and before releasing the button. 
 
        The position given by \a x and \a y is transformed from the co-ordinate 
        system of \a item into window co-ordinates and then delivered. 
        If \a item is obscured by another item, or a child of \a item occupies 
        that position, then the event will be delivered to the other item instead. 
 
        This QML method was introduced in Qt 5.5. 
 
        \sa mousePress(), mouseRelease(), mouseClick(), mouseMove(), mouseDrag(), mouseWheel() 
    */</span>
    <span class="s2">function </span><span class="s1">mouseDoubleClickSequence</span><span class="s4">(</span><span class="s1">item</span><span class="s4">, </span><span class="s1">x</span><span class="s4">, </span><span class="s1">y</span><span class="s4">, </span><span class="s1">button</span><span class="s4">, </span><span class="s1">modifiers</span><span class="s4">, </span><span class="s1">delay</span><span class="s4">) {</span>
        <span class="s2">if </span><span class="s4">(!</span><span class="s1">qtest_verifyItem</span><span class="s4">(</span><span class="s1">item</span><span class="s4">, </span><span class="s6">&quot;mouseDoubleClickSequence&quot;</span><span class="s4">))</span>
            <span class="s2">return</span>

        <span class="s2">if </span><span class="s4">(</span><span class="s1">button </span><span class="s4">=== </span><span class="s1">undefined</span><span class="s4">)</span>
            <span class="s1">button </span><span class="s4">= </span><span class="s1">Qt</span><span class="s4">.</span><span class="s1">LeftButton</span>
        <span class="s2">if </span><span class="s4">(</span><span class="s1">modifiers </span><span class="s4">=== </span><span class="s1">undefined</span><span class="s4">)</span>
            <span class="s1">modifiers </span><span class="s4">= </span><span class="s1">Qt</span><span class="s4">.</span><span class="s1">NoModifier</span>
        <span class="s2">if </span><span class="s4">(</span><span class="s1">delay </span><span class="s4">== </span><span class="s1">undefined</span><span class="s4">)</span>
            <span class="s1">delay </span><span class="s4">= -</span><span class="s3">1</span>
        <span class="s2">if </span><span class="s4">(</span><span class="s1">x </span><span class="s4">=== </span><span class="s1">undefined</span><span class="s4">)</span>
            <span class="s1">x </span><span class="s4">= </span><span class="s1">item</span><span class="s4">.</span><span class="s1">width </span><span class="s4">/ </span><span class="s3">2</span>
        <span class="s2">if </span><span class="s4">(</span><span class="s1">y </span><span class="s4">=== </span><span class="s1">undefined</span><span class="s4">)</span>
            <span class="s1">y </span><span class="s4">= </span><span class="s1">item</span><span class="s4">.</span><span class="s1">height </span><span class="s4">/ </span><span class="s3">2</span>
        <span class="s2">if </span><span class="s4">(!</span><span class="s1">qtest_events</span><span class="s4">.</span><span class="s1">mouseDoubleClickSequence</span><span class="s4">(</span><span class="s1">item</span><span class="s4">, </span><span class="s1">x</span><span class="s4">, </span><span class="s1">y</span><span class="s4">, </span><span class="s1">button</span><span class="s4">, </span><span class="s1">modifiers</span><span class="s4">, </span><span class="s1">delay</span><span class="s4">))</span>
            <span class="s1">qtest_fail</span><span class="s4">(</span><span class="s6">&quot;window not shown&quot;</span><span class="s4">, </span><span class="s3">2</span><span class="s4">)</span>
    <span class="s4">}</span>

    <span class="s5">/*! 
        \qmlmethod TestCase::mouseMove(item, x, y, delay = -1) 
 
        Moves the mouse pointer to the position given by \a x and \a y within 
        \a item.  If a \a delay (in milliseconds) is given, the test will wait 
        before moving the mouse pointer. 
 
        The position given by \a x and \a y is transformed from the co-ordinate 
        system of \a item into window co-ordinates and then delivered. 
        If \a item is obscured by another item, or a child of \a item occupies 
        that position, then the event will be delivered to the other item instead. 
 
        \sa mousePress(), mouseRelease(), mouseClick(), mouseDoubleClickSequence(), mouseDrag(), mouseWheel() 
    */</span>
    <span class="s2">function </span><span class="s1">mouseMove</span><span class="s4">(</span><span class="s1">item</span><span class="s4">, </span><span class="s1">x</span><span class="s4">, </span><span class="s1">y</span><span class="s4">, </span><span class="s1">delay</span><span class="s4">, </span><span class="s1">buttons</span><span class="s4">) {</span>
        <span class="s2">if </span><span class="s4">(!</span><span class="s1">qtest_verifyItem</span><span class="s4">(</span><span class="s1">item</span><span class="s4">, </span><span class="s6">&quot;mouseMove&quot;</span><span class="s4">))</span>
            <span class="s2">return</span>

        <span class="s2">if </span><span class="s4">(</span><span class="s1">delay </span><span class="s4">== </span><span class="s1">undefined</span><span class="s4">)</span>
            <span class="s1">delay </span><span class="s4">= -</span><span class="s3">1</span>
        <span class="s2">if </span><span class="s4">(</span><span class="s1">buttons </span><span class="s4">== </span><span class="s1">undefined</span><span class="s4">)</span>
            <span class="s1">buttons </span><span class="s4">= </span><span class="s1">Qt</span><span class="s4">.</span><span class="s1">NoButton</span>
        <span class="s2">if </span><span class="s4">(!</span><span class="s1">qtest_events</span><span class="s4">.</span><span class="s1">mouseMove</span><span class="s4">(</span><span class="s1">item</span><span class="s4">, </span><span class="s1">x</span><span class="s4">, </span><span class="s1">y</span><span class="s4">, </span><span class="s1">delay</span><span class="s4">, </span><span class="s1">buttons</span><span class="s4">))</span>
            <span class="s1">qtest_fail</span><span class="s4">(</span><span class="s6">&quot;window not shown&quot;</span><span class="s4">, </span><span class="s3">2</span><span class="s4">)</span>
    <span class="s4">}</span>

    <span class="s5">/*! 
        \qmlmethod TestCase::mouseWheel(item, x, y, xDelta, yDelta, button = Qt.LeftButton, modifiers = Qt.NoModifier, delay = -1) 
 
        Simulates rotating the mouse wheel on an \a item with \a button pressed and optional \a modifiers. 
        The position of the wheel event is defined by \a x and \a y. 
        If \a delay is specified, the test will wait for the specified amount of milliseconds before releasing the button. 
 
        The position given by \a x and \a y is transformed from the co-ordinate 
        system of \a item into window co-ordinates and then delivered. 
        If \a item is obscured by another item, or a child of \a item occupies 
        that position, then the event will be delivered to the other item instead. 
 
        The \a xDelta and \a yDelta contain the wheel rotation distance in eighths of a degree. see \l QWheelEvent::angleDelta() for more details. 
 
        \sa mousePress(), mouseClick(), mouseDoubleClickSequence(), mouseMove(), mouseRelease(), mouseDrag(), QWheelEvent::angleDelta() 
    */</span>
    <span class="s2">function </span><span class="s1">mouseWheel</span><span class="s4">(</span><span class="s1">item</span><span class="s4">, </span><span class="s1">x</span><span class="s4">, </span><span class="s1">y</span><span class="s4">, </span><span class="s1">xDelta</span><span class="s4">, </span><span class="s1">yDelta</span><span class="s4">, </span><span class="s1">buttons</span><span class="s4">, </span><span class="s1">modifiers</span><span class="s4">, </span><span class="s1">delay</span><span class="s4">) {</span>
        <span class="s2">if </span><span class="s4">(!</span><span class="s1">qtest_verifyItem</span><span class="s4">(</span><span class="s1">item</span><span class="s4">, </span><span class="s6">&quot;mouseWheel&quot;</span><span class="s4">))</span>
            <span class="s2">return</span>

        <span class="s2">if </span><span class="s4">(</span><span class="s1">delay </span><span class="s4">== </span><span class="s1">undefined</span><span class="s4">)</span>
            <span class="s1">delay </span><span class="s4">= -</span><span class="s3">1</span>
        <span class="s2">if </span><span class="s4">(</span><span class="s1">buttons </span><span class="s4">== </span><span class="s1">undefined</span><span class="s4">)</span>
            <span class="s1">buttons </span><span class="s4">= </span><span class="s1">Qt</span><span class="s4">.</span><span class="s1">NoButton</span>
        <span class="s2">if </span><span class="s4">(</span><span class="s1">modifiers </span><span class="s4">=== </span><span class="s1">undefined</span><span class="s4">)</span>
            <span class="s1">modifiers </span><span class="s4">= </span><span class="s1">Qt</span><span class="s4">.</span><span class="s1">NoModifier</span>
        <span class="s2">if </span><span class="s4">(</span><span class="s1">xDelta </span><span class="s4">== </span><span class="s1">undefined</span><span class="s4">)</span>
            <span class="s1">xDelta </span><span class="s4">= </span><span class="s3">0</span>
        <span class="s2">if </span><span class="s4">(</span><span class="s1">yDelta </span><span class="s4">== </span><span class="s1">undefined</span><span class="s4">)</span>
            <span class="s1">yDelta </span><span class="s4">= </span><span class="s3">0</span>
        <span class="s2">if </span><span class="s4">(!</span><span class="s1">qtest_events</span><span class="s4">.</span><span class="s1">mouseWheel</span><span class="s4">(</span><span class="s1">item</span><span class="s4">, </span><span class="s1">x</span><span class="s4">, </span><span class="s1">y</span><span class="s4">, </span><span class="s1">buttons</span><span class="s4">, </span><span class="s1">modifiers</span><span class="s4">, </span><span class="s1">xDelta</span><span class="s4">, </span><span class="s1">yDelta</span><span class="s4">, </span><span class="s1">delay</span><span class="s4">))</span>
            <span class="s1">qtest_fail</span><span class="s4">(</span><span class="s6">&quot;window not shown&quot;</span><span class="s4">, </span><span class="s3">2</span><span class="s4">)</span>
   <span class="s4">}</span>

    <span class="s5">/*! 
        \qmlmethod TouchEventSequence TestCase::touchEvent(object item) 
 
        \since 5.9 
 
        Begins a sequence of touch events through a simulated QTouchDevice::TouchScreen. 
        Events are delivered to the window containing \a item. 
 
        The returned object is used to enumerate events to be delivered through a single 
        QTouchEvent. Touches are delivered to the window containing the TestCase unless 
        otherwise specified. 
 
        \code 
        Rectangle { 
            width: 640; height: 480 
 
            MultiPointTouchArea { 
                id: area 
                anchors.fill: parent 
 
                property bool touched: false 
 
                onPressed: touched = true 
            } 
 
            TestCase { 
                name: &quot;ItemTests&quot; 
                when: windowShown 
                id: test1 
 
                function test_touch() { 
                    var touch = touchEvent(area); 
                    touch.press(0, area, 10, 10); 
                    touch.commit(); 
                    verify(area.touched); 
                } 
            } 
        } 
        \endcode 
 
        \sa TouchEventSequence::press(), TouchEventSequence::move(), TouchEventSequence::release(), TouchEventSequence::stationary(), TouchEventSequence::commit(), QTouchDevice::TouchScreen 
    */</span>

    <span class="s2">function </span><span class="s1">touchEvent</span><span class="s4">(</span><span class="s1">item</span><span class="s4">) {</span>
        <span class="s2">if </span><span class="s4">(!</span><span class="s1">qtest_verifyItem</span><span class="s4">(</span><span class="s1">item</span><span class="s4">, </span><span class="s6">&quot;touchEvent&quot;</span><span class="s4">))</span>
            <span class="s2">return</span>

        <span class="s2">return </span><span class="s4">{</span>
            <span class="s1">_defaultItem</span><span class="s4">: </span><span class="s1">item</span><span class="s4">,</span>
            <span class="s1">_sequence</span><span class="s4">: </span><span class="s1">qtest_events</span><span class="s4">.</span><span class="s1">touchEvent</span><span class="s4">(</span><span class="s1">item</span><span class="s4">),</span>

            <span class="s1">press</span><span class="s4">: </span><span class="s2">function </span><span class="s4">(</span><span class="s1">id</span><span class="s4">, </span><span class="s1">target</span><span class="s4">, </span><span class="s1">x</span><span class="s4">, </span><span class="s1">y</span><span class="s4">) {</span>
                <span class="s2">if </span><span class="s4">(!</span><span class="s1">target</span><span class="s4">)</span>
                    <span class="s1">target </span><span class="s4">= </span><span class="s2">this</span><span class="s4">.</span><span class="s1">_defaultItem</span><span class="s4">;</span>
                <span class="s2">if </span><span class="s4">(</span><span class="s1">id </span><span class="s4">=== </span><span class="s1">undefined</span><span class="s4">)</span>
                    <span class="s1">qtest_fail</span><span class="s4">(</span><span class="s6">&quot;No id given to TouchEventSequence::press&quot;</span><span class="s4">, </span><span class="s3">1</span><span class="s4">);</span>
                <span class="s2">if </span><span class="s4">(</span><span class="s1">x </span><span class="s4">=== </span><span class="s1">undefined</span><span class="s4">)</span>
                    <span class="s1">x </span><span class="s4">= </span><span class="s1">target</span><span class="s4">.</span><span class="s1">width </span><span class="s4">/ </span><span class="s3">2</span><span class="s4">;</span>
                <span class="s2">if </span><span class="s4">(</span><span class="s1">y </span><span class="s4">=== </span><span class="s1">undefined</span><span class="s4">)</span>
                    <span class="s1">y </span><span class="s4">= </span><span class="s1">target</span><span class="s4">.</span><span class="s1">height </span><span class="s4">/ </span><span class="s3">2</span><span class="s4">;</span>
                <span class="s2">this</span><span class="s4">.</span><span class="s1">_sequence</span><span class="s4">.</span><span class="s1">press</span><span class="s4">(</span><span class="s1">id</span><span class="s4">, </span><span class="s1">target</span><span class="s4">, </span><span class="s1">x</span><span class="s4">, </span><span class="s1">y</span><span class="s4">);</span>
                <span class="s2">return this</span><span class="s4">;</span>
            <span class="s4">},</span>

            <span class="s1">move</span><span class="s4">: </span><span class="s2">function </span><span class="s4">(</span><span class="s1">id</span><span class="s4">, </span><span class="s1">target</span><span class="s4">, </span><span class="s1">x</span><span class="s4">, </span><span class="s1">y</span><span class="s4">) {</span>
                <span class="s2">if </span><span class="s4">(!</span><span class="s1">target</span><span class="s4">)</span>
                    <span class="s1">target </span><span class="s4">= </span><span class="s2">this</span><span class="s4">.</span><span class="s1">_defaultItem</span><span class="s4">;</span>
                <span class="s2">if </span><span class="s4">(</span><span class="s1">id </span><span class="s4">=== </span><span class="s1">undefined</span><span class="s4">)</span>
                    <span class="s1">qtest_fail</span><span class="s4">(</span><span class="s6">&quot;No id given to TouchEventSequence::move&quot;</span><span class="s4">, </span><span class="s3">1</span><span class="s4">);</span>
                <span class="s2">if </span><span class="s4">(</span><span class="s1">x </span><span class="s4">=== </span><span class="s1">undefined</span><span class="s4">)</span>
                    <span class="s1">x </span><span class="s4">= </span><span class="s1">target</span><span class="s4">.</span><span class="s1">width </span><span class="s4">/ </span><span class="s3">2</span><span class="s4">;</span>
                <span class="s2">if </span><span class="s4">(</span><span class="s1">y </span><span class="s4">=== </span><span class="s1">undefined</span><span class="s4">)</span>
                    <span class="s1">y </span><span class="s4">= </span><span class="s1">target</span><span class="s4">.</span><span class="s1">height </span><span class="s4">/ </span><span class="s3">2</span><span class="s4">;</span>
                <span class="s2">this</span><span class="s4">.</span><span class="s1">_sequence</span><span class="s4">.</span><span class="s1">move</span><span class="s4">(</span><span class="s1">id</span><span class="s4">, </span><span class="s1">target</span><span class="s4">, </span><span class="s1">x</span><span class="s4">, </span><span class="s1">y</span><span class="s4">);</span>
                <span class="s2">return this</span><span class="s4">;</span>
            <span class="s4">},</span>

            <span class="s1">stationary</span><span class="s4">: </span><span class="s2">function </span><span class="s4">(</span><span class="s1">id</span><span class="s4">) {</span>
                <span class="s2">if </span><span class="s4">(</span><span class="s1">id </span><span class="s4">=== </span><span class="s1">undefined</span><span class="s4">)</span>
                    <span class="s1">qtest_fail</span><span class="s4">(</span><span class="s6">&quot;No id given to TouchEventSequence::stationary&quot;</span><span class="s4">, </span><span class="s3">1</span><span class="s4">);</span>
                <span class="s2">this</span><span class="s4">.</span><span class="s1">_sequence</span><span class="s4">.</span><span class="s1">stationary</span><span class="s4">(</span><span class="s1">id</span><span class="s4">);</span>
                <span class="s2">return this</span><span class="s4">;</span>
            <span class="s4">},</span>

            <span class="s1">release</span><span class="s4">: </span><span class="s2">function </span><span class="s4">(</span><span class="s1">id</span><span class="s4">, </span><span class="s1">target</span><span class="s4">, </span><span class="s1">x</span><span class="s4">, </span><span class="s1">y</span><span class="s4">) {</span>
                <span class="s2">if </span><span class="s4">(!</span><span class="s1">target</span><span class="s4">)</span>
                    <span class="s1">target </span><span class="s4">= </span><span class="s2">this</span><span class="s4">.</span><span class="s1">_defaultItem</span><span class="s4">;</span>
                <span class="s2">if </span><span class="s4">(</span><span class="s1">id </span><span class="s4">=== </span><span class="s1">undefined</span><span class="s4">)</span>
                    <span class="s1">qtest_fail</span><span class="s4">(</span><span class="s6">&quot;No id given to TouchEventSequence::release&quot;</span><span class="s4">, </span><span class="s3">1</span><span class="s4">);</span>
                <span class="s2">if </span><span class="s4">(</span><span class="s1">x </span><span class="s4">=== </span><span class="s1">undefined</span><span class="s4">)</span>
                    <span class="s1">x </span><span class="s4">= </span><span class="s1">target</span><span class="s4">.</span><span class="s1">width </span><span class="s4">/ </span><span class="s3">2</span><span class="s4">;</span>
                <span class="s2">if </span><span class="s4">(</span><span class="s1">y </span><span class="s4">=== </span><span class="s1">undefined</span><span class="s4">)</span>
                    <span class="s1">y </span><span class="s4">= </span><span class="s1">target</span><span class="s4">.</span><span class="s1">height </span><span class="s4">/ </span><span class="s3">2</span><span class="s4">;</span>
                <span class="s2">this</span><span class="s4">.</span><span class="s1">_sequence</span><span class="s4">.</span><span class="s1">release</span><span class="s4">(</span><span class="s1">id</span><span class="s4">, </span><span class="s1">target</span><span class="s4">, </span><span class="s1">x</span><span class="s4">, </span><span class="s1">y</span><span class="s4">);</span>
                <span class="s2">return this</span><span class="s4">;</span>
            <span class="s4">},</span>

            <span class="s1">commit</span><span class="s4">: </span><span class="s2">function </span><span class="s4">() {</span>
                 <span class="s2">this</span><span class="s4">.</span><span class="s1">_sequence</span><span class="s4">.</span><span class="s1">commit</span><span class="s4">();</span>
                 <span class="s2">return this</span><span class="s4">;</span>
            <span class="s4">}</span>
        <span class="s4">};</span>
    <span class="s4">}</span>

    <span class="s5">// Functions that can be overridden in subclasses for init/cleanup duties.</span>
    <span class="s5">/*! 
        \qmlmethod TestCase::initTestCase() 
 
        This function is called before any other test functions in the 
        \l TestCase type.  The default implementation does nothing. 
        The application can provide its own implementation to perform 
        test case initialization. 
 
        \sa cleanupTestCase(), init() 
    */</span>
    <span class="s2">function </span><span class="s1">initTestCase</span><span class="s4">() {}</span>

    <span class="s5">/*! 
        \qmlmethod TestCase::cleanupTestCase() 
 
        This function is called after all other test functions in the 
        \l TestCase type have completed.  The default implementation 
        does nothing.  The application can provide its own implementation 
        to perform test case cleanup. 
 
        \sa initTestCase(), cleanup() 
    */</span>
    <span class="s2">function </span><span class="s1">cleanupTestCase</span><span class="s4">() {}</span>

    <span class="s5">/*! 
        \qmlmethod TestCase::init() 
 
        This function is called before each test function that is 
        executed in the \l TestCase type.  The default implementation 
        does nothing.  The application can provide its own implementation 
        to perform initialization before each test function. 
 
        \sa cleanup(), initTestCase() 
    */</span>
    <span class="s2">function </span><span class="s1">init</span><span class="s4">() {}</span>

    <span class="s5">/*! 
        \qmlmethod TestCase::cleanup() 
 
        This function is called after each test function that is 
        executed in the \l TestCase type.  The default implementation 
        does nothing.  The application can provide its own implementation 
        to perform cleanup after each test function. 
 
        \sa init(), cleanupTestCase() 
    */</span>
    <span class="s2">function </span><span class="s1">cleanup</span><span class="s4">() {}</span>

    <span class="s5">/*! \internal */</span>
    <span class="s2">function </span><span class="s1">qtest_verifyItem</span><span class="s4">(</span><span class="s1">item</span><span class="s4">, </span><span class="s1">method</span><span class="s4">) {</span>
        <span class="s2">try </span><span class="s4">{</span>
            <span class="s2">if </span><span class="s4">(!(</span><span class="s1">item </span><span class="s2">instanceof </span><span class="s1">Item</span><span class="s4">) &amp;&amp;</span>
                <span class="s4">!(</span><span class="s1">item </span><span class="s2">instanceof </span><span class="s1">Window</span><span class="s4">)) {</span>
                <span class="s5">// it's a QObject, but not a type</span>
                <span class="s1">qtest_fail</span><span class="s4">(</span><span class="s6">&quot;TypeError: %1 requires an Item or Window type&quot;</span><span class="s4">.</span><span class="s1">arg</span><span class="s4">(</span><span class="s1">method</span><span class="s4">), </span><span class="s3">2</span><span class="s4">);</span>
                <span class="s2">return false</span><span class="s4">;</span>
            <span class="s4">}</span>
        <span class="s4">} </span><span class="s2">catch </span><span class="s4">(</span><span class="s1">e</span><span class="s4">) { </span><span class="s5">// it's not a QObject</span>
            <span class="s1">qtest_fail</span><span class="s4">(</span><span class="s6">&quot;TypeError: %1 requires an Item or Window type&quot;</span><span class="s4">.</span><span class="s1">arg</span><span class="s4">(</span><span class="s1">method</span><span class="s4">), </span><span class="s3">3</span><span class="s4">);</span>
            <span class="s2">return false</span><span class="s4">;</span>
        <span class="s4">}</span>

        <span class="s2">return true</span><span class="s4">;</span>
    <span class="s4">}</span>

    <span class="s5">/*! \internal */</span>
    <span class="s2">function </span><span class="s1">qtest_runInternal</span><span class="s4">(</span><span class="s1">prop</span><span class="s4">, </span><span class="s1">arg</span><span class="s4">) {</span>
        <span class="s2">try </span><span class="s4">{</span>
            <span class="s1">qtest_testCaseResult </span><span class="s4">= </span><span class="s1">testCase</span><span class="s4">[</span><span class="s1">prop</span><span class="s4">](</span><span class="s1">arg</span><span class="s4">)</span>
        <span class="s4">} </span><span class="s2">catch </span><span class="s4">(</span><span class="s1">e</span><span class="s4">) {</span>
            <span class="s1">qtest_testCaseResult </span><span class="s4">= []</span>
            <span class="s2">if </span><span class="s4">(</span><span class="s1">e</span><span class="s4">.</span><span class="s1">message</span><span class="s4">.</span><span class="s1">indexOf</span><span class="s4">(</span><span class="s6">&quot;QtQuickTest::&quot;</span><span class="s4">) != </span><span class="s3">0</span><span class="s4">) {</span>
                <span class="s5">// Test threw an unrecognized exception - fail.</span>
                <span class="s1">qtest_results</span><span class="s4">.</span><span class="s1">fail</span><span class="s4">(</span><span class="s6">&quot;Uncaught exception: &quot; </span><span class="s4">+ </span><span class="s1">e</span><span class="s4">.</span><span class="s1">message</span><span class="s4">,</span>
                             <span class="s1">e</span><span class="s4">.</span><span class="s1">fileName</span><span class="s4">, </span><span class="s1">e</span><span class="s4">.</span><span class="s1">lineNumber</span><span class="s4">)</span>
            <span class="s4">}</span>
        <span class="s4">}</span>
        <span class="s2">return </span><span class="s4">!</span><span class="s1">qtest_results</span><span class="s4">.</span><span class="s1">failed</span>
    <span class="s4">}</span>

    <span class="s5">/*! \internal */</span>
    <span class="s2">function </span><span class="s1">qtest_runFunction</span><span class="s4">(</span><span class="s1">prop</span><span class="s4">, </span><span class="s1">arg</span><span class="s4">) {</span>
        <span class="s1">qtest_runInternal</span><span class="s4">(</span><span class="s6">&quot;init&quot;</span><span class="s4">)</span>
        <span class="s2">if </span><span class="s4">(!</span><span class="s1">qtest_results</span><span class="s4">.</span><span class="s1">skipped</span><span class="s4">) {</span>
            <span class="s1">qtest_runInternal</span><span class="s4">(</span><span class="s1">prop</span><span class="s4">, </span><span class="s1">arg</span><span class="s4">)</span>
            <span class="s1">qtest_results</span><span class="s4">.</span><span class="s1">finishTestData</span><span class="s4">()</span>
            <span class="s1">qtest_runInternal</span><span class="s4">(</span><span class="s6">&quot;cleanup&quot;</span><span class="s4">)</span>
            <span class="s1">qtest_destroyTemporaryObjects</span><span class="s4">()</span>
            <span class="s1">qtest_results</span><span class="s4">.</span><span class="s1">finishTestDataCleanup</span><span class="s4">()</span>
            <span class="s5">// wait(0) will call processEvents() so objects marked for deletion</span>
            <span class="s5">// in the test function will be deleted.</span>
            <span class="s1">wait</span><span class="s4">(</span><span class="s3">0</span><span class="s4">)</span>
        <span class="s4">}</span>
    <span class="s4">}</span>

    <span class="s5">/*! \internal */</span>
    <span class="s2">function </span><span class="s1">qtest_runBenchmarkFunction</span><span class="s4">(</span><span class="s1">prop</span><span class="s4">, </span><span class="s1">arg</span><span class="s4">) {</span>
        <span class="s1">qtest_results</span><span class="s4">.</span><span class="s1">startMeasurement</span><span class="s4">()</span>
        <span class="s2">do </span><span class="s4">{</span>
            <span class="s1">qtest_results</span><span class="s4">.</span><span class="s1">beginDataRun</span><span class="s4">()</span>
            <span class="s2">do </span><span class="s4">{</span>
                <span class="s5">// Run the initialization function.</span>
                <span class="s1">qtest_runInternal</span><span class="s4">(</span><span class="s6">&quot;init&quot;</span><span class="s4">)</span>
                <span class="s2">if </span><span class="s4">(</span><span class="s1">qtest_results</span><span class="s4">.</span><span class="s1">skipped</span><span class="s4">)</span>
                    <span class="s2">break</span>

                <span class="s5">// Execute the benchmark function.</span>
                <span class="s2">if </span><span class="s4">(</span><span class="s1">prop</span><span class="s4">.</span><span class="s1">indexOf</span><span class="s4">(</span><span class="s6">&quot;benchmark_once_&quot;</span><span class="s4">) != </span><span class="s3">0</span><span class="s4">)</span>
                    <span class="s1">qtest_results</span><span class="s4">.</span><span class="s1">startBenchmark</span><span class="s4">(</span><span class="s1">TestResult</span><span class="s4">.</span><span class="s1">RepeatUntilValidMeasurement</span><span class="s4">, </span><span class="s1">qtest_results</span><span class="s4">.</span><span class="s1">dataTag</span><span class="s4">)</span>
                <span class="s2">else</span>
                    <span class="s1">qtest_results</span><span class="s4">.</span><span class="s1">startBenchmark</span><span class="s4">(</span><span class="s1">TestResult</span><span class="s4">.</span><span class="s1">RunOnce</span><span class="s4">, </span><span class="s1">qtest_results</span><span class="s4">.</span><span class="s1">dataTag</span><span class="s4">)</span>
                <span class="s2">while </span><span class="s4">(!</span><span class="s1">qtest_results</span><span class="s4">.</span><span class="s1">isBenchmarkDone</span><span class="s4">()) {</span>
                    <span class="s2">var </span><span class="s1">success </span><span class="s4">= </span><span class="s1">qtest_runInternal</span><span class="s4">(</span><span class="s1">prop</span><span class="s4">, </span><span class="s1">arg</span><span class="s4">)</span>
                    <span class="s1">qtest_results</span><span class="s4">.</span><span class="s1">finishTestData</span><span class="s4">()</span>
                    <span class="s2">if </span><span class="s4">(!</span><span class="s1">success</span><span class="s4">)</span>
                        <span class="s2">break</span>
                    <span class="s1">qtest_results</span><span class="s4">.</span><span class="s1">nextBenchmark</span><span class="s4">()</span>
                <span class="s4">}</span>
                <span class="s1">qtest_results</span><span class="s4">.</span><span class="s1">stopBenchmark</span><span class="s4">()</span>

                <span class="s5">// Run the cleanup function.</span>
                <span class="s1">qtest_runInternal</span><span class="s4">(</span><span class="s6">&quot;cleanup&quot;</span><span class="s4">)</span>
                <span class="s1">qtest_results</span><span class="s4">.</span><span class="s1">finishTestDataCleanup</span><span class="s4">()</span>
                <span class="s5">// wait(0) will call processEvents() so objects marked for deletion</span>
                <span class="s5">// in the test function will be deleted.</span>
                <span class="s1">wait</span><span class="s4">(</span><span class="s3">0</span><span class="s4">)</span>
            <span class="s4">} </span><span class="s2">while </span><span class="s4">(!</span><span class="s1">qtest_results</span><span class="s4">.</span><span class="s1">measurementAccepted</span><span class="s4">())</span>
            <span class="s1">qtest_results</span><span class="s4">.</span><span class="s1">endDataRun</span><span class="s4">()</span>
        <span class="s4">} </span><span class="s2">while </span><span class="s4">(</span><span class="s1">qtest_results</span><span class="s4">.</span><span class="s1">needsMoreMeasurements</span><span class="s4">())</span>
    <span class="s4">}</span>

    <span class="s5">/*! \internal */</span>
    <span class="s2">function </span><span class="s1">qtest_run</span><span class="s4">() {</span>
        <span class="s2">if </span><span class="s4">(</span><span class="s1">TestLogger</span><span class="s4">.</span><span class="s1">log_start_test</span><span class="s4">()) {</span>
            <span class="s1">qtest_results</span><span class="s4">.</span><span class="s1">reset</span><span class="s4">()</span>
            <span class="s1">qtest_results</span><span class="s4">.</span><span class="s1">testCaseName </span><span class="s4">= </span><span class="s1">name</span>
            <span class="s1">qtest_results</span><span class="s4">.</span><span class="s1">startLogging</span><span class="s4">()</span>
        <span class="s4">} </span><span class="s2">else </span><span class="s4">{</span>
            <span class="s1">qtest_results</span><span class="s4">.</span><span class="s1">testCaseName </span><span class="s4">= </span><span class="s1">name</span>
        <span class="s4">}</span>
        <span class="s1">running </span><span class="s4">= </span><span class="s2">true</span>

        <span class="s5">// Check the run list to see if this class is mentioned.</span>
        <span class="s2">let </span><span class="s1">checkNames </span><span class="s4">= </span><span class="s2">false</span>
        <span class="s2">let </span><span class="s1">testsToRun </span><span class="s4">= {} </span><span class="s5">// explicitly provided function names to run and their tags for data-driven tests</span>

        <span class="s2">if </span><span class="s4">(</span><span class="s1">qtest_results</span><span class="s4">.</span><span class="s1">functionsToRun</span><span class="s4">.</span><span class="s1">length </span><span class="s4">&gt; </span><span class="s3">0</span><span class="s4">) {</span>
            <span class="s1">checkNames </span><span class="s4">= </span><span class="s2">true</span>
            <span class="s2">var </span><span class="s1">found </span><span class="s4">= </span><span class="s2">false</span>

            <span class="s2">if </span><span class="s4">(</span><span class="s1">name</span><span class="s4">.</span><span class="s1">length </span><span class="s4">&gt; </span><span class="s3">0</span><span class="s4">) {</span>
                <span class="s2">for </span><span class="s4">(</span><span class="s2">var </span><span class="s1">index </span><span class="s2">in </span><span class="s1">qtest_results</span><span class="s4">.</span><span class="s1">functionsToRun</span><span class="s4">) {</span>
                    <span class="s2">let </span><span class="s1">caseFuncName </span><span class="s4">= </span><span class="s1">qtest_results</span><span class="s4">.</span><span class="s1">functionsToRun</span><span class="s4">[</span><span class="s1">index</span><span class="s4">]</span>
                    <span class="s2">if </span><span class="s4">(</span><span class="s1">caseFuncName</span><span class="s4">.</span><span class="s1">indexOf</span><span class="s4">(</span><span class="s1">name </span><span class="s4">+ </span><span class="s6">&quot;::&quot;</span><span class="s4">) != </span><span class="s3">0</span><span class="s4">)</span>
                        <span class="s2">continue</span>

                    <span class="s1">found </span><span class="s4">= </span><span class="s2">true</span>
                    <span class="s2">let </span><span class="s1">funcName </span><span class="s4">= </span><span class="s1">caseFuncName</span><span class="s4">.</span><span class="s1">substring</span><span class="s4">(</span><span class="s1">name</span><span class="s4">.</span><span class="s1">length </span><span class="s4">+ </span><span class="s3">2</span><span class="s4">)</span>

                    <span class="s2">if </span><span class="s4">(!(</span><span class="s1">funcName </span><span class="s2">in </span><span class="s1">testsToRun</span><span class="s4">))</span>
                        <span class="s1">testsToRun</span><span class="s4">[</span><span class="s1">funcName</span><span class="s4">] = []</span>

                    <span class="s2">let </span><span class="s1">tagName </span><span class="s4">= </span><span class="s1">qtest_results</span><span class="s4">.</span><span class="s1">tagsToRun</span><span class="s4">[</span><span class="s1">index</span><span class="s4">]</span>
                    <span class="s2">if </span><span class="s4">(</span><span class="s1">tagName</span><span class="s4">.</span><span class="s1">length </span><span class="s4">&gt; </span><span class="s3">0</span><span class="s4">) </span><span class="s5">// empty tags mean run all rows</span>
                        <span class="s1">testsToRun</span><span class="s4">[</span><span class="s1">funcName</span><span class="s4">].</span><span class="s1">push</span><span class="s4">(</span><span class="s1">tagName</span><span class="s4">)</span>
                <span class="s4">}</span>
            <span class="s4">}</span>
            <span class="s2">if </span><span class="s4">(!</span><span class="s1">found</span><span class="s4">) {</span>
                <span class="s1">completed </span><span class="s4">= </span><span class="s2">true</span>
                <span class="s2">if </span><span class="s4">(!</span><span class="s1">TestLogger</span><span class="s4">.</span><span class="s1">log_complete_test</span><span class="s4">(</span><span class="s1">qtest_testId</span><span class="s4">)) {</span>
                    <span class="s1">qtest_results</span><span class="s4">.</span><span class="s1">stopLogging</span><span class="s4">()</span>
                    <span class="s1">Qt</span><span class="s4">.</span><span class="s1">quit</span><span class="s4">()</span>
                <span class="s4">}</span>
                <span class="s1">qtest_results</span><span class="s4">.</span><span class="s1">testCaseName </span><span class="s4">= </span><span class="s6">&quot;&quot;</span>
                <span class="s2">return</span>
            <span class="s4">}</span>
        <span class="s4">}</span>

        <span class="s5">// Run the initTestCase function.</span>
        <span class="s1">qtest_results</span><span class="s4">.</span><span class="s1">functionName </span><span class="s4">= </span><span class="s6">&quot;initTestCase&quot;</span>
        <span class="s2">var </span><span class="s1">runTests </span><span class="s4">= </span><span class="s2">true</span>
        <span class="s2">if </span><span class="s4">(!</span><span class="s1">qtest_runInternal</span><span class="s4">(</span><span class="s6">&quot;initTestCase&quot;</span><span class="s4">))</span>
            <span class="s1">runTests </span><span class="s4">= </span><span class="s2">false</span>
        <span class="s1">qtest_results</span><span class="s4">.</span><span class="s1">finishTestData</span><span class="s4">()</span>
        <span class="s1">qtest_results</span><span class="s4">.</span><span class="s1">finishTestDataCleanup</span><span class="s4">()</span>
        <span class="s1">qtest_results</span><span class="s4">.</span><span class="s1">finishTestFunction</span><span class="s4">()</span>

        <span class="s5">// Run the test methods.</span>
        <span class="s2">var </span><span class="s1">testList </span><span class="s4">= []</span>
        <span class="s2">if </span><span class="s4">(</span><span class="s1">runTests</span><span class="s4">) {</span>
            <span class="s2">for </span><span class="s4">(</span><span class="s2">var </span><span class="s1">prop </span><span class="s2">in </span><span class="s1">testCase</span><span class="s4">) {</span>
                <span class="s2">if </span><span class="s4">(</span><span class="s1">prop</span><span class="s4">.</span><span class="s1">indexOf</span><span class="s4">(</span><span class="s6">&quot;test_&quot;</span><span class="s4">) != </span><span class="s3">0 </span><span class="s4">&amp;&amp; </span><span class="s1">prop</span><span class="s4">.</span><span class="s1">indexOf</span><span class="s4">(</span><span class="s6">&quot;benchmark_&quot;</span><span class="s4">) != </span><span class="s3">0</span><span class="s4">)</span>
                    <span class="s2">continue</span>
                <span class="s2">var </span><span class="s1">tail </span><span class="s4">= </span><span class="s1">prop</span><span class="s4">.</span><span class="s1">lastIndexOf</span><span class="s4">(</span><span class="s6">&quot;_data&quot;</span><span class="s4">);</span>
                <span class="s2">if </span><span class="s4">(</span><span class="s1">tail </span><span class="s4">!= -</span><span class="s3">1 </span><span class="s4">&amp;&amp; </span><span class="s1">tail </span><span class="s4">== (</span><span class="s1">prop</span><span class="s4">.</span><span class="s1">length </span><span class="s4">- </span><span class="s3">5</span><span class="s4">))</span>
                    <span class="s2">continue</span>
                <span class="s1">testList</span><span class="s4">.</span><span class="s1">push</span><span class="s4">(</span><span class="s1">prop</span><span class="s4">)</span>
            <span class="s4">}</span>
            <span class="s1">testList</span><span class="s4">.</span><span class="s1">sort</span><span class="s4">()</span>
        <span class="s4">}</span>

        <span class="s2">for </span><span class="s4">(</span><span class="s2">var </span><span class="s1">index </span><span class="s2">in </span><span class="s1">testList</span><span class="s4">) {</span>
            <span class="s2">var </span><span class="s1">prop </span><span class="s4">= </span><span class="s1">testList</span><span class="s4">[</span><span class="s1">index</span><span class="s4">]</span>

            <span class="s2">if </span><span class="s4">(</span><span class="s1">checkNames </span><span class="s4">&amp;&amp; !(</span><span class="s1">prop </span><span class="s2">in </span><span class="s1">testsToRun</span><span class="s4">))</span>
                <span class="s2">continue</span>

            <span class="s2">var </span><span class="s1">datafunc </span><span class="s4">= </span><span class="s1">prop </span><span class="s4">+ </span><span class="s6">&quot;_data&quot;</span>
            <span class="s2">var </span><span class="s1">isBenchmark </span><span class="s4">= (</span><span class="s1">prop</span><span class="s4">.</span><span class="s1">indexOf</span><span class="s4">(</span><span class="s6">&quot;benchmark_&quot;</span><span class="s4">) == </span><span class="s3">0</span><span class="s4">)</span>
            <span class="s1">qtest_results</span><span class="s4">.</span><span class="s1">functionName </span><span class="s4">= </span><span class="s1">prop</span>

            <span class="s2">if </span><span class="s4">(!(</span><span class="s1">datafunc </span><span class="s2">in </span><span class="s1">testCase</span><span class="s4">))</span>
                <span class="s1">datafunc </span><span class="s4">= </span><span class="s6">&quot;init_data&quot;</span><span class="s4">;</span>

            <span class="s2">if </span><span class="s4">(</span><span class="s1">datafunc </span><span class="s2">in </span><span class="s1">testCase</span><span class="s4">) {</span>
                <span class="s2">if </span><span class="s4">(</span><span class="s1">qtest_runInternal</span><span class="s4">(</span><span class="s1">datafunc</span><span class="s4">)) {</span>
                    <span class="s2">var </span><span class="s1">table </span><span class="s4">= </span><span class="s1">qtest_testCaseResult</span>
                    <span class="s2">var </span><span class="s1">haveData </span><span class="s4">= </span><span class="s2">false</span>

                    <span class="s2">let </span><span class="s1">checkTags </span><span class="s4">= (</span><span class="s1">checkNames </span><span class="s4">&amp;&amp; </span><span class="s1">testsToRun</span><span class="s4">[</span><span class="s1">prop</span><span class="s4">].</span><span class="s1">length </span><span class="s4">&gt; </span><span class="s3">0</span><span class="s4">)</span>

                    <span class="s1">qtest_results</span><span class="s4">.</span><span class="s1">initTestTable</span><span class="s4">()</span>
                    <span class="s2">for </span><span class="s4">(</span><span class="s2">var </span><span class="s1">index </span><span class="s2">in </span><span class="s1">table</span><span class="s4">) {</span>
                        <span class="s1">haveData </span><span class="s4">= </span><span class="s2">true</span>
                        <span class="s2">var </span><span class="s1">row </span><span class="s4">= </span><span class="s1">table</span><span class="s4">[</span><span class="s1">index</span><span class="s4">]</span>
                        <span class="s2">if </span><span class="s4">(!</span><span class="s1">row</span><span class="s4">.</span><span class="s1">tag</span><span class="s4">)</span>
                            <span class="s1">row</span><span class="s4">.</span><span class="s1">tag </span><span class="s4">= </span><span class="s6">&quot;row &quot; </span><span class="s4">+ </span><span class="s1">index    </span><span class="s5">// Must have something</span>
                        <span class="s2">if </span><span class="s4">(</span><span class="s1">checkTags</span><span class="s4">) {</span>
                            <span class="s2">let </span><span class="s1">tags </span><span class="s4">= </span><span class="s1">testsToRun</span><span class="s4">[</span><span class="s1">prop</span><span class="s4">]</span>
                            <span class="s2">let </span><span class="s1">tagIdx </span><span class="s4">= </span><span class="s1">tags</span><span class="s4">.</span><span class="s1">indexOf</span><span class="s4">(</span><span class="s1">row</span><span class="s4">.</span><span class="s1">tag</span><span class="s4">)</span>
                            <span class="s2">if </span><span class="s4">(</span><span class="s1">tagIdx </span><span class="s4">&lt; </span><span class="s3">0</span><span class="s4">)</span>
                                <span class="s2">continue</span>
                            <span class="s1">tags</span><span class="s4">.</span><span class="s1">splice</span><span class="s4">(</span><span class="s1">tagIdx</span><span class="s4">, </span><span class="s3">1</span><span class="s4">)</span>
                        <span class="s4">}</span>
                        <span class="s1">qtest_results</span><span class="s4">.</span><span class="s1">dataTag </span><span class="s4">= </span><span class="s1">row</span><span class="s4">.</span><span class="s1">tag</span>
                        <span class="s2">if </span><span class="s4">(</span><span class="s1">isBenchmark</span><span class="s4">)</span>
                            <span class="s1">qtest_runBenchmarkFunction</span><span class="s4">(</span><span class="s1">prop</span><span class="s4">, </span><span class="s1">row</span><span class="s4">)</span>
                        <span class="s2">else</span>
                            <span class="s1">qtest_runFunction</span><span class="s4">(</span><span class="s1">prop</span><span class="s4">, </span><span class="s1">row</span><span class="s4">)</span>
                        <span class="s1">qtest_results</span><span class="s4">.</span><span class="s1">dataTag </span><span class="s4">= </span><span class="s6">&quot;&quot;</span>
                        <span class="s1">qtest_results</span><span class="s4">.</span><span class="s1">skipped </span><span class="s4">= </span><span class="s2">false</span>
                    <span class="s4">}</span>
                    <span class="s2">if </span><span class="s4">(!</span><span class="s1">haveData</span><span class="s4">) {</span>
                        <span class="s2">if </span><span class="s4">(</span><span class="s1">datafunc </span><span class="s4">=== </span><span class="s6">&quot;init_data&quot;</span><span class="s4">)</span>
                           <span class="s1">qtest_runFunction</span><span class="s4">(</span><span class="s1">prop</span><span class="s4">, </span><span class="s2">null</span><span class="s4">, </span><span class="s1">isBenchmark</span><span class="s4">)</span>
                        <span class="s2">else</span>
                           <span class="s1">qtest_results</span><span class="s4">.</span><span class="s1">warn</span><span class="s4">(</span><span class="s6">&quot;no data supplied for &quot; </span><span class="s4">+ </span><span class="s1">prop </span><span class="s4">+ </span><span class="s6">&quot;() by &quot; </span><span class="s4">+ </span><span class="s1">datafunc </span><span class="s4">+ </span><span class="s6">&quot;()&quot;</span>
                                            <span class="s4">, </span><span class="s1">util</span><span class="s4">.</span><span class="s1">callerFile</span><span class="s4">(), </span><span class="s1">util</span><span class="s4">.</span><span class="s1">callerLine</span><span class="s4">());</span>
                    <span class="s4">}</span>
                    <span class="s1">qtest_results</span><span class="s4">.</span><span class="s1">clearTestTable</span><span class="s4">()</span>
                <span class="s4">}</span>
            <span class="s4">} </span><span class="s2">else if </span><span class="s4">(</span><span class="s1">isBenchmark</span><span class="s4">) {</span>
                <span class="s1">qtest_runBenchmarkFunction</span><span class="s4">(</span><span class="s1">prop</span><span class="s4">, </span><span class="s2">null</span><span class="s4">, </span><span class="s1">isBenchmark</span><span class="s4">)</span>
            <span class="s4">} </span><span class="s2">else </span><span class="s4">{</span>
                <span class="s1">qtest_runFunction</span><span class="s4">(</span><span class="s1">prop</span><span class="s4">, </span><span class="s2">null</span><span class="s4">, </span><span class="s1">isBenchmark</span><span class="s4">)</span>
            <span class="s4">}</span>
            <span class="s1">qtest_results</span><span class="s4">.</span><span class="s1">finishTestFunction</span><span class="s4">()</span>
            <span class="s1">qtest_results</span><span class="s4">.</span><span class="s1">skipped </span><span class="s4">= </span><span class="s2">false</span>

            <span class="s2">if </span><span class="s4">(</span><span class="s1">checkNames </span><span class="s4">&amp;&amp; </span><span class="s1">testsToRun</span><span class="s4">[</span><span class="s1">prop</span><span class="s4">].</span><span class="s1">length </span><span class="s4">&lt;= </span><span class="s3">0</span><span class="s4">)</span>
                <span class="s2">delete </span><span class="s1">testsToRun</span><span class="s4">[</span><span class="s1">prop</span><span class="s4">]</span>
        <span class="s4">}</span>

        <span class="s5">// Run the cleanupTestCase function.</span>
        <span class="s1">qtest_results</span><span class="s4">.</span><span class="s1">skipped </span><span class="s4">= </span><span class="s2">false</span>
        <span class="s1">qtest_results</span><span class="s4">.</span><span class="s1">functionName </span><span class="s4">= </span><span class="s6">&quot;cleanupTestCase&quot;</span>
        <span class="s1">qtest_runInternal</span><span class="s4">(</span><span class="s6">&quot;cleanupTestCase&quot;</span><span class="s4">)</span>

        <span class="s5">// Complain about missing functions that we were supposed to run.</span>
        <span class="s2">if </span><span class="s4">(</span><span class="s1">checkNames</span><span class="s4">) {</span>
            <span class="s2">let </span><span class="s1">missingTests </span><span class="s4">= []</span>
            <span class="s2">for </span><span class="s4">(</span><span class="s2">var </span><span class="s1">func </span><span class="s2">in </span><span class="s1">testsToRun</span><span class="s4">) {</span>
                <span class="s2">let </span><span class="s1">caseFuncName </span><span class="s4">= </span><span class="s1">name </span><span class="s4">+ </span><span class="s6">'::' </span><span class="s4">+ </span><span class="s1">func</span>
                <span class="s2">let </span><span class="s1">tags </span><span class="s4">= </span><span class="s1">testsToRun</span><span class="s4">[</span><span class="s1">func</span><span class="s4">]</span>
                <span class="s2">if </span><span class="s4">(</span><span class="s1">tags</span><span class="s4">.</span><span class="s1">length </span><span class="s4">&lt;= </span><span class="s3">0</span><span class="s4">)</span>
                    <span class="s1">missingTests</span><span class="s4">.</span><span class="s1">push</span><span class="s4">(</span><span class="s1">caseFuncName</span><span class="s4">)</span>
                <span class="s2">else</span>
                    <span class="s2">for </span><span class="s4">(</span><span class="s2">var </span><span class="s1">i </span><span class="s2">in </span><span class="s1">tags</span><span class="s4">)</span>
                        <span class="s1">missingTests</span><span class="s4">.</span><span class="s1">push</span><span class="s4">(</span><span class="s1">caseFuncName </span><span class="s4">+ </span><span class="s6">':' </span><span class="s4">+ </span><span class="s1">tags</span><span class="s4">[</span><span class="s1">i</span><span class="s4">])</span>
            <span class="s4">}</span>
            <span class="s1">missingTests</span><span class="s4">.</span><span class="s1">sort</span><span class="s4">()</span>
            <span class="s2">if </span><span class="s4">(</span><span class="s1">missingTests</span><span class="s4">.</span><span class="s1">length </span><span class="s4">&gt; </span><span class="s3">0</span><span class="s4">)</span>
                <span class="s1">qtest_results</span><span class="s4">.</span><span class="s1">fail</span><span class="s4">(</span><span class="s6">&quot;Could not find test functions: &quot; </span><span class="s4">+ </span><span class="s1">missingTests</span><span class="s4">, </span><span class="s6">&quot;&quot;</span><span class="s4">, </span><span class="s3">0</span><span class="s4">)</span>
        <span class="s4">}</span>

        <span class="s5">// Clean up and exit.</span>
        <span class="s1">running </span><span class="s4">= </span><span class="s2">false</span>
        <span class="s1">completed </span><span class="s4">= </span><span class="s2">true</span>
        <span class="s1">qtest_results</span><span class="s4">.</span><span class="s1">finishTestData</span><span class="s4">()</span>
        <span class="s1">qtest_results</span><span class="s4">.</span><span class="s1">finishTestDataCleanup</span><span class="s4">()</span>
        <span class="s1">qtest_results</span><span class="s4">.</span><span class="s1">finishTestFunction</span><span class="s4">()</span>
        <span class="s1">qtest_results</span><span class="s4">.</span><span class="s1">functionName </span><span class="s4">= </span><span class="s6">&quot;&quot;</span>

        <span class="s5">// Stop if there are no more tests to be run.</span>
        <span class="s2">if </span><span class="s4">(!</span><span class="s1">TestLogger</span><span class="s4">.</span><span class="s1">log_complete_test</span><span class="s4">(</span><span class="s1">qtest_testId</span><span class="s4">)) {</span>
            <span class="s1">qtest_results</span><span class="s4">.</span><span class="s1">stopLogging</span><span class="s4">()</span>
            <span class="s1">Qt</span><span class="s4">.</span><span class="s1">quit</span><span class="s4">()</span>
        <span class="s4">}</span>
        <span class="s1">qtest_results</span><span class="s4">.</span><span class="s1">testCaseName </span><span class="s4">= </span><span class="s6">&quot;&quot;</span>
    <span class="s4">}</span>

    <span class="s1">onWhenChanged</span><span class="s4">: {</span>
        <span class="s2">if </span><span class="s4">(</span><span class="s1">when </span><span class="s4">!= </span><span class="s1">qtest_prevWhen</span><span class="s4">) {</span>
            <span class="s1">qtest_prevWhen </span><span class="s4">= </span><span class="s1">when</span>
            <span class="s2">if </span><span class="s4">(</span><span class="s1">when </span><span class="s4">&amp;&amp; !</span><span class="s1">completed </span><span class="s4">&amp;&amp; !</span><span class="s1">running </span><span class="s4">&amp;&amp; </span><span class="s1">qtest_componentCompleted</span><span class="s4">)</span>
                <span class="s1">qtest_run</span><span class="s4">()</span>
        <span class="s4">}</span>
    <span class="s4">}</span>

    <span class="s1">onOptionalChanged</span><span class="s4">: {</span>
        <span class="s2">if </span><span class="s4">(!</span><span class="s1">completed</span><span class="s4">) {</span>
            <span class="s2">if </span><span class="s4">(</span><span class="s1">optional</span><span class="s4">)</span>
                <span class="s1">TestLogger</span><span class="s4">.</span><span class="s1">log_optional_test</span><span class="s4">(</span><span class="s1">qtest_testId</span><span class="s4">)</span>
            <span class="s2">else</span>
                <span class="s1">TestLogger</span><span class="s4">.</span><span class="s1">log_mandatory_test</span><span class="s4">(</span><span class="s1">qtest_testId</span><span class="s4">)</span>
        <span class="s4">}</span>
    <span class="s4">}</span>

    <span class="s1">Component</span><span class="s4">.</span><span class="s1">onCompleted</span><span class="s4">: {</span>
        <span class="s1">QTestRootObject</span><span class="s4">.</span><span class="s1">hasTestCase </span><span class="s4">= </span><span class="s2">true</span><span class="s4">;</span>
        <span class="s1">qtest_componentCompleted </span><span class="s4">= </span><span class="s2">true</span><span class="s4">;</span>
        <span class="s1">qtest_testId </span><span class="s4">= </span><span class="s1">TestLogger</span><span class="s4">.</span><span class="s1">log_register_test</span><span class="s4">(</span><span class="s1">name</span><span class="s4">)</span>
        <span class="s2">if </span><span class="s4">(</span><span class="s1">optional</span><span class="s4">)</span>
            <span class="s1">TestLogger</span><span class="s4">.</span><span class="s1">log_optional_test</span><span class="s4">(</span><span class="s1">qtest_testId</span><span class="s4">)</span>
        <span class="s1">qtest_prevWhen </span><span class="s4">= </span><span class="s1">when</span>
        <span class="s2">if </span><span class="s4">(</span><span class="s1">when </span><span class="s4">&amp;&amp; !</span><span class="s1">completed </span><span class="s4">&amp;&amp; !</span><span class="s1">running</span><span class="s4">)</span>
            <span class="s1">qtest_run</span><span class="s4">()</span>
    <span class="s4">}</span>
<span class="s4">}</span>
</pre>
</body>
</html>