<html>
<head>
<title>core.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cf8e6d;}
.s1 { color: #bcbec4;}
.s2 { color: #bcbec4;}
.s3 { color: #6aab73;}
.s4 { color: #7a7e85;}
.s5 { color: #5f826b; font-style: italic;}
.s6 { color: #2aacb8;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
core.py</font>
</center></td></tr></table>
<pre><span class="s0">import </span><span class="s1">sys</span>
<span class="s0">from </span><span class="s1">distutils</span><span class="s2">.</span><span class="s1">core </span><span class="s0">import </span><span class="s1">Distribution</span>

<span class="s0">if </span><span class="s3">'setuptools' </span><span class="s0">in </span><span class="s1">sys</span><span class="s2">.</span><span class="s1">modules</span><span class="s2">:</span>
    <span class="s1">have_setuptools </span><span class="s2">= </span><span class="s0">True</span>
    <span class="s0">from </span><span class="s1">setuptools </span><span class="s0">import </span><span class="s1">setup </span><span class="s0">as </span><span class="s1">old_setup</span>
    <span class="s4"># easy_install imports math, it may be picked up from cwd</span>
    <span class="s0">from </span><span class="s1">setuptools</span><span class="s2">.</span><span class="s1">command </span><span class="s0">import </span><span class="s1">easy_install</span>
    <span class="s0">try</span><span class="s2">:</span>
        <span class="s4"># very old versions of setuptools don't have this</span>
        <span class="s0">from </span><span class="s1">setuptools</span><span class="s2">.</span><span class="s1">command </span><span class="s0">import </span><span class="s1">bdist_egg</span>
    <span class="s0">except </span><span class="s1">ImportError</span><span class="s2">:</span>
        <span class="s1">have_setuptools </span><span class="s2">= </span><span class="s0">False</span>
<span class="s0">else</span><span class="s2">:</span>
    <span class="s0">from </span><span class="s1">distutils</span><span class="s2">.</span><span class="s1">core </span><span class="s0">import </span><span class="s1">setup </span><span class="s0">as </span><span class="s1">old_setup</span>
    <span class="s1">have_setuptools </span><span class="s2">= </span><span class="s0">False</span>

<span class="s0">import </span><span class="s1">warnings</span>
<span class="s0">import </span><span class="s1">distutils</span><span class="s2">.</span><span class="s1">core</span>
<span class="s0">import </span><span class="s1">distutils</span><span class="s2">.</span><span class="s1">dist</span>

<span class="s0">from </span><span class="s1">numpy</span><span class="s2">.</span><span class="s1">distutils</span><span class="s2">.</span><span class="s1">extension </span><span class="s0">import </span><span class="s1">Extension  </span><span class="s4"># noqa: F401</span>
<span class="s0">from </span><span class="s1">numpy</span><span class="s2">.</span><span class="s1">distutils</span><span class="s2">.</span><span class="s1">numpy_distribution </span><span class="s0">import </span><span class="s1">NumpyDistribution</span>
<span class="s0">from </span><span class="s1">numpy</span><span class="s2">.</span><span class="s1">distutils</span><span class="s2">.</span><span class="s1">command </span><span class="s0">import </span><span class="s1">config</span><span class="s2">, </span><span class="s1">config_compiler</span><span class="s2">, </span><span class="s1">\</span>
     <span class="s1">build</span><span class="s2">, </span><span class="s1">build_py</span><span class="s2">, </span><span class="s1">build_ext</span><span class="s2">, </span><span class="s1">build_clib</span><span class="s2">, </span><span class="s1">build_src</span><span class="s2">, </span><span class="s1">build_scripts</span><span class="s2">, </span><span class="s1">\</span>
     <span class="s1">sdist</span><span class="s2">, </span><span class="s1">install_data</span><span class="s2">, </span><span class="s1">install_headers</span><span class="s2">, </span><span class="s1">install</span><span class="s2">, </span><span class="s1">bdist_rpm</span><span class="s2">, </span><span class="s1">\</span>
     <span class="s1">install_clib</span>
<span class="s0">from </span><span class="s1">numpy</span><span class="s2">.</span><span class="s1">distutils</span><span class="s2">.</span><span class="s1">misc_util </span><span class="s0">import </span><span class="s1">is_sequence</span><span class="s2">, </span><span class="s1">is_string</span>

<span class="s1">numpy_cmdclass </span><span class="s2">= {</span><span class="s3">'build'</span><span class="s2">:            </span><span class="s1">build</span><span class="s2">.</span><span class="s1">build</span><span class="s2">,</span>
                  <span class="s3">'build_src'</span><span class="s2">:        </span><span class="s1">build_src</span><span class="s2">.</span><span class="s1">build_src</span><span class="s2">,</span>
                  <span class="s3">'build_scripts'</span><span class="s2">:    </span><span class="s1">build_scripts</span><span class="s2">.</span><span class="s1">build_scripts</span><span class="s2">,</span>
                  <span class="s3">'config_cc'</span><span class="s2">:        </span><span class="s1">config_compiler</span><span class="s2">.</span><span class="s1">config_cc</span><span class="s2">,</span>
                  <span class="s3">'config_fc'</span><span class="s2">:        </span><span class="s1">config_compiler</span><span class="s2">.</span><span class="s1">config_fc</span><span class="s2">,</span>
                  <span class="s3">'config'</span><span class="s2">:           </span><span class="s1">config</span><span class="s2">.</span><span class="s1">config</span><span class="s2">,</span>
                  <span class="s3">'build_ext'</span><span class="s2">:        </span><span class="s1">build_ext</span><span class="s2">.</span><span class="s1">build_ext</span><span class="s2">,</span>
                  <span class="s3">'build_py'</span><span class="s2">:         </span><span class="s1">build_py</span><span class="s2">.</span><span class="s1">build_py</span><span class="s2">,</span>
                  <span class="s3">'build_clib'</span><span class="s2">:       </span><span class="s1">build_clib</span><span class="s2">.</span><span class="s1">build_clib</span><span class="s2">,</span>
                  <span class="s3">'sdist'</span><span class="s2">:            </span><span class="s1">sdist</span><span class="s2">.</span><span class="s1">sdist</span><span class="s2">,</span>
                  <span class="s3">'install_data'</span><span class="s2">:     </span><span class="s1">install_data</span><span class="s2">.</span><span class="s1">install_data</span><span class="s2">,</span>
                  <span class="s3">'install_headers'</span><span class="s2">:  </span><span class="s1">install_headers</span><span class="s2">.</span><span class="s1">install_headers</span><span class="s2">,</span>
                  <span class="s3">'install_clib'</span><span class="s2">:     </span><span class="s1">install_clib</span><span class="s2">.</span><span class="s1">install_clib</span><span class="s2">,</span>
                  <span class="s3">'install'</span><span class="s2">:          </span><span class="s1">install</span><span class="s2">.</span><span class="s1">install</span><span class="s2">,</span>
                  <span class="s3">'bdist_rpm'</span><span class="s2">:        </span><span class="s1">bdist_rpm</span><span class="s2">.</span><span class="s1">bdist_rpm</span><span class="s2">,</span>
                  <span class="s2">}</span>
<span class="s0">if </span><span class="s1">have_setuptools</span><span class="s2">:</span>
    <span class="s4"># Use our own versions of develop and egg_info to ensure that build_src is</span>
    <span class="s4"># handled appropriately.</span>
    <span class="s0">from </span><span class="s1">numpy</span><span class="s2">.</span><span class="s1">distutils</span><span class="s2">.</span><span class="s1">command </span><span class="s0">import </span><span class="s1">develop</span><span class="s2">, </span><span class="s1">egg_info</span>
    <span class="s1">numpy_cmdclass</span><span class="s2">[</span><span class="s3">'bdist_egg'</span><span class="s2">] = </span><span class="s1">bdist_egg</span><span class="s2">.</span><span class="s1">bdist_egg</span>
    <span class="s1">numpy_cmdclass</span><span class="s2">[</span><span class="s3">'develop'</span><span class="s2">] = </span><span class="s1">develop</span><span class="s2">.</span><span class="s1">develop</span>
    <span class="s1">numpy_cmdclass</span><span class="s2">[</span><span class="s3">'easy_install'</span><span class="s2">] = </span><span class="s1">easy_install</span><span class="s2">.</span><span class="s1">easy_install</span>
    <span class="s1">numpy_cmdclass</span><span class="s2">[</span><span class="s3">'egg_info'</span><span class="s2">] = </span><span class="s1">egg_info</span><span class="s2">.</span><span class="s1">egg_info</span>

<span class="s0">def </span><span class="s1">_dict_append</span><span class="s2">(</span><span class="s1">d</span><span class="s2">, **</span><span class="s1">kws</span><span class="s2">):</span>
    <span class="s0">for </span><span class="s1">k</span><span class="s2">, </span><span class="s1">v </span><span class="s0">in </span><span class="s1">kws</span><span class="s2">.</span><span class="s1">items</span><span class="s2">():</span>
        <span class="s0">if </span><span class="s1">k </span><span class="s0">not in </span><span class="s1">d</span><span class="s2">:</span>
            <span class="s1">d</span><span class="s2">[</span><span class="s1">k</span><span class="s2">] = </span><span class="s1">v</span>
            <span class="s0">continue</span>
        <span class="s1">dv </span><span class="s2">= </span><span class="s1">d</span><span class="s2">[</span><span class="s1">k</span><span class="s2">]</span>
        <span class="s0">if </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">dv</span><span class="s2">, </span><span class="s1">tuple</span><span class="s2">):</span>
            <span class="s1">d</span><span class="s2">[</span><span class="s1">k</span><span class="s2">] = </span><span class="s1">dv </span><span class="s2">+ </span><span class="s1">tuple</span><span class="s2">(</span><span class="s1">v</span><span class="s2">)</span>
        <span class="s0">elif </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">dv</span><span class="s2">, </span><span class="s1">list</span><span class="s2">):</span>
            <span class="s1">d</span><span class="s2">[</span><span class="s1">k</span><span class="s2">] = </span><span class="s1">dv </span><span class="s2">+ </span><span class="s1">list</span><span class="s2">(</span><span class="s1">v</span><span class="s2">)</span>
        <span class="s0">elif </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">dv</span><span class="s2">, </span><span class="s1">dict</span><span class="s2">):</span>
            <span class="s1">_dict_append</span><span class="s2">(</span><span class="s1">dv</span><span class="s2">, **</span><span class="s1">v</span><span class="s2">)</span>
        <span class="s0">elif </span><span class="s1">is_string</span><span class="s2">(</span><span class="s1">dv</span><span class="s2">):</span>
            <span class="s0">assert </span><span class="s1">is_string</span><span class="s2">(</span><span class="s1">v</span><span class="s2">)</span>
            <span class="s1">d</span><span class="s2">[</span><span class="s1">k</span><span class="s2">] = </span><span class="s1">v</span>
        <span class="s0">else</span><span class="s2">:</span>
            <span class="s0">raise </span><span class="s1">TypeError</span><span class="s2">(</span><span class="s1">repr</span><span class="s2">(</span><span class="s1">type</span><span class="s2">(</span><span class="s1">dv</span><span class="s2">)))</span>

<span class="s0">def </span><span class="s1">_command_line_ok</span><span class="s2">(</span><span class="s1">_cache</span><span class="s2">=</span><span class="s0">None</span><span class="s2">):</span>
    <span class="s5">&quot;&quot;&quot; Return True if command line does not contain any 
    help or display requests. 
    &quot;&quot;&quot;</span>
    <span class="s0">if </span><span class="s1">_cache</span><span class="s2">:</span>
        <span class="s0">return </span><span class="s1">_cache</span><span class="s2">[</span><span class="s6">0</span><span class="s2">]</span>
    <span class="s0">elif </span><span class="s1">_cache </span><span class="s0">is None</span><span class="s2">:</span>
        <span class="s1">_cache </span><span class="s2">= []</span>
    <span class="s1">ok </span><span class="s2">= </span><span class="s0">True</span>
    <span class="s1">display_opts </span><span class="s2">= [</span><span class="s3">'--'</span><span class="s2">+</span><span class="s1">n </span><span class="s0">for </span><span class="s1">n </span><span class="s0">in </span><span class="s1">Distribution</span><span class="s2">.</span><span class="s1">display_option_names</span><span class="s2">]</span>
    <span class="s0">for </span><span class="s1">o </span><span class="s0">in </span><span class="s1">Distribution</span><span class="s2">.</span><span class="s1">display_options</span><span class="s2">:</span>
        <span class="s0">if </span><span class="s1">o</span><span class="s2">[</span><span class="s6">1</span><span class="s2">]:</span>
            <span class="s1">display_opts</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s3">'-'</span><span class="s2">+</span><span class="s1">o</span><span class="s2">[</span><span class="s6">1</span><span class="s2">])</span>
    <span class="s0">for </span><span class="s1">arg </span><span class="s0">in </span><span class="s1">sys</span><span class="s2">.</span><span class="s1">argv</span><span class="s2">:</span>
        <span class="s0">if </span><span class="s1">arg</span><span class="s2">.</span><span class="s1">startswith</span><span class="s2">(</span><span class="s3">'--help'</span><span class="s2">) </span><span class="s0">or </span><span class="s1">arg</span><span class="s2">==</span><span class="s3">'-h' </span><span class="s0">or </span><span class="s1">arg </span><span class="s0">in </span><span class="s1">display_opts</span><span class="s2">:</span>
            <span class="s1">ok </span><span class="s2">= </span><span class="s0">False</span>
            <span class="s0">break</span>
    <span class="s1">_cache</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">ok</span><span class="s2">)</span>
    <span class="s0">return </span><span class="s1">ok</span>

<span class="s0">def </span><span class="s1">get_distribution</span><span class="s2">(</span><span class="s1">always</span><span class="s2">=</span><span class="s0">False</span><span class="s2">):</span>
    <span class="s1">dist </span><span class="s2">= </span><span class="s1">distutils</span><span class="s2">.</span><span class="s1">core</span><span class="s2">.</span><span class="s1">_setup_distribution</span>
    <span class="s4"># XXX Hack to get numpy installable with easy_install.</span>
    <span class="s4"># The problem is easy_install runs it's own setup(), which</span>
    <span class="s4"># sets up distutils.core._setup_distribution. However,</span>
    <span class="s4"># when our setup() runs, that gets overwritten and lost.</span>
    <span class="s4"># We can't use isinstance, as the DistributionWithoutHelpCommands</span>
    <span class="s4"># class is local to a function in setuptools.command.easy_install</span>
    <span class="s0">if </span><span class="s1">dist </span><span class="s0">is not None and </span><span class="s1">\</span>
            <span class="s3">'DistributionWithoutHelpCommands' </span><span class="s0">in </span><span class="s1">repr</span><span class="s2">(</span><span class="s1">dist</span><span class="s2">):</span>
        <span class="s1">dist </span><span class="s2">= </span><span class="s0">None</span>
    <span class="s0">if </span><span class="s1">always </span><span class="s0">and </span><span class="s1">dist </span><span class="s0">is None</span><span class="s2">:</span>
        <span class="s1">dist </span><span class="s2">= </span><span class="s1">NumpyDistribution</span><span class="s2">()</span>
    <span class="s0">return </span><span class="s1">dist</span>

<span class="s0">def </span><span class="s1">setup</span><span class="s2">(**</span><span class="s1">attr</span><span class="s2">):</span>

    <span class="s1">cmdclass </span><span class="s2">= </span><span class="s1">numpy_cmdclass</span><span class="s2">.</span><span class="s1">copy</span><span class="s2">()</span>

    <span class="s1">new_attr </span><span class="s2">= </span><span class="s1">attr</span><span class="s2">.</span><span class="s1">copy</span><span class="s2">()</span>
    <span class="s0">if </span><span class="s3">'cmdclass' </span><span class="s0">in </span><span class="s1">new_attr</span><span class="s2">:</span>
        <span class="s1">cmdclass</span><span class="s2">.</span><span class="s1">update</span><span class="s2">(</span><span class="s1">new_attr</span><span class="s2">[</span><span class="s3">'cmdclass'</span><span class="s2">])</span>
    <span class="s1">new_attr</span><span class="s2">[</span><span class="s3">'cmdclass'</span><span class="s2">] = </span><span class="s1">cmdclass</span>

    <span class="s0">if </span><span class="s3">'configuration' </span><span class="s0">in </span><span class="s1">new_attr</span><span class="s2">:</span>
        <span class="s4"># To avoid calling configuration if there are any errors</span>
        <span class="s4"># or help request in command in the line.</span>
        <span class="s1">configuration </span><span class="s2">= </span><span class="s1">new_attr</span><span class="s2">.</span><span class="s1">pop</span><span class="s2">(</span><span class="s3">'configuration'</span><span class="s2">)</span>

        <span class="s1">old_dist </span><span class="s2">= </span><span class="s1">distutils</span><span class="s2">.</span><span class="s1">core</span><span class="s2">.</span><span class="s1">_setup_distribution</span>
        <span class="s1">old_stop </span><span class="s2">= </span><span class="s1">distutils</span><span class="s2">.</span><span class="s1">core</span><span class="s2">.</span><span class="s1">_setup_stop_after</span>
        <span class="s1">distutils</span><span class="s2">.</span><span class="s1">core</span><span class="s2">.</span><span class="s1">_setup_distribution </span><span class="s2">= </span><span class="s0">None</span>
        <span class="s1">distutils</span><span class="s2">.</span><span class="s1">core</span><span class="s2">.</span><span class="s1">_setup_stop_after </span><span class="s2">= </span><span class="s3">&quot;commandline&quot;</span>
        <span class="s0">try</span><span class="s2">:</span>
            <span class="s1">dist </span><span class="s2">= </span><span class="s1">setup</span><span class="s2">(**</span><span class="s1">new_attr</span><span class="s2">)</span>
        <span class="s0">finally</span><span class="s2">:</span>
            <span class="s1">distutils</span><span class="s2">.</span><span class="s1">core</span><span class="s2">.</span><span class="s1">_setup_distribution </span><span class="s2">= </span><span class="s1">old_dist</span>
            <span class="s1">distutils</span><span class="s2">.</span><span class="s1">core</span><span class="s2">.</span><span class="s1">_setup_stop_after </span><span class="s2">= </span><span class="s1">old_stop</span>
        <span class="s0">if </span><span class="s1">dist</span><span class="s2">.</span><span class="s1">help </span><span class="s0">or not </span><span class="s1">_command_line_ok</span><span class="s2">():</span>
            <span class="s4"># probably displayed help, skip running any commands</span>
            <span class="s0">return </span><span class="s1">dist</span>

        <span class="s4"># create setup dictionary and append to new_attr</span>
        <span class="s1">config </span><span class="s2">= </span><span class="s1">configuration</span><span class="s2">()</span>
        <span class="s0">if </span><span class="s1">hasattr</span><span class="s2">(</span><span class="s1">config</span><span class="s2">, </span><span class="s3">'todict'</span><span class="s2">):</span>
            <span class="s1">config </span><span class="s2">= </span><span class="s1">config</span><span class="s2">.</span><span class="s1">todict</span><span class="s2">()</span>
        <span class="s1">_dict_append</span><span class="s2">(</span><span class="s1">new_attr</span><span class="s2">, **</span><span class="s1">config</span><span class="s2">)</span>

    <span class="s4"># Move extension source libraries to libraries</span>
    <span class="s1">libraries </span><span class="s2">= []</span>
    <span class="s0">for </span><span class="s1">ext </span><span class="s0">in </span><span class="s1">new_attr</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s3">'ext_modules'</span><span class="s2">, []):</span>
        <span class="s1">new_libraries </span><span class="s2">= []</span>
        <span class="s0">for </span><span class="s1">item </span><span class="s0">in </span><span class="s1">ext</span><span class="s2">.</span><span class="s1">libraries</span><span class="s2">:</span>
            <span class="s0">if </span><span class="s1">is_sequence</span><span class="s2">(</span><span class="s1">item</span><span class="s2">):</span>
                <span class="s1">lib_name</span><span class="s2">, </span><span class="s1">build_info </span><span class="s2">= </span><span class="s1">item</span>
                <span class="s1">_check_append_ext_library</span><span class="s2">(</span><span class="s1">libraries</span><span class="s2">, </span><span class="s1">lib_name</span><span class="s2">, </span><span class="s1">build_info</span><span class="s2">)</span>
                <span class="s1">new_libraries</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">lib_name</span><span class="s2">)</span>
            <span class="s0">elif </span><span class="s1">is_string</span><span class="s2">(</span><span class="s1">item</span><span class="s2">):</span>
                <span class="s1">new_libraries</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">item</span><span class="s2">)</span>
            <span class="s0">else</span><span class="s2">:</span>
                <span class="s0">raise </span><span class="s1">TypeError</span><span class="s2">(</span><span class="s3">&quot;invalid description of extension module &quot;</span>
                                <span class="s3">&quot;library %r&quot; </span><span class="s2">% (</span><span class="s1">item</span><span class="s2">,))</span>
        <span class="s1">ext</span><span class="s2">.</span><span class="s1">libraries </span><span class="s2">= </span><span class="s1">new_libraries</span>
    <span class="s0">if </span><span class="s1">libraries</span><span class="s2">:</span>
        <span class="s0">if </span><span class="s3">'libraries' </span><span class="s0">not in </span><span class="s1">new_attr</span><span class="s2">:</span>
            <span class="s1">new_attr</span><span class="s2">[</span><span class="s3">'libraries'</span><span class="s2">] = []</span>
        <span class="s0">for </span><span class="s1">item </span><span class="s0">in </span><span class="s1">libraries</span><span class="s2">:</span>
            <span class="s1">_check_append_library</span><span class="s2">(</span><span class="s1">new_attr</span><span class="s2">[</span><span class="s3">'libraries'</span><span class="s2">], </span><span class="s1">item</span><span class="s2">)</span>

    <span class="s4"># sources in ext_modules or libraries may contain header files</span>
    <span class="s0">if </span><span class="s2">(</span><span class="s3">'ext_modules' </span><span class="s0">in </span><span class="s1">new_attr </span><span class="s0">or </span><span class="s3">'libraries' </span><span class="s0">in </span><span class="s1">new_attr</span><span class="s2">) </span><span class="s1">\</span>
       <span class="s0">and </span><span class="s3">'headers' </span><span class="s0">not in </span><span class="s1">new_attr</span><span class="s2">:</span>
        <span class="s1">new_attr</span><span class="s2">[</span><span class="s3">'headers'</span><span class="s2">] = []</span>

    <span class="s4"># Use our custom NumpyDistribution class instead of distutils' one</span>
    <span class="s1">new_attr</span><span class="s2">[</span><span class="s3">'distclass'</span><span class="s2">] = </span><span class="s1">NumpyDistribution</span>

    <span class="s0">return </span><span class="s1">old_setup</span><span class="s2">(**</span><span class="s1">new_attr</span><span class="s2">)</span>

<span class="s0">def </span><span class="s1">_check_append_library</span><span class="s2">(</span><span class="s1">libraries</span><span class="s2">, </span><span class="s1">item</span><span class="s2">):</span>
    <span class="s0">for </span><span class="s1">libitem </span><span class="s0">in </span><span class="s1">libraries</span><span class="s2">:</span>
        <span class="s0">if </span><span class="s1">is_sequence</span><span class="s2">(</span><span class="s1">libitem</span><span class="s2">):</span>
            <span class="s0">if </span><span class="s1">is_sequence</span><span class="s2">(</span><span class="s1">item</span><span class="s2">):</span>
                <span class="s0">if </span><span class="s1">item</span><span class="s2">[</span><span class="s6">0</span><span class="s2">]==</span><span class="s1">libitem</span><span class="s2">[</span><span class="s6">0</span><span class="s2">]:</span>
                    <span class="s0">if </span><span class="s1">item</span><span class="s2">[</span><span class="s6">1</span><span class="s2">] </span><span class="s0">is </span><span class="s1">libitem</span><span class="s2">[</span><span class="s6">1</span><span class="s2">]:</span>
                        <span class="s0">return</span>
                    <span class="s1">warnings</span><span class="s2">.</span><span class="s1">warn</span><span class="s2">(</span><span class="s3">&quot;[0] libraries list contains %r with&quot;</span>
                                  <span class="s3">&quot; different build_info&quot; </span><span class="s2">% (</span><span class="s1">item</span><span class="s2">[</span><span class="s6">0</span><span class="s2">],),</span>
                                  <span class="s1">stacklevel</span><span class="s2">=</span><span class="s6">2</span><span class="s2">)</span>
                    <span class="s0">break</span>
            <span class="s0">else</span><span class="s2">:</span>
                <span class="s0">if </span><span class="s1">item</span><span class="s2">==</span><span class="s1">libitem</span><span class="s2">[</span><span class="s6">0</span><span class="s2">]:</span>
                    <span class="s1">warnings</span><span class="s2">.</span><span class="s1">warn</span><span class="s2">(</span><span class="s3">&quot;[1] libraries list contains %r with&quot;</span>
                                  <span class="s3">&quot; no build_info&quot; </span><span class="s2">% (</span><span class="s1">item</span><span class="s2">[</span><span class="s6">0</span><span class="s2">],),</span>
                                  <span class="s1">stacklevel</span><span class="s2">=</span><span class="s6">2</span><span class="s2">)</span>
                    <span class="s0">break</span>
        <span class="s0">else</span><span class="s2">:</span>
            <span class="s0">if </span><span class="s1">is_sequence</span><span class="s2">(</span><span class="s1">item</span><span class="s2">):</span>
                <span class="s0">if </span><span class="s1">item</span><span class="s2">[</span><span class="s6">0</span><span class="s2">]==</span><span class="s1">libitem</span><span class="s2">:</span>
                    <span class="s1">warnings</span><span class="s2">.</span><span class="s1">warn</span><span class="s2">(</span><span class="s3">&quot;[2] libraries list contains %r with&quot;</span>
                                  <span class="s3">&quot; no build_info&quot; </span><span class="s2">% (</span><span class="s1">item</span><span class="s2">[</span><span class="s6">0</span><span class="s2">],),</span>
                                  <span class="s1">stacklevel</span><span class="s2">=</span><span class="s6">2</span><span class="s2">)</span>
                    <span class="s0">break</span>
            <span class="s0">else</span><span class="s2">:</span>
                <span class="s0">if </span><span class="s1">item</span><span class="s2">==</span><span class="s1">libitem</span><span class="s2">:</span>
                    <span class="s0">return</span>
    <span class="s1">libraries</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">item</span><span class="s2">)</span>

<span class="s0">def </span><span class="s1">_check_append_ext_library</span><span class="s2">(</span><span class="s1">libraries</span><span class="s2">, </span><span class="s1">lib_name</span><span class="s2">, </span><span class="s1">build_info</span><span class="s2">):</span>
    <span class="s0">for </span><span class="s1">item </span><span class="s0">in </span><span class="s1">libraries</span><span class="s2">:</span>
        <span class="s0">if </span><span class="s1">is_sequence</span><span class="s2">(</span><span class="s1">item</span><span class="s2">):</span>
            <span class="s0">if </span><span class="s1">item</span><span class="s2">[</span><span class="s6">0</span><span class="s2">]==</span><span class="s1">lib_name</span><span class="s2">:</span>
                <span class="s0">if </span><span class="s1">item</span><span class="s2">[</span><span class="s6">1</span><span class="s2">] </span><span class="s0">is </span><span class="s1">build_info</span><span class="s2">:</span>
                    <span class="s0">return</span>
                <span class="s1">warnings</span><span class="s2">.</span><span class="s1">warn</span><span class="s2">(</span><span class="s3">&quot;[3] libraries list contains %r with&quot;</span>
                              <span class="s3">&quot; different build_info&quot; </span><span class="s2">% (</span><span class="s1">lib_name</span><span class="s2">,),</span>
                              <span class="s1">stacklevel</span><span class="s2">=</span><span class="s6">2</span><span class="s2">)</span>
                <span class="s0">break</span>
        <span class="s0">elif </span><span class="s1">item</span><span class="s2">==</span><span class="s1">lib_name</span><span class="s2">:</span>
            <span class="s1">warnings</span><span class="s2">.</span><span class="s1">warn</span><span class="s2">(</span><span class="s3">&quot;[4] libraries list contains %r with&quot;</span>
                          <span class="s3">&quot; no build_info&quot; </span><span class="s2">% (</span><span class="s1">lib_name</span><span class="s2">,),</span>
                          <span class="s1">stacklevel</span><span class="s2">=</span><span class="s6">2</span><span class="s2">)</span>
            <span class="s0">break</span>
    <span class="s1">libraries</span><span class="s2">.</span><span class="s1">append</span><span class="s2">((</span><span class="s1">lib_name</span><span class="s2">, </span><span class="s1">build_info</span><span class="s2">))</span>
</pre>
</body>
</html>