<html>
<head>
<title>test_config.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cf8e6d;}
.s1 { color: #bcbec4;}
.s2 { color: #bcbec4;}
.s3 { color: #6aab73;}
.s4 { color: #7a7e85;}
.s5 { color: #2aacb8;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_config.py</font>
</center></td></tr></table>
<pre><span class="s0">import </span><span class="s1">pytest</span>

<span class="s0">from </span><span class="s1">pandas</span><span class="s2">.</span><span class="s1">_config </span><span class="s0">import </span><span class="s1">config </span><span class="s0">as </span><span class="s1">cf</span>
<span class="s0">from </span><span class="s1">pandas</span><span class="s2">.</span><span class="s1">_config</span><span class="s2">.</span><span class="s1">config </span><span class="s0">import </span><span class="s1">OptionError</span>

<span class="s0">import </span><span class="s1">pandas </span><span class="s0">as </span><span class="s1">pd</span>
<span class="s0">import </span><span class="s1">pandas</span><span class="s2">.</span><span class="s1">_testing </span><span class="s0">as </span><span class="s1">tm</span>


<span class="s0">class </span><span class="s1">TestConfig</span><span class="s2">:</span>
    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">fixture</span><span class="s2">(</span><span class="s1">autouse</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s0">def </span><span class="s1">clean_config</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">monkeypatch</span><span class="s2">):</span>
        <span class="s0">with </span><span class="s1">monkeypatch</span><span class="s2">.</span><span class="s1">context</span><span class="s2">() </span><span class="s0">as </span><span class="s1">m</span><span class="s2">:</span>
            <span class="s1">m</span><span class="s2">.</span><span class="s1">setattr</span><span class="s2">(</span><span class="s1">cf</span><span class="s2">, </span><span class="s3">&quot;_global_config&quot;</span><span class="s2">, {})</span>
            <span class="s1">m</span><span class="s2">.</span><span class="s1">setattr</span><span class="s2">(</span><span class="s1">cf</span><span class="s2">, </span><span class="s3">&quot;options&quot;</span><span class="s2">, </span><span class="s1">cf</span><span class="s2">.</span><span class="s1">DictWrapper</span><span class="s2">(</span><span class="s1">cf</span><span class="s2">.</span><span class="s1">_global_config</span><span class="s2">))</span>
            <span class="s1">m</span><span class="s2">.</span><span class="s1">setattr</span><span class="s2">(</span><span class="s1">cf</span><span class="s2">, </span><span class="s3">&quot;_deprecated_options&quot;</span><span class="s2">, {})</span>
            <span class="s1">m</span><span class="s2">.</span><span class="s1">setattr</span><span class="s2">(</span><span class="s1">cf</span><span class="s2">, </span><span class="s3">&quot;_registered_options&quot;</span><span class="s2">, {})</span>

            <span class="s4"># Our test fixture in conftest.py sets &quot;chained_assignment&quot;</span>
            <span class="s4"># to &quot;raise&quot; only after all test methods have been setup.</span>
            <span class="s4"># However, after this setup, there is no longer any</span>
            <span class="s4"># &quot;chained_assignment&quot; option, so re-register it.</span>
            <span class="s1">cf</span><span class="s2">.</span><span class="s1">register_option</span><span class="s2">(</span><span class="s3">&quot;chained_assignment&quot;</span><span class="s2">, </span><span class="s3">&quot;raise&quot;</span><span class="s2">)</span>
            <span class="s0">yield</span>

    <span class="s0">def </span><span class="s1">test_api</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s4"># the pandas object exposes the user API</span>
        <span class="s0">assert </span><span class="s1">hasattr</span><span class="s2">(</span><span class="s1">pd</span><span class="s2">, </span><span class="s3">&quot;get_option&quot;</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">hasattr</span><span class="s2">(</span><span class="s1">pd</span><span class="s2">, </span><span class="s3">&quot;set_option&quot;</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">hasattr</span><span class="s2">(</span><span class="s1">pd</span><span class="s2">, </span><span class="s3">&quot;reset_option&quot;</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">hasattr</span><span class="s2">(</span><span class="s1">pd</span><span class="s2">, </span><span class="s3">&quot;describe_option&quot;</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_is_one_of_factory</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">v </span><span class="s2">= </span><span class="s1">cf</span><span class="s2">.</span><span class="s1">is_one_of_factory</span><span class="s2">([</span><span class="s0">None</span><span class="s2">, </span><span class="s5">12</span><span class="s2">])</span>

        <span class="s1">v</span><span class="s2">(</span><span class="s5">12</span><span class="s2">)</span>
        <span class="s1">v</span><span class="s2">(</span><span class="s0">None</span><span class="s2">)</span>
        <span class="s1">msg </span><span class="s2">= </span><span class="s3">r&quot;Value must be one of None\|12&quot;</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
            <span class="s1">v</span><span class="s2">(</span><span class="s5">1.1</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_register_option</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">cf</span><span class="s2">.</span><span class="s1">register_option</span><span class="s2">(</span><span class="s3">&quot;a&quot;</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s3">&quot;doc&quot;</span><span class="s2">)</span>

        <span class="s4"># can't register an already registered option</span>
        <span class="s1">msg </span><span class="s2">= </span><span class="s3">&quot;Option 'a' has already been registered&quot;</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">OptionError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
            <span class="s1">cf</span><span class="s2">.</span><span class="s1">register_option</span><span class="s2">(</span><span class="s3">&quot;a&quot;</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s3">&quot;doc&quot;</span><span class="s2">)</span>

        <span class="s4"># can't register an already registered option</span>
        <span class="s1">msg </span><span class="s2">= </span><span class="s3">&quot;Path prefix to option 'a' is already an option&quot;</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">OptionError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
            <span class="s1">cf</span><span class="s2">.</span><span class="s1">register_option</span><span class="s2">(</span><span class="s3">&quot;a.b.c.d1&quot;</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s3">&quot;doc&quot;</span><span class="s2">)</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">OptionError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
            <span class="s1">cf</span><span class="s2">.</span><span class="s1">register_option</span><span class="s2">(</span><span class="s3">&quot;a.b.c.d2&quot;</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s3">&quot;doc&quot;</span><span class="s2">)</span>

        <span class="s4"># no python keywords</span>
        <span class="s1">msg </span><span class="s2">= </span><span class="s3">&quot;for is a python keyword&quot;</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
            <span class="s1">cf</span><span class="s2">.</span><span class="s1">register_option</span><span class="s2">(</span><span class="s3">&quot;for&quot;</span><span class="s2">, </span><span class="s5">0</span><span class="s2">)</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
            <span class="s1">cf</span><span class="s2">.</span><span class="s1">register_option</span><span class="s2">(</span><span class="s3">&quot;a.for.b&quot;</span><span class="s2">, </span><span class="s5">0</span><span class="s2">)</span>
        <span class="s4"># must be valid identifier (ensure attribute access works)</span>
        <span class="s1">msg </span><span class="s2">= </span><span class="s3">&quot;oh my goddess! is not a valid identifier&quot;</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
            <span class="s1">cf</span><span class="s2">.</span><span class="s1">register_option</span><span class="s2">(</span><span class="s3">&quot;Oh my Goddess!&quot;</span><span class="s2">, </span><span class="s5">0</span><span class="s2">)</span>

        <span class="s4"># we can register options several levels deep</span>
        <span class="s4"># without predefining the intermediate steps</span>
        <span class="s4"># and we can define differently named options</span>
        <span class="s4"># in the same namespace</span>
        <span class="s1">cf</span><span class="s2">.</span><span class="s1">register_option</span><span class="s2">(</span><span class="s3">&quot;k.b.c.d1&quot;</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s3">&quot;doc&quot;</span><span class="s2">)</span>
        <span class="s1">cf</span><span class="s2">.</span><span class="s1">register_option</span><span class="s2">(</span><span class="s3">&quot;k.b.c.d2&quot;</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s3">&quot;doc&quot;</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_describe_option</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">cf</span><span class="s2">.</span><span class="s1">register_option</span><span class="s2">(</span><span class="s3">&quot;a&quot;</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s3">&quot;doc&quot;</span><span class="s2">)</span>
        <span class="s1">cf</span><span class="s2">.</span><span class="s1">register_option</span><span class="s2">(</span><span class="s3">&quot;b&quot;</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s3">&quot;doc2&quot;</span><span class="s2">)</span>
        <span class="s1">cf</span><span class="s2">.</span><span class="s1">deprecate_option</span><span class="s2">(</span><span class="s3">&quot;b&quot;</span><span class="s2">)</span>

        <span class="s1">cf</span><span class="s2">.</span><span class="s1">register_option</span><span class="s2">(</span><span class="s3">&quot;c.d.e1&quot;</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s3">&quot;doc3&quot;</span><span class="s2">)</span>
        <span class="s1">cf</span><span class="s2">.</span><span class="s1">register_option</span><span class="s2">(</span><span class="s3">&quot;c.d.e2&quot;</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s3">&quot;doc4&quot;</span><span class="s2">)</span>
        <span class="s1">cf</span><span class="s2">.</span><span class="s1">register_option</span><span class="s2">(</span><span class="s3">&quot;f&quot;</span><span class="s2">, </span><span class="s5">1</span><span class="s2">)</span>
        <span class="s1">cf</span><span class="s2">.</span><span class="s1">register_option</span><span class="s2">(</span><span class="s3">&quot;g.h&quot;</span><span class="s2">, </span><span class="s5">1</span><span class="s2">)</span>
        <span class="s1">cf</span><span class="s2">.</span><span class="s1">register_option</span><span class="s2">(</span><span class="s3">&quot;k&quot;</span><span class="s2">, </span><span class="s5">2</span><span class="s2">)</span>
        <span class="s1">cf</span><span class="s2">.</span><span class="s1">deprecate_option</span><span class="s2">(</span><span class="s3">&quot;g.h&quot;</span><span class="s2">, </span><span class="s1">rkey</span><span class="s2">=</span><span class="s3">&quot;k&quot;</span><span class="s2">)</span>
        <span class="s1">cf</span><span class="s2">.</span><span class="s1">register_option</span><span class="s2">(</span><span class="s3">&quot;l&quot;</span><span class="s2">, </span><span class="s3">&quot;foo&quot;</span><span class="s2">)</span>

        <span class="s4"># non-existent keys raise KeyError</span>
        <span class="s1">msg </span><span class="s2">= </span><span class="s3">r&quot;No such keys\(s\)&quot;</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">OptionError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
            <span class="s1">cf</span><span class="s2">.</span><span class="s1">describe_option</span><span class="s2">(</span><span class="s3">&quot;no.such.key&quot;</span><span class="s2">)</span>

        <span class="s4"># we can get the description for any key we registered</span>
        <span class="s0">assert </span><span class="s3">&quot;doc&quot; </span><span class="s0">in </span><span class="s1">cf</span><span class="s2">.</span><span class="s1">describe_option</span><span class="s2">(</span><span class="s3">&quot;a&quot;</span><span class="s2">, </span><span class="s1">_print_desc</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s3">&quot;doc2&quot; </span><span class="s0">in </span><span class="s1">cf</span><span class="s2">.</span><span class="s1">describe_option</span><span class="s2">(</span><span class="s3">&quot;b&quot;</span><span class="s2">, </span><span class="s1">_print_desc</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s3">&quot;precated&quot; </span><span class="s0">in </span><span class="s1">cf</span><span class="s2">.</span><span class="s1">describe_option</span><span class="s2">(</span><span class="s3">&quot;b&quot;</span><span class="s2">, </span><span class="s1">_print_desc</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s3">&quot;doc3&quot; </span><span class="s0">in </span><span class="s1">cf</span><span class="s2">.</span><span class="s1">describe_option</span><span class="s2">(</span><span class="s3">&quot;c.d.e1&quot;</span><span class="s2">, </span><span class="s1">_print_desc</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s3">&quot;doc4&quot; </span><span class="s0">in </span><span class="s1">cf</span><span class="s2">.</span><span class="s1">describe_option</span><span class="s2">(</span><span class="s3">&quot;c.d.e2&quot;</span><span class="s2">, </span><span class="s1">_print_desc</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>

        <span class="s4"># if no doc is specified we get a default message</span>
        <span class="s4"># saying &quot;description not available&quot;</span>
        <span class="s0">assert </span><span class="s3">&quot;available&quot; </span><span class="s0">in </span><span class="s1">cf</span><span class="s2">.</span><span class="s1">describe_option</span><span class="s2">(</span><span class="s3">&quot;f&quot;</span><span class="s2">, </span><span class="s1">_print_desc</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s3">&quot;available&quot; </span><span class="s0">in </span><span class="s1">cf</span><span class="s2">.</span><span class="s1">describe_option</span><span class="s2">(</span><span class="s3">&quot;g.h&quot;</span><span class="s2">, </span><span class="s1">_print_desc</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s3">&quot;precated&quot; </span><span class="s0">in </span><span class="s1">cf</span><span class="s2">.</span><span class="s1">describe_option</span><span class="s2">(</span><span class="s3">&quot;g.h&quot;</span><span class="s2">, </span><span class="s1">_print_desc</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s3">&quot;k&quot; </span><span class="s0">in </span><span class="s1">cf</span><span class="s2">.</span><span class="s1">describe_option</span><span class="s2">(</span><span class="s3">&quot;g.h&quot;</span><span class="s2">, </span><span class="s1">_print_desc</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>

        <span class="s4"># default is reported</span>
        <span class="s0">assert </span><span class="s3">&quot;foo&quot; </span><span class="s0">in </span><span class="s1">cf</span><span class="s2">.</span><span class="s1">describe_option</span><span class="s2">(</span><span class="s3">&quot;l&quot;</span><span class="s2">, </span><span class="s1">_print_desc</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>
        <span class="s4"># current value is reported</span>
        <span class="s0">assert </span><span class="s3">&quot;bar&quot; </span><span class="s0">not in </span><span class="s1">cf</span><span class="s2">.</span><span class="s1">describe_option</span><span class="s2">(</span><span class="s3">&quot;l&quot;</span><span class="s2">, </span><span class="s1">_print_desc</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>
        <span class="s1">cf</span><span class="s2">.</span><span class="s1">set_option</span><span class="s2">(</span><span class="s3">&quot;l&quot;</span><span class="s2">, </span><span class="s3">&quot;bar&quot;</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s3">&quot;bar&quot; </span><span class="s0">in </span><span class="s1">cf</span><span class="s2">.</span><span class="s1">describe_option</span><span class="s2">(</span><span class="s3">&quot;l&quot;</span><span class="s2">, </span><span class="s1">_print_desc</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_case_insensitive</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">cf</span><span class="s2">.</span><span class="s1">register_option</span><span class="s2">(</span><span class="s3">&quot;KanBAN&quot;</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s3">&quot;doc&quot;</span><span class="s2">)</span>

        <span class="s0">assert </span><span class="s3">&quot;doc&quot; </span><span class="s0">in </span><span class="s1">cf</span><span class="s2">.</span><span class="s1">describe_option</span><span class="s2">(</span><span class="s3">&quot;kanbaN&quot;</span><span class="s2">, </span><span class="s1">_print_desc</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">cf</span><span class="s2">.</span><span class="s1">get_option</span><span class="s2">(</span><span class="s3">&quot;kanBaN&quot;</span><span class="s2">) == </span><span class="s5">1</span>
        <span class="s1">cf</span><span class="s2">.</span><span class="s1">set_option</span><span class="s2">(</span><span class="s3">&quot;KanBan&quot;</span><span class="s2">, </span><span class="s5">2</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">cf</span><span class="s2">.</span><span class="s1">get_option</span><span class="s2">(</span><span class="s3">&quot;kAnBaN&quot;</span><span class="s2">) == </span><span class="s5">2</span>

        <span class="s4"># gets of non-existent keys fail</span>
        <span class="s1">msg </span><span class="s2">= </span><span class="s3">r&quot;No such keys\(s\): 'no_such_option'&quot;</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">OptionError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
            <span class="s1">cf</span><span class="s2">.</span><span class="s1">get_option</span><span class="s2">(</span><span class="s3">&quot;no_such_option&quot;</span><span class="s2">)</span>
        <span class="s1">cf</span><span class="s2">.</span><span class="s1">deprecate_option</span><span class="s2">(</span><span class="s3">&quot;KanBan&quot;</span><span class="s2">)</span>

        <span class="s0">assert </span><span class="s1">cf</span><span class="s2">.</span><span class="s1">_is_deprecated</span><span class="s2">(</span><span class="s3">&quot;kAnBaN&quot;</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_get_option</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">cf</span><span class="s2">.</span><span class="s1">register_option</span><span class="s2">(</span><span class="s3">&quot;a&quot;</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s3">&quot;doc&quot;</span><span class="s2">)</span>
        <span class="s1">cf</span><span class="s2">.</span><span class="s1">register_option</span><span class="s2">(</span><span class="s3">&quot;b.c&quot;</span><span class="s2">, </span><span class="s3">&quot;hullo&quot;</span><span class="s2">, </span><span class="s3">&quot;doc2&quot;</span><span class="s2">)</span>
        <span class="s1">cf</span><span class="s2">.</span><span class="s1">register_option</span><span class="s2">(</span><span class="s3">&quot;b.b&quot;</span><span class="s2">, </span><span class="s0">None</span><span class="s2">, </span><span class="s3">&quot;doc2&quot;</span><span class="s2">)</span>

        <span class="s4"># gets of existing keys succeed</span>
        <span class="s0">assert </span><span class="s1">cf</span><span class="s2">.</span><span class="s1">get_option</span><span class="s2">(</span><span class="s3">&quot;a&quot;</span><span class="s2">) == </span><span class="s5">1</span>
        <span class="s0">assert </span><span class="s1">cf</span><span class="s2">.</span><span class="s1">get_option</span><span class="s2">(</span><span class="s3">&quot;b.c&quot;</span><span class="s2">) == </span><span class="s3">&quot;hullo&quot;</span>
        <span class="s0">assert </span><span class="s1">cf</span><span class="s2">.</span><span class="s1">get_option</span><span class="s2">(</span><span class="s3">&quot;b.b&quot;</span><span class="s2">) </span><span class="s0">is None</span>

        <span class="s4"># gets of non-existent keys fail</span>
        <span class="s1">msg </span><span class="s2">= </span><span class="s3">r&quot;No such keys\(s\): 'no_such_option'&quot;</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">OptionError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
            <span class="s1">cf</span><span class="s2">.</span><span class="s1">get_option</span><span class="s2">(</span><span class="s3">&quot;no_such_option&quot;</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_set_option</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">cf</span><span class="s2">.</span><span class="s1">register_option</span><span class="s2">(</span><span class="s3">&quot;a&quot;</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s3">&quot;doc&quot;</span><span class="s2">)</span>
        <span class="s1">cf</span><span class="s2">.</span><span class="s1">register_option</span><span class="s2">(</span><span class="s3">&quot;b.c&quot;</span><span class="s2">, </span><span class="s3">&quot;hullo&quot;</span><span class="s2">, </span><span class="s3">&quot;doc2&quot;</span><span class="s2">)</span>
        <span class="s1">cf</span><span class="s2">.</span><span class="s1">register_option</span><span class="s2">(</span><span class="s3">&quot;b.b&quot;</span><span class="s2">, </span><span class="s0">None</span><span class="s2">, </span><span class="s3">&quot;doc2&quot;</span><span class="s2">)</span>

        <span class="s0">assert </span><span class="s1">cf</span><span class="s2">.</span><span class="s1">get_option</span><span class="s2">(</span><span class="s3">&quot;a&quot;</span><span class="s2">) == </span><span class="s5">1</span>
        <span class="s0">assert </span><span class="s1">cf</span><span class="s2">.</span><span class="s1">get_option</span><span class="s2">(</span><span class="s3">&quot;b.c&quot;</span><span class="s2">) == </span><span class="s3">&quot;hullo&quot;</span>
        <span class="s0">assert </span><span class="s1">cf</span><span class="s2">.</span><span class="s1">get_option</span><span class="s2">(</span><span class="s3">&quot;b.b&quot;</span><span class="s2">) </span><span class="s0">is None</span>

        <span class="s1">cf</span><span class="s2">.</span><span class="s1">set_option</span><span class="s2">(</span><span class="s3">&quot;a&quot;</span><span class="s2">, </span><span class="s5">2</span><span class="s2">)</span>
        <span class="s1">cf</span><span class="s2">.</span><span class="s1">set_option</span><span class="s2">(</span><span class="s3">&quot;b.c&quot;</span><span class="s2">, </span><span class="s3">&quot;wurld&quot;</span><span class="s2">)</span>
        <span class="s1">cf</span><span class="s2">.</span><span class="s1">set_option</span><span class="s2">(</span><span class="s3">&quot;b.b&quot;</span><span class="s2">, </span><span class="s5">1.1</span><span class="s2">)</span>

        <span class="s0">assert </span><span class="s1">cf</span><span class="s2">.</span><span class="s1">get_option</span><span class="s2">(</span><span class="s3">&quot;a&quot;</span><span class="s2">) == </span><span class="s5">2</span>
        <span class="s0">assert </span><span class="s1">cf</span><span class="s2">.</span><span class="s1">get_option</span><span class="s2">(</span><span class="s3">&quot;b.c&quot;</span><span class="s2">) == </span><span class="s3">&quot;wurld&quot;</span>
        <span class="s0">assert </span><span class="s1">cf</span><span class="s2">.</span><span class="s1">get_option</span><span class="s2">(</span><span class="s3">&quot;b.b&quot;</span><span class="s2">) == </span><span class="s5">1.1</span>

        <span class="s1">msg </span><span class="s2">= </span><span class="s3">r&quot;No such keys\(s\): 'no.such.key'&quot;</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">OptionError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
            <span class="s1">cf</span><span class="s2">.</span><span class="s1">set_option</span><span class="s2">(</span><span class="s3">&quot;no.such.key&quot;</span><span class="s2">, </span><span class="s0">None</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_set_option_empty_args</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">msg </span><span class="s2">= </span><span class="s3">&quot;Must provide an even number of non-keyword arguments&quot;</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
            <span class="s1">cf</span><span class="s2">.</span><span class="s1">set_option</span><span class="s2">()</span>

    <span class="s0">def </span><span class="s1">test_set_option_uneven_args</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">msg </span><span class="s2">= </span><span class="s3">&quot;Must provide an even number of non-keyword arguments&quot;</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
            <span class="s1">cf</span><span class="s2">.</span><span class="s1">set_option</span><span class="s2">(</span><span class="s3">&quot;a.b&quot;</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s3">&quot;b.c&quot;</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_set_option_invalid_single_argument_type</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">msg </span><span class="s2">= </span><span class="s3">&quot;Must provide an even number of non-keyword arguments&quot;</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
            <span class="s1">cf</span><span class="s2">.</span><span class="s1">set_option</span><span class="s2">(</span><span class="s5">2</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_set_option_multiple</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">cf</span><span class="s2">.</span><span class="s1">register_option</span><span class="s2">(</span><span class="s3">&quot;a&quot;</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s3">&quot;doc&quot;</span><span class="s2">)</span>
        <span class="s1">cf</span><span class="s2">.</span><span class="s1">register_option</span><span class="s2">(</span><span class="s3">&quot;b.c&quot;</span><span class="s2">, </span><span class="s3">&quot;hullo&quot;</span><span class="s2">, </span><span class="s3">&quot;doc2&quot;</span><span class="s2">)</span>
        <span class="s1">cf</span><span class="s2">.</span><span class="s1">register_option</span><span class="s2">(</span><span class="s3">&quot;b.b&quot;</span><span class="s2">, </span><span class="s0">None</span><span class="s2">, </span><span class="s3">&quot;doc2&quot;</span><span class="s2">)</span>

        <span class="s0">assert </span><span class="s1">cf</span><span class="s2">.</span><span class="s1">get_option</span><span class="s2">(</span><span class="s3">&quot;a&quot;</span><span class="s2">) == </span><span class="s5">1</span>
        <span class="s0">assert </span><span class="s1">cf</span><span class="s2">.</span><span class="s1">get_option</span><span class="s2">(</span><span class="s3">&quot;b.c&quot;</span><span class="s2">) == </span><span class="s3">&quot;hullo&quot;</span>
        <span class="s0">assert </span><span class="s1">cf</span><span class="s2">.</span><span class="s1">get_option</span><span class="s2">(</span><span class="s3">&quot;b.b&quot;</span><span class="s2">) </span><span class="s0">is None</span>

        <span class="s1">cf</span><span class="s2">.</span><span class="s1">set_option</span><span class="s2">(</span><span class="s3">&quot;a&quot;</span><span class="s2">, </span><span class="s3">&quot;2&quot;</span><span class="s2">, </span><span class="s3">&quot;b.c&quot;</span><span class="s2">, </span><span class="s0">None</span><span class="s2">, </span><span class="s3">&quot;b.b&quot;</span><span class="s2">, </span><span class="s5">10.0</span><span class="s2">)</span>

        <span class="s0">assert </span><span class="s1">cf</span><span class="s2">.</span><span class="s1">get_option</span><span class="s2">(</span><span class="s3">&quot;a&quot;</span><span class="s2">) == </span><span class="s3">&quot;2&quot;</span>
        <span class="s0">assert </span><span class="s1">cf</span><span class="s2">.</span><span class="s1">get_option</span><span class="s2">(</span><span class="s3">&quot;b.c&quot;</span><span class="s2">) </span><span class="s0">is None</span>
        <span class="s0">assert </span><span class="s1">cf</span><span class="s2">.</span><span class="s1">get_option</span><span class="s2">(</span><span class="s3">&quot;b.b&quot;</span><span class="s2">) == </span><span class="s5">10.0</span>

    <span class="s0">def </span><span class="s1">test_validation</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">cf</span><span class="s2">.</span><span class="s1">register_option</span><span class="s2">(</span><span class="s3">&quot;a&quot;</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s3">&quot;doc&quot;</span><span class="s2">, </span><span class="s1">validator</span><span class="s2">=</span><span class="s1">cf</span><span class="s2">.</span><span class="s1">is_int</span><span class="s2">)</span>
        <span class="s1">cf</span><span class="s2">.</span><span class="s1">register_option</span><span class="s2">(</span><span class="s3">&quot;d&quot;</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s3">&quot;doc&quot;</span><span class="s2">, </span><span class="s1">validator</span><span class="s2">=</span><span class="s1">cf</span><span class="s2">.</span><span class="s1">is_nonnegative_int</span><span class="s2">)</span>
        <span class="s1">cf</span><span class="s2">.</span><span class="s1">register_option</span><span class="s2">(</span><span class="s3">&quot;b.c&quot;</span><span class="s2">, </span><span class="s3">&quot;hullo&quot;</span><span class="s2">, </span><span class="s3">&quot;doc2&quot;</span><span class="s2">, </span><span class="s1">validator</span><span class="s2">=</span><span class="s1">cf</span><span class="s2">.</span><span class="s1">is_text</span><span class="s2">)</span>

        <span class="s1">msg </span><span class="s2">= </span><span class="s3">&quot;Value must have type '&lt;class 'int'&gt;'&quot;</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
            <span class="s1">cf</span><span class="s2">.</span><span class="s1">register_option</span><span class="s2">(</span><span class="s3">&quot;a.b.c.d2&quot;</span><span class="s2">, </span><span class="s3">&quot;NO&quot;</span><span class="s2">, </span><span class="s3">&quot;doc&quot;</span><span class="s2">, </span><span class="s1">validator</span><span class="s2">=</span><span class="s1">cf</span><span class="s2">.</span><span class="s1">is_int</span><span class="s2">)</span>

        <span class="s1">cf</span><span class="s2">.</span><span class="s1">set_option</span><span class="s2">(</span><span class="s3">&quot;a&quot;</span><span class="s2">, </span><span class="s5">2</span><span class="s2">)  </span><span class="s4"># int is_int</span>
        <span class="s1">cf</span><span class="s2">.</span><span class="s1">set_option</span><span class="s2">(</span><span class="s3">&quot;b.c&quot;</span><span class="s2">, </span><span class="s3">&quot;wurld&quot;</span><span class="s2">)  </span><span class="s4"># str is_str</span>
        <span class="s1">cf</span><span class="s2">.</span><span class="s1">set_option</span><span class="s2">(</span><span class="s3">&quot;d&quot;</span><span class="s2">, </span><span class="s5">2</span><span class="s2">)</span>
        <span class="s1">cf</span><span class="s2">.</span><span class="s1">set_option</span><span class="s2">(</span><span class="s3">&quot;d&quot;</span><span class="s2">, </span><span class="s0">None</span><span class="s2">)  </span><span class="s4"># non-negative int can be None</span>

        <span class="s4"># None not is_int</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
            <span class="s1">cf</span><span class="s2">.</span><span class="s1">set_option</span><span class="s2">(</span><span class="s3">&quot;a&quot;</span><span class="s2">, </span><span class="s0">None</span><span class="s2">)</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
            <span class="s1">cf</span><span class="s2">.</span><span class="s1">set_option</span><span class="s2">(</span><span class="s3">&quot;a&quot;</span><span class="s2">, </span><span class="s3">&quot;ab&quot;</span><span class="s2">)</span>

        <span class="s1">msg </span><span class="s2">= </span><span class="s3">&quot;Value must be a nonnegative integer or None&quot;</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
            <span class="s1">cf</span><span class="s2">.</span><span class="s1">register_option</span><span class="s2">(</span><span class="s3">&quot;a.b.c.d3&quot;</span><span class="s2">, </span><span class="s3">&quot;NO&quot;</span><span class="s2">, </span><span class="s3">&quot;doc&quot;</span><span class="s2">, </span><span class="s1">validator</span><span class="s2">=</span><span class="s1">cf</span><span class="s2">.</span><span class="s1">is_nonnegative_int</span><span class="s2">)</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
            <span class="s1">cf</span><span class="s2">.</span><span class="s1">register_option</span><span class="s2">(</span><span class="s3">&quot;a.b.c.d3&quot;</span><span class="s2">, -</span><span class="s5">2</span><span class="s2">, </span><span class="s3">&quot;doc&quot;</span><span class="s2">, </span><span class="s1">validator</span><span class="s2">=</span><span class="s1">cf</span><span class="s2">.</span><span class="s1">is_nonnegative_int</span><span class="s2">)</span>

        <span class="s1">msg </span><span class="s2">= </span><span class="s3">r&quot;Value must be an instance of &lt;class 'str'&gt;\|&lt;class 'bytes'&gt;&quot;</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
            <span class="s1">cf</span><span class="s2">.</span><span class="s1">set_option</span><span class="s2">(</span><span class="s3">&quot;b.c&quot;</span><span class="s2">, </span><span class="s5">1</span><span class="s2">)</span>

        <span class="s1">validator </span><span class="s2">= </span><span class="s1">cf</span><span class="s2">.</span><span class="s1">is_one_of_factory</span><span class="s2">([</span><span class="s0">None</span><span class="s2">, </span><span class="s1">cf</span><span class="s2">.</span><span class="s1">is_callable</span><span class="s2">])</span>
        <span class="s1">cf</span><span class="s2">.</span><span class="s1">register_option</span><span class="s2">(</span><span class="s3">&quot;b&quot;</span><span class="s2">, </span><span class="s0">lambda</span><span class="s2">: </span><span class="s0">None</span><span class="s2">, </span><span class="s3">&quot;doc&quot;</span><span class="s2">, </span><span class="s1">validator</span><span class="s2">=</span><span class="s1">validator</span><span class="s2">)</span>
        <span class="s4"># pylint: disable-next=consider-using-f-string</span>
        <span class="s1">cf</span><span class="s2">.</span><span class="s1">set_option</span><span class="s2">(</span><span class="s3">&quot;b&quot;</span><span class="s2">, </span><span class="s3">&quot;%.1f&quot;</span><span class="s2">.</span><span class="s1">format</span><span class="s2">)  </span><span class="s4"># Formatter is callable</span>
        <span class="s1">cf</span><span class="s2">.</span><span class="s1">set_option</span><span class="s2">(</span><span class="s3">&quot;b&quot;</span><span class="s2">, </span><span class="s0">None</span><span class="s2">)  </span><span class="s4"># Formatter is none (default)</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s3">&quot;Value must be a callable&quot;</span><span class="s2">):</span>
            <span class="s1">cf</span><span class="s2">.</span><span class="s1">set_option</span><span class="s2">(</span><span class="s3">&quot;b&quot;</span><span class="s2">, </span><span class="s3">&quot;%.1f&quot;</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_reset_option</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">cf</span><span class="s2">.</span><span class="s1">register_option</span><span class="s2">(</span><span class="s3">&quot;a&quot;</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s3">&quot;doc&quot;</span><span class="s2">, </span><span class="s1">validator</span><span class="s2">=</span><span class="s1">cf</span><span class="s2">.</span><span class="s1">is_int</span><span class="s2">)</span>
        <span class="s1">cf</span><span class="s2">.</span><span class="s1">register_option</span><span class="s2">(</span><span class="s3">&quot;b.c&quot;</span><span class="s2">, </span><span class="s3">&quot;hullo&quot;</span><span class="s2">, </span><span class="s3">&quot;doc2&quot;</span><span class="s2">, </span><span class="s1">validator</span><span class="s2">=</span><span class="s1">cf</span><span class="s2">.</span><span class="s1">is_str</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">cf</span><span class="s2">.</span><span class="s1">get_option</span><span class="s2">(</span><span class="s3">&quot;a&quot;</span><span class="s2">) == </span><span class="s5">1</span>
        <span class="s0">assert </span><span class="s1">cf</span><span class="s2">.</span><span class="s1">get_option</span><span class="s2">(</span><span class="s3">&quot;b.c&quot;</span><span class="s2">) == </span><span class="s3">&quot;hullo&quot;</span>

        <span class="s1">cf</span><span class="s2">.</span><span class="s1">set_option</span><span class="s2">(</span><span class="s3">&quot;a&quot;</span><span class="s2">, </span><span class="s5">2</span><span class="s2">)</span>
        <span class="s1">cf</span><span class="s2">.</span><span class="s1">set_option</span><span class="s2">(</span><span class="s3">&quot;b.c&quot;</span><span class="s2">, </span><span class="s3">&quot;wurld&quot;</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">cf</span><span class="s2">.</span><span class="s1">get_option</span><span class="s2">(</span><span class="s3">&quot;a&quot;</span><span class="s2">) == </span><span class="s5">2</span>
        <span class="s0">assert </span><span class="s1">cf</span><span class="s2">.</span><span class="s1">get_option</span><span class="s2">(</span><span class="s3">&quot;b.c&quot;</span><span class="s2">) == </span><span class="s3">&quot;wurld&quot;</span>

        <span class="s1">cf</span><span class="s2">.</span><span class="s1">reset_option</span><span class="s2">(</span><span class="s3">&quot;a&quot;</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">cf</span><span class="s2">.</span><span class="s1">get_option</span><span class="s2">(</span><span class="s3">&quot;a&quot;</span><span class="s2">) == </span><span class="s5">1</span>
        <span class="s0">assert </span><span class="s1">cf</span><span class="s2">.</span><span class="s1">get_option</span><span class="s2">(</span><span class="s3">&quot;b.c&quot;</span><span class="s2">) == </span><span class="s3">&quot;wurld&quot;</span>
        <span class="s1">cf</span><span class="s2">.</span><span class="s1">reset_option</span><span class="s2">(</span><span class="s3">&quot;b.c&quot;</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">cf</span><span class="s2">.</span><span class="s1">get_option</span><span class="s2">(</span><span class="s3">&quot;a&quot;</span><span class="s2">) == </span><span class="s5">1</span>
        <span class="s0">assert </span><span class="s1">cf</span><span class="s2">.</span><span class="s1">get_option</span><span class="s2">(</span><span class="s3">&quot;b.c&quot;</span><span class="s2">) == </span><span class="s3">&quot;hullo&quot;</span>

    <span class="s0">def </span><span class="s1">test_reset_option_all</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">cf</span><span class="s2">.</span><span class="s1">register_option</span><span class="s2">(</span><span class="s3">&quot;a&quot;</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s3">&quot;doc&quot;</span><span class="s2">, </span><span class="s1">validator</span><span class="s2">=</span><span class="s1">cf</span><span class="s2">.</span><span class="s1">is_int</span><span class="s2">)</span>
        <span class="s1">cf</span><span class="s2">.</span><span class="s1">register_option</span><span class="s2">(</span><span class="s3">&quot;b.c&quot;</span><span class="s2">, </span><span class="s3">&quot;hullo&quot;</span><span class="s2">, </span><span class="s3">&quot;doc2&quot;</span><span class="s2">, </span><span class="s1">validator</span><span class="s2">=</span><span class="s1">cf</span><span class="s2">.</span><span class="s1">is_str</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">cf</span><span class="s2">.</span><span class="s1">get_option</span><span class="s2">(</span><span class="s3">&quot;a&quot;</span><span class="s2">) == </span><span class="s5">1</span>
        <span class="s0">assert </span><span class="s1">cf</span><span class="s2">.</span><span class="s1">get_option</span><span class="s2">(</span><span class="s3">&quot;b.c&quot;</span><span class="s2">) == </span><span class="s3">&quot;hullo&quot;</span>

        <span class="s1">cf</span><span class="s2">.</span><span class="s1">set_option</span><span class="s2">(</span><span class="s3">&quot;a&quot;</span><span class="s2">, </span><span class="s5">2</span><span class="s2">)</span>
        <span class="s1">cf</span><span class="s2">.</span><span class="s1">set_option</span><span class="s2">(</span><span class="s3">&quot;b.c&quot;</span><span class="s2">, </span><span class="s3">&quot;wurld&quot;</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">cf</span><span class="s2">.</span><span class="s1">get_option</span><span class="s2">(</span><span class="s3">&quot;a&quot;</span><span class="s2">) == </span><span class="s5">2</span>
        <span class="s0">assert </span><span class="s1">cf</span><span class="s2">.</span><span class="s1">get_option</span><span class="s2">(</span><span class="s3">&quot;b.c&quot;</span><span class="s2">) == </span><span class="s3">&quot;wurld&quot;</span>

        <span class="s1">cf</span><span class="s2">.</span><span class="s1">reset_option</span><span class="s2">(</span><span class="s3">&quot;all&quot;</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">cf</span><span class="s2">.</span><span class="s1">get_option</span><span class="s2">(</span><span class="s3">&quot;a&quot;</span><span class="s2">) == </span><span class="s5">1</span>
        <span class="s0">assert </span><span class="s1">cf</span><span class="s2">.</span><span class="s1">get_option</span><span class="s2">(</span><span class="s3">&quot;b.c&quot;</span><span class="s2">) == </span><span class="s3">&quot;hullo&quot;</span>

    <span class="s0">def </span><span class="s1">test_deprecate_option</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s4"># we can deprecate non-existent options</span>
        <span class="s1">cf</span><span class="s2">.</span><span class="s1">deprecate_option</span><span class="s2">(</span><span class="s3">&quot;foo&quot;</span><span class="s2">)</span>

        <span class="s0">assert </span><span class="s1">cf</span><span class="s2">.</span><span class="s1">_is_deprecated</span><span class="s2">(</span><span class="s3">&quot;foo&quot;</span><span class="s2">)</span>
        <span class="s0">with </span><span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_produces_warning</span><span class="s2">(</span><span class="s1">FutureWarning</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s3">&quot;deprecated&quot;</span><span class="s2">):</span>
            <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">KeyError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s3">&quot;No such keys.s.: 'foo'&quot;</span><span class="s2">):</span>
                <span class="s1">cf</span><span class="s2">.</span><span class="s1">get_option</span><span class="s2">(</span><span class="s3">&quot;foo&quot;</span><span class="s2">)</span>

        <span class="s1">cf</span><span class="s2">.</span><span class="s1">register_option</span><span class="s2">(</span><span class="s3">&quot;a&quot;</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s3">&quot;doc&quot;</span><span class="s2">, </span><span class="s1">validator</span><span class="s2">=</span><span class="s1">cf</span><span class="s2">.</span><span class="s1">is_int</span><span class="s2">)</span>
        <span class="s1">cf</span><span class="s2">.</span><span class="s1">register_option</span><span class="s2">(</span><span class="s3">&quot;b.c&quot;</span><span class="s2">, </span><span class="s3">&quot;hullo&quot;</span><span class="s2">, </span><span class="s3">&quot;doc2&quot;</span><span class="s2">)</span>
        <span class="s1">cf</span><span class="s2">.</span><span class="s1">register_option</span><span class="s2">(</span><span class="s3">&quot;foo&quot;</span><span class="s2">, </span><span class="s3">&quot;hullo&quot;</span><span class="s2">, </span><span class="s3">&quot;doc2&quot;</span><span class="s2">)</span>

        <span class="s1">cf</span><span class="s2">.</span><span class="s1">deprecate_option</span><span class="s2">(</span><span class="s3">&quot;a&quot;</span><span class="s2">, </span><span class="s1">removal_ver</span><span class="s2">=</span><span class="s3">&quot;nifty_ver&quot;</span><span class="s2">)</span>
        <span class="s0">with </span><span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_produces_warning</span><span class="s2">(</span><span class="s1">FutureWarning</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s3">&quot;eprecated.*nifty_ver&quot;</span><span class="s2">):</span>
            <span class="s1">cf</span><span class="s2">.</span><span class="s1">get_option</span><span class="s2">(</span><span class="s3">&quot;a&quot;</span><span class="s2">)</span>

            <span class="s1">msg </span><span class="s2">= </span><span class="s3">&quot;Option 'a' has already been defined as deprecated&quot;</span>
            <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">OptionError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
                <span class="s1">cf</span><span class="s2">.</span><span class="s1">deprecate_option</span><span class="s2">(</span><span class="s3">&quot;a&quot;</span><span class="s2">)</span>

        <span class="s1">cf</span><span class="s2">.</span><span class="s1">deprecate_option</span><span class="s2">(</span><span class="s3">&quot;b.c&quot;</span><span class="s2">, </span><span class="s3">&quot;zounds!&quot;</span><span class="s2">)</span>
        <span class="s0">with </span><span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_produces_warning</span><span class="s2">(</span><span class="s1">FutureWarning</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s3">&quot;zounds!&quot;</span><span class="s2">):</span>
            <span class="s1">cf</span><span class="s2">.</span><span class="s1">get_option</span><span class="s2">(</span><span class="s3">&quot;b.c&quot;</span><span class="s2">)</span>

        <span class="s4"># test rerouting keys</span>
        <span class="s1">cf</span><span class="s2">.</span><span class="s1">register_option</span><span class="s2">(</span><span class="s3">&quot;d.a&quot;</span><span class="s2">, </span><span class="s3">&quot;foo&quot;</span><span class="s2">, </span><span class="s3">&quot;doc2&quot;</span><span class="s2">)</span>
        <span class="s1">cf</span><span class="s2">.</span><span class="s1">register_option</span><span class="s2">(</span><span class="s3">&quot;d.dep&quot;</span><span class="s2">, </span><span class="s3">&quot;bar&quot;</span><span class="s2">, </span><span class="s3">&quot;doc2&quot;</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">cf</span><span class="s2">.</span><span class="s1">get_option</span><span class="s2">(</span><span class="s3">&quot;d.a&quot;</span><span class="s2">) == </span><span class="s3">&quot;foo&quot;</span>
        <span class="s0">assert </span><span class="s1">cf</span><span class="s2">.</span><span class="s1">get_option</span><span class="s2">(</span><span class="s3">&quot;d.dep&quot;</span><span class="s2">) == </span><span class="s3">&quot;bar&quot;</span>

        <span class="s1">cf</span><span class="s2">.</span><span class="s1">deprecate_option</span><span class="s2">(</span><span class="s3">&quot;d.dep&quot;</span><span class="s2">, </span><span class="s1">rkey</span><span class="s2">=</span><span class="s3">&quot;d.a&quot;</span><span class="s2">)  </span><span class="s4"># reroute d.dep to d.a</span>
        <span class="s0">with </span><span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_produces_warning</span><span class="s2">(</span><span class="s1">FutureWarning</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s3">&quot;eprecated&quot;</span><span class="s2">):</span>
            <span class="s0">assert </span><span class="s1">cf</span><span class="s2">.</span><span class="s1">get_option</span><span class="s2">(</span><span class="s3">&quot;d.dep&quot;</span><span class="s2">) == </span><span class="s3">&quot;foo&quot;</span>

        <span class="s0">with </span><span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_produces_warning</span><span class="s2">(</span><span class="s1">FutureWarning</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s3">&quot;eprecated&quot;</span><span class="s2">):</span>
            <span class="s1">cf</span><span class="s2">.</span><span class="s1">set_option</span><span class="s2">(</span><span class="s3">&quot;d.dep&quot;</span><span class="s2">, </span><span class="s3">&quot;baz&quot;</span><span class="s2">)  </span><span class="s4"># should overwrite &quot;d.a&quot;</span>

        <span class="s0">with </span><span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_produces_warning</span><span class="s2">(</span><span class="s1">FutureWarning</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s3">&quot;eprecated&quot;</span><span class="s2">):</span>
            <span class="s0">assert </span><span class="s1">cf</span><span class="s2">.</span><span class="s1">get_option</span><span class="s2">(</span><span class="s3">&quot;d.dep&quot;</span><span class="s2">) == </span><span class="s3">&quot;baz&quot;</span>

    <span class="s0">def </span><span class="s1">test_config_prefix</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">with </span><span class="s1">cf</span><span class="s2">.</span><span class="s1">config_prefix</span><span class="s2">(</span><span class="s3">&quot;base&quot;</span><span class="s2">):</span>
            <span class="s1">cf</span><span class="s2">.</span><span class="s1">register_option</span><span class="s2">(</span><span class="s3">&quot;a&quot;</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s3">&quot;doc1&quot;</span><span class="s2">)</span>
            <span class="s1">cf</span><span class="s2">.</span><span class="s1">register_option</span><span class="s2">(</span><span class="s3">&quot;b&quot;</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s3">&quot;doc2&quot;</span><span class="s2">)</span>
            <span class="s0">assert </span><span class="s1">cf</span><span class="s2">.</span><span class="s1">get_option</span><span class="s2">(</span><span class="s3">&quot;a&quot;</span><span class="s2">) == </span><span class="s5">1</span>
            <span class="s0">assert </span><span class="s1">cf</span><span class="s2">.</span><span class="s1">get_option</span><span class="s2">(</span><span class="s3">&quot;b&quot;</span><span class="s2">) == </span><span class="s5">2</span>

            <span class="s1">cf</span><span class="s2">.</span><span class="s1">set_option</span><span class="s2">(</span><span class="s3">&quot;a&quot;</span><span class="s2">, </span><span class="s5">3</span><span class="s2">)</span>
            <span class="s1">cf</span><span class="s2">.</span><span class="s1">set_option</span><span class="s2">(</span><span class="s3">&quot;b&quot;</span><span class="s2">, </span><span class="s5">4</span><span class="s2">)</span>
            <span class="s0">assert </span><span class="s1">cf</span><span class="s2">.</span><span class="s1">get_option</span><span class="s2">(</span><span class="s3">&quot;a&quot;</span><span class="s2">) == </span><span class="s5">3</span>
            <span class="s0">assert </span><span class="s1">cf</span><span class="s2">.</span><span class="s1">get_option</span><span class="s2">(</span><span class="s3">&quot;b&quot;</span><span class="s2">) == </span><span class="s5">4</span>

        <span class="s0">assert </span><span class="s1">cf</span><span class="s2">.</span><span class="s1">get_option</span><span class="s2">(</span><span class="s3">&quot;base.a&quot;</span><span class="s2">) == </span><span class="s5">3</span>
        <span class="s0">assert </span><span class="s1">cf</span><span class="s2">.</span><span class="s1">get_option</span><span class="s2">(</span><span class="s3">&quot;base.b&quot;</span><span class="s2">) == </span><span class="s5">4</span>
        <span class="s0">assert </span><span class="s3">&quot;doc1&quot; </span><span class="s0">in </span><span class="s1">cf</span><span class="s2">.</span><span class="s1">describe_option</span><span class="s2">(</span><span class="s3">&quot;base.a&quot;</span><span class="s2">, </span><span class="s1">_print_desc</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s3">&quot;doc2&quot; </span><span class="s0">in </span><span class="s1">cf</span><span class="s2">.</span><span class="s1">describe_option</span><span class="s2">(</span><span class="s3">&quot;base.b&quot;</span><span class="s2">, </span><span class="s1">_print_desc</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>

        <span class="s1">cf</span><span class="s2">.</span><span class="s1">reset_option</span><span class="s2">(</span><span class="s3">&quot;base.a&quot;</span><span class="s2">)</span>
        <span class="s1">cf</span><span class="s2">.</span><span class="s1">reset_option</span><span class="s2">(</span><span class="s3">&quot;base.b&quot;</span><span class="s2">)</span>

        <span class="s0">with </span><span class="s1">cf</span><span class="s2">.</span><span class="s1">config_prefix</span><span class="s2">(</span><span class="s3">&quot;base&quot;</span><span class="s2">):</span>
            <span class="s0">assert </span><span class="s1">cf</span><span class="s2">.</span><span class="s1">get_option</span><span class="s2">(</span><span class="s3">&quot;a&quot;</span><span class="s2">) == </span><span class="s5">1</span>
            <span class="s0">assert </span><span class="s1">cf</span><span class="s2">.</span><span class="s1">get_option</span><span class="s2">(</span><span class="s3">&quot;b&quot;</span><span class="s2">) == </span><span class="s5">2</span>

    <span class="s0">def </span><span class="s1">test_callback</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">k </span><span class="s2">= [</span><span class="s0">None</span><span class="s2">]</span>
        <span class="s1">v </span><span class="s2">= [</span><span class="s0">None</span><span class="s2">]</span>

        <span class="s0">def </span><span class="s1">callback</span><span class="s2">(</span><span class="s1">key</span><span class="s2">):</span>
            <span class="s1">k</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">key</span><span class="s2">)</span>
            <span class="s1">v</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">cf</span><span class="s2">.</span><span class="s1">get_option</span><span class="s2">(</span><span class="s1">key</span><span class="s2">))</span>

        <span class="s1">cf</span><span class="s2">.</span><span class="s1">register_option</span><span class="s2">(</span><span class="s3">&quot;d.a&quot;</span><span class="s2">, </span><span class="s3">&quot;foo&quot;</span><span class="s2">, </span><span class="s1">cb</span><span class="s2">=</span><span class="s1">callback</span><span class="s2">)</span>
        <span class="s1">cf</span><span class="s2">.</span><span class="s1">register_option</span><span class="s2">(</span><span class="s3">&quot;d.b&quot;</span><span class="s2">, </span><span class="s3">&quot;foo&quot;</span><span class="s2">, </span><span class="s1">cb</span><span class="s2">=</span><span class="s1">callback</span><span class="s2">)</span>

        <span class="s0">del </span><span class="s1">k</span><span class="s2">[-</span><span class="s5">1</span><span class="s2">], </span><span class="s1">v</span><span class="s2">[-</span><span class="s5">1</span><span class="s2">]</span>
        <span class="s1">cf</span><span class="s2">.</span><span class="s1">set_option</span><span class="s2">(</span><span class="s3">&quot;d.a&quot;</span><span class="s2">, </span><span class="s3">&quot;fooz&quot;</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">k</span><span class="s2">[-</span><span class="s5">1</span><span class="s2">] == </span><span class="s3">&quot;d.a&quot;</span>
        <span class="s0">assert </span><span class="s1">v</span><span class="s2">[-</span><span class="s5">1</span><span class="s2">] == </span><span class="s3">&quot;fooz&quot;</span>

        <span class="s0">del </span><span class="s1">k</span><span class="s2">[-</span><span class="s5">1</span><span class="s2">], </span><span class="s1">v</span><span class="s2">[-</span><span class="s5">1</span><span class="s2">]</span>
        <span class="s1">cf</span><span class="s2">.</span><span class="s1">set_option</span><span class="s2">(</span><span class="s3">&quot;d.b&quot;</span><span class="s2">, </span><span class="s3">&quot;boo&quot;</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">k</span><span class="s2">[-</span><span class="s5">1</span><span class="s2">] == </span><span class="s3">&quot;d.b&quot;</span>
        <span class="s0">assert </span><span class="s1">v</span><span class="s2">[-</span><span class="s5">1</span><span class="s2">] == </span><span class="s3">&quot;boo&quot;</span>

        <span class="s0">del </span><span class="s1">k</span><span class="s2">[-</span><span class="s5">1</span><span class="s2">], </span><span class="s1">v</span><span class="s2">[-</span><span class="s5">1</span><span class="s2">]</span>
        <span class="s1">cf</span><span class="s2">.</span><span class="s1">reset_option</span><span class="s2">(</span><span class="s3">&quot;d.b&quot;</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">k</span><span class="s2">[-</span><span class="s5">1</span><span class="s2">] == </span><span class="s3">&quot;d.b&quot;</span>

    <span class="s0">def </span><span class="s1">test_set_ContextManager</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">def </span><span class="s1">eq</span><span class="s2">(</span><span class="s1">val</span><span class="s2">):</span>
            <span class="s0">assert </span><span class="s1">cf</span><span class="s2">.</span><span class="s1">get_option</span><span class="s2">(</span><span class="s3">&quot;a&quot;</span><span class="s2">) == </span><span class="s1">val</span>

        <span class="s1">cf</span><span class="s2">.</span><span class="s1">register_option</span><span class="s2">(</span><span class="s3">&quot;a&quot;</span><span class="s2">, </span><span class="s5">0</span><span class="s2">)</span>
        <span class="s1">eq</span><span class="s2">(</span><span class="s5">0</span><span class="s2">)</span>
        <span class="s0">with </span><span class="s1">cf</span><span class="s2">.</span><span class="s1">option_context</span><span class="s2">(</span><span class="s3">&quot;a&quot;</span><span class="s2">, </span><span class="s5">15</span><span class="s2">):</span>
            <span class="s1">eq</span><span class="s2">(</span><span class="s5">15</span><span class="s2">)</span>
            <span class="s0">with </span><span class="s1">cf</span><span class="s2">.</span><span class="s1">option_context</span><span class="s2">(</span><span class="s3">&quot;a&quot;</span><span class="s2">, </span><span class="s5">25</span><span class="s2">):</span>
                <span class="s1">eq</span><span class="s2">(</span><span class="s5">25</span><span class="s2">)</span>
            <span class="s1">eq</span><span class="s2">(</span><span class="s5">15</span><span class="s2">)</span>
        <span class="s1">eq</span><span class="s2">(</span><span class="s5">0</span><span class="s2">)</span>

        <span class="s1">cf</span><span class="s2">.</span><span class="s1">set_option</span><span class="s2">(</span><span class="s3">&quot;a&quot;</span><span class="s2">, </span><span class="s5">17</span><span class="s2">)</span>
        <span class="s1">eq</span><span class="s2">(</span><span class="s5">17</span><span class="s2">)</span>

        <span class="s4"># Test that option_context can be used as a decorator too (#34253).</span>
        <span class="s2">@</span><span class="s1">cf</span><span class="s2">.</span><span class="s1">option_context</span><span class="s2">(</span><span class="s3">&quot;a&quot;</span><span class="s2">, </span><span class="s5">123</span><span class="s2">)</span>
        <span class="s0">def </span><span class="s1">f</span><span class="s2">():</span>
            <span class="s1">eq</span><span class="s2">(</span><span class="s5">123</span><span class="s2">)</span>

        <span class="s1">f</span><span class="s2">()</span>

    <span class="s0">def </span><span class="s1">test_attribute_access</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">holder </span><span class="s2">= []</span>

        <span class="s0">def </span><span class="s1">f3</span><span class="s2">(</span><span class="s1">key</span><span class="s2">):</span>
            <span class="s1">holder</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s0">True</span><span class="s2">)</span>

        <span class="s1">cf</span><span class="s2">.</span><span class="s1">register_option</span><span class="s2">(</span><span class="s3">&quot;a&quot;</span><span class="s2">, </span><span class="s5">0</span><span class="s2">)</span>
        <span class="s1">cf</span><span class="s2">.</span><span class="s1">register_option</span><span class="s2">(</span><span class="s3">&quot;c&quot;</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s1">cb</span><span class="s2">=</span><span class="s1">f3</span><span class="s2">)</span>
        <span class="s1">options </span><span class="s2">= </span><span class="s1">cf</span><span class="s2">.</span><span class="s1">options</span>

        <span class="s0">assert </span><span class="s1">options</span><span class="s2">.</span><span class="s1">a </span><span class="s2">== </span><span class="s5">0</span>
        <span class="s0">with </span><span class="s1">cf</span><span class="s2">.</span><span class="s1">option_context</span><span class="s2">(</span><span class="s3">&quot;a&quot;</span><span class="s2">, </span><span class="s5">15</span><span class="s2">):</span>
            <span class="s0">assert </span><span class="s1">options</span><span class="s2">.</span><span class="s1">a </span><span class="s2">== </span><span class="s5">15</span>

        <span class="s1">options</span><span class="s2">.</span><span class="s1">a </span><span class="s2">= </span><span class="s5">500</span>
        <span class="s0">assert </span><span class="s1">cf</span><span class="s2">.</span><span class="s1">get_option</span><span class="s2">(</span><span class="s3">&quot;a&quot;</span><span class="s2">) == </span><span class="s5">500</span>

        <span class="s1">cf</span><span class="s2">.</span><span class="s1">reset_option</span><span class="s2">(</span><span class="s3">&quot;a&quot;</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">options</span><span class="s2">.</span><span class="s1">a </span><span class="s2">== </span><span class="s1">cf</span><span class="s2">.</span><span class="s1">get_option</span><span class="s2">(</span><span class="s3">&quot;a&quot;</span><span class="s2">, </span><span class="s5">0</span><span class="s2">)</span>

        <span class="s1">msg </span><span class="s2">= </span><span class="s3">&quot;You can only set the value of existing options&quot;</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">OptionError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
            <span class="s1">options</span><span class="s2">.</span><span class="s1">b </span><span class="s2">= </span><span class="s5">1</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">OptionError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
            <span class="s1">options</span><span class="s2">.</span><span class="s1">display </span><span class="s2">= </span><span class="s5">1</span>

        <span class="s4"># make sure callback kicks when using this form of setting</span>
        <span class="s1">options</span><span class="s2">.</span><span class="s1">c </span><span class="s2">= </span><span class="s5">1</span>
        <span class="s0">assert </span><span class="s1">len</span><span class="s2">(</span><span class="s1">holder</span><span class="s2">) == </span><span class="s5">1</span>

    <span class="s0">def </span><span class="s1">test_option_context_scope</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s4"># Ensure that creating a context does not affect the existing</span>
        <span class="s4"># environment as it is supposed to be used with the `with` statement.</span>
        <span class="s4"># See https://github.com/pandas-dev/pandas/issues/8514</span>

        <span class="s1">original_value </span><span class="s2">= </span><span class="s5">60</span>
        <span class="s1">context_value </span><span class="s2">= </span><span class="s5">10</span>
        <span class="s1">option_name </span><span class="s2">= </span><span class="s3">&quot;a&quot;</span>

        <span class="s1">cf</span><span class="s2">.</span><span class="s1">register_option</span><span class="s2">(</span><span class="s1">option_name</span><span class="s2">, </span><span class="s1">original_value</span><span class="s2">)</span>

        <span class="s4"># Ensure creating contexts didn't affect the current context.</span>
        <span class="s1">ctx </span><span class="s2">= </span><span class="s1">cf</span><span class="s2">.</span><span class="s1">option_context</span><span class="s2">(</span><span class="s1">option_name</span><span class="s2">, </span><span class="s1">context_value</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">cf</span><span class="s2">.</span><span class="s1">get_option</span><span class="s2">(</span><span class="s1">option_name</span><span class="s2">) == </span><span class="s1">original_value</span>

        <span class="s4"># Ensure the correct value is available inside the context.</span>
        <span class="s0">with </span><span class="s1">ctx</span><span class="s2">:</span>
            <span class="s0">assert </span><span class="s1">cf</span><span class="s2">.</span><span class="s1">get_option</span><span class="s2">(</span><span class="s1">option_name</span><span class="s2">) == </span><span class="s1">context_value</span>

        <span class="s4"># Ensure the current context is reset</span>
        <span class="s0">assert </span><span class="s1">cf</span><span class="s2">.</span><span class="s1">get_option</span><span class="s2">(</span><span class="s1">option_name</span><span class="s2">) == </span><span class="s1">original_value</span>

    <span class="s0">def </span><span class="s1">test_dictwrapper_getattr</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">options </span><span class="s2">= </span><span class="s1">cf</span><span class="s2">.</span><span class="s1">options</span>
        <span class="s4"># GH 19789</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">OptionError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s3">&quot;No such option&quot;</span><span class="s2">):</span>
            <span class="s1">options</span><span class="s2">.</span><span class="s1">bananas</span>
        <span class="s0">assert not </span><span class="s1">hasattr</span><span class="s2">(</span><span class="s1">options</span><span class="s2">, </span><span class="s3">&quot;bananas&quot;</span><span class="s2">)</span>
</pre>
</body>
</html>