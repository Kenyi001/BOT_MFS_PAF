<html>
<head>
<title>test_datetime.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #bcbec4;}
.s1 { color: #cf8e6d;}
.s2 { color: #bcbec4;}
.s3 { color: #7a7e85;}
.s4 { color: #6aab73;}
.s5 { color: #2aacb8;}
.s6 { color: #a5c261;}
.s7 { color: #5f826b; font-style: italic;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_datetime.py</font>
</center></td></tr></table>
<pre>
<span class="s1">import </span><span class="s0">numpy</span>
<span class="s1">import </span><span class="s0">numpy </span><span class="s1">as </span><span class="s0">np</span>
<span class="s1">import </span><span class="s0">datetime</span>
<span class="s1">import </span><span class="s0">pytest</span>
<span class="s1">from </span><span class="s0">numpy</span><span class="s2">.</span><span class="s0">testing </span><span class="s1">import </span><span class="s2">(</span>
    <span class="s0">IS_WASM</span><span class="s2">,</span>
    <span class="s0">assert_</span><span class="s2">, </span><span class="s0">assert_equal</span><span class="s2">, </span><span class="s0">assert_raises</span><span class="s2">, </span><span class="s0">assert_warns</span><span class="s2">, </span><span class="s0">suppress_warnings</span><span class="s2">,</span>
    <span class="s0">assert_raises_regex</span><span class="s2">, </span><span class="s0">assert_array_equal</span><span class="s2">,</span>
    <span class="s2">)</span>
<span class="s1">from </span><span class="s0">numpy</span><span class="s2">.</span><span class="s0">compat </span><span class="s1">import </span><span class="s0">pickle</span>

<span class="s3"># Use pytz to test out various time zones if available</span>
<span class="s1">try</span><span class="s2">:</span>
    <span class="s1">from </span><span class="s0">pytz </span><span class="s1">import </span><span class="s0">timezone </span><span class="s1">as </span><span class="s0">tz</span>
    <span class="s0">_has_pytz </span><span class="s2">= </span><span class="s1">True</span>
<span class="s1">except </span><span class="s0">ImportError</span><span class="s2">:</span>
    <span class="s0">_has_pytz </span><span class="s2">= </span><span class="s1">False</span>

<span class="s1">try</span><span class="s2">:</span>
    <span class="s0">RecursionError</span>
<span class="s1">except </span><span class="s0">NameError</span><span class="s2">:</span>
    <span class="s0">RecursionError </span><span class="s2">= </span><span class="s0">RuntimeError  </span><span class="s3"># python &lt; 3.5</span>


<span class="s1">class </span><span class="s0">TestDateTime</span><span class="s2">:</span>
    <span class="s1">def </span><span class="s0">test_datetime_dtype_creation</span><span class="s2">(</span><span class="s0">self</span><span class="s2">):</span>
        <span class="s1">for </span><span class="s0">unit </span><span class="s1">in </span><span class="s2">[</span><span class="s4">'Y'</span><span class="s2">, </span><span class="s4">'M'</span><span class="s2">, </span><span class="s4">'W'</span><span class="s2">, </span><span class="s4">'D'</span><span class="s2">,</span>
                     <span class="s4">'h'</span><span class="s2">, </span><span class="s4">'m'</span><span class="s2">, </span><span class="s4">'s'</span><span class="s2">, </span><span class="s4">'ms'</span><span class="s2">, </span><span class="s4">'us'</span><span class="s2">,</span>
                     <span class="s4">'Î¼s'</span><span class="s2">,  </span><span class="s3"># alias for us</span>
                     <span class="s4">'ns'</span><span class="s2">, </span><span class="s4">'ps'</span><span class="s2">, </span><span class="s4">'fs'</span><span class="s2">, </span><span class="s4">'as'</span><span class="s2">]:</span>
            <span class="s0">dt1 </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[750%s]' </span><span class="s2">% </span><span class="s0">unit</span><span class="s2">)</span>
            <span class="s0">assert_</span><span class="s2">(</span><span class="s0">dt1 </span><span class="s2">== </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'datetime64[750%s]' </span><span class="s2">% </span><span class="s0">unit</span><span class="s2">))</span>
            <span class="s0">dt2 </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'m8[%s]' </span><span class="s2">% </span><span class="s0">unit</span><span class="s2">)</span>
            <span class="s0">assert_</span><span class="s2">(</span><span class="s0">dt2 </span><span class="s2">== </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'timedelta64[%s]' </span><span class="s2">% </span><span class="s0">unit</span><span class="s2">))</span>

        <span class="s3"># Generic units shouldn't add [] to the end</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">str</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">&quot;M8&quot;</span><span class="s2">)), </span><span class="s4">&quot;datetime64&quot;</span><span class="s2">)</span>

        <span class="s3"># Should be possible to specify the endianness</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">&quot;=M8&quot;</span><span class="s2">), </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">&quot;M8&quot;</span><span class="s2">))</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">&quot;=M8[s]&quot;</span><span class="s2">), </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">&quot;M8[s]&quot;</span><span class="s2">))</span>
        <span class="s0">assert_</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">&quot;&gt;M8&quot;</span><span class="s2">) == </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">&quot;M8&quot;</span><span class="s2">) </span><span class="s1">or</span>
                <span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">&quot;&lt;M8&quot;</span><span class="s2">) == </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">&quot;M8&quot;</span><span class="s2">))</span>
        <span class="s0">assert_</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">&quot;&gt;M8[D]&quot;</span><span class="s2">) == </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">&quot;M8[D]&quot;</span><span class="s2">) </span><span class="s1">or</span>
                <span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">&quot;&lt;M8[D]&quot;</span><span class="s2">) == </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">&quot;M8[D]&quot;</span><span class="s2">))</span>
        <span class="s0">assert_</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">&quot;&gt;M8&quot;</span><span class="s2">) != </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">&quot;&lt;M8&quot;</span><span class="s2">))</span>

        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">&quot;=m8&quot;</span><span class="s2">), </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">&quot;m8&quot;</span><span class="s2">))</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">&quot;=m8[s]&quot;</span><span class="s2">), </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">&quot;m8[s]&quot;</span><span class="s2">))</span>
        <span class="s0">assert_</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">&quot;&gt;m8&quot;</span><span class="s2">) == </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">&quot;m8&quot;</span><span class="s2">) </span><span class="s1">or</span>
                <span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">&quot;&lt;m8&quot;</span><span class="s2">) == </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">&quot;m8&quot;</span><span class="s2">))</span>
        <span class="s0">assert_</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">&quot;&gt;m8[D]&quot;</span><span class="s2">) == </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">&quot;m8[D]&quot;</span><span class="s2">) </span><span class="s1">or</span>
                <span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">&quot;&lt;m8[D]&quot;</span><span class="s2">) == </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">&quot;m8[D]&quot;</span><span class="s2">))</span>
        <span class="s0">assert_</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">&quot;&gt;m8&quot;</span><span class="s2">) != </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">&quot;&lt;m8&quot;</span><span class="s2">))</span>

        <span class="s3"># Check that the parser rejects bad datetime types</span>
        <span class="s0">assert_raises</span><span class="s2">(</span><span class="s0">TypeError</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">, </span><span class="s4">'M8[badunit]'</span><span class="s2">)</span>
        <span class="s0">assert_raises</span><span class="s2">(</span><span class="s0">TypeError</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">, </span><span class="s4">'m8[badunit]'</span><span class="s2">)</span>
        <span class="s0">assert_raises</span><span class="s2">(</span><span class="s0">TypeError</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">, </span><span class="s4">'M8[YY]'</span><span class="s2">)</span>
        <span class="s0">assert_raises</span><span class="s2">(</span><span class="s0">TypeError</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">, </span><span class="s4">'m8[YY]'</span><span class="s2">)</span>
        <span class="s0">assert_raises</span><span class="s2">(</span><span class="s0">TypeError</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">, </span><span class="s4">'m4'</span><span class="s2">)</span>
        <span class="s0">assert_raises</span><span class="s2">(</span><span class="s0">TypeError</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">, </span><span class="s4">'M7'</span><span class="s2">)</span>
        <span class="s0">assert_raises</span><span class="s2">(</span><span class="s0">TypeError</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">, </span><span class="s4">'m7'</span><span class="s2">)</span>
        <span class="s0">assert_raises</span><span class="s2">(</span><span class="s0">TypeError</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">, </span><span class="s4">'M16'</span><span class="s2">)</span>
        <span class="s0">assert_raises</span><span class="s2">(</span><span class="s0">TypeError</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">, </span><span class="s4">'m16'</span><span class="s2">)</span>
        <span class="s0">assert_raises</span><span class="s2">(</span><span class="s0">TypeError</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">, </span><span class="s4">'M8[3000000000ps]'</span><span class="s2">)</span>

    <span class="s1">def </span><span class="s0">test_datetime_casting_rules</span><span class="s2">(</span><span class="s0">self</span><span class="s2">):</span>
        <span class="s3"># Cannot cast safely/same_kind between timedelta and datetime</span>
        <span class="s0">assert_</span><span class="s2">(</span><span class="s1">not </span><span class="s0">np</span><span class="s2">.</span><span class="s0">can_cast</span><span class="s2">(</span><span class="s4">'m8'</span><span class="s2">, </span><span class="s4">'M8'</span><span class="s2">, </span><span class="s0">casting</span><span class="s2">=</span><span class="s4">'same_kind'</span><span class="s2">))</span>
        <span class="s0">assert_</span><span class="s2">(</span><span class="s1">not </span><span class="s0">np</span><span class="s2">.</span><span class="s0">can_cast</span><span class="s2">(</span><span class="s4">'M8'</span><span class="s2">, </span><span class="s4">'m8'</span><span class="s2">, </span><span class="s0">casting</span><span class="s2">=</span><span class="s4">'same_kind'</span><span class="s2">))</span>
        <span class="s0">assert_</span><span class="s2">(</span><span class="s1">not </span><span class="s0">np</span><span class="s2">.</span><span class="s0">can_cast</span><span class="s2">(</span><span class="s4">'m8'</span><span class="s2">, </span><span class="s4">'M8'</span><span class="s2">, </span><span class="s0">casting</span><span class="s2">=</span><span class="s4">'safe'</span><span class="s2">))</span>
        <span class="s0">assert_</span><span class="s2">(</span><span class="s1">not </span><span class="s0">np</span><span class="s2">.</span><span class="s0">can_cast</span><span class="s2">(</span><span class="s4">'M8'</span><span class="s2">, </span><span class="s4">'m8'</span><span class="s2">, </span><span class="s0">casting</span><span class="s2">=</span><span class="s4">'safe'</span><span class="s2">))</span>

        <span class="s3"># Can cast safely/same_kind from integer to timedelta</span>
        <span class="s0">assert_</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">can_cast</span><span class="s2">(</span><span class="s4">'i8'</span><span class="s2">, </span><span class="s4">'m8'</span><span class="s2">, </span><span class="s0">casting</span><span class="s2">=</span><span class="s4">'same_kind'</span><span class="s2">))</span>
        <span class="s0">assert_</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">can_cast</span><span class="s2">(</span><span class="s4">'i8'</span><span class="s2">, </span><span class="s4">'m8'</span><span class="s2">, </span><span class="s0">casting</span><span class="s2">=</span><span class="s4">'safe'</span><span class="s2">))</span>
        <span class="s0">assert_</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">can_cast</span><span class="s2">(</span><span class="s4">'i4'</span><span class="s2">, </span><span class="s4">'m8'</span><span class="s2">, </span><span class="s0">casting</span><span class="s2">=</span><span class="s4">'same_kind'</span><span class="s2">))</span>
        <span class="s0">assert_</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">can_cast</span><span class="s2">(</span><span class="s4">'i4'</span><span class="s2">, </span><span class="s4">'m8'</span><span class="s2">, </span><span class="s0">casting</span><span class="s2">=</span><span class="s4">'safe'</span><span class="s2">))</span>
        <span class="s0">assert_</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">can_cast</span><span class="s2">(</span><span class="s4">'u4'</span><span class="s2">, </span><span class="s4">'m8'</span><span class="s2">, </span><span class="s0">casting</span><span class="s2">=</span><span class="s4">'same_kind'</span><span class="s2">))</span>
        <span class="s0">assert_</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">can_cast</span><span class="s2">(</span><span class="s4">'u4'</span><span class="s2">, </span><span class="s4">'m8'</span><span class="s2">, </span><span class="s0">casting</span><span class="s2">=</span><span class="s4">'safe'</span><span class="s2">))</span>

        <span class="s3"># Cannot cast safely from unsigned integer of the same size, which</span>
        <span class="s3"># could overflow</span>
        <span class="s0">assert_</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">can_cast</span><span class="s2">(</span><span class="s4">'u8'</span><span class="s2">, </span><span class="s4">'m8'</span><span class="s2">, </span><span class="s0">casting</span><span class="s2">=</span><span class="s4">'same_kind'</span><span class="s2">))</span>
        <span class="s0">assert_</span><span class="s2">(</span><span class="s1">not </span><span class="s0">np</span><span class="s2">.</span><span class="s0">can_cast</span><span class="s2">(</span><span class="s4">'u8'</span><span class="s2">, </span><span class="s4">'m8'</span><span class="s2">, </span><span class="s0">casting</span><span class="s2">=</span><span class="s4">'safe'</span><span class="s2">))</span>

        <span class="s3"># Cannot cast safely/same_kind from float to timedelta</span>
        <span class="s0">assert_</span><span class="s2">(</span><span class="s1">not </span><span class="s0">np</span><span class="s2">.</span><span class="s0">can_cast</span><span class="s2">(</span><span class="s4">'f4'</span><span class="s2">, </span><span class="s4">'m8'</span><span class="s2">, </span><span class="s0">casting</span><span class="s2">=</span><span class="s4">'same_kind'</span><span class="s2">))</span>
        <span class="s0">assert_</span><span class="s2">(</span><span class="s1">not </span><span class="s0">np</span><span class="s2">.</span><span class="s0">can_cast</span><span class="s2">(</span><span class="s4">'f4'</span><span class="s2">, </span><span class="s4">'m8'</span><span class="s2">, </span><span class="s0">casting</span><span class="s2">=</span><span class="s4">'safe'</span><span class="s2">))</span>

        <span class="s3"># Cannot cast safely/same_kind from integer to datetime</span>
        <span class="s0">assert_</span><span class="s2">(</span><span class="s1">not </span><span class="s0">np</span><span class="s2">.</span><span class="s0">can_cast</span><span class="s2">(</span><span class="s4">'i8'</span><span class="s2">, </span><span class="s4">'M8'</span><span class="s2">, </span><span class="s0">casting</span><span class="s2">=</span><span class="s4">'same_kind'</span><span class="s2">))</span>
        <span class="s0">assert_</span><span class="s2">(</span><span class="s1">not </span><span class="s0">np</span><span class="s2">.</span><span class="s0">can_cast</span><span class="s2">(</span><span class="s4">'i8'</span><span class="s2">, </span><span class="s4">'M8'</span><span class="s2">, </span><span class="s0">casting</span><span class="s2">=</span><span class="s4">'safe'</span><span class="s2">))</span>

        <span class="s3"># Cannot cast safely/same_kind from bool to datetime</span>
        <span class="s0">assert_</span><span class="s2">(</span><span class="s1">not </span><span class="s0">np</span><span class="s2">.</span><span class="s0">can_cast</span><span class="s2">(</span><span class="s4">'b1'</span><span class="s2">, </span><span class="s4">'M8'</span><span class="s2">, </span><span class="s0">casting</span><span class="s2">=</span><span class="s4">'same_kind'</span><span class="s2">))</span>
        <span class="s0">assert_</span><span class="s2">(</span><span class="s1">not </span><span class="s0">np</span><span class="s2">.</span><span class="s0">can_cast</span><span class="s2">(</span><span class="s4">'b1'</span><span class="s2">, </span><span class="s4">'M8'</span><span class="s2">, </span><span class="s0">casting</span><span class="s2">=</span><span class="s4">'safe'</span><span class="s2">))</span>
        <span class="s3"># Can cast safely/same_kind from bool to timedelta</span>
        <span class="s0">assert_</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">can_cast</span><span class="s2">(</span><span class="s4">'b1'</span><span class="s2">, </span><span class="s4">'m8'</span><span class="s2">, </span><span class="s0">casting</span><span class="s2">=</span><span class="s4">'same_kind'</span><span class="s2">))</span>
        <span class="s0">assert_</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">can_cast</span><span class="s2">(</span><span class="s4">'b1'</span><span class="s2">, </span><span class="s4">'m8'</span><span class="s2">, </span><span class="s0">casting</span><span class="s2">=</span><span class="s4">'safe'</span><span class="s2">))</span>

        <span class="s3"># Can cast datetime safely from months/years to days</span>
        <span class="s0">assert_</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">can_cast</span><span class="s2">(</span><span class="s4">'M8[M]'</span><span class="s2">, </span><span class="s4">'M8[D]'</span><span class="s2">, </span><span class="s0">casting</span><span class="s2">=</span><span class="s4">'safe'</span><span class="s2">))</span>
        <span class="s0">assert_</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">can_cast</span><span class="s2">(</span><span class="s4">'M8[Y]'</span><span class="s2">, </span><span class="s4">'M8[D]'</span><span class="s2">, </span><span class="s0">casting</span><span class="s2">=</span><span class="s4">'safe'</span><span class="s2">))</span>
        <span class="s3"># Cannot cast timedelta safely from months/years to days</span>
        <span class="s0">assert_</span><span class="s2">(</span><span class="s1">not </span><span class="s0">np</span><span class="s2">.</span><span class="s0">can_cast</span><span class="s2">(</span><span class="s4">'m8[M]'</span><span class="s2">, </span><span class="s4">'m8[D]'</span><span class="s2">, </span><span class="s0">casting</span><span class="s2">=</span><span class="s4">'safe'</span><span class="s2">))</span>
        <span class="s0">assert_</span><span class="s2">(</span><span class="s1">not </span><span class="s0">np</span><span class="s2">.</span><span class="s0">can_cast</span><span class="s2">(</span><span class="s4">'m8[Y]'</span><span class="s2">, </span><span class="s4">'m8[D]'</span><span class="s2">, </span><span class="s0">casting</span><span class="s2">=</span><span class="s4">'safe'</span><span class="s2">))</span>
        <span class="s3"># Can cast datetime same_kind from months/years to days</span>
        <span class="s0">assert_</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">can_cast</span><span class="s2">(</span><span class="s4">'M8[M]'</span><span class="s2">, </span><span class="s4">'M8[D]'</span><span class="s2">, </span><span class="s0">casting</span><span class="s2">=</span><span class="s4">'same_kind'</span><span class="s2">))</span>
        <span class="s0">assert_</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">can_cast</span><span class="s2">(</span><span class="s4">'M8[Y]'</span><span class="s2">, </span><span class="s4">'M8[D]'</span><span class="s2">, </span><span class="s0">casting</span><span class="s2">=</span><span class="s4">'same_kind'</span><span class="s2">))</span>
        <span class="s3"># Can't cast timedelta same_kind from months/years to days</span>
        <span class="s0">assert_</span><span class="s2">(</span><span class="s1">not </span><span class="s0">np</span><span class="s2">.</span><span class="s0">can_cast</span><span class="s2">(</span><span class="s4">'m8[M]'</span><span class="s2">, </span><span class="s4">'m8[D]'</span><span class="s2">, </span><span class="s0">casting</span><span class="s2">=</span><span class="s4">'same_kind'</span><span class="s2">))</span>
        <span class="s0">assert_</span><span class="s2">(</span><span class="s1">not </span><span class="s0">np</span><span class="s2">.</span><span class="s0">can_cast</span><span class="s2">(</span><span class="s4">'m8[Y]'</span><span class="s2">, </span><span class="s4">'m8[D]'</span><span class="s2">, </span><span class="s0">casting</span><span class="s2">=</span><span class="s4">'same_kind'</span><span class="s2">))</span>
        <span class="s3"># Can cast datetime same_kind across the date/time boundary</span>
        <span class="s0">assert_</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">can_cast</span><span class="s2">(</span><span class="s4">'M8[D]'</span><span class="s2">, </span><span class="s4">'M8[h]'</span><span class="s2">, </span><span class="s0">casting</span><span class="s2">=</span><span class="s4">'same_kind'</span><span class="s2">))</span>
        <span class="s3"># Can cast timedelta same_kind across the date/time boundary</span>
        <span class="s0">assert_</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">can_cast</span><span class="s2">(</span><span class="s4">'m8[D]'</span><span class="s2">, </span><span class="s4">'m8[h]'</span><span class="s2">, </span><span class="s0">casting</span><span class="s2">=</span><span class="s4">'same_kind'</span><span class="s2">))</span>
        <span class="s0">assert_</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">can_cast</span><span class="s2">(</span><span class="s4">'m8[h]'</span><span class="s2">, </span><span class="s4">'m8[D]'</span><span class="s2">, </span><span class="s0">casting</span><span class="s2">=</span><span class="s4">'same_kind'</span><span class="s2">))</span>

        <span class="s3"># Cannot cast safely if the integer multiplier doesn't divide</span>
        <span class="s0">assert_</span><span class="s2">(</span><span class="s1">not </span><span class="s0">np</span><span class="s2">.</span><span class="s0">can_cast</span><span class="s2">(</span><span class="s4">'M8[7h]'</span><span class="s2">, </span><span class="s4">'M8[3h]'</span><span class="s2">, </span><span class="s0">casting</span><span class="s2">=</span><span class="s4">'safe'</span><span class="s2">))</span>
        <span class="s0">assert_</span><span class="s2">(</span><span class="s1">not </span><span class="s0">np</span><span class="s2">.</span><span class="s0">can_cast</span><span class="s2">(</span><span class="s4">'M8[3h]'</span><span class="s2">, </span><span class="s4">'M8[6h]'</span><span class="s2">, </span><span class="s0">casting</span><span class="s2">=</span><span class="s4">'safe'</span><span class="s2">))</span>
        <span class="s3"># But can cast same_kind</span>
        <span class="s0">assert_</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">can_cast</span><span class="s2">(</span><span class="s4">'M8[7h]'</span><span class="s2">, </span><span class="s4">'M8[3h]'</span><span class="s2">, </span><span class="s0">casting</span><span class="s2">=</span><span class="s4">'same_kind'</span><span class="s2">))</span>
        <span class="s3"># Can cast safely if the integer multiplier does divide</span>
        <span class="s0">assert_</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">can_cast</span><span class="s2">(</span><span class="s4">'M8[6h]'</span><span class="s2">, </span><span class="s4">'M8[3h]'</span><span class="s2">, </span><span class="s0">casting</span><span class="s2">=</span><span class="s4">'safe'</span><span class="s2">))</span>

        <span class="s3"># We can always cast types with generic units (corresponding to NaT) to</span>
        <span class="s3"># more specific types</span>
        <span class="s0">assert_</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">can_cast</span><span class="s2">(</span><span class="s4">'m8'</span><span class="s2">, </span><span class="s4">'m8[h]'</span><span class="s2">, </span><span class="s0">casting</span><span class="s2">=</span><span class="s4">'same_kind'</span><span class="s2">))</span>
        <span class="s0">assert_</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">can_cast</span><span class="s2">(</span><span class="s4">'m8'</span><span class="s2">, </span><span class="s4">'m8[h]'</span><span class="s2">, </span><span class="s0">casting</span><span class="s2">=</span><span class="s4">'safe'</span><span class="s2">))</span>
        <span class="s0">assert_</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">can_cast</span><span class="s2">(</span><span class="s4">'M8'</span><span class="s2">, </span><span class="s4">'M8[h]'</span><span class="s2">, </span><span class="s0">casting</span><span class="s2">=</span><span class="s4">'same_kind'</span><span class="s2">))</span>
        <span class="s0">assert_</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">can_cast</span><span class="s2">(</span><span class="s4">'M8'</span><span class="s2">, </span><span class="s4">'M8[h]'</span><span class="s2">, </span><span class="s0">casting</span><span class="s2">=</span><span class="s4">'safe'</span><span class="s2">))</span>
        <span class="s3"># but not the other way around</span>
        <span class="s0">assert_</span><span class="s2">(</span><span class="s1">not </span><span class="s0">np</span><span class="s2">.</span><span class="s0">can_cast</span><span class="s2">(</span><span class="s4">'m8[h]'</span><span class="s2">, </span><span class="s4">'m8'</span><span class="s2">, </span><span class="s0">casting</span><span class="s2">=</span><span class="s4">'same_kind'</span><span class="s2">))</span>
        <span class="s0">assert_</span><span class="s2">(</span><span class="s1">not </span><span class="s0">np</span><span class="s2">.</span><span class="s0">can_cast</span><span class="s2">(</span><span class="s4">'m8[h]'</span><span class="s2">, </span><span class="s4">'m8'</span><span class="s2">, </span><span class="s0">casting</span><span class="s2">=</span><span class="s4">'safe'</span><span class="s2">))</span>
        <span class="s0">assert_</span><span class="s2">(</span><span class="s1">not </span><span class="s0">np</span><span class="s2">.</span><span class="s0">can_cast</span><span class="s2">(</span><span class="s4">'M8[h]'</span><span class="s2">, </span><span class="s4">'M8'</span><span class="s2">, </span><span class="s0">casting</span><span class="s2">=</span><span class="s4">'same_kind'</span><span class="s2">))</span>
        <span class="s0">assert_</span><span class="s2">(</span><span class="s1">not </span><span class="s0">np</span><span class="s2">.</span><span class="s0">can_cast</span><span class="s2">(</span><span class="s4">'M8[h]'</span><span class="s2">, </span><span class="s4">'M8'</span><span class="s2">, </span><span class="s0">casting</span><span class="s2">=</span><span class="s4">'safe'</span><span class="s2">))</span>

    <span class="s1">def </span><span class="s0">test_datetime_prefix_conversions</span><span class="s2">(</span><span class="s0">self</span><span class="s2">):</span>
        <span class="s3"># regression tests related to gh-19631;</span>
        <span class="s3"># test metric prefixes from seconds down to</span>
        <span class="s3"># attoseconds for bidirectional conversions</span>
        <span class="s0">smaller_units </span><span class="s2">= [</span><span class="s4">'M8[7000ms]'</span><span class="s2">,</span>
                         <span class="s4">'M8[2000us]'</span><span class="s2">,</span>
                         <span class="s4">'M8[1000ns]'</span><span class="s2">,</span>
                         <span class="s4">'M8[5000ns]'</span><span class="s2">,</span>
                         <span class="s4">'M8[2000ps]'</span><span class="s2">,</span>
                         <span class="s4">'M8[9000fs]'</span><span class="s2">,</span>
                         <span class="s4">'M8[1000as]'</span><span class="s2">,</span>
                         <span class="s4">'M8[2000000ps]'</span><span class="s2">,</span>
                         <span class="s4">'M8[1000000as]'</span><span class="s2">,</span>
                         <span class="s4">'M8[2000000000ps]'</span><span class="s2">,</span>
                         <span class="s4">'M8[1000000000as]'</span><span class="s2">]</span>
        <span class="s0">larger_units </span><span class="s2">= [</span><span class="s4">'M8[7s]'</span><span class="s2">,</span>
                        <span class="s4">'M8[2ms]'</span><span class="s2">,</span>
                        <span class="s4">'M8[us]'</span><span class="s2">,</span>
                        <span class="s4">'M8[5us]'</span><span class="s2">,</span>
                        <span class="s4">'M8[2ns]'</span><span class="s2">,</span>
                        <span class="s4">'M8[9ps]'</span><span class="s2">,</span>
                        <span class="s4">'M8[1fs]'</span><span class="s2">,</span>
                        <span class="s4">'M8[2us]'</span><span class="s2">,</span>
                        <span class="s4">'M8[1ps]'</span><span class="s2">,</span>
                        <span class="s4">'M8[2ms]'</span><span class="s2">,</span>
                        <span class="s4">'M8[1ns]'</span><span class="s2">]</span>
        <span class="s1">for </span><span class="s0">larger_unit</span><span class="s2">, </span><span class="s0">smaller_unit </span><span class="s1">in </span><span class="s0">zip</span><span class="s2">(</span><span class="s0">larger_units</span><span class="s2">, </span><span class="s0">smaller_units</span><span class="s2">):</span>
            <span class="s1">assert </span><span class="s0">np</span><span class="s2">.</span><span class="s0">can_cast</span><span class="s2">(</span><span class="s0">larger_unit</span><span class="s2">, </span><span class="s0">smaller_unit</span><span class="s2">, </span><span class="s0">casting</span><span class="s2">=</span><span class="s4">'safe'</span><span class="s2">)</span>
            <span class="s1">assert </span><span class="s0">np</span><span class="s2">.</span><span class="s0">can_cast</span><span class="s2">(</span><span class="s0">smaller_unit</span><span class="s2">, </span><span class="s0">larger_unit</span><span class="s2">, </span><span class="s0">casting</span><span class="s2">=</span><span class="s4">'safe'</span><span class="s2">)</span>

    <span class="s2">@</span><span class="s0">pytest</span><span class="s2">.</span><span class="s0">mark</span><span class="s2">.</span><span class="s0">parametrize</span><span class="s2">(</span><span class="s4">&quot;unit&quot;</span><span class="s2">, [</span>
        <span class="s4">&quot;s&quot;</span><span class="s2">, </span><span class="s4">&quot;ms&quot;</span><span class="s2">, </span><span class="s4">&quot;us&quot;</span><span class="s2">, </span><span class="s4">&quot;ns&quot;</span><span class="s2">, </span><span class="s4">&quot;ps&quot;</span><span class="s2">, </span><span class="s4">&quot;fs&quot;</span><span class="s2">, </span><span class="s4">&quot;as&quot;</span><span class="s2">])</span>
    <span class="s1">def </span><span class="s0">test_prohibit_negative_datetime</span><span class="s2">(</span><span class="s0">self</span><span class="s2">, </span><span class="s0">unit</span><span class="s2">):</span>
        <span class="s1">with </span><span class="s0">assert_raises</span><span class="s2">(</span><span class="s0">TypeError</span><span class="s2">):</span>
            <span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">([</span><span class="s5">1</span><span class="s2">], </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">f&quot;M8[-1</span><span class="s1">{</span><span class="s0">unit</span><span class="s1">}</span><span class="s4">]&quot;</span><span class="s2">)</span>

    <span class="s1">def </span><span class="s0">test_compare_generic_nat</span><span class="s2">(</span><span class="s0">self</span><span class="s2">):</span>
        <span class="s3"># regression tests for gh-6452</span>
        <span class="s0">assert_</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'NaT'</span><span class="s2">) !=</span>
                <span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'2000'</span><span class="s2">) + </span><span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s4">'NaT'</span><span class="s2">))</span>
        <span class="s0">assert_</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'NaT'</span><span class="s2">) != </span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'NaT'</span><span class="s2">, </span><span class="s4">'us'</span><span class="s2">))</span>
        <span class="s0">assert_</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'NaT'</span><span class="s2">, </span><span class="s4">'us'</span><span class="s2">) != </span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'NaT'</span><span class="s2">))</span>

    <span class="s2">@</span><span class="s0">pytest</span><span class="s2">.</span><span class="s0">mark</span><span class="s2">.</span><span class="s0">parametrize</span><span class="s2">(</span><span class="s4">&quot;size&quot;</span><span class="s2">, [</span>
        <span class="s5">3</span><span class="s2">, </span><span class="s5">21</span><span class="s2">, </span><span class="s5">217</span><span class="s2">, </span><span class="s5">1000</span><span class="s2">])</span>
    <span class="s1">def </span><span class="s0">test_datetime_nat_argsort_stability</span><span class="s2">(</span><span class="s0">self</span><span class="s2">, </span><span class="s0">size</span><span class="s2">):</span>
        <span class="s3"># NaT &lt; NaT should be False internally for</span>
        <span class="s3"># sort stability</span>
        <span class="s0">expected </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">arange</span><span class="s2">(</span><span class="s0">size</span><span class="s2">)</span>
        <span class="s0">arr </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">tile</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'NaT'</span><span class="s2">), </span><span class="s0">size</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">argsort</span><span class="s2">(</span><span class="s0">arr</span><span class="s2">, </span><span class="s0">kind</span><span class="s2">=</span><span class="s4">'mergesort'</span><span class="s2">), </span><span class="s0">expected</span><span class="s2">)</span>

    <span class="s2">@</span><span class="s0">pytest</span><span class="s2">.</span><span class="s0">mark</span><span class="s2">.</span><span class="s0">parametrize</span><span class="s2">(</span><span class="s4">&quot;size&quot;</span><span class="s2">, [</span>
        <span class="s5">3</span><span class="s2">, </span><span class="s5">21</span><span class="s2">, </span><span class="s5">217</span><span class="s2">, </span><span class="s5">1000</span><span class="s2">])</span>
    <span class="s1">def </span><span class="s0">test_timedelta_nat_argsort_stability</span><span class="s2">(</span><span class="s0">self</span><span class="s2">, </span><span class="s0">size</span><span class="s2">):</span>
        <span class="s3"># NaT &lt; NaT should be False internally for</span>
        <span class="s3"># sort stability</span>
        <span class="s0">expected </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">arange</span><span class="s2">(</span><span class="s0">size</span><span class="s2">)</span>
        <span class="s0">arr </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">tile</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s4">'NaT'</span><span class="s2">), </span><span class="s0">size</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">argsort</span><span class="s2">(</span><span class="s0">arr</span><span class="s2">, </span><span class="s0">kind</span><span class="s2">=</span><span class="s4">'mergesort'</span><span class="s2">), </span><span class="s0">expected</span><span class="s2">)</span>

    <span class="s2">@</span><span class="s0">pytest</span><span class="s2">.</span><span class="s0">mark</span><span class="s2">.</span><span class="s0">parametrize</span><span class="s2">(</span><span class="s4">&quot;arr, expected&quot;</span><span class="s2">, [</span>
        <span class="s3"># the example provided in gh-12629</span>
        <span class="s2">([</span><span class="s4">'NaT'</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">],</span>
         <span class="s2">[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s4">'NaT'</span><span class="s2">]),</span>
        <span class="s3"># multiple NaTs</span>
        <span class="s2">([</span><span class="s4">'NaT'</span><span class="s2">, </span><span class="s5">9</span><span class="s2">, </span><span class="s4">'NaT'</span><span class="s2">, -</span><span class="s5">707</span><span class="s2">],</span>
         <span class="s2">[-</span><span class="s5">707</span><span class="s2">, </span><span class="s5">9</span><span class="s2">, </span><span class="s4">'NaT'</span><span class="s2">, </span><span class="s4">'NaT'</span><span class="s2">]),</span>
        <span class="s3"># this sort explores another code path for NaT</span>
        <span class="s2">([</span><span class="s5">1</span><span class="s2">, -</span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s4">'NaT'</span><span class="s2">],</span>
         <span class="s2">[-</span><span class="s5">2</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s4">'NaT'</span><span class="s2">]),</span>
        <span class="s3"># 2-D array</span>
        <span class="s2">([[</span><span class="s5">51</span><span class="s2">, -</span><span class="s5">220</span><span class="s2">, </span><span class="s4">'NaT'</span><span class="s2">],</span>
          <span class="s2">[-</span><span class="s5">17</span><span class="s2">, </span><span class="s4">'NaT'</span><span class="s2">, -</span><span class="s5">90</span><span class="s2">]],</span>
         <span class="s2">[[-</span><span class="s5">220</span><span class="s2">, </span><span class="s5">51</span><span class="s2">, </span><span class="s4">'NaT'</span><span class="s2">],</span>
          <span class="s2">[-</span><span class="s5">90</span><span class="s2">, -</span><span class="s5">17</span><span class="s2">, </span><span class="s4">'NaT'</span><span class="s2">]]),</span>
        <span class="s2">])</span>
    <span class="s2">@</span><span class="s0">pytest</span><span class="s2">.</span><span class="s0">mark</span><span class="s2">.</span><span class="s0">parametrize</span><span class="s2">(</span><span class="s4">&quot;dtype&quot;</span><span class="s2">, [</span>
        <span class="s4">'M8[ns]'</span><span class="s2">, </span><span class="s4">'M8[us]'</span><span class="s2">,</span>
        <span class="s4">'m8[ns]'</span><span class="s2">, </span><span class="s4">'m8[us]'</span><span class="s2">])</span>
    <span class="s1">def </span><span class="s0">test_datetime_timedelta_sort_nat</span><span class="s2">(</span><span class="s0">self</span><span class="s2">, </span><span class="s0">arr</span><span class="s2">, </span><span class="s0">expected</span><span class="s2">, </span><span class="s0">dtype</span><span class="s2">):</span>
        <span class="s3"># fix for gh-12629 and gh-15063; NaT sorting to end of array</span>
        <span class="s0">arr </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">(</span><span class="s0">arr</span><span class="s2">, </span><span class="s0">dtype</span><span class="s2">=</span><span class="s0">dtype</span><span class="s2">)</span>
        <span class="s0">expected </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">(</span><span class="s0">expected</span><span class="s2">, </span><span class="s0">dtype</span><span class="s2">=</span><span class="s0">dtype</span><span class="s2">)</span>
        <span class="s0">arr</span><span class="s2">.</span><span class="s0">sort</span><span class="s2">()</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">arr</span><span class="s2">, </span><span class="s0">expected</span><span class="s2">)</span>

    <span class="s1">def </span><span class="s0">test_datetime_scalar_construction</span><span class="s2">(</span><span class="s0">self</span><span class="s2">):</span>
        <span class="s3"># Construct with different units</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'1950-03-12'</span><span class="s2">, </span><span class="s4">'D'</span><span class="s2">),</span>
                     <span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'1950-03-12'</span><span class="s2">))</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'1950-03-12T13'</span><span class="s2">, </span><span class="s4">'s'</span><span class="s2">),</span>
                     <span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'1950-03-12T13'</span><span class="s2">, </span><span class="s4">'m'</span><span class="s2">))</span>

        <span class="s3"># Default construction means NaT</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(), </span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'NaT'</span><span class="s2">))</span>

        <span class="s3"># Some basic strings and repr</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">str</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'NaT'</span><span class="s2">)), </span><span class="s4">'NaT'</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">repr</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'NaT'</span><span class="s2">)),</span>
                     <span class="s4">&quot;numpy.datetime64('NaT')&quot;</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">str</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'2011-02'</span><span class="s2">)), </span><span class="s4">'2011-02'</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">repr</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'2011-02'</span><span class="s2">)),</span>
                     <span class="s4">&quot;numpy.datetime64('2011-02')&quot;</span><span class="s2">)</span>

        <span class="s3"># None gets constructed as NaT</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s1">None</span><span class="s2">), </span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'NaT'</span><span class="s2">))</span>

        <span class="s3"># Default construction of NaT is in generic units</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">().</span><span class="s0">dtype</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8'</span><span class="s2">))</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'NaT'</span><span class="s2">).</span><span class="s0">dtype</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8'</span><span class="s2">))</span>

        <span class="s3"># Construction from integers requires a specified unit</span>
        <span class="s0">assert_raises</span><span class="s2">(</span><span class="s0">ValueError</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">, </span><span class="s5">17</span><span class="s2">)</span>

        <span class="s3"># When constructing from a scalar or zero-dimensional array,</span>
        <span class="s3"># it either keeps the units or you can override them.</span>
        <span class="s0">a </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'2000-03-18T16'</span><span class="s2">, </span><span class="s4">'h'</span><span class="s2">)</span>
        <span class="s0">b </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">(</span><span class="s4">'2000-03-18T16'</span><span class="s2">, </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'M8[h]'</span><span class="s2">)</span>

        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">a</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[h]'</span><span class="s2">))</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">b</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[h]'</span><span class="s2">))</span>

        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s0">a</span><span class="s2">), </span><span class="s0">a</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s0">a</span><span class="s2">).</span><span class="s0">dtype</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[h]'</span><span class="s2">))</span>

        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s0">b</span><span class="s2">), </span><span class="s0">a</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s0">b</span><span class="s2">).</span><span class="s0">dtype</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[h]'</span><span class="s2">))</span>

        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s0">a</span><span class="s2">, </span><span class="s4">'s'</span><span class="s2">), </span><span class="s0">a</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s0">a</span><span class="s2">, </span><span class="s4">'s'</span><span class="s2">).</span><span class="s0">dtype</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[s]'</span><span class="s2">))</span>

        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s0">b</span><span class="s2">, </span><span class="s4">'s'</span><span class="s2">), </span><span class="s0">a</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s0">b</span><span class="s2">, </span><span class="s4">'s'</span><span class="s2">).</span><span class="s0">dtype</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[s]'</span><span class="s2">))</span>

        <span class="s3"># Construction from datetime.date</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'1945-03-25'</span><span class="s2">),</span>
                     <span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s0">datetime</span><span class="s2">.</span><span class="s0">date</span><span class="s2">(</span><span class="s5">1945</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s5">25</span><span class="s2">)))</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'2045-03-25'</span><span class="s2">, </span><span class="s4">'D'</span><span class="s2">),</span>
                     <span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s0">datetime</span><span class="s2">.</span><span class="s0">date</span><span class="s2">(</span><span class="s5">2045</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s5">25</span><span class="s2">), </span><span class="s4">'D'</span><span class="s2">))</span>
        <span class="s3"># Construction from datetime.datetime</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'1980-01-25T14:36:22.5'</span><span class="s2">),</span>
                     <span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s0">datetime</span><span class="s2">.</span><span class="s0">datetime</span><span class="s2">(</span><span class="s5">1980</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">25</span><span class="s2">,</span>
                                                <span class="s5">14</span><span class="s2">, </span><span class="s5">36</span><span class="s2">, </span><span class="s5">22</span><span class="s2">, </span><span class="s5">500000</span><span class="s2">)))</span>

        <span class="s3"># Construction with time units from a date is okay</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'1920-03-13'</span><span class="s2">, </span><span class="s4">'h'</span><span class="s2">),</span>
                     <span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'1920-03-13T00'</span><span class="s2">))</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'1920-03'</span><span class="s2">, </span><span class="s4">'m'</span><span class="s2">),</span>
                     <span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'1920-03-01T00:00'</span><span class="s2">))</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'1920'</span><span class="s2">, </span><span class="s4">'s'</span><span class="s2">),</span>
                     <span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'1920-01-01T00:00:00'</span><span class="s2">))</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s0">datetime</span><span class="s2">.</span><span class="s0">date</span><span class="s2">(</span><span class="s5">2045</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s5">25</span><span class="s2">), </span><span class="s4">'ms'</span><span class="s2">),</span>
                     <span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'2045-03-25T00:00:00.000'</span><span class="s2">))</span>

        <span class="s3"># Construction with date units from a datetime is also okay</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'1920-03-13T18'</span><span class="s2">, </span><span class="s4">'D'</span><span class="s2">),</span>
                     <span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'1920-03-13'</span><span class="s2">))</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'1920-03-13T18:33:12'</span><span class="s2">, </span><span class="s4">'M'</span><span class="s2">),</span>
                     <span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'1920-03'</span><span class="s2">))</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'1920-03-13T18:33:12.5'</span><span class="s2">, </span><span class="s4">'Y'</span><span class="s2">),</span>
                     <span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'1920'</span><span class="s2">))</span>

    <span class="s1">def </span><span class="s0">test_datetime_scalar_construction_timezone</span><span class="s2">(</span><span class="s0">self</span><span class="s2">):</span>
        <span class="s3"># verify that supplying an explicit timezone works, but is deprecated</span>
        <span class="s1">with </span><span class="s0">assert_warns</span><span class="s2">(</span><span class="s0">DeprecationWarning</span><span class="s2">):</span>
            <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'2000-01-01T00Z'</span><span class="s2">),</span>
                         <span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'2000-01-01T00'</span><span class="s2">))</span>
        <span class="s1">with </span><span class="s0">assert_warns</span><span class="s2">(</span><span class="s0">DeprecationWarning</span><span class="s2">):</span>
            <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'2000-01-01T00-08'</span><span class="s2">),</span>
                         <span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'2000-01-01T08'</span><span class="s2">))</span>

    <span class="s1">def </span><span class="s0">test_datetime_array_find_type</span><span class="s2">(</span><span class="s0">self</span><span class="s2">):</span>
        <span class="s0">dt </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'1970-01-01'</span><span class="s2">, </span><span class="s4">'M'</span><span class="s2">)</span>
        <span class="s0">arr </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">([</span><span class="s0">dt</span><span class="s2">])</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">arr</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[M]'</span><span class="s2">))</span>

        <span class="s3"># at the moment, we don't automatically convert these to datetime64</span>

        <span class="s0">dt </span><span class="s2">= </span><span class="s0">datetime</span><span class="s2">.</span><span class="s0">date</span><span class="s2">(</span><span class="s5">1970</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">)</span>
        <span class="s0">arr </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">([</span><span class="s0">dt</span><span class="s2">])</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">arr</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'O'</span><span class="s2">))</span>

        <span class="s0">dt </span><span class="s2">= </span><span class="s0">datetime</span><span class="s2">.</span><span class="s0">datetime</span><span class="s2">(</span><span class="s5">1970</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">12</span><span class="s2">, </span><span class="s5">30</span><span class="s2">, </span><span class="s5">40</span><span class="s2">)</span>
        <span class="s0">arr </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">([</span><span class="s0">dt</span><span class="s2">])</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">arr</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'O'</span><span class="s2">))</span>

        <span class="s3"># find &quot;supertype&quot; for non-dates and dates</span>

        <span class="s0">b </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">bool_</span><span class="s2">(</span><span class="s1">True</span><span class="s2">)</span>
        <span class="s0">dm </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'1970-01-01'</span><span class="s2">, </span><span class="s4">'M'</span><span class="s2">)</span>
        <span class="s0">d </span><span class="s2">= </span><span class="s0">datetime</span><span class="s2">.</span><span class="s0">date</span><span class="s2">(</span><span class="s5">1970</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">)</span>
        <span class="s0">dt </span><span class="s2">= </span><span class="s0">datetime</span><span class="s2">.</span><span class="s0">datetime</span><span class="s2">(</span><span class="s5">1970</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">12</span><span class="s2">, </span><span class="s5">30</span><span class="s2">, </span><span class="s5">40</span><span class="s2">)</span>

        <span class="s0">arr </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">([</span><span class="s0">b</span><span class="s2">, </span><span class="s0">dm</span><span class="s2">])</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">arr</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'O'</span><span class="s2">))</span>

        <span class="s0">arr </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">([</span><span class="s0">b</span><span class="s2">, </span><span class="s0">d</span><span class="s2">])</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">arr</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'O'</span><span class="s2">))</span>

        <span class="s0">arr </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">([</span><span class="s0">b</span><span class="s2">, </span><span class="s0">dt</span><span class="s2">])</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">arr</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'O'</span><span class="s2">))</span>

        <span class="s0">arr </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">([</span><span class="s0">d</span><span class="s2">, </span><span class="s0">d</span><span class="s2">]).</span><span class="s0">astype</span><span class="s2">(</span><span class="s4">'datetime64'</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">arr</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[D]'</span><span class="s2">))</span>

        <span class="s0">arr </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">([</span><span class="s0">dt</span><span class="s2">, </span><span class="s0">dt</span><span class="s2">]).</span><span class="s0">astype</span><span class="s2">(</span><span class="s4">'datetime64'</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">arr</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[us]'</span><span class="s2">))</span>

    <span class="s2">@</span><span class="s0">pytest</span><span class="s2">.</span><span class="s0">mark</span><span class="s2">.</span><span class="s0">parametrize</span><span class="s2">(</span><span class="s4">&quot;unit&quot;</span><span class="s2">, [</span>
    <span class="s3"># test all date / time units and use</span>
    <span class="s3"># &quot;generic&quot; to select generic unit</span>
    <span class="s2">(</span><span class="s4">&quot;Y&quot;</span><span class="s2">), (</span><span class="s4">&quot;M&quot;</span><span class="s2">), (</span><span class="s4">&quot;W&quot;</span><span class="s2">), (</span><span class="s4">&quot;D&quot;</span><span class="s2">), (</span><span class="s4">&quot;h&quot;</span><span class="s2">), (</span><span class="s4">&quot;m&quot;</span><span class="s2">),</span>
    <span class="s2">(</span><span class="s4">&quot;s&quot;</span><span class="s2">), (</span><span class="s4">&quot;ms&quot;</span><span class="s2">), (</span><span class="s4">&quot;us&quot;</span><span class="s2">), (</span><span class="s4">&quot;ns&quot;</span><span class="s2">), (</span><span class="s4">&quot;ps&quot;</span><span class="s2">),</span>
    <span class="s2">(</span><span class="s4">&quot;fs&quot;</span><span class="s2">), (</span><span class="s4">&quot;as&quot;</span><span class="s2">), (</span><span class="s4">&quot;generic&quot;</span><span class="s2">) ])</span>
    <span class="s1">def </span><span class="s0">test_timedelta_np_int_construction</span><span class="s2">(</span><span class="s0">self</span><span class="s2">, </span><span class="s0">unit</span><span class="s2">):</span>
        <span class="s3"># regression test for gh-7617</span>
        <span class="s1">if </span><span class="s0">unit </span><span class="s2">!= </span><span class="s4">&quot;generic&quot;</span><span class="s2">:</span>
            <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">int64</span><span class="s2">(</span><span class="s5">123</span><span class="s2">), </span><span class="s0">unit</span><span class="s2">),</span>
                         <span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s5">123</span><span class="s2">, </span><span class="s0">unit</span><span class="s2">))</span>
        <span class="s1">else</span><span class="s2">:</span>
            <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">int64</span><span class="s2">(</span><span class="s5">123</span><span class="s2">)),</span>
                         <span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s5">123</span><span class="s2">))</span>

    <span class="s1">def </span><span class="s0">test_timedelta_scalar_construction</span><span class="s2">(</span><span class="s0">self</span><span class="s2">):</span>
        <span class="s3"># Construct with different units</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s5">7</span><span class="s2">, </span><span class="s4">'D'</span><span class="s2">),</span>
                     <span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s5">1</span><span class="s2">, </span><span class="s4">'W'</span><span class="s2">))</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s5">120</span><span class="s2">, </span><span class="s4">'s'</span><span class="s2">),</span>
                     <span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s5">2</span><span class="s2">, </span><span class="s4">'m'</span><span class="s2">))</span>

        <span class="s3"># Default construction means 0</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(), </span><span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s5">0</span><span class="s2">))</span>

        <span class="s3"># None gets constructed as NaT</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s1">None</span><span class="s2">), </span><span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s4">'NaT'</span><span class="s2">))</span>

        <span class="s3"># Some basic strings and repr</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">str</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s4">'NaT'</span><span class="s2">)), </span><span class="s4">'NaT'</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">repr</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s4">'NaT'</span><span class="s2">)),</span>
                     <span class="s4">&quot;numpy.timedelta64('NaT')&quot;</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">str</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s5">3</span><span class="s2">, </span><span class="s4">'s'</span><span class="s2">)), </span><span class="s4">'3 seconds'</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">repr</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(-</span><span class="s5">3</span><span class="s2">, </span><span class="s4">'s'</span><span class="s2">)),</span>
                     <span class="s4">&quot;numpy.timedelta64(-3,'s')&quot;</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">repr</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s5">12</span><span class="s2">)),</span>
                     <span class="s4">&quot;numpy.timedelta64(12)&quot;</span><span class="s2">)</span>

        <span class="s3"># Construction from an integer produces generic units</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s5">12</span><span class="s2">).</span><span class="s0">dtype</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'m8'</span><span class="s2">))</span>

        <span class="s3"># When constructing from a scalar or zero-dimensional array,</span>
        <span class="s3"># it either keeps the units or you can override them.</span>
        <span class="s0">a </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s5">2</span><span class="s2">, </span><span class="s4">'h'</span><span class="s2">)</span>
        <span class="s0">b </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">(</span><span class="s5">2</span><span class="s2">, </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'m8[h]'</span><span class="s2">)</span>

        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">a</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'m8[h]'</span><span class="s2">))</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">b</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'m8[h]'</span><span class="s2">))</span>

        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s0">a</span><span class="s2">), </span><span class="s0">a</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s0">a</span><span class="s2">).</span><span class="s0">dtype</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'m8[h]'</span><span class="s2">))</span>

        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s0">b</span><span class="s2">), </span><span class="s0">a</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s0">b</span><span class="s2">).</span><span class="s0">dtype</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'m8[h]'</span><span class="s2">))</span>

        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s0">a</span><span class="s2">, </span><span class="s4">'s'</span><span class="s2">), </span><span class="s0">a</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s0">a</span><span class="s2">, </span><span class="s4">'s'</span><span class="s2">).</span><span class="s0">dtype</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'m8[s]'</span><span class="s2">))</span>

        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s0">b</span><span class="s2">, </span><span class="s4">'s'</span><span class="s2">), </span><span class="s0">a</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s0">b</span><span class="s2">, </span><span class="s4">'s'</span><span class="s2">).</span><span class="s0">dtype</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'m8[s]'</span><span class="s2">))</span>

        <span class="s3"># Construction from datetime.timedelta</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s5">5</span><span class="s2">, </span><span class="s4">'D'</span><span class="s2">),</span>
                     <span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s0">datetime</span><span class="s2">.</span><span class="s0">timedelta</span><span class="s2">(</span><span class="s0">days</span><span class="s2">=</span><span class="s5">5</span><span class="s2">)))</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s5">102347621</span><span class="s2">, </span><span class="s4">'s'</span><span class="s2">),</span>
                     <span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s0">datetime</span><span class="s2">.</span><span class="s0">timedelta</span><span class="s2">(</span><span class="s0">seconds</span><span class="s2">=</span><span class="s5">102347621</span><span class="s2">)))</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(-</span><span class="s5">10234760000</span><span class="s2">, </span><span class="s4">'us'</span><span class="s2">),</span>
                     <span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s0">datetime</span><span class="s2">.</span><span class="s0">timedelta</span><span class="s2">(</span>
                                            <span class="s0">microseconds</span><span class="s2">=-</span><span class="s5">10234760000</span><span class="s2">)))</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s5">10234760000</span><span class="s2">, </span><span class="s4">'us'</span><span class="s2">),</span>
                     <span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s0">datetime</span><span class="s2">.</span><span class="s0">timedelta</span><span class="s2">(</span>
                                            <span class="s0">microseconds</span><span class="s2">=</span><span class="s5">10234760000</span><span class="s2">)))</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s5">1023476</span><span class="s2">, </span><span class="s4">'ms'</span><span class="s2">),</span>
                     <span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s0">datetime</span><span class="s2">.</span><span class="s0">timedelta</span><span class="s2">(</span><span class="s0">milliseconds</span><span class="s2">=</span><span class="s5">1023476</span><span class="s2">)))</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s5">10</span><span class="s2">, </span><span class="s4">'m'</span><span class="s2">),</span>
                     <span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s0">datetime</span><span class="s2">.</span><span class="s0">timedelta</span><span class="s2">(</span><span class="s0">minutes</span><span class="s2">=</span><span class="s5">10</span><span class="s2">)))</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s5">281</span><span class="s2">, </span><span class="s4">'h'</span><span class="s2">),</span>
                     <span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s0">datetime</span><span class="s2">.</span><span class="s0">timedelta</span><span class="s2">(</span><span class="s0">hours</span><span class="s2">=</span><span class="s5">281</span><span class="s2">)))</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s5">28</span><span class="s2">, </span><span class="s4">'W'</span><span class="s2">),</span>
                     <span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s0">datetime</span><span class="s2">.</span><span class="s0">timedelta</span><span class="s2">(</span><span class="s0">weeks</span><span class="s2">=</span><span class="s5">28</span><span class="s2">)))</span>

        <span class="s3"># Cannot construct across nonlinear time unit boundaries</span>
        <span class="s0">a </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s5">3</span><span class="s2">, </span><span class="s4">'s'</span><span class="s2">)</span>
        <span class="s0">assert_raises</span><span class="s2">(</span><span class="s0">TypeError</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">, </span><span class="s0">a</span><span class="s2">, </span><span class="s4">'M'</span><span class="s2">)</span>
        <span class="s0">assert_raises</span><span class="s2">(</span><span class="s0">TypeError</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">, </span><span class="s0">a</span><span class="s2">, </span><span class="s4">'Y'</span><span class="s2">)</span>
        <span class="s0">a </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s5">6</span><span class="s2">, </span><span class="s4">'M'</span><span class="s2">)</span>
        <span class="s0">assert_raises</span><span class="s2">(</span><span class="s0">TypeError</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">, </span><span class="s0">a</span><span class="s2">, </span><span class="s4">'D'</span><span class="s2">)</span>
        <span class="s0">assert_raises</span><span class="s2">(</span><span class="s0">TypeError</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">, </span><span class="s0">a</span><span class="s2">, </span><span class="s4">'h'</span><span class="s2">)</span>
        <span class="s0">a </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s5">1</span><span class="s2">, </span><span class="s4">'Y'</span><span class="s2">)</span>
        <span class="s0">assert_raises</span><span class="s2">(</span><span class="s0">TypeError</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">, </span><span class="s0">a</span><span class="s2">, </span><span class="s4">'D'</span><span class="s2">)</span>
        <span class="s0">assert_raises</span><span class="s2">(</span><span class="s0">TypeError</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">, </span><span class="s0">a</span><span class="s2">, </span><span class="s4">'m'</span><span class="s2">)</span>
        <span class="s0">a </span><span class="s2">= </span><span class="s0">datetime</span><span class="s2">.</span><span class="s0">timedelta</span><span class="s2">(</span><span class="s0">seconds</span><span class="s2">=</span><span class="s5">3</span><span class="s2">)</span>
        <span class="s0">assert_raises</span><span class="s2">(</span><span class="s0">TypeError</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">, </span><span class="s0">a</span><span class="s2">, </span><span class="s4">'M'</span><span class="s2">)</span>
        <span class="s0">assert_raises</span><span class="s2">(</span><span class="s0">TypeError</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">, </span><span class="s0">a</span><span class="s2">, </span><span class="s4">'Y'</span><span class="s2">)</span>
        <span class="s0">a </span><span class="s2">= </span><span class="s0">datetime</span><span class="s2">.</span><span class="s0">timedelta</span><span class="s2">(</span><span class="s0">weeks</span><span class="s2">=</span><span class="s5">3</span><span class="s2">)</span>
        <span class="s0">assert_raises</span><span class="s2">(</span><span class="s0">TypeError</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">, </span><span class="s0">a</span><span class="s2">, </span><span class="s4">'M'</span><span class="s2">)</span>
        <span class="s0">assert_raises</span><span class="s2">(</span><span class="s0">TypeError</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">, </span><span class="s0">a</span><span class="s2">, </span><span class="s4">'Y'</span><span class="s2">)</span>
        <span class="s0">a </span><span class="s2">= </span><span class="s0">datetime</span><span class="s2">.</span><span class="s0">timedelta</span><span class="s2">()</span>
        <span class="s0">assert_raises</span><span class="s2">(</span><span class="s0">TypeError</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">, </span><span class="s0">a</span><span class="s2">, </span><span class="s4">'M'</span><span class="s2">)</span>
        <span class="s0">assert_raises</span><span class="s2">(</span><span class="s0">TypeError</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">, </span><span class="s0">a</span><span class="s2">, </span><span class="s4">'Y'</span><span class="s2">)</span>

    <span class="s1">def </span><span class="s0">test_timedelta_object_array_conversion</span><span class="s2">(</span><span class="s0">self</span><span class="s2">):</span>
        <span class="s3"># Regression test for gh-11096</span>
        <span class="s0">inputs </span><span class="s2">= [</span><span class="s0">datetime</span><span class="s2">.</span><span class="s0">timedelta</span><span class="s2">(</span><span class="s5">28</span><span class="s2">),</span>
                  <span class="s0">datetime</span><span class="s2">.</span><span class="s0">timedelta</span><span class="s2">(</span><span class="s5">30</span><span class="s2">),</span>
                  <span class="s0">datetime</span><span class="s2">.</span><span class="s0">timedelta</span><span class="s2">(</span><span class="s5">31</span><span class="s2">)]</span>
        <span class="s0">expected </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">([</span><span class="s5">28</span><span class="s2">, </span><span class="s5">30</span><span class="s2">, </span><span class="s5">31</span><span class="s2">], </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'timedelta64[D]'</span><span class="s2">)</span>
        <span class="s0">actual </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">(</span><span class="s0">inputs</span><span class="s2">, </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'timedelta64[D]'</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">expected</span><span class="s2">, </span><span class="s0">actual</span><span class="s2">)</span>

    <span class="s1">def </span><span class="s0">test_timedelta_0_dim_object_array_conversion</span><span class="s2">(</span><span class="s0">self</span><span class="s2">):</span>
        <span class="s3"># Regression test for gh-11151</span>
        <span class="s0">test </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">(</span><span class="s0">datetime</span><span class="s2">.</span><span class="s0">timedelta</span><span class="s2">(</span><span class="s0">seconds</span><span class="s2">=</span><span class="s5">20</span><span class="s2">))</span>
        <span class="s0">actual </span><span class="s2">= </span><span class="s0">test</span><span class="s2">.</span><span class="s0">astype</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">)</span>
        <span class="s3"># expected value from the array constructor workaround</span>
        <span class="s3"># described in above issue</span>
        <span class="s0">expected </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">(</span><span class="s0">datetime</span><span class="s2">.</span><span class="s0">timedelta</span><span class="s2">(</span><span class="s0">seconds</span><span class="s2">=</span><span class="s5">20</span><span class="s2">),</span>
                            <span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">actual</span><span class="s2">, </span><span class="s0">expected</span><span class="s2">)</span>

    <span class="s1">def </span><span class="s0">test_timedelta_nat_format</span><span class="s2">(</span><span class="s0">self</span><span class="s2">):</span>
        <span class="s3"># gh-17552</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s4">'NaT'</span><span class="s2">, </span><span class="s4">'{0}'</span><span class="s2">.</span><span class="s0">format</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s4">'nat'</span><span class="s2">)))</span>

    <span class="s1">def </span><span class="s0">test_timedelta_scalar_construction_units</span><span class="s2">(</span><span class="s0">self</span><span class="s2">):</span>
        <span class="s3"># String construction detecting units</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'2010'</span><span class="s2">).</span><span class="s0">dtype</span><span class="s2">,</span>
                     <span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[Y]'</span><span class="s2">))</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'2010-03'</span><span class="s2">).</span><span class="s0">dtype</span><span class="s2">,</span>
                     <span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[M]'</span><span class="s2">))</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'2010-03-12'</span><span class="s2">).</span><span class="s0">dtype</span><span class="s2">,</span>
                     <span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[D]'</span><span class="s2">))</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'2010-03-12T17'</span><span class="s2">).</span><span class="s0">dtype</span><span class="s2">,</span>
                     <span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[h]'</span><span class="s2">))</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'2010-03-12T17:15'</span><span class="s2">).</span><span class="s0">dtype</span><span class="s2">,</span>
                     <span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[m]'</span><span class="s2">))</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'2010-03-12T17:15:08'</span><span class="s2">).</span><span class="s0">dtype</span><span class="s2">,</span>
                     <span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[s]'</span><span class="s2">))</span>

        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'2010-03-12T17:15:08.1'</span><span class="s2">).</span><span class="s0">dtype</span><span class="s2">,</span>
                     <span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[ms]'</span><span class="s2">))</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'2010-03-12T17:15:08.12'</span><span class="s2">).</span><span class="s0">dtype</span><span class="s2">,</span>
                     <span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[ms]'</span><span class="s2">))</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'2010-03-12T17:15:08.123'</span><span class="s2">).</span><span class="s0">dtype</span><span class="s2">,</span>
                     <span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[ms]'</span><span class="s2">))</span>

        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'2010-03-12T17:15:08.1234'</span><span class="s2">).</span><span class="s0">dtype</span><span class="s2">,</span>
                     <span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[us]'</span><span class="s2">))</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'2010-03-12T17:15:08.12345'</span><span class="s2">).</span><span class="s0">dtype</span><span class="s2">,</span>
                     <span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[us]'</span><span class="s2">))</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'2010-03-12T17:15:08.123456'</span><span class="s2">).</span><span class="s0">dtype</span><span class="s2">,</span>
                     <span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[us]'</span><span class="s2">))</span>

        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'1970-01-01T00:00:02.1234567'</span><span class="s2">).</span><span class="s0">dtype</span><span class="s2">,</span>
                     <span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[ns]'</span><span class="s2">))</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'1970-01-01T00:00:02.12345678'</span><span class="s2">).</span><span class="s0">dtype</span><span class="s2">,</span>
                     <span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[ns]'</span><span class="s2">))</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'1970-01-01T00:00:02.123456789'</span><span class="s2">).</span><span class="s0">dtype</span><span class="s2">,</span>
                     <span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[ns]'</span><span class="s2">))</span>

        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'1970-01-01T00:00:02.1234567890'</span><span class="s2">).</span><span class="s0">dtype</span><span class="s2">,</span>
                     <span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[ps]'</span><span class="s2">))</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'1970-01-01T00:00:02.12345678901'</span><span class="s2">).</span><span class="s0">dtype</span><span class="s2">,</span>
                     <span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[ps]'</span><span class="s2">))</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'1970-01-01T00:00:02.123456789012'</span><span class="s2">).</span><span class="s0">dtype</span><span class="s2">,</span>
                     <span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[ps]'</span><span class="s2">))</span>

        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span>
                     <span class="s4">'1970-01-01T00:00:02.1234567890123'</span><span class="s2">).</span><span class="s0">dtype</span><span class="s2">,</span>
                     <span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[fs]'</span><span class="s2">))</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span>
                     <span class="s4">'1970-01-01T00:00:02.12345678901234'</span><span class="s2">).</span><span class="s0">dtype</span><span class="s2">,</span>
                     <span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[fs]'</span><span class="s2">))</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span>
                     <span class="s4">'1970-01-01T00:00:02.123456789012345'</span><span class="s2">).</span><span class="s0">dtype</span><span class="s2">,</span>
                     <span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[fs]'</span><span class="s2">))</span>

        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span>
                    <span class="s4">'1970-01-01T00:00:02.1234567890123456'</span><span class="s2">).</span><span class="s0">dtype</span><span class="s2">,</span>
                     <span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[as]'</span><span class="s2">))</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span>
                    <span class="s4">'1970-01-01T00:00:02.12345678901234567'</span><span class="s2">).</span><span class="s0">dtype</span><span class="s2">,</span>
                     <span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[as]'</span><span class="s2">))</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span>
                    <span class="s4">'1970-01-01T00:00:02.123456789012345678'</span><span class="s2">).</span><span class="s0">dtype</span><span class="s2">,</span>
                     <span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[as]'</span><span class="s2">))</span>

        <span class="s3"># Python date object</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s0">datetime</span><span class="s2">.</span><span class="s0">date</span><span class="s2">(</span><span class="s5">2010</span><span class="s2">, </span><span class="s5">4</span><span class="s2">, </span><span class="s5">16</span><span class="s2">)).</span><span class="s0">dtype</span><span class="s2">,</span>
                     <span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[D]'</span><span class="s2">))</span>

        <span class="s3"># Python datetime object</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span>
                        <span class="s0">datetime</span><span class="s2">.</span><span class="s0">datetime</span><span class="s2">(</span><span class="s5">2010</span><span class="s2">, </span><span class="s5">4</span><span class="s2">, </span><span class="s5">16</span><span class="s2">, </span><span class="s5">13</span><span class="s2">, </span><span class="s5">45</span><span class="s2">, </span><span class="s5">18</span><span class="s2">)).</span><span class="s0">dtype</span><span class="s2">,</span>
                     <span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[us]'</span><span class="s2">))</span>

        <span class="s3"># 'today' special value</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'today'</span><span class="s2">).</span><span class="s0">dtype</span><span class="s2">,</span>
                     <span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[D]'</span><span class="s2">))</span>

        <span class="s3"># 'now' special value</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'now'</span><span class="s2">).</span><span class="s0">dtype</span><span class="s2">,</span>
                     <span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[s]'</span><span class="s2">))</span>

    <span class="s1">def </span><span class="s0">test_datetime_nat_casting</span><span class="s2">(</span><span class="s0">self</span><span class="s2">):</span>
        <span class="s0">a </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">(</span><span class="s4">'NaT'</span><span class="s2">, </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'M8[D]'</span><span class="s2">)</span>
        <span class="s0">b </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'NaT'</span><span class="s2">, </span><span class="s4">'[D]'</span><span class="s2">)</span>

        <span class="s3"># Arrays</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">a</span><span class="s2">.</span><span class="s0">astype</span><span class="s2">(</span><span class="s4">'M8[s]'</span><span class="s2">), </span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">(</span><span class="s4">'NaT'</span><span class="s2">, </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'M8[s]'</span><span class="s2">))</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">a</span><span class="s2">.</span><span class="s0">astype</span><span class="s2">(</span><span class="s4">'M8[ms]'</span><span class="s2">), </span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">(</span><span class="s4">'NaT'</span><span class="s2">, </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'M8[ms]'</span><span class="s2">))</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">a</span><span class="s2">.</span><span class="s0">astype</span><span class="s2">(</span><span class="s4">'M8[M]'</span><span class="s2">), </span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">(</span><span class="s4">'NaT'</span><span class="s2">, </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'M8[M]'</span><span class="s2">))</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">a</span><span class="s2">.</span><span class="s0">astype</span><span class="s2">(</span><span class="s4">'M8[Y]'</span><span class="s2">), </span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">(</span><span class="s4">'NaT'</span><span class="s2">, </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'M8[Y]'</span><span class="s2">))</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">a</span><span class="s2">.</span><span class="s0">astype</span><span class="s2">(</span><span class="s4">'M8[W]'</span><span class="s2">), </span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">(</span><span class="s4">'NaT'</span><span class="s2">, </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'M8[W]'</span><span class="s2">))</span>

        <span class="s3"># Scalars -&gt; Scalars</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s0">b</span><span class="s2">, </span><span class="s4">'[s]'</span><span class="s2">), </span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'NaT'</span><span class="s2">, </span><span class="s4">'[s]'</span><span class="s2">))</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s0">b</span><span class="s2">, </span><span class="s4">'[ms]'</span><span class="s2">), </span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'NaT'</span><span class="s2">, </span><span class="s4">'[ms]'</span><span class="s2">))</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s0">b</span><span class="s2">, </span><span class="s4">'[M]'</span><span class="s2">), </span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'NaT'</span><span class="s2">, </span><span class="s4">'[M]'</span><span class="s2">))</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s0">b</span><span class="s2">, </span><span class="s4">'[Y]'</span><span class="s2">), </span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'NaT'</span><span class="s2">, </span><span class="s4">'[Y]'</span><span class="s2">))</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s0">b</span><span class="s2">, </span><span class="s4">'[W]'</span><span class="s2">), </span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'NaT'</span><span class="s2">, </span><span class="s4">'[W]'</span><span class="s2">))</span>

        <span class="s3"># Arrays -&gt; Scalars</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s0">a</span><span class="s2">, </span><span class="s4">'[s]'</span><span class="s2">), </span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'NaT'</span><span class="s2">, </span><span class="s4">'[s]'</span><span class="s2">))</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s0">a</span><span class="s2">, </span><span class="s4">'[ms]'</span><span class="s2">), </span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'NaT'</span><span class="s2">, </span><span class="s4">'[ms]'</span><span class="s2">))</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s0">a</span><span class="s2">, </span><span class="s4">'[M]'</span><span class="s2">), </span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'NaT'</span><span class="s2">, </span><span class="s4">'[M]'</span><span class="s2">))</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s0">a</span><span class="s2">, </span><span class="s4">'[Y]'</span><span class="s2">), </span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'NaT'</span><span class="s2">, </span><span class="s4">'[Y]'</span><span class="s2">))</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s0">a</span><span class="s2">, </span><span class="s4">'[W]'</span><span class="s2">), </span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'NaT'</span><span class="s2">, </span><span class="s4">'[W]'</span><span class="s2">))</span>

        <span class="s3"># NaN -&gt; NaT</span>
        <span class="s0">nan </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">([</span><span class="s0">np</span><span class="s2">.</span><span class="s0">nan</span><span class="s2">] * </span><span class="s5">8</span><span class="s2">)</span>
        <span class="s0">fnan </span><span class="s2">= </span><span class="s0">nan</span><span class="s2">.</span><span class="s0">astype</span><span class="s2">(</span><span class="s4">'f'</span><span class="s2">)</span>
        <span class="s0">lnan </span><span class="s2">= </span><span class="s0">nan</span><span class="s2">.</span><span class="s0">astype</span><span class="s2">(</span><span class="s4">'g'</span><span class="s2">)</span>
        <span class="s0">cnan </span><span class="s2">= </span><span class="s0">nan</span><span class="s2">.</span><span class="s0">astype</span><span class="s2">(</span><span class="s4">'D'</span><span class="s2">)</span>
        <span class="s0">cfnan </span><span class="s2">= </span><span class="s0">nan</span><span class="s2">.</span><span class="s0">astype</span><span class="s2">(</span><span class="s4">'F'</span><span class="s2">)</span>
        <span class="s0">clnan </span><span class="s2">= </span><span class="s0">nan</span><span class="s2">.</span><span class="s0">astype</span><span class="s2">(</span><span class="s4">'G'</span><span class="s2">)</span>

        <span class="s0">nat </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">([</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'NaT'</span><span class="s2">)] * </span><span class="s5">8</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">nan</span><span class="s2">.</span><span class="s0">astype</span><span class="s2">(</span><span class="s4">'M8[ns]'</span><span class="s2">), </span><span class="s0">nat</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">fnan</span><span class="s2">.</span><span class="s0">astype</span><span class="s2">(</span><span class="s4">'M8[ns]'</span><span class="s2">), </span><span class="s0">nat</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">lnan</span><span class="s2">.</span><span class="s0">astype</span><span class="s2">(</span><span class="s4">'M8[ns]'</span><span class="s2">), </span><span class="s0">nat</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">cnan</span><span class="s2">.</span><span class="s0">astype</span><span class="s2">(</span><span class="s4">'M8[ns]'</span><span class="s2">), </span><span class="s0">nat</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">cfnan</span><span class="s2">.</span><span class="s0">astype</span><span class="s2">(</span><span class="s4">'M8[ns]'</span><span class="s2">), </span><span class="s0">nat</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">clnan</span><span class="s2">.</span><span class="s0">astype</span><span class="s2">(</span><span class="s4">'M8[ns]'</span><span class="s2">), </span><span class="s0">nat</span><span class="s2">)</span>

        <span class="s0">nat </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">([</span><span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s4">'NaT'</span><span class="s2">)] * </span><span class="s5">8</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">nan</span><span class="s2">.</span><span class="s0">astype</span><span class="s2">(</span><span class="s4">'timedelta64[ns]'</span><span class="s2">), </span><span class="s0">nat</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">fnan</span><span class="s2">.</span><span class="s0">astype</span><span class="s2">(</span><span class="s4">'timedelta64[ns]'</span><span class="s2">), </span><span class="s0">nat</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">lnan</span><span class="s2">.</span><span class="s0">astype</span><span class="s2">(</span><span class="s4">'timedelta64[ns]'</span><span class="s2">), </span><span class="s0">nat</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">cnan</span><span class="s2">.</span><span class="s0">astype</span><span class="s2">(</span><span class="s4">'timedelta64[ns]'</span><span class="s2">), </span><span class="s0">nat</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">cfnan</span><span class="s2">.</span><span class="s0">astype</span><span class="s2">(</span><span class="s4">'timedelta64[ns]'</span><span class="s2">), </span><span class="s0">nat</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">clnan</span><span class="s2">.</span><span class="s0">astype</span><span class="s2">(</span><span class="s4">'timedelta64[ns]'</span><span class="s2">), </span><span class="s0">nat</span><span class="s2">)</span>

    <span class="s1">def </span><span class="s0">test_days_creation</span><span class="s2">(</span><span class="s0">self</span><span class="s2">):</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">(</span><span class="s4">'1599'</span><span class="s2">, </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'M8[D]'</span><span class="s2">).</span><span class="s0">astype</span><span class="s2">(</span><span class="s4">'i8'</span><span class="s2">),</span>
                <span class="s2">(</span><span class="s5">1600</span><span class="s2">-</span><span class="s5">1970</span><span class="s2">)*</span><span class="s5">365 </span><span class="s2">- (</span><span class="s5">1972</span><span class="s2">-</span><span class="s5">1600</span><span class="s2">)/</span><span class="s5">4 </span><span class="s2">+ </span><span class="s5">3 </span><span class="s2">- </span><span class="s5">365</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">(</span><span class="s4">'1600'</span><span class="s2">, </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'M8[D]'</span><span class="s2">).</span><span class="s0">astype</span><span class="s2">(</span><span class="s4">'i8'</span><span class="s2">),</span>
                <span class="s2">(</span><span class="s5">1600</span><span class="s2">-</span><span class="s5">1970</span><span class="s2">)*</span><span class="s5">365 </span><span class="s2">- (</span><span class="s5">1972</span><span class="s2">-</span><span class="s5">1600</span><span class="s2">)/</span><span class="s5">4 </span><span class="s2">+ </span><span class="s5">3</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">(</span><span class="s4">'1601'</span><span class="s2">, </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'M8[D]'</span><span class="s2">).</span><span class="s0">astype</span><span class="s2">(</span><span class="s4">'i8'</span><span class="s2">),</span>
                <span class="s2">(</span><span class="s5">1600</span><span class="s2">-</span><span class="s5">1970</span><span class="s2">)*</span><span class="s5">365 </span><span class="s2">- (</span><span class="s5">1972</span><span class="s2">-</span><span class="s5">1600</span><span class="s2">)/</span><span class="s5">4 </span><span class="s2">+ </span><span class="s5">3 </span><span class="s2">+ </span><span class="s5">366</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">(</span><span class="s4">'1900'</span><span class="s2">, </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'M8[D]'</span><span class="s2">).</span><span class="s0">astype</span><span class="s2">(</span><span class="s4">'i8'</span><span class="s2">),</span>
                <span class="s2">(</span><span class="s5">1900</span><span class="s2">-</span><span class="s5">1970</span><span class="s2">)*</span><span class="s5">365 </span><span class="s2">- (</span><span class="s5">1970</span><span class="s2">-</span><span class="s5">1900</span><span class="s2">)//</span><span class="s5">4</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">(</span><span class="s4">'1901'</span><span class="s2">, </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'M8[D]'</span><span class="s2">).</span><span class="s0">astype</span><span class="s2">(</span><span class="s4">'i8'</span><span class="s2">),</span>
                <span class="s2">(</span><span class="s5">1900</span><span class="s2">-</span><span class="s5">1970</span><span class="s2">)*</span><span class="s5">365 </span><span class="s2">- (</span><span class="s5">1970</span><span class="s2">-</span><span class="s5">1900</span><span class="s2">)//</span><span class="s5">4 </span><span class="s2">+ </span><span class="s5">365</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">(</span><span class="s4">'1967'</span><span class="s2">, </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'M8[D]'</span><span class="s2">).</span><span class="s0">astype</span><span class="s2">(</span><span class="s4">'i8'</span><span class="s2">), -</span><span class="s5">3</span><span class="s2">*</span><span class="s5">365 </span><span class="s2">- </span><span class="s5">1</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">(</span><span class="s4">'1968'</span><span class="s2">, </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'M8[D]'</span><span class="s2">).</span><span class="s0">astype</span><span class="s2">(</span><span class="s4">'i8'</span><span class="s2">), -</span><span class="s5">2</span><span class="s2">*</span><span class="s5">365 </span><span class="s2">- </span><span class="s5">1</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">(</span><span class="s4">'1969'</span><span class="s2">, </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'M8[D]'</span><span class="s2">).</span><span class="s0">astype</span><span class="s2">(</span><span class="s4">'i8'</span><span class="s2">), -</span><span class="s5">1</span><span class="s2">*</span><span class="s5">365</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">(</span><span class="s4">'1970'</span><span class="s2">, </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'M8[D]'</span><span class="s2">).</span><span class="s0">astype</span><span class="s2">(</span><span class="s4">'i8'</span><span class="s2">), </span><span class="s5">0</span><span class="s2">*</span><span class="s5">365</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">(</span><span class="s4">'1971'</span><span class="s2">, </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'M8[D]'</span><span class="s2">).</span><span class="s0">astype</span><span class="s2">(</span><span class="s4">'i8'</span><span class="s2">), </span><span class="s5">1</span><span class="s2">*</span><span class="s5">365</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">(</span><span class="s4">'1972'</span><span class="s2">, </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'M8[D]'</span><span class="s2">).</span><span class="s0">astype</span><span class="s2">(</span><span class="s4">'i8'</span><span class="s2">), </span><span class="s5">2</span><span class="s2">*</span><span class="s5">365</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">(</span><span class="s4">'1973'</span><span class="s2">, </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'M8[D]'</span><span class="s2">).</span><span class="s0">astype</span><span class="s2">(</span><span class="s4">'i8'</span><span class="s2">), </span><span class="s5">3</span><span class="s2">*</span><span class="s5">365 </span><span class="s2">+ </span><span class="s5">1</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">(</span><span class="s4">'1974'</span><span class="s2">, </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'M8[D]'</span><span class="s2">).</span><span class="s0">astype</span><span class="s2">(</span><span class="s4">'i8'</span><span class="s2">), </span><span class="s5">4</span><span class="s2">*</span><span class="s5">365 </span><span class="s2">+ </span><span class="s5">1</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">(</span><span class="s4">'2000'</span><span class="s2">, </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'M8[D]'</span><span class="s2">).</span><span class="s0">astype</span><span class="s2">(</span><span class="s4">'i8'</span><span class="s2">),</span>
                 <span class="s2">(</span><span class="s5">2000 </span><span class="s2">- </span><span class="s5">1970</span><span class="s2">)*</span><span class="s5">365 </span><span class="s2">+ (</span><span class="s5">2000 </span><span class="s2">- </span><span class="s5">1972</span><span class="s2">)//</span><span class="s5">4</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">(</span><span class="s4">'2001'</span><span class="s2">, </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'M8[D]'</span><span class="s2">).</span><span class="s0">astype</span><span class="s2">(</span><span class="s4">'i8'</span><span class="s2">),</span>
                 <span class="s2">(</span><span class="s5">2000 </span><span class="s2">- </span><span class="s5">1970</span><span class="s2">)*</span><span class="s5">365 </span><span class="s2">+ (</span><span class="s5">2000 </span><span class="s2">- </span><span class="s5">1972</span><span class="s2">)//</span><span class="s5">4 </span><span class="s2">+ </span><span class="s5">366</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">(</span><span class="s4">'2400'</span><span class="s2">, </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'M8[D]'</span><span class="s2">).</span><span class="s0">astype</span><span class="s2">(</span><span class="s4">'i8'</span><span class="s2">),</span>
                 <span class="s2">(</span><span class="s5">2400 </span><span class="s2">- </span><span class="s5">1970</span><span class="s2">)*</span><span class="s5">365 </span><span class="s2">+ (</span><span class="s5">2400 </span><span class="s2">- </span><span class="s5">1972</span><span class="s2">)//</span><span class="s5">4 </span><span class="s2">- </span><span class="s5">3</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">(</span><span class="s4">'2401'</span><span class="s2">, </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'M8[D]'</span><span class="s2">).</span><span class="s0">astype</span><span class="s2">(</span><span class="s4">'i8'</span><span class="s2">),</span>
                 <span class="s2">(</span><span class="s5">2400 </span><span class="s2">- </span><span class="s5">1970</span><span class="s2">)*</span><span class="s5">365 </span><span class="s2">+ (</span><span class="s5">2400 </span><span class="s2">- </span><span class="s5">1972</span><span class="s2">)//</span><span class="s5">4 </span><span class="s2">- </span><span class="s5">3 </span><span class="s2">+ </span><span class="s5">366</span><span class="s2">)</span>

        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">(</span><span class="s4">'1600-02-29'</span><span class="s2">, </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'M8[D]'</span><span class="s2">).</span><span class="s0">astype</span><span class="s2">(</span><span class="s4">'i8'</span><span class="s2">),</span>
                <span class="s2">(</span><span class="s5">1600</span><span class="s2">-</span><span class="s5">1970</span><span class="s2">)*</span><span class="s5">365 </span><span class="s2">- (</span><span class="s5">1972</span><span class="s2">-</span><span class="s5">1600</span><span class="s2">)//</span><span class="s5">4 </span><span class="s2">+ </span><span class="s5">3 </span><span class="s2">+ </span><span class="s5">31 </span><span class="s2">+ </span><span class="s5">28</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">(</span><span class="s4">'1600-03-01'</span><span class="s2">, </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'M8[D]'</span><span class="s2">).</span><span class="s0">astype</span><span class="s2">(</span><span class="s4">'i8'</span><span class="s2">),</span>
                <span class="s2">(</span><span class="s5">1600</span><span class="s2">-</span><span class="s5">1970</span><span class="s2">)*</span><span class="s5">365 </span><span class="s2">- (</span><span class="s5">1972</span><span class="s2">-</span><span class="s5">1600</span><span class="s2">)//</span><span class="s5">4 </span><span class="s2">+ </span><span class="s5">3 </span><span class="s2">+ </span><span class="s5">31 </span><span class="s2">+ </span><span class="s5">29</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">(</span><span class="s4">'2000-02-29'</span><span class="s2">, </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'M8[D]'</span><span class="s2">).</span><span class="s0">astype</span><span class="s2">(</span><span class="s4">'i8'</span><span class="s2">),</span>
                 <span class="s2">(</span><span class="s5">2000 </span><span class="s2">- </span><span class="s5">1970</span><span class="s2">)*</span><span class="s5">365 </span><span class="s2">+ (</span><span class="s5">2000 </span><span class="s2">- </span><span class="s5">1972</span><span class="s2">)//</span><span class="s5">4 </span><span class="s2">+ </span><span class="s5">31 </span><span class="s2">+ </span><span class="s5">28</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">(</span><span class="s4">'2000-03-01'</span><span class="s2">, </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'M8[D]'</span><span class="s2">).</span><span class="s0">astype</span><span class="s2">(</span><span class="s4">'i8'</span><span class="s2">),</span>
                 <span class="s2">(</span><span class="s5">2000 </span><span class="s2">- </span><span class="s5">1970</span><span class="s2">)*</span><span class="s5">365 </span><span class="s2">+ (</span><span class="s5">2000 </span><span class="s2">- </span><span class="s5">1972</span><span class="s2">)//</span><span class="s5">4 </span><span class="s2">+ </span><span class="s5">31 </span><span class="s2">+ </span><span class="s5">29</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">(</span><span class="s4">'2001-03-22'</span><span class="s2">, </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'M8[D]'</span><span class="s2">).</span><span class="s0">astype</span><span class="s2">(</span><span class="s4">'i8'</span><span class="s2">),</span>
                 <span class="s2">(</span><span class="s5">2000 </span><span class="s2">- </span><span class="s5">1970</span><span class="s2">)*</span><span class="s5">365 </span><span class="s2">+ (</span><span class="s5">2000 </span><span class="s2">- </span><span class="s5">1972</span><span class="s2">)//</span><span class="s5">4 </span><span class="s2">+ </span><span class="s5">366 </span><span class="s2">+ </span><span class="s5">31 </span><span class="s2">+ </span><span class="s5">28 </span><span class="s2">+ </span><span class="s5">21</span><span class="s2">)</span>

    <span class="s1">def </span><span class="s0">test_days_to_pydate</span><span class="s2">(</span><span class="s0">self</span><span class="s2">):</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">(</span><span class="s4">'1599'</span><span class="s2">, </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'M8[D]'</span><span class="s2">).</span><span class="s0">astype</span><span class="s2">(</span><span class="s4">'O'</span><span class="s2">),</span>
                    <span class="s0">datetime</span><span class="s2">.</span><span class="s0">date</span><span class="s2">(</span><span class="s5">1599</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">))</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">(</span><span class="s4">'1600'</span><span class="s2">, </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'M8[D]'</span><span class="s2">).</span><span class="s0">astype</span><span class="s2">(</span><span class="s4">'O'</span><span class="s2">),</span>
                    <span class="s0">datetime</span><span class="s2">.</span><span class="s0">date</span><span class="s2">(</span><span class="s5">1600</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">))</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">(</span><span class="s4">'1601'</span><span class="s2">, </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'M8[D]'</span><span class="s2">).</span><span class="s0">astype</span><span class="s2">(</span><span class="s4">'O'</span><span class="s2">),</span>
                    <span class="s0">datetime</span><span class="s2">.</span><span class="s0">date</span><span class="s2">(</span><span class="s5">1601</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">))</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">(</span><span class="s4">'1900'</span><span class="s2">, </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'M8[D]'</span><span class="s2">).</span><span class="s0">astype</span><span class="s2">(</span><span class="s4">'O'</span><span class="s2">),</span>
                    <span class="s0">datetime</span><span class="s2">.</span><span class="s0">date</span><span class="s2">(</span><span class="s5">1900</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">))</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">(</span><span class="s4">'1901'</span><span class="s2">, </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'M8[D]'</span><span class="s2">).</span><span class="s0">astype</span><span class="s2">(</span><span class="s4">'O'</span><span class="s2">),</span>
                    <span class="s0">datetime</span><span class="s2">.</span><span class="s0">date</span><span class="s2">(</span><span class="s5">1901</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">))</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">(</span><span class="s4">'2000'</span><span class="s2">, </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'M8[D]'</span><span class="s2">).</span><span class="s0">astype</span><span class="s2">(</span><span class="s4">'O'</span><span class="s2">),</span>
                    <span class="s0">datetime</span><span class="s2">.</span><span class="s0">date</span><span class="s2">(</span><span class="s5">2000</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">))</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">(</span><span class="s4">'2001'</span><span class="s2">, </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'M8[D]'</span><span class="s2">).</span><span class="s0">astype</span><span class="s2">(</span><span class="s4">'O'</span><span class="s2">),</span>
                    <span class="s0">datetime</span><span class="s2">.</span><span class="s0">date</span><span class="s2">(</span><span class="s5">2001</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">))</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">(</span><span class="s4">'1600-02-29'</span><span class="s2">, </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'M8[D]'</span><span class="s2">).</span><span class="s0">astype</span><span class="s2">(</span><span class="s4">'O'</span><span class="s2">),</span>
                    <span class="s0">datetime</span><span class="s2">.</span><span class="s0">date</span><span class="s2">(</span><span class="s5">1600</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">29</span><span class="s2">))</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">(</span><span class="s4">'1600-03-01'</span><span class="s2">, </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'M8[D]'</span><span class="s2">).</span><span class="s0">astype</span><span class="s2">(</span><span class="s4">'O'</span><span class="s2">),</span>
                    <span class="s0">datetime</span><span class="s2">.</span><span class="s0">date</span><span class="s2">(</span><span class="s5">1600</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s5">1</span><span class="s2">))</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">(</span><span class="s4">'2001-03-22'</span><span class="s2">, </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'M8[D]'</span><span class="s2">).</span><span class="s0">astype</span><span class="s2">(</span><span class="s4">'O'</span><span class="s2">),</span>
                    <span class="s0">datetime</span><span class="s2">.</span><span class="s0">date</span><span class="s2">(</span><span class="s5">2001</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s5">22</span><span class="s2">))</span>

    <span class="s1">def </span><span class="s0">test_dtype_comparison</span><span class="s2">(</span><span class="s0">self</span><span class="s2">):</span>
        <span class="s0">assert_</span><span class="s2">(</span><span class="s1">not </span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[us]'</span><span class="s2">) == </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[ms]'</span><span class="s2">)))</span>
        <span class="s0">assert_</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[us]'</span><span class="s2">) != </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[ms]'</span><span class="s2">))</span>
        <span class="s0">assert_</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[2D]'</span><span class="s2">) != </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[D]'</span><span class="s2">))</span>
        <span class="s0">assert_</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[D]'</span><span class="s2">) != </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[2D]'</span><span class="s2">))</span>

    <span class="s1">def </span><span class="s0">test_pydatetime_creation</span><span class="s2">(</span><span class="s0">self</span><span class="s2">):</span>
        <span class="s0">a </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">([</span><span class="s4">'1960-03-12'</span><span class="s2">, </span><span class="s0">datetime</span><span class="s2">.</span><span class="s0">date</span><span class="s2">(</span><span class="s5">1960</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s5">12</span><span class="s2">)], </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'M8[D]'</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">a</span><span class="s2">[</span><span class="s5">0</span><span class="s2">], </span><span class="s0">a</span><span class="s2">[</span><span class="s5">1</span><span class="s2">])</span>
        <span class="s0">a </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">([</span><span class="s4">'1999-12-31'</span><span class="s2">, </span><span class="s0">datetime</span><span class="s2">.</span><span class="s0">date</span><span class="s2">(</span><span class="s5">1999</span><span class="s2">, </span><span class="s5">12</span><span class="s2">, </span><span class="s5">31</span><span class="s2">)], </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'M8[D]'</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">a</span><span class="s2">[</span><span class="s5">0</span><span class="s2">], </span><span class="s0">a</span><span class="s2">[</span><span class="s5">1</span><span class="s2">])</span>
        <span class="s0">a </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">([</span><span class="s4">'2000-01-01'</span><span class="s2">, </span><span class="s0">datetime</span><span class="s2">.</span><span class="s0">date</span><span class="s2">(</span><span class="s5">2000</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">)], </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'M8[D]'</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">a</span><span class="s2">[</span><span class="s5">0</span><span class="s2">], </span><span class="s0">a</span><span class="s2">[</span><span class="s5">1</span><span class="s2">])</span>
        <span class="s3"># Will fail if the date changes during the exact right moment</span>
        <span class="s0">a </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">([</span><span class="s4">'today'</span><span class="s2">, </span><span class="s0">datetime</span><span class="s2">.</span><span class="s0">date</span><span class="s2">.</span><span class="s0">today</span><span class="s2">()], </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'M8[D]'</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">a</span><span class="s2">[</span><span class="s5">0</span><span class="s2">], </span><span class="s0">a</span><span class="s2">[</span><span class="s5">1</span><span class="s2">])</span>
        <span class="s3"># datetime.datetime.now() returns local time, not UTC</span>
        <span class="s3">#a = np.array(['now', datetime.datetime.now()], dtype='M8[s]')</span>
        <span class="s3">#assert_equal(a[0], a[1])</span>

        <span class="s3"># we can give a datetime.date time units</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">(</span><span class="s0">datetime</span><span class="s2">.</span><span class="s0">date</span><span class="s2">(</span><span class="s5">1960</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s5">12</span><span class="s2">), </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'M8[s]'</span><span class="s2">),</span>
                     <span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'1960-03-12T00:00:00'</span><span class="s2">)))</span>

    <span class="s1">def </span><span class="s0">test_datetime_string_conversion</span><span class="s2">(</span><span class="s0">self</span><span class="s2">):</span>
        <span class="s0">a </span><span class="s2">= [</span><span class="s4">'2011-03-16'</span><span class="s2">, </span><span class="s4">'1920-01-01'</span><span class="s2">, </span><span class="s4">'2013-05-19'</span><span class="s2">]</span>
        <span class="s0">str_a </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">(</span><span class="s0">a</span><span class="s2">, </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'S'</span><span class="s2">)</span>
        <span class="s0">uni_a </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">(</span><span class="s0">a</span><span class="s2">, </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'U'</span><span class="s2">)</span>
        <span class="s0">dt_a </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">(</span><span class="s0">a</span><span class="s2">, </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'M'</span><span class="s2">)</span>

        <span class="s3"># String to datetime</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">dt_a</span><span class="s2">, </span><span class="s0">str_a</span><span class="s2">.</span><span class="s0">astype</span><span class="s2">(</span><span class="s4">'M'</span><span class="s2">))</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">dt_a</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">, </span><span class="s0">str_a</span><span class="s2">.</span><span class="s0">astype</span><span class="s2">(</span><span class="s4">'M'</span><span class="s2">).</span><span class="s0">dtype</span><span class="s2">)</span>
        <span class="s0">dt_b </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">empty_like</span><span class="s2">(</span><span class="s0">dt_a</span><span class="s2">)</span>
        <span class="s0">dt_b</span><span class="s2">[...] = </span><span class="s0">str_a</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">dt_a</span><span class="s2">, </span><span class="s0">dt_b</span><span class="s2">)</span>

        <span class="s3"># Datetime to string</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">str_a</span><span class="s2">, </span><span class="s0">dt_a</span><span class="s2">.</span><span class="s0">astype</span><span class="s2">(</span><span class="s4">'S0'</span><span class="s2">))</span>
        <span class="s0">str_b </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">empty_like</span><span class="s2">(</span><span class="s0">str_a</span><span class="s2">)</span>
        <span class="s0">str_b</span><span class="s2">[...] = </span><span class="s0">dt_a</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">str_a</span><span class="s2">, </span><span class="s0">str_b</span><span class="s2">)</span>

        <span class="s3"># Unicode to datetime</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">dt_a</span><span class="s2">, </span><span class="s0">uni_a</span><span class="s2">.</span><span class="s0">astype</span><span class="s2">(</span><span class="s4">'M'</span><span class="s2">))</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">dt_a</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">, </span><span class="s0">uni_a</span><span class="s2">.</span><span class="s0">astype</span><span class="s2">(</span><span class="s4">'M'</span><span class="s2">).</span><span class="s0">dtype</span><span class="s2">)</span>
        <span class="s0">dt_b </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">empty_like</span><span class="s2">(</span><span class="s0">dt_a</span><span class="s2">)</span>
        <span class="s0">dt_b</span><span class="s2">[...] = </span><span class="s0">uni_a</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">dt_a</span><span class="s2">, </span><span class="s0">dt_b</span><span class="s2">)</span>

        <span class="s3"># Datetime to unicode</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">uni_a</span><span class="s2">, </span><span class="s0">dt_a</span><span class="s2">.</span><span class="s0">astype</span><span class="s2">(</span><span class="s4">'U'</span><span class="s2">))</span>
        <span class="s0">uni_b </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">empty_like</span><span class="s2">(</span><span class="s0">uni_a</span><span class="s2">)</span>
        <span class="s0">uni_b</span><span class="s2">[...] = </span><span class="s0">dt_a</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">uni_a</span><span class="s2">, </span><span class="s0">uni_b</span><span class="s2">)</span>

        <span class="s3"># Datetime to long string - gh-9712</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">str_a</span><span class="s2">, </span><span class="s0">dt_a</span><span class="s2">.</span><span class="s0">astype</span><span class="s2">((</span><span class="s0">np</span><span class="s2">.</span><span class="s0">bytes_</span><span class="s2">, </span><span class="s5">128</span><span class="s2">)))</span>
        <span class="s0">str_b </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">empty</span><span class="s2">(</span><span class="s0">str_a</span><span class="s2">.</span><span class="s0">shape</span><span class="s2">, </span><span class="s0">dtype</span><span class="s2">=(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">bytes_</span><span class="s2">, </span><span class="s5">128</span><span class="s2">))</span>
        <span class="s0">str_b</span><span class="s2">[...] = </span><span class="s0">dt_a</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">str_a</span><span class="s2">, </span><span class="s0">str_b</span><span class="s2">)</span>

    <span class="s2">@</span><span class="s0">pytest</span><span class="s2">.</span><span class="s0">mark</span><span class="s2">.</span><span class="s0">parametrize</span><span class="s2">(</span><span class="s4">&quot;time_dtype&quot;</span><span class="s2">, [</span><span class="s4">&quot;m8[D]&quot;</span><span class="s2">, </span><span class="s4">&quot;M8[Y]&quot;</span><span class="s2">])</span>
    <span class="s1">def </span><span class="s0">test_time_byteswapping</span><span class="s2">(</span><span class="s0">self</span><span class="s2">, </span><span class="s0">time_dtype</span><span class="s2">):</span>
        <span class="s0">times </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">([</span><span class="s4">&quot;2017&quot;</span><span class="s2">, </span><span class="s4">&quot;NaT&quot;</span><span class="s2">], </span><span class="s0">dtype</span><span class="s2">=</span><span class="s0">time_dtype</span><span class="s2">)</span>
        <span class="s0">times_swapped </span><span class="s2">= </span><span class="s0">times</span><span class="s2">.</span><span class="s0">astype</span><span class="s2">(</span><span class="s0">times</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">.</span><span class="s0">newbyteorder</span><span class="s2">())</span>
        <span class="s0">assert_array_equal</span><span class="s2">(</span><span class="s0">times</span><span class="s2">, </span><span class="s0">times_swapped</span><span class="s2">)</span>

        <span class="s0">unswapped </span><span class="s2">= </span><span class="s0">times_swapped</span><span class="s2">.</span><span class="s0">view</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">int64</span><span class="s2">).</span><span class="s0">newbyteorder</span><span class="s2">()</span>
        <span class="s0">assert_array_equal</span><span class="s2">(</span><span class="s0">unswapped</span><span class="s2">, </span><span class="s0">times</span><span class="s2">.</span><span class="s0">view</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">int64</span><span class="s2">))</span>

    <span class="s2">@</span><span class="s0">pytest</span><span class="s2">.</span><span class="s0">mark</span><span class="s2">.</span><span class="s0">parametrize</span><span class="s2">([</span><span class="s4">&quot;time1&quot;</span><span class="s2">, </span><span class="s4">&quot;time2&quot;</span><span class="s2">],</span>
            <span class="s2">[(</span><span class="s4">&quot;M8[s]&quot;</span><span class="s2">, </span><span class="s4">&quot;M8[D]&quot;</span><span class="s2">), (</span><span class="s4">&quot;m8[s]&quot;</span><span class="s2">, </span><span class="s4">&quot;m8[ns]&quot;</span><span class="s2">)])</span>
    <span class="s1">def </span><span class="s0">test_time_byteswapped_cast</span><span class="s2">(</span><span class="s0">self</span><span class="s2">, </span><span class="s0">time1</span><span class="s2">, </span><span class="s0">time2</span><span class="s2">):</span>
        <span class="s0">dtype1 </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s0">time1</span><span class="s2">)</span>
        <span class="s0">dtype2 </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s0">time2</span><span class="s2">)</span>
        <span class="s0">times </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">([</span><span class="s4">&quot;2017&quot;</span><span class="s2">, </span><span class="s4">&quot;NaT&quot;</span><span class="s2">], </span><span class="s0">dtype</span><span class="s2">=</span><span class="s0">dtype1</span><span class="s2">)</span>
        <span class="s0">expected </span><span class="s2">= </span><span class="s0">times</span><span class="s2">.</span><span class="s0">astype</span><span class="s2">(</span><span class="s0">dtype2</span><span class="s2">)</span>

        <span class="s3"># Test that every byte-swapping combination also returns the same</span>
        <span class="s3"># results (previous tests check that this comparison works fine).</span>
        <span class="s0">res </span><span class="s2">= </span><span class="s0">times</span><span class="s2">.</span><span class="s0">astype</span><span class="s2">(</span><span class="s0">dtype1</span><span class="s2">.</span><span class="s0">newbyteorder</span><span class="s2">()).</span><span class="s0">astype</span><span class="s2">(</span><span class="s0">dtype2</span><span class="s2">)</span>
        <span class="s0">assert_array_equal</span><span class="s2">(</span><span class="s0">res</span><span class="s2">, </span><span class="s0">expected</span><span class="s2">)</span>
        <span class="s0">res </span><span class="s2">= </span><span class="s0">times</span><span class="s2">.</span><span class="s0">astype</span><span class="s2">(</span><span class="s0">dtype2</span><span class="s2">.</span><span class="s0">newbyteorder</span><span class="s2">())</span>
        <span class="s0">assert_array_equal</span><span class="s2">(</span><span class="s0">res</span><span class="s2">, </span><span class="s0">expected</span><span class="s2">)</span>
        <span class="s0">res </span><span class="s2">= </span><span class="s0">times</span><span class="s2">.</span><span class="s0">astype</span><span class="s2">(</span><span class="s0">dtype1</span><span class="s2">.</span><span class="s0">newbyteorder</span><span class="s2">()).</span><span class="s0">astype</span><span class="s2">(</span><span class="s0">dtype2</span><span class="s2">.</span><span class="s0">newbyteorder</span><span class="s2">())</span>
        <span class="s0">assert_array_equal</span><span class="s2">(</span><span class="s0">res</span><span class="s2">, </span><span class="s0">expected</span><span class="s2">)</span>

    <span class="s2">@</span><span class="s0">pytest</span><span class="s2">.</span><span class="s0">mark</span><span class="s2">.</span><span class="s0">parametrize</span><span class="s2">(</span><span class="s4">&quot;time_dtype&quot;</span><span class="s2">, [</span><span class="s4">&quot;m8[D]&quot;</span><span class="s2">, </span><span class="s4">&quot;M8[Y]&quot;</span><span class="s2">])</span>
    <span class="s2">@</span><span class="s0">pytest</span><span class="s2">.</span><span class="s0">mark</span><span class="s2">.</span><span class="s0">parametrize</span><span class="s2">(</span><span class="s4">&quot;str_dtype&quot;</span><span class="s2">, [</span><span class="s4">&quot;U&quot;</span><span class="s2">, </span><span class="s4">&quot;S&quot;</span><span class="s2">])</span>
    <span class="s1">def </span><span class="s0">test_datetime_conversions_byteorders</span><span class="s2">(</span><span class="s0">self</span><span class="s2">, </span><span class="s0">str_dtype</span><span class="s2">, </span><span class="s0">time_dtype</span><span class="s2">):</span>
        <span class="s0">times </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">([</span><span class="s4">&quot;2017&quot;</span><span class="s2">, </span><span class="s4">&quot;NaT&quot;</span><span class="s2">], </span><span class="s0">dtype</span><span class="s2">=</span><span class="s0">time_dtype</span><span class="s2">)</span>
        <span class="s3"># Unfortunately, timedelta does not roundtrip:</span>
        <span class="s0">from_strings </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">([</span><span class="s4">&quot;2017&quot;</span><span class="s2">, </span><span class="s4">&quot;NaT&quot;</span><span class="s2">], </span><span class="s0">dtype</span><span class="s2">=</span><span class="s0">str_dtype</span><span class="s2">)</span>
        <span class="s0">to_strings </span><span class="s2">= </span><span class="s0">times</span><span class="s2">.</span><span class="s0">astype</span><span class="s2">(</span><span class="s0">str_dtype</span><span class="s2">)  </span><span class="s3"># assume this is correct</span>

        <span class="s3"># Check that conversion from times to string works if src is swapped:</span>
        <span class="s0">times_swapped </span><span class="s2">= </span><span class="s0">times</span><span class="s2">.</span><span class="s0">astype</span><span class="s2">(</span><span class="s0">times</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">.</span><span class="s0">newbyteorder</span><span class="s2">())</span>
        <span class="s0">res </span><span class="s2">= </span><span class="s0">times_swapped</span><span class="s2">.</span><span class="s0">astype</span><span class="s2">(</span><span class="s0">str_dtype</span><span class="s2">)</span>
        <span class="s0">assert_array_equal</span><span class="s2">(</span><span class="s0">res</span><span class="s2">, </span><span class="s0">to_strings</span><span class="s2">)</span>
        <span class="s3"># And also if both are swapped:</span>
        <span class="s0">res </span><span class="s2">= </span><span class="s0">times_swapped</span><span class="s2">.</span><span class="s0">astype</span><span class="s2">(</span><span class="s0">to_strings</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">.</span><span class="s0">newbyteorder</span><span class="s2">())</span>
        <span class="s0">assert_array_equal</span><span class="s2">(</span><span class="s0">res</span><span class="s2">, </span><span class="s0">to_strings</span><span class="s2">)</span>
        <span class="s3"># only destination is swapped:</span>
        <span class="s0">res </span><span class="s2">= </span><span class="s0">times</span><span class="s2">.</span><span class="s0">astype</span><span class="s2">(</span><span class="s0">to_strings</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">.</span><span class="s0">newbyteorder</span><span class="s2">())</span>
        <span class="s0">assert_array_equal</span><span class="s2">(</span><span class="s0">res</span><span class="s2">, </span><span class="s0">to_strings</span><span class="s2">)</span>

        <span class="s3"># Check that conversion from string to times works if src is swapped:</span>
        <span class="s0">from_strings_swapped </span><span class="s2">= </span><span class="s0">from_strings</span><span class="s2">.</span><span class="s0">astype</span><span class="s2">(</span>
                <span class="s0">from_strings</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">.</span><span class="s0">newbyteorder</span><span class="s2">())</span>
        <span class="s0">res </span><span class="s2">= </span><span class="s0">from_strings_swapped</span><span class="s2">.</span><span class="s0">astype</span><span class="s2">(</span><span class="s0">time_dtype</span><span class="s2">)</span>
        <span class="s0">assert_array_equal</span><span class="s2">(</span><span class="s0">res</span><span class="s2">, </span><span class="s0">times</span><span class="s2">)</span>
        <span class="s3"># And if both are swapped:</span>
        <span class="s0">res </span><span class="s2">= </span><span class="s0">from_strings_swapped</span><span class="s2">.</span><span class="s0">astype</span><span class="s2">(</span><span class="s0">times</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">.</span><span class="s0">newbyteorder</span><span class="s2">())</span>
        <span class="s0">assert_array_equal</span><span class="s2">(</span><span class="s0">res</span><span class="s2">, </span><span class="s0">times</span><span class="s2">)</span>
        <span class="s3"># Only destination is swapped:</span>
        <span class="s0">res </span><span class="s2">= </span><span class="s0">from_strings</span><span class="s2">.</span><span class="s0">astype</span><span class="s2">(</span><span class="s0">times</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">.</span><span class="s0">newbyteorder</span><span class="s2">())</span>
        <span class="s0">assert_array_equal</span><span class="s2">(</span><span class="s0">res</span><span class="s2">, </span><span class="s0">times</span><span class="s2">)</span>

    <span class="s1">def </span><span class="s0">test_datetime_array_str</span><span class="s2">(</span><span class="s0">self</span><span class="s2">):</span>
        <span class="s0">a </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">([</span><span class="s4">'2011-03-16'</span><span class="s2">, </span><span class="s4">'1920-01-01'</span><span class="s2">, </span><span class="s4">'2013-05-19'</span><span class="s2">], </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'M'</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">str</span><span class="s2">(</span><span class="s0">a</span><span class="s2">), </span><span class="s4">&quot;['2011-03-16' '1920-01-01' '2013-05-19']&quot;</span><span class="s2">)</span>

        <span class="s0">a </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">([</span><span class="s4">'2011-03-16T13:55'</span><span class="s2">, </span><span class="s4">'1920-01-01T03:12'</span><span class="s2">], </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'M'</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">array2string</span><span class="s2">(</span><span class="s0">a</span><span class="s2">, </span><span class="s0">separator</span><span class="s2">=</span><span class="s4">', '</span><span class="s2">,</span>
                    <span class="s0">formatter</span><span class="s2">={</span><span class="s4">'datetime'</span><span class="s2">: </span><span class="s1">lambda </span><span class="s0">x</span><span class="s2">:</span>
                            <span class="s4">&quot;'%s'&quot; </span><span class="s2">% </span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime_as_string</span><span class="s2">(</span><span class="s0">x</span><span class="s2">, </span><span class="s0">timezone</span><span class="s2">=</span><span class="s4">'UTC'</span><span class="s2">)}),</span>
                     <span class="s4">&quot;['2011-03-16T13:55Z', '1920-01-01T03:12Z']&quot;</span><span class="s2">)</span>

        <span class="s3"># Check that one NaT doesn't corrupt subsequent entries</span>
        <span class="s0">a </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">([</span><span class="s4">'2010'</span><span class="s2">, </span><span class="s4">'NaT'</span><span class="s2">, </span><span class="s4">'2030'</span><span class="s2">]).</span><span class="s0">astype</span><span class="s2">(</span><span class="s4">'M'</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">str</span><span class="s2">(</span><span class="s0">a</span><span class="s2">), </span><span class="s4">&quot;['2010'  'NaT' '2030']&quot;</span><span class="s2">)</span>

    <span class="s1">def </span><span class="s0">test_timedelta_array_str</span><span class="s2">(</span><span class="s0">self</span><span class="s2">):</span>
        <span class="s0">a </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">([-</span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">100</span><span class="s2">], </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'m'</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">str</span><span class="s2">(</span><span class="s0">a</span><span class="s2">), </span><span class="s4">&quot;[ -1   0 100]&quot;</span><span class="s2">)</span>
        <span class="s0">a </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">([</span><span class="s4">'NaT'</span><span class="s2">, </span><span class="s4">'NaT'</span><span class="s2">], </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'m'</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">str</span><span class="s2">(</span><span class="s0">a</span><span class="s2">), </span><span class="s4">&quot;['NaT' 'NaT']&quot;</span><span class="s2">)</span>
        <span class="s3"># Check right-alignment with NaTs</span>
        <span class="s0">a </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">([-</span><span class="s5">1</span><span class="s2">, </span><span class="s4">'NaT'</span><span class="s2">, </span><span class="s5">0</span><span class="s2">], </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'m'</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">str</span><span class="s2">(</span><span class="s0">a</span><span class="s2">), </span><span class="s4">&quot;[   -1 'NaT'     0]&quot;</span><span class="s2">)</span>
        <span class="s0">a </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">([-</span><span class="s5">1</span><span class="s2">, </span><span class="s4">'NaT'</span><span class="s2">, </span><span class="s5">1234567</span><span class="s2">], </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'m'</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">str</span><span class="s2">(</span><span class="s0">a</span><span class="s2">), </span><span class="s4">&quot;[     -1   'NaT' 1234567]&quot;</span><span class="s2">)</span>

        <span class="s3"># Test with other byteorder:</span>
        <span class="s0">a </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">([-</span><span class="s5">1</span><span class="s2">, </span><span class="s4">'NaT'</span><span class="s2">, </span><span class="s5">1234567</span><span class="s2">], </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'&gt;m'</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">str</span><span class="s2">(</span><span class="s0">a</span><span class="s2">), </span><span class="s4">&quot;[     -1   'NaT' 1234567]&quot;</span><span class="s2">)</span>
        <span class="s0">a </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">([-</span><span class="s5">1</span><span class="s2">, </span><span class="s4">'NaT'</span><span class="s2">, </span><span class="s5">1234567</span><span class="s2">], </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'&lt;m'</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">str</span><span class="s2">(</span><span class="s0">a</span><span class="s2">), </span><span class="s4">&quot;[     -1   'NaT' 1234567]&quot;</span><span class="s2">)</span>

    <span class="s1">def </span><span class="s0">test_pickle</span><span class="s2">(</span><span class="s0">self</span><span class="s2">):</span>
        <span class="s3"># Check that pickle roundtripping works</span>
        <span class="s1">for </span><span class="s0">proto </span><span class="s1">in </span><span class="s0">range</span><span class="s2">(</span><span class="s5">2</span><span class="s2">, </span><span class="s0">pickle</span><span class="s2">.</span><span class="s0">HIGHEST_PROTOCOL </span><span class="s2">+ </span><span class="s5">1</span><span class="s2">):</span>
            <span class="s0">dt </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[7D]'</span><span class="s2">)</span>
            <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">pickle</span><span class="s2">.</span><span class="s0">loads</span><span class="s2">(</span><span class="s0">pickle</span><span class="s2">.</span><span class="s0">dumps</span><span class="s2">(</span><span class="s0">dt</span><span class="s2">, </span><span class="s0">protocol</span><span class="s2">=</span><span class="s0">proto</span><span class="s2">)), </span><span class="s0">dt</span><span class="s2">)</span>
            <span class="s0">dt </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[W]'</span><span class="s2">)</span>
            <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">pickle</span><span class="s2">.</span><span class="s0">loads</span><span class="s2">(</span><span class="s0">pickle</span><span class="s2">.</span><span class="s0">dumps</span><span class="s2">(</span><span class="s0">dt</span><span class="s2">, </span><span class="s0">protocol</span><span class="s2">=</span><span class="s0">proto</span><span class="s2">)), </span><span class="s0">dt</span><span class="s2">)</span>
            <span class="s0">scalar </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'2016-01-01T00:00:00.000000000'</span><span class="s2">)</span>
            <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">pickle</span><span class="s2">.</span><span class="s0">loads</span><span class="s2">(</span><span class="s0">pickle</span><span class="s2">.</span><span class="s0">dumps</span><span class="s2">(</span><span class="s0">scalar</span><span class="s2">, </span><span class="s0">protocol</span><span class="s2">=</span><span class="s0">proto</span><span class="s2">)),</span>
                         <span class="s0">scalar</span><span class="s2">)</span>
            <span class="s0">delta </span><span class="s2">= </span><span class="s0">scalar </span><span class="s2">- </span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'2015-01-01T00:00:00.000000000'</span><span class="s2">)</span>
            <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">pickle</span><span class="s2">.</span><span class="s0">loads</span><span class="s2">(</span><span class="s0">pickle</span><span class="s2">.</span><span class="s0">dumps</span><span class="s2">(</span><span class="s0">delta</span><span class="s2">, </span><span class="s0">protocol</span><span class="s2">=</span><span class="s0">proto</span><span class="s2">)),</span>
                         <span class="s0">delta</span><span class="s2">)</span>

        <span class="s3"># Check that loading pickles from 1.6 works</span>
        <span class="s0">pkl </span><span class="s2">= </span><span class="s6">b&quot;cnumpy</span><span class="s1">\n</span><span class="s6">dtype</span><span class="s1">\n</span><span class="s6">p0</span><span class="s1">\n</span><span class="s6">(S'M8'</span><span class="s1">\n</span><span class="s6">p1</span><span class="s1">\n</span><span class="s6">I0</span><span class="s1">\n</span><span class="s6">I1</span><span class="s1">\n</span><span class="s6">tp2</span><span class="s1">\n</span><span class="s6">Rp3</span><span class="s1">\n</span><span class="s6">&quot; </span><span class="s2">+ </span><span class="s0">\</span>
              <span class="s6">b&quot;(I4</span><span class="s1">\n</span><span class="s6">S'&lt;'</span><span class="s1">\n</span><span class="s6">p4</span><span class="s1">\n</span><span class="s6">NNNI-1</span><span class="s1">\n</span><span class="s6">I-1</span><span class="s1">\n</span><span class="s6">I0</span><span class="s1">\n</span><span class="s6">((dp5</span><span class="s1">\n</span><span class="s6">(S'D'</span><span class="s1">\n</span><span class="s6">p6</span><span class="s1">\n</span><span class="s6">&quot; </span><span class="s2">+ </span><span class="s0">\</span>
              <span class="s6">b&quot;I7</span><span class="s1">\n</span><span class="s6">I1</span><span class="s1">\n</span><span class="s6">I1</span><span class="s1">\n</span><span class="s6">tp7</span><span class="s1">\n</span><span class="s6">tp8</span><span class="s1">\n</span><span class="s6">tp9</span><span class="s1">\n</span><span class="s6">b.&quot;</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">pickle</span><span class="s2">.</span><span class="s0">loads</span><span class="s2">(</span><span class="s0">pkl</span><span class="s2">), </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'&lt;M8[7D]'</span><span class="s2">))</span>
        <span class="s0">pkl </span><span class="s2">= </span><span class="s6">b&quot;cnumpy</span><span class="s1">\n</span><span class="s6">dtype</span><span class="s1">\n</span><span class="s6">p0</span><span class="s1">\n</span><span class="s6">(S'M8'</span><span class="s1">\n</span><span class="s6">p1</span><span class="s1">\n</span><span class="s6">I0</span><span class="s1">\n</span><span class="s6">I1</span><span class="s1">\n</span><span class="s6">tp2</span><span class="s1">\n</span><span class="s6">Rp3</span><span class="s1">\n</span><span class="s6">&quot; </span><span class="s2">+ </span><span class="s0">\</span>
              <span class="s6">b&quot;(I4</span><span class="s1">\n</span><span class="s6">S'&lt;'</span><span class="s1">\n</span><span class="s6">p4</span><span class="s1">\n</span><span class="s6">NNNI-1</span><span class="s1">\n</span><span class="s6">I-1</span><span class="s1">\n</span><span class="s6">I0</span><span class="s1">\n</span><span class="s6">((dp5</span><span class="s1">\n</span><span class="s6">(S'W'</span><span class="s1">\n</span><span class="s6">p6</span><span class="s1">\n</span><span class="s6">&quot; </span><span class="s2">+ </span><span class="s0">\</span>
              <span class="s6">b&quot;I1</span><span class="s1">\n</span><span class="s6">I1</span><span class="s1">\n</span><span class="s6">I1</span><span class="s1">\n</span><span class="s6">tp7</span><span class="s1">\n</span><span class="s6">tp8</span><span class="s1">\n</span><span class="s6">tp9</span><span class="s1">\n</span><span class="s6">b.&quot;</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">pickle</span><span class="s2">.</span><span class="s0">loads</span><span class="s2">(</span><span class="s0">pkl</span><span class="s2">), </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'&lt;M8[W]'</span><span class="s2">))</span>
        <span class="s0">pkl </span><span class="s2">= </span><span class="s6">b&quot;cnumpy</span><span class="s1">\n</span><span class="s6">dtype</span><span class="s1">\n</span><span class="s6">p0</span><span class="s1">\n</span><span class="s6">(S'M8'</span><span class="s1">\n</span><span class="s6">p1</span><span class="s1">\n</span><span class="s6">I0</span><span class="s1">\n</span><span class="s6">I1</span><span class="s1">\n</span><span class="s6">tp2</span><span class="s1">\n</span><span class="s6">Rp3</span><span class="s1">\n</span><span class="s6">&quot; </span><span class="s2">+ </span><span class="s0">\</span>
              <span class="s6">b&quot;(I4</span><span class="s1">\n</span><span class="s6">S'&gt;'</span><span class="s1">\n</span><span class="s6">p4</span><span class="s1">\n</span><span class="s6">NNNI-1</span><span class="s1">\n</span><span class="s6">I-1</span><span class="s1">\n</span><span class="s6">I0</span><span class="s1">\n</span><span class="s6">((dp5</span><span class="s1">\n</span><span class="s6">(S'us'</span><span class="s1">\n</span><span class="s6">p6</span><span class="s1">\n</span><span class="s6">&quot; </span><span class="s2">+ </span><span class="s0">\</span>
              <span class="s6">b&quot;I1</span><span class="s1">\n</span><span class="s6">I1</span><span class="s1">\n</span><span class="s6">I1</span><span class="s1">\n</span><span class="s6">tp7</span><span class="s1">\n</span><span class="s6">tp8</span><span class="s1">\n</span><span class="s6">tp9</span><span class="s1">\n</span><span class="s6">b.&quot;</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">pickle</span><span class="s2">.</span><span class="s0">loads</span><span class="s2">(</span><span class="s0">pkl</span><span class="s2">), </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'&gt;M8[us]'</span><span class="s2">))</span>

    <span class="s1">def </span><span class="s0">test_setstate</span><span class="s2">(</span><span class="s0">self</span><span class="s2">):</span>
        <span class="s7">&quot;Verify that datetime dtype __setstate__ can handle bad arguments&quot;</span>
        <span class="s0">dt </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'&gt;M8[us]'</span><span class="s2">)</span>
        <span class="s0">assert_raises</span><span class="s2">(</span><span class="s0">ValueError</span><span class="s2">, </span><span class="s0">dt</span><span class="s2">.</span><span class="s0">__setstate__</span><span class="s2">, (</span><span class="s5">4</span><span class="s2">, </span><span class="s4">'&gt;'</span><span class="s2">, </span><span class="s1">None</span><span class="s2">, </span><span class="s1">None</span><span class="s2">, </span><span class="s1">None</span><span class="s2">, -</span><span class="s5">1</span><span class="s2">, -</span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">))</span>
        <span class="s0">assert_</span><span class="s2">(</span><span class="s0">dt</span><span class="s2">.</span><span class="s0">__reduce__</span><span class="s2">()[</span><span class="s5">2</span><span class="s2">] == </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'&gt;M8[us]'</span><span class="s2">).</span><span class="s0">__reduce__</span><span class="s2">()[</span><span class="s5">2</span><span class="s2">])</span>
        <span class="s0">assert_raises</span><span class="s2">(</span><span class="s0">TypeError</span><span class="s2">, </span><span class="s0">dt</span><span class="s2">.</span><span class="s0">__setstate__</span><span class="s2">, (</span><span class="s5">4</span><span class="s2">, </span><span class="s4">'&gt;'</span><span class="s2">, </span><span class="s1">None</span><span class="s2">, </span><span class="s1">None</span><span class="s2">, </span><span class="s1">None</span><span class="s2">, -</span><span class="s5">1</span><span class="s2">, -</span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, ({}, </span><span class="s4">'xxx'</span><span class="s2">)))</span>
        <span class="s0">assert_</span><span class="s2">(</span><span class="s0">dt</span><span class="s2">.</span><span class="s0">__reduce__</span><span class="s2">()[</span><span class="s5">2</span><span class="s2">] == </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'&gt;M8[us]'</span><span class="s2">).</span><span class="s0">__reduce__</span><span class="s2">()[</span><span class="s5">2</span><span class="s2">])</span>

    <span class="s1">def </span><span class="s0">test_dtype_promotion</span><span class="s2">(</span><span class="s0">self</span><span class="s2">):</span>
        <span class="s3"># datetime &lt;op&gt; datetime computes the metadata gcd</span>
        <span class="s3"># timedelta &lt;op&gt; timedelta computes the metadata gcd</span>
        <span class="s1">for </span><span class="s0">mM </span><span class="s1">in </span><span class="s2">[</span><span class="s4">'m'</span><span class="s2">, </span><span class="s4">'M'</span><span class="s2">]:</span>
            <span class="s0">assert_equal</span><span class="s2">(</span>
                <span class="s0">np</span><span class="s2">.</span><span class="s0">promote_types</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s0">mM</span><span class="s2">+</span><span class="s4">'8[2Y]'</span><span class="s2">), </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s0">mM</span><span class="s2">+</span><span class="s4">'8[2Y]'</span><span class="s2">)),</span>
                <span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s0">mM</span><span class="s2">+</span><span class="s4">'8[2Y]'</span><span class="s2">))</span>
            <span class="s0">assert_equal</span><span class="s2">(</span>
                <span class="s0">np</span><span class="s2">.</span><span class="s0">promote_types</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s0">mM</span><span class="s2">+</span><span class="s4">'8[12Y]'</span><span class="s2">), </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s0">mM</span><span class="s2">+</span><span class="s4">'8[15Y]'</span><span class="s2">)),</span>
                <span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s0">mM</span><span class="s2">+</span><span class="s4">'8[3Y]'</span><span class="s2">))</span>
            <span class="s0">assert_equal</span><span class="s2">(</span>
                <span class="s0">np</span><span class="s2">.</span><span class="s0">promote_types</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s0">mM</span><span class="s2">+</span><span class="s4">'8[62M]'</span><span class="s2">), </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s0">mM</span><span class="s2">+</span><span class="s4">'8[24M]'</span><span class="s2">)),</span>
                <span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s0">mM</span><span class="s2">+</span><span class="s4">'8[2M]'</span><span class="s2">))</span>
            <span class="s0">assert_equal</span><span class="s2">(</span>
                <span class="s0">np</span><span class="s2">.</span><span class="s0">promote_types</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s0">mM</span><span class="s2">+</span><span class="s4">'8[1W]'</span><span class="s2">), </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s0">mM</span><span class="s2">+</span><span class="s4">'8[2D]'</span><span class="s2">)),</span>
                <span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s0">mM</span><span class="s2">+</span><span class="s4">'8[1D]'</span><span class="s2">))</span>
            <span class="s0">assert_equal</span><span class="s2">(</span>
                <span class="s0">np</span><span class="s2">.</span><span class="s0">promote_types</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s0">mM</span><span class="s2">+</span><span class="s4">'8[W]'</span><span class="s2">), </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s0">mM</span><span class="s2">+</span><span class="s4">'8[13s]'</span><span class="s2">)),</span>
                <span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s0">mM</span><span class="s2">+</span><span class="s4">'8[s]'</span><span class="s2">))</span>
            <span class="s0">assert_equal</span><span class="s2">(</span>
                <span class="s0">np</span><span class="s2">.</span><span class="s0">promote_types</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s0">mM</span><span class="s2">+</span><span class="s4">'8[13W]'</span><span class="s2">), </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s0">mM</span><span class="s2">+</span><span class="s4">'8[49s]'</span><span class="s2">)),</span>
                <span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s0">mM</span><span class="s2">+</span><span class="s4">'8[7s]'</span><span class="s2">))</span>
        <span class="s3"># timedelta &lt;op&gt; timedelta raises when there is no reasonable gcd</span>
        <span class="s0">assert_raises</span><span class="s2">(</span><span class="s0">TypeError</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">promote_types</span><span class="s2">,</span>
                            <span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'m8[Y]'</span><span class="s2">), </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'m8[D]'</span><span class="s2">))</span>
        <span class="s0">assert_raises</span><span class="s2">(</span><span class="s0">TypeError</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">promote_types</span><span class="s2">,</span>
                            <span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'m8[M]'</span><span class="s2">), </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'m8[W]'</span><span class="s2">))</span>
        <span class="s3"># timedelta and float cannot be safely cast with each other</span>
        <span class="s0">assert_raises</span><span class="s2">(</span><span class="s0">TypeError</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">promote_types</span><span class="s2">, </span><span class="s4">&quot;float32&quot;</span><span class="s2">, </span><span class="s4">&quot;m8&quot;</span><span class="s2">)</span>
        <span class="s0">assert_raises</span><span class="s2">(</span><span class="s0">TypeError</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">promote_types</span><span class="s2">, </span><span class="s4">&quot;m8&quot;</span><span class="s2">, </span><span class="s4">&quot;float32&quot;</span><span class="s2">)</span>
        <span class="s0">assert_raises</span><span class="s2">(</span><span class="s0">TypeError</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">promote_types</span><span class="s2">, </span><span class="s4">&quot;uint64&quot;</span><span class="s2">, </span><span class="s4">&quot;m8&quot;</span><span class="s2">)</span>
        <span class="s0">assert_raises</span><span class="s2">(</span><span class="s0">TypeError</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">promote_types</span><span class="s2">, </span><span class="s4">&quot;m8&quot;</span><span class="s2">, </span><span class="s4">&quot;uint64&quot;</span><span class="s2">)</span>

        <span class="s3"># timedelta &lt;op&gt; timedelta may overflow with big unit ranges</span>
        <span class="s0">assert_raises</span><span class="s2">(</span><span class="s0">OverflowError</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">promote_types</span><span class="s2">,</span>
                            <span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'m8[W]'</span><span class="s2">), </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'m8[fs]'</span><span class="s2">))</span>
        <span class="s0">assert_raises</span><span class="s2">(</span><span class="s0">OverflowError</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">promote_types</span><span class="s2">,</span>
                            <span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'m8[s]'</span><span class="s2">), </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'m8[as]'</span><span class="s2">))</span>

    <span class="s1">def </span><span class="s0">test_cast_overflow</span><span class="s2">(</span><span class="s0">self</span><span class="s2">):</span>
        <span class="s3"># gh-4486</span>
        <span class="s1">def </span><span class="s0">cast</span><span class="s2">():</span>
            <span class="s0">numpy</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">&quot;1971-01-01 00:00:00.000000000000000&quot;</span><span class="s2">).</span><span class="s0">astype</span><span class="s2">(</span><span class="s4">&quot;&lt;M8[D]&quot;</span><span class="s2">)</span>
        <span class="s0">assert_raises</span><span class="s2">(</span><span class="s0">OverflowError</span><span class="s2">, </span><span class="s0">cast</span><span class="s2">)</span>

        <span class="s1">def </span><span class="s0">cast2</span><span class="s2">():</span>
            <span class="s0">numpy</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">&quot;2014&quot;</span><span class="s2">).</span><span class="s0">astype</span><span class="s2">(</span><span class="s4">&quot;&lt;M8[fs]&quot;</span><span class="s2">)</span>
        <span class="s0">assert_raises</span><span class="s2">(</span><span class="s0">OverflowError</span><span class="s2">, </span><span class="s0">cast2</span><span class="s2">)</span>

    <span class="s1">def </span><span class="s0">test_pyobject_roundtrip</span><span class="s2">(</span><span class="s0">self</span><span class="s2">):</span>
        <span class="s3"># All datetime types should be able to roundtrip through object</span>
        <span class="s0">a </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">([</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">,</span>
                      <span class="s2">-</span><span class="s5">1020040340</span><span class="s2">, -</span><span class="s5">2942398</span><span class="s2">, -</span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">234523453</span><span class="s2">, </span><span class="s5">1199164176</span><span class="s2">],</span>
                                                        <span class="s0">dtype</span><span class="s2">=</span><span class="s0">np</span><span class="s2">.</span><span class="s0">int64</span><span class="s2">)</span>
        <span class="s3"># With date units</span>
        <span class="s1">for </span><span class="s0">unit </span><span class="s1">in </span><span class="s2">[</span><span class="s4">'M8[D]'</span><span class="s2">, </span><span class="s4">'M8[W]'</span><span class="s2">, </span><span class="s4">'M8[M]'</span><span class="s2">, </span><span class="s4">'M8[Y]'</span><span class="s2">]:</span>
            <span class="s0">b </span><span class="s2">= </span><span class="s0">a</span><span class="s2">.</span><span class="s0">copy</span><span class="s2">().</span><span class="s0">view</span><span class="s2">(</span><span class="s0">dtype</span><span class="s2">=</span><span class="s0">unit</span><span class="s2">)</span>
            <span class="s0">b</span><span class="s2">[</span><span class="s5">0</span><span class="s2">] = </span><span class="s4">'-0001-01-01'</span>
            <span class="s0">b</span><span class="s2">[</span><span class="s5">1</span><span class="s2">] = </span><span class="s4">'-0001-12-31'</span>
            <span class="s0">b</span><span class="s2">[</span><span class="s5">2</span><span class="s2">] = </span><span class="s4">'0000-01-01'</span>
            <span class="s0">b</span><span class="s2">[</span><span class="s5">3</span><span class="s2">] = </span><span class="s4">'0001-01-01'</span>
            <span class="s0">b</span><span class="s2">[</span><span class="s5">4</span><span class="s2">] = </span><span class="s4">'1969-12-31'</span>
            <span class="s0">b</span><span class="s2">[</span><span class="s5">5</span><span class="s2">] = </span><span class="s4">'1970-01-01'</span>
            <span class="s0">b</span><span class="s2">[</span><span class="s5">6</span><span class="s2">] = </span><span class="s4">'9999-12-31'</span>
            <span class="s0">b</span><span class="s2">[</span><span class="s5">7</span><span class="s2">] = </span><span class="s4">'10000-01-01'</span>
            <span class="s0">b</span><span class="s2">[</span><span class="s5">8</span><span class="s2">] = </span><span class="s4">'NaT'</span>

            <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">b</span><span class="s2">.</span><span class="s0">astype</span><span class="s2">(</span><span class="s0">object</span><span class="s2">).</span><span class="s0">astype</span><span class="s2">(</span><span class="s0">unit</span><span class="s2">), </span><span class="s0">b</span><span class="s2">,</span>
                            <span class="s4">&quot;Error roundtripping unit %s&quot; </span><span class="s2">% </span><span class="s0">unit</span><span class="s2">)</span>
        <span class="s3"># With time units</span>
        <span class="s1">for </span><span class="s0">unit </span><span class="s1">in </span><span class="s2">[</span><span class="s4">'M8[as]'</span><span class="s2">, </span><span class="s4">'M8[16fs]'</span><span class="s2">, </span><span class="s4">'M8[ps]'</span><span class="s2">, </span><span class="s4">'M8[us]'</span><span class="s2">,</span>
                     <span class="s4">'M8[300as]'</span><span class="s2">, </span><span class="s4">'M8[20us]'</span><span class="s2">]:</span>
            <span class="s0">b </span><span class="s2">= </span><span class="s0">a</span><span class="s2">.</span><span class="s0">copy</span><span class="s2">().</span><span class="s0">view</span><span class="s2">(</span><span class="s0">dtype</span><span class="s2">=</span><span class="s0">unit</span><span class="s2">)</span>
            <span class="s0">b</span><span class="s2">[</span><span class="s5">0</span><span class="s2">] = </span><span class="s4">'-0001-01-01T00'</span>
            <span class="s0">b</span><span class="s2">[</span><span class="s5">1</span><span class="s2">] = </span><span class="s4">'-0001-12-31T00'</span>
            <span class="s0">b</span><span class="s2">[</span><span class="s5">2</span><span class="s2">] = </span><span class="s4">'0000-01-01T00'</span>
            <span class="s0">b</span><span class="s2">[</span><span class="s5">3</span><span class="s2">] = </span><span class="s4">'0001-01-01T00'</span>
            <span class="s0">b</span><span class="s2">[</span><span class="s5">4</span><span class="s2">] = </span><span class="s4">'1969-12-31T23:59:59.999999'</span>
            <span class="s0">b</span><span class="s2">[</span><span class="s5">5</span><span class="s2">] = </span><span class="s4">'1970-01-01T00'</span>
            <span class="s0">b</span><span class="s2">[</span><span class="s5">6</span><span class="s2">] = </span><span class="s4">'9999-12-31T23:59:59.999999'</span>
            <span class="s0">b</span><span class="s2">[</span><span class="s5">7</span><span class="s2">] = </span><span class="s4">'10000-01-01T00'</span>
            <span class="s0">b</span><span class="s2">[</span><span class="s5">8</span><span class="s2">] = </span><span class="s4">'NaT'</span>

            <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">b</span><span class="s2">.</span><span class="s0">astype</span><span class="s2">(</span><span class="s0">object</span><span class="s2">).</span><span class="s0">astype</span><span class="s2">(</span><span class="s0">unit</span><span class="s2">), </span><span class="s0">b</span><span class="s2">,</span>
                            <span class="s4">&quot;Error roundtripping unit %s&quot; </span><span class="s2">% </span><span class="s0">unit</span><span class="s2">)</span>

    <span class="s1">def </span><span class="s0">test_month_truncation</span><span class="s2">(</span><span class="s0">self</span><span class="s2">):</span>
        <span class="s3"># Make sure that months are truncating correctly</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">(</span><span class="s4">'1945-03-01'</span><span class="s2">, </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'M8[M]'</span><span class="s2">),</span>
                     <span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">(</span><span class="s4">'1945-03-31'</span><span class="s2">, </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'M8[M]'</span><span class="s2">))</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">(</span><span class="s4">'1969-11-01'</span><span class="s2">, </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'M8[M]'</span><span class="s2">),</span>
             <span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">(</span><span class="s4">'1969-11-30T23:59:59.99999'</span><span class="s2">, </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'M'</span><span class="s2">).</span><span class="s0">astype</span><span class="s2">(</span><span class="s4">'M8[M]'</span><span class="s2">))</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">(</span><span class="s4">'1969-12-01'</span><span class="s2">, </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'M8[M]'</span><span class="s2">),</span>
             <span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">(</span><span class="s4">'1969-12-31T23:59:59.99999'</span><span class="s2">, </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'M'</span><span class="s2">).</span><span class="s0">astype</span><span class="s2">(</span><span class="s4">'M8[M]'</span><span class="s2">))</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">(</span><span class="s4">'1970-01-01'</span><span class="s2">, </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'M8[M]'</span><span class="s2">),</span>
             <span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">(</span><span class="s4">'1970-01-31T23:59:59.99999'</span><span class="s2">, </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'M'</span><span class="s2">).</span><span class="s0">astype</span><span class="s2">(</span><span class="s4">'M8[M]'</span><span class="s2">))</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">(</span><span class="s4">'1980-02-01'</span><span class="s2">, </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'M8[M]'</span><span class="s2">),</span>
             <span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">(</span><span class="s4">'1980-02-29T23:59:59.99999'</span><span class="s2">, </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'M'</span><span class="s2">).</span><span class="s0">astype</span><span class="s2">(</span><span class="s4">'M8[M]'</span><span class="s2">))</span>

    <span class="s1">def </span><span class="s0">test_different_unit_comparison</span><span class="s2">(</span><span class="s0">self</span><span class="s2">):</span>
        <span class="s3"># Check some years with date units</span>
        <span class="s1">for </span><span class="s0">unit1 </span><span class="s1">in </span><span class="s2">[</span><span class="s4">'Y'</span><span class="s2">, </span><span class="s4">'M'</span><span class="s2">, </span><span class="s4">'D'</span><span class="s2">]:</span>
            <span class="s0">dt1 </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[%s]' </span><span class="s2">% </span><span class="s0">unit1</span><span class="s2">)</span>
            <span class="s1">for </span><span class="s0">unit2 </span><span class="s1">in </span><span class="s2">[</span><span class="s4">'Y'</span><span class="s2">, </span><span class="s4">'M'</span><span class="s2">, </span><span class="s4">'D'</span><span class="s2">]:</span>
                <span class="s0">dt2 </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[%s]' </span><span class="s2">% </span><span class="s0">unit2</span><span class="s2">)</span>
                <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">(</span><span class="s4">'1945'</span><span class="s2">, </span><span class="s0">dtype</span><span class="s2">=</span><span class="s0">dt1</span><span class="s2">),</span>
                             <span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">(</span><span class="s4">'1945'</span><span class="s2">, </span><span class="s0">dtype</span><span class="s2">=</span><span class="s0">dt2</span><span class="s2">))</span>
                <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">(</span><span class="s4">'1970'</span><span class="s2">, </span><span class="s0">dtype</span><span class="s2">=</span><span class="s0">dt1</span><span class="s2">),</span>
                             <span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">(</span><span class="s4">'1970'</span><span class="s2">, </span><span class="s0">dtype</span><span class="s2">=</span><span class="s0">dt2</span><span class="s2">))</span>
                <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">(</span><span class="s4">'9999'</span><span class="s2">, </span><span class="s0">dtype</span><span class="s2">=</span><span class="s0">dt1</span><span class="s2">),</span>
                             <span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">(</span><span class="s4">'9999'</span><span class="s2">, </span><span class="s0">dtype</span><span class="s2">=</span><span class="s0">dt2</span><span class="s2">))</span>
                <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">(</span><span class="s4">'10000'</span><span class="s2">, </span><span class="s0">dtype</span><span class="s2">=</span><span class="s0">dt1</span><span class="s2">),</span>
                             <span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">(</span><span class="s4">'10000-01-01'</span><span class="s2">, </span><span class="s0">dtype</span><span class="s2">=</span><span class="s0">dt2</span><span class="s2">))</span>
                <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'1945'</span><span class="s2">, </span><span class="s0">unit1</span><span class="s2">),</span>
                             <span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'1945'</span><span class="s2">, </span><span class="s0">unit2</span><span class="s2">))</span>
                <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'1970'</span><span class="s2">, </span><span class="s0">unit1</span><span class="s2">),</span>
                             <span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'1970'</span><span class="s2">, </span><span class="s0">unit2</span><span class="s2">))</span>
                <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'9999'</span><span class="s2">, </span><span class="s0">unit1</span><span class="s2">),</span>
                             <span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'9999'</span><span class="s2">, </span><span class="s0">unit2</span><span class="s2">))</span>
                <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'10000'</span><span class="s2">, </span><span class="s0">unit1</span><span class="s2">),</span>
                             <span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'10000-01-01'</span><span class="s2">, </span><span class="s0">unit2</span><span class="s2">))</span>
        <span class="s3"># Check some datetimes with time units</span>
        <span class="s1">for </span><span class="s0">unit1 </span><span class="s1">in </span><span class="s2">[</span><span class="s4">'6h'</span><span class="s2">, </span><span class="s4">'h'</span><span class="s2">, </span><span class="s4">'m'</span><span class="s2">, </span><span class="s4">'s'</span><span class="s2">, </span><span class="s4">'10ms'</span><span class="s2">, </span><span class="s4">'ms'</span><span class="s2">, </span><span class="s4">'us'</span><span class="s2">]:</span>
            <span class="s0">dt1 </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[%s]' </span><span class="s2">% </span><span class="s0">unit1</span><span class="s2">)</span>
            <span class="s1">for </span><span class="s0">unit2 </span><span class="s1">in </span><span class="s2">[</span><span class="s4">'h'</span><span class="s2">, </span><span class="s4">'m'</span><span class="s2">, </span><span class="s4">'s'</span><span class="s2">, </span><span class="s4">'ms'</span><span class="s2">, </span><span class="s4">'us'</span><span class="s2">]:</span>
                <span class="s0">dt2 </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[%s]' </span><span class="s2">% </span><span class="s0">unit2</span><span class="s2">)</span>
                <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">(</span><span class="s4">'1945-03-12T18'</span><span class="s2">, </span><span class="s0">dtype</span><span class="s2">=</span><span class="s0">dt1</span><span class="s2">),</span>
                             <span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">(</span><span class="s4">'1945-03-12T18'</span><span class="s2">, </span><span class="s0">dtype</span><span class="s2">=</span><span class="s0">dt2</span><span class="s2">))</span>
                <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">(</span><span class="s4">'1970-03-12T18'</span><span class="s2">, </span><span class="s0">dtype</span><span class="s2">=</span><span class="s0">dt1</span><span class="s2">),</span>
                             <span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">(</span><span class="s4">'1970-03-12T18'</span><span class="s2">, </span><span class="s0">dtype</span><span class="s2">=</span><span class="s0">dt2</span><span class="s2">))</span>
                <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">(</span><span class="s4">'9999-03-12T18'</span><span class="s2">, </span><span class="s0">dtype</span><span class="s2">=</span><span class="s0">dt1</span><span class="s2">),</span>
                             <span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">(</span><span class="s4">'9999-03-12T18'</span><span class="s2">, </span><span class="s0">dtype</span><span class="s2">=</span><span class="s0">dt2</span><span class="s2">))</span>
                <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">(</span><span class="s4">'10000-01-01T00'</span><span class="s2">, </span><span class="s0">dtype</span><span class="s2">=</span><span class="s0">dt1</span><span class="s2">),</span>
                             <span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">(</span><span class="s4">'10000-01-01T00'</span><span class="s2">, </span><span class="s0">dtype</span><span class="s2">=</span><span class="s0">dt2</span><span class="s2">))</span>
                <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'1945-03-12T18'</span><span class="s2">, </span><span class="s0">unit1</span><span class="s2">),</span>
                             <span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'1945-03-12T18'</span><span class="s2">, </span><span class="s0">unit2</span><span class="s2">))</span>
                <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'1970-03-12T18'</span><span class="s2">, </span><span class="s0">unit1</span><span class="s2">),</span>
                             <span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'1970-03-12T18'</span><span class="s2">, </span><span class="s0">unit2</span><span class="s2">))</span>
                <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'9999-03-12T18'</span><span class="s2">, </span><span class="s0">unit1</span><span class="s2">),</span>
                             <span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'9999-03-12T18'</span><span class="s2">, </span><span class="s0">unit2</span><span class="s2">))</span>
                <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'10000-01-01T00'</span><span class="s2">, </span><span class="s0">unit1</span><span class="s2">),</span>
                             <span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'10000-01-01T00'</span><span class="s2">, </span><span class="s0">unit2</span><span class="s2">))</span>
        <span class="s3"># Check some days with units that won't overflow</span>
        <span class="s1">for </span><span class="s0">unit1 </span><span class="s1">in </span><span class="s2">[</span><span class="s4">'D'</span><span class="s2">, </span><span class="s4">'12h'</span><span class="s2">, </span><span class="s4">'h'</span><span class="s2">, </span><span class="s4">'m'</span><span class="s2">, </span><span class="s4">'s'</span><span class="s2">, </span><span class="s4">'4s'</span><span class="s2">, </span><span class="s4">'ms'</span><span class="s2">, </span><span class="s4">'us'</span><span class="s2">]:</span>
            <span class="s0">dt1 </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[%s]' </span><span class="s2">% </span><span class="s0">unit1</span><span class="s2">)</span>
            <span class="s1">for </span><span class="s0">unit2 </span><span class="s1">in </span><span class="s2">[</span><span class="s4">'D'</span><span class="s2">, </span><span class="s4">'h'</span><span class="s2">, </span><span class="s4">'m'</span><span class="s2">, </span><span class="s4">'s'</span><span class="s2">, </span><span class="s4">'ms'</span><span class="s2">, </span><span class="s4">'us'</span><span class="s2">]:</span>
                <span class="s0">dt2 </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[%s]' </span><span class="s2">% </span><span class="s0">unit2</span><span class="s2">)</span>
                <span class="s0">assert_</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">(</span><span class="s4">'1932-02-17'</span><span class="s2">, </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'M'</span><span class="s2">).</span><span class="s0">astype</span><span class="s2">(</span><span class="s0">dt1</span><span class="s2">),</span>
                     <span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">(</span><span class="s4">'1932-02-17T00:00:00'</span><span class="s2">, </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'M'</span><span class="s2">).</span><span class="s0">astype</span><span class="s2">(</span><span class="s0">dt2</span><span class="s2">),</span>
                     <span class="s0">casting</span><span class="s2">=</span><span class="s4">'unsafe'</span><span class="s2">))</span>
                <span class="s0">assert_</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">(</span><span class="s4">'10000-04-27'</span><span class="s2">, </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'M'</span><span class="s2">).</span><span class="s0">astype</span><span class="s2">(</span><span class="s0">dt1</span><span class="s2">),</span>
                     <span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">(</span><span class="s4">'10000-04-27T00:00:00'</span><span class="s2">, </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'M'</span><span class="s2">).</span><span class="s0">astype</span><span class="s2">(</span><span class="s0">dt2</span><span class="s2">),</span>
                     <span class="s0">casting</span><span class="s2">=</span><span class="s4">'unsafe'</span><span class="s2">))</span>

        <span class="s3"># Shouldn't be able to compare datetime and timedelta</span>
        <span class="s0">a </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">(</span><span class="s4">'2012-12-21'</span><span class="s2">, </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'M8[D]'</span><span class="s2">)</span>
        <span class="s0">b </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">(</span><span class="s5">3</span><span class="s2">, </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'m8[D]'</span><span class="s2">)</span>
        <span class="s0">assert_raises</span><span class="s2">(</span><span class="s0">TypeError</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">less</span><span class="s2">, </span><span class="s0">a</span><span class="s2">, </span><span class="s0">b</span><span class="s2">)</span>
        <span class="s3"># not even if &quot;unsafe&quot;</span>
        <span class="s0">assert_raises</span><span class="s2">(</span><span class="s0">TypeError</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">less</span><span class="s2">, </span><span class="s0">a</span><span class="s2">, </span><span class="s0">b</span><span class="s2">, </span><span class="s0">casting</span><span class="s2">=</span><span class="s4">'unsafe'</span><span class="s2">)</span>

    <span class="s1">def </span><span class="s0">test_datetime_like</span><span class="s2">(</span><span class="s0">self</span><span class="s2">):</span>
        <span class="s0">a </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">([</span><span class="s5">3</span><span class="s2">], </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'m8[4D]'</span><span class="s2">)</span>
        <span class="s0">b </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">([</span><span class="s4">'2012-12-21'</span><span class="s2">], </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'M8[D]'</span><span class="s2">)</span>

        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">ones_like</span><span class="s2">(</span><span class="s0">a</span><span class="s2">).</span><span class="s0">dtype</span><span class="s2">, </span><span class="s0">a</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">zeros_like</span><span class="s2">(</span><span class="s0">a</span><span class="s2">).</span><span class="s0">dtype</span><span class="s2">, </span><span class="s0">a</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">empty_like</span><span class="s2">(</span><span class="s0">a</span><span class="s2">).</span><span class="s0">dtype</span><span class="s2">, </span><span class="s0">a</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">ones_like</span><span class="s2">(</span><span class="s0">b</span><span class="s2">).</span><span class="s0">dtype</span><span class="s2">, </span><span class="s0">b</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">zeros_like</span><span class="s2">(</span><span class="s0">b</span><span class="s2">).</span><span class="s0">dtype</span><span class="s2">, </span><span class="s0">b</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">empty_like</span><span class="s2">(</span><span class="s0">b</span><span class="s2">).</span><span class="s0">dtype</span><span class="s2">, </span><span class="s0">b</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">)</span>

    <span class="s1">def </span><span class="s0">test_datetime_unary</span><span class="s2">(</span><span class="s0">self</span><span class="s2">):</span>
        <span class="s1">for </span><span class="s0">tda</span><span class="s2">, </span><span class="s0">tdb</span><span class="s2">, </span><span class="s0">tdzero</span><span class="s2">, </span><span class="s0">tdone</span><span class="s2">, </span><span class="s0">tdmone </span><span class="s1">in </span><span class="s0">\</span>
                <span class="s2">[</span>
                 <span class="s3"># One-dimensional arrays</span>
                 <span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">([</span><span class="s5">3</span><span class="s2">], </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'m8[D]'</span><span class="s2">),</span>
                  <span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">([-</span><span class="s5">3</span><span class="s2">], </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'m8[D]'</span><span class="s2">),</span>
                  <span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">([</span><span class="s5">0</span><span class="s2">], </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'m8[D]'</span><span class="s2">),</span>
                  <span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">([</span><span class="s5">1</span><span class="s2">], </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'m8[D]'</span><span class="s2">),</span>
                  <span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">([-</span><span class="s5">1</span><span class="s2">], </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'m8[D]'</span><span class="s2">)),</span>
                 <span class="s3"># NumPy scalars</span>
                 <span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s5">3</span><span class="s2">, </span><span class="s4">'[D]'</span><span class="s2">),</span>
                  <span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(-</span><span class="s5">3</span><span class="s2">, </span><span class="s4">'[D]'</span><span class="s2">),</span>
                  <span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s4">'[D]'</span><span class="s2">),</span>
                  <span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s5">1</span><span class="s2">, </span><span class="s4">'[D]'</span><span class="s2">),</span>
                  <span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(-</span><span class="s5">1</span><span class="s2">, </span><span class="s4">'[D]'</span><span class="s2">))]:</span>
            <span class="s3"># negative ufunc</span>
            <span class="s0">assert_equal</span><span class="s2">(-</span><span class="s0">tdb</span><span class="s2">, </span><span class="s0">tda</span><span class="s2">)</span>
            <span class="s0">assert_equal</span><span class="s2">((-</span><span class="s0">tdb</span><span class="s2">).</span><span class="s0">dtype</span><span class="s2">, </span><span class="s0">tda</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">)</span>
            <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">negative</span><span class="s2">(</span><span class="s0">tdb</span><span class="s2">), </span><span class="s0">tda</span><span class="s2">)</span>
            <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">negative</span><span class="s2">(</span><span class="s0">tdb</span><span class="s2">).</span><span class="s0">dtype</span><span class="s2">, </span><span class="s0">tda</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">)</span>

            <span class="s3"># positive ufunc</span>
            <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">positive</span><span class="s2">(</span><span class="s0">tda</span><span class="s2">), </span><span class="s0">tda</span><span class="s2">)</span>
            <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">positive</span><span class="s2">(</span><span class="s0">tda</span><span class="s2">).</span><span class="s0">dtype</span><span class="s2">, </span><span class="s0">tda</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">)</span>
            <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">positive</span><span class="s2">(</span><span class="s0">tdb</span><span class="s2">), </span><span class="s0">tdb</span><span class="s2">)</span>
            <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">positive</span><span class="s2">(</span><span class="s0">tdb</span><span class="s2">).</span><span class="s0">dtype</span><span class="s2">, </span><span class="s0">tdb</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">)</span>

            <span class="s3"># absolute ufunc</span>
            <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">absolute</span><span class="s2">(</span><span class="s0">tdb</span><span class="s2">), </span><span class="s0">tda</span><span class="s2">)</span>
            <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">absolute</span><span class="s2">(</span><span class="s0">tdb</span><span class="s2">).</span><span class="s0">dtype</span><span class="s2">, </span><span class="s0">tda</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">)</span>

            <span class="s3"># sign ufunc</span>
            <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">sign</span><span class="s2">(</span><span class="s0">tda</span><span class="s2">), </span><span class="s0">tdone</span><span class="s2">)</span>
            <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">sign</span><span class="s2">(</span><span class="s0">tdb</span><span class="s2">), </span><span class="s0">tdmone</span><span class="s2">)</span>
            <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">sign</span><span class="s2">(</span><span class="s0">tdzero</span><span class="s2">), </span><span class="s0">tdzero</span><span class="s2">)</span>
            <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">sign</span><span class="s2">(</span><span class="s0">tda</span><span class="s2">).</span><span class="s0">dtype</span><span class="s2">, </span><span class="s0">tda</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">)</span>

            <span class="s3"># The ufuncs always produce native-endian results</span>
            <span class="s0">assert_</span>

    <span class="s1">def </span><span class="s0">test_datetime_add</span><span class="s2">(</span><span class="s0">self</span><span class="s2">):</span>
        <span class="s1">for </span><span class="s0">dta</span><span class="s2">, </span><span class="s0">dtb</span><span class="s2">, </span><span class="s0">dtc</span><span class="s2">, </span><span class="s0">dtnat</span><span class="s2">, </span><span class="s0">tda</span><span class="s2">, </span><span class="s0">tdb</span><span class="s2">, </span><span class="s0">tdc </span><span class="s1">in </span><span class="s0">\</span>
                    <span class="s2">[</span>
                     <span class="s3"># One-dimensional arrays</span>
                     <span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">([</span><span class="s4">'2012-12-21'</span><span class="s2">], </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'M8[D]'</span><span class="s2">),</span>
                      <span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">([</span><span class="s4">'2012-12-24'</span><span class="s2">], </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'M8[D]'</span><span class="s2">),</span>
                      <span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">([</span><span class="s4">'2012-12-21T11'</span><span class="s2">], </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'M8[h]'</span><span class="s2">),</span>
                      <span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">([</span><span class="s4">'NaT'</span><span class="s2">], </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'M8[D]'</span><span class="s2">),</span>
                      <span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">([</span><span class="s5">3</span><span class="s2">], </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'m8[D]'</span><span class="s2">),</span>
                      <span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">([</span><span class="s5">11</span><span class="s2">], </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'m8[h]'</span><span class="s2">),</span>
                      <span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">([</span><span class="s5">3</span><span class="s2">*</span><span class="s5">24 </span><span class="s2">+ </span><span class="s5">11</span><span class="s2">], </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'m8[h]'</span><span class="s2">)),</span>
                     <span class="s3"># NumPy scalars</span>
                     <span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'2012-12-21'</span><span class="s2">, </span><span class="s4">'[D]'</span><span class="s2">),</span>
                      <span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'2012-12-24'</span><span class="s2">, </span><span class="s4">'[D]'</span><span class="s2">),</span>
                      <span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'2012-12-21T11'</span><span class="s2">, </span><span class="s4">'[h]'</span><span class="s2">),</span>
                      <span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'NaT'</span><span class="s2">, </span><span class="s4">'[D]'</span><span class="s2">),</span>
                      <span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s5">3</span><span class="s2">, </span><span class="s4">'[D]'</span><span class="s2">),</span>
                      <span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s5">11</span><span class="s2">, </span><span class="s4">'[h]'</span><span class="s2">),</span>
                      <span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s5">3</span><span class="s2">*</span><span class="s5">24 </span><span class="s2">+ </span><span class="s5">11</span><span class="s2">, </span><span class="s4">'[h]'</span><span class="s2">))]:</span>
            <span class="s3"># m8 + m8</span>
            <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">tda </span><span class="s2">+ </span><span class="s0">tdb</span><span class="s2">, </span><span class="s0">tdc</span><span class="s2">)</span>
            <span class="s0">assert_equal</span><span class="s2">((</span><span class="s0">tda </span><span class="s2">+ </span><span class="s0">tdb</span><span class="s2">).</span><span class="s0">dtype</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'m8[h]'</span><span class="s2">))</span>
            <span class="s3"># m8 + bool</span>
            <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">tdb </span><span class="s2">+ </span><span class="s1">True</span><span class="s2">, </span><span class="s0">tdb </span><span class="s2">+ </span><span class="s5">1</span><span class="s2">)</span>
            <span class="s0">assert_equal</span><span class="s2">((</span><span class="s0">tdb </span><span class="s2">+ </span><span class="s1">True</span><span class="s2">).</span><span class="s0">dtype</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'m8[h]'</span><span class="s2">))</span>
            <span class="s3"># m8 + int</span>
            <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">tdb </span><span class="s2">+ </span><span class="s5">3</span><span class="s2">*</span><span class="s5">24</span><span class="s2">, </span><span class="s0">tdc</span><span class="s2">)</span>
            <span class="s0">assert_equal</span><span class="s2">((</span><span class="s0">tdb </span><span class="s2">+ </span><span class="s5">3</span><span class="s2">*</span><span class="s5">24</span><span class="s2">).</span><span class="s0">dtype</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'m8[h]'</span><span class="s2">))</span>
            <span class="s3"># bool + m8</span>
            <span class="s0">assert_equal</span><span class="s2">(</span><span class="s1">False </span><span class="s2">+ </span><span class="s0">tdb</span><span class="s2">, </span><span class="s0">tdb</span><span class="s2">)</span>
            <span class="s0">assert_equal</span><span class="s2">((</span><span class="s1">False </span><span class="s2">+ </span><span class="s0">tdb</span><span class="s2">).</span><span class="s0">dtype</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'m8[h]'</span><span class="s2">))</span>
            <span class="s3"># int + m8</span>
            <span class="s0">assert_equal</span><span class="s2">(</span><span class="s5">3</span><span class="s2">*</span><span class="s5">24 </span><span class="s2">+ </span><span class="s0">tdb</span><span class="s2">, </span><span class="s0">tdc</span><span class="s2">)</span>
            <span class="s0">assert_equal</span><span class="s2">((</span><span class="s5">3</span><span class="s2">*</span><span class="s5">24 </span><span class="s2">+ </span><span class="s0">tdb</span><span class="s2">).</span><span class="s0">dtype</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'m8[h]'</span><span class="s2">))</span>
            <span class="s3"># M8 + bool</span>
            <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">dta </span><span class="s2">+ </span><span class="s1">True</span><span class="s2">, </span><span class="s0">dta </span><span class="s2">+ </span><span class="s5">1</span><span class="s2">)</span>
            <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">dtnat </span><span class="s2">+ </span><span class="s1">True</span><span class="s2">, </span><span class="s0">dtnat</span><span class="s2">)</span>
            <span class="s0">assert_equal</span><span class="s2">((</span><span class="s0">dta </span><span class="s2">+ </span><span class="s1">True</span><span class="s2">).</span><span class="s0">dtype</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[D]'</span><span class="s2">))</span>
            <span class="s3"># M8 + int</span>
            <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">dta </span><span class="s2">+ </span><span class="s5">3</span><span class="s2">, </span><span class="s0">dtb</span><span class="s2">)</span>
            <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">dtnat </span><span class="s2">+ </span><span class="s5">3</span><span class="s2">, </span><span class="s0">dtnat</span><span class="s2">)</span>
            <span class="s0">assert_equal</span><span class="s2">((</span><span class="s0">dta </span><span class="s2">+ </span><span class="s5">3</span><span class="s2">).</span><span class="s0">dtype</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[D]'</span><span class="s2">))</span>
            <span class="s3"># bool + M8</span>
            <span class="s0">assert_equal</span><span class="s2">(</span><span class="s1">False </span><span class="s2">+ </span><span class="s0">dta</span><span class="s2">, </span><span class="s0">dta</span><span class="s2">)</span>
            <span class="s0">assert_equal</span><span class="s2">(</span><span class="s1">False </span><span class="s2">+ </span><span class="s0">dtnat</span><span class="s2">, </span><span class="s0">dtnat</span><span class="s2">)</span>
            <span class="s0">assert_equal</span><span class="s2">((</span><span class="s1">False </span><span class="s2">+ </span><span class="s0">dta</span><span class="s2">).</span><span class="s0">dtype</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[D]'</span><span class="s2">))</span>
            <span class="s3"># int + M8</span>
            <span class="s0">assert_equal</span><span class="s2">(</span><span class="s5">3 </span><span class="s2">+ </span><span class="s0">dta</span><span class="s2">, </span><span class="s0">dtb</span><span class="s2">)</span>
            <span class="s0">assert_equal</span><span class="s2">(</span><span class="s5">3 </span><span class="s2">+ </span><span class="s0">dtnat</span><span class="s2">, </span><span class="s0">dtnat</span><span class="s2">)</span>
            <span class="s0">assert_equal</span><span class="s2">((</span><span class="s5">3 </span><span class="s2">+ </span><span class="s0">dta</span><span class="s2">).</span><span class="s0">dtype</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[D]'</span><span class="s2">))</span>
            <span class="s3"># M8 + m8</span>
            <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">dta </span><span class="s2">+ </span><span class="s0">tda</span><span class="s2">, </span><span class="s0">dtb</span><span class="s2">)</span>
            <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">dtnat </span><span class="s2">+ </span><span class="s0">tda</span><span class="s2">, </span><span class="s0">dtnat</span><span class="s2">)</span>
            <span class="s0">assert_equal</span><span class="s2">((</span><span class="s0">dta </span><span class="s2">+ </span><span class="s0">tda</span><span class="s2">).</span><span class="s0">dtype</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[D]'</span><span class="s2">))</span>
            <span class="s3"># m8 + M8</span>
            <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">tda </span><span class="s2">+ </span><span class="s0">dta</span><span class="s2">, </span><span class="s0">dtb</span><span class="s2">)</span>
            <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">tda </span><span class="s2">+ </span><span class="s0">dtnat</span><span class="s2">, </span><span class="s0">dtnat</span><span class="s2">)</span>
            <span class="s0">assert_equal</span><span class="s2">((</span><span class="s0">tda </span><span class="s2">+ </span><span class="s0">dta</span><span class="s2">).</span><span class="s0">dtype</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[D]'</span><span class="s2">))</span>

            <span class="s3"># In M8 + m8, the result goes to higher precision</span>
            <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">add</span><span class="s2">(</span><span class="s0">dta</span><span class="s2">, </span><span class="s0">tdb</span><span class="s2">, </span><span class="s0">casting</span><span class="s2">=</span><span class="s4">'unsafe'</span><span class="s2">), </span><span class="s0">dtc</span><span class="s2">)</span>
            <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">add</span><span class="s2">(</span><span class="s0">dta</span><span class="s2">, </span><span class="s0">tdb</span><span class="s2">, </span><span class="s0">casting</span><span class="s2">=</span><span class="s4">'unsafe'</span><span class="s2">).</span><span class="s0">dtype</span><span class="s2">,</span>
                         <span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[h]'</span><span class="s2">))</span>
            <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">add</span><span class="s2">(</span><span class="s0">tdb</span><span class="s2">, </span><span class="s0">dta</span><span class="s2">, </span><span class="s0">casting</span><span class="s2">=</span><span class="s4">'unsafe'</span><span class="s2">), </span><span class="s0">dtc</span><span class="s2">)</span>
            <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">add</span><span class="s2">(</span><span class="s0">tdb</span><span class="s2">, </span><span class="s0">dta</span><span class="s2">, </span><span class="s0">casting</span><span class="s2">=</span><span class="s4">'unsafe'</span><span class="s2">).</span><span class="s0">dtype</span><span class="s2">,</span>
                         <span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[h]'</span><span class="s2">))</span>

            <span class="s3"># M8 + M8</span>
            <span class="s0">assert_raises</span><span class="s2">(</span><span class="s0">TypeError</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">add</span><span class="s2">, </span><span class="s0">dta</span><span class="s2">, </span><span class="s0">dtb</span><span class="s2">)</span>

    <span class="s1">def </span><span class="s0">test_datetime_subtract</span><span class="s2">(</span><span class="s0">self</span><span class="s2">):</span>
        <span class="s1">for </span><span class="s0">dta</span><span class="s2">, </span><span class="s0">dtb</span><span class="s2">, </span><span class="s0">dtc</span><span class="s2">, </span><span class="s0">dtd</span><span class="s2">, </span><span class="s0">dte</span><span class="s2">, </span><span class="s0">dtnat</span><span class="s2">, </span><span class="s0">tda</span><span class="s2">, </span><span class="s0">tdb</span><span class="s2">, </span><span class="s0">tdc </span><span class="s1">in </span><span class="s0">\</span>
                    <span class="s2">[</span>
                     <span class="s3"># One-dimensional arrays</span>
                     <span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">([</span><span class="s4">'2012-12-21'</span><span class="s2">], </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'M8[D]'</span><span class="s2">),</span>
                      <span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">([</span><span class="s4">'2012-12-24'</span><span class="s2">], </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'M8[D]'</span><span class="s2">),</span>
                      <span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">([</span><span class="s4">'1940-12-24'</span><span class="s2">], </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'M8[D]'</span><span class="s2">),</span>
                      <span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">([</span><span class="s4">'1940-12-24T00'</span><span class="s2">], </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'M8[h]'</span><span class="s2">),</span>
                      <span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">([</span><span class="s4">'1940-12-23T13'</span><span class="s2">], </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'M8[h]'</span><span class="s2">),</span>
                      <span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">([</span><span class="s4">'NaT'</span><span class="s2">], </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'M8[D]'</span><span class="s2">),</span>
                      <span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">([</span><span class="s5">3</span><span class="s2">], </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'m8[D]'</span><span class="s2">),</span>
                      <span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">([</span><span class="s5">11</span><span class="s2">], </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'m8[h]'</span><span class="s2">),</span>
                      <span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">([</span><span class="s5">3</span><span class="s2">*</span><span class="s5">24 </span><span class="s2">- </span><span class="s5">11</span><span class="s2">], </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'m8[h]'</span><span class="s2">)),</span>
                     <span class="s3"># NumPy scalars</span>
                     <span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'2012-12-21'</span><span class="s2">, </span><span class="s4">'[D]'</span><span class="s2">),</span>
                      <span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'2012-12-24'</span><span class="s2">, </span><span class="s4">'[D]'</span><span class="s2">),</span>
                      <span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'1940-12-24'</span><span class="s2">, </span><span class="s4">'[D]'</span><span class="s2">),</span>
                      <span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'1940-12-24T00'</span><span class="s2">, </span><span class="s4">'[h]'</span><span class="s2">),</span>
                      <span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'1940-12-23T13'</span><span class="s2">, </span><span class="s4">'[h]'</span><span class="s2">),</span>
                      <span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'NaT'</span><span class="s2">, </span><span class="s4">'[D]'</span><span class="s2">),</span>
                      <span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s5">3</span><span class="s2">, </span><span class="s4">'[D]'</span><span class="s2">),</span>
                      <span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s5">11</span><span class="s2">, </span><span class="s4">'[h]'</span><span class="s2">),</span>
                      <span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s5">3</span><span class="s2">*</span><span class="s5">24 </span><span class="s2">- </span><span class="s5">11</span><span class="s2">, </span><span class="s4">'[h]'</span><span class="s2">))]:</span>
            <span class="s3"># m8 - m8</span>
            <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">tda </span><span class="s2">- </span><span class="s0">tdb</span><span class="s2">, </span><span class="s0">tdc</span><span class="s2">)</span>
            <span class="s0">assert_equal</span><span class="s2">((</span><span class="s0">tda </span><span class="s2">- </span><span class="s0">tdb</span><span class="s2">).</span><span class="s0">dtype</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'m8[h]'</span><span class="s2">))</span>
            <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">tdb </span><span class="s2">- </span><span class="s0">tda</span><span class="s2">, -</span><span class="s0">tdc</span><span class="s2">)</span>
            <span class="s0">assert_equal</span><span class="s2">((</span><span class="s0">tdb </span><span class="s2">- </span><span class="s0">tda</span><span class="s2">).</span><span class="s0">dtype</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'m8[h]'</span><span class="s2">))</span>
            <span class="s3"># m8 - bool</span>
            <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">tdc </span><span class="s2">- </span><span class="s1">True</span><span class="s2">, </span><span class="s0">tdc </span><span class="s2">- </span><span class="s5">1</span><span class="s2">)</span>
            <span class="s0">assert_equal</span><span class="s2">((</span><span class="s0">tdc </span><span class="s2">- </span><span class="s1">True</span><span class="s2">).</span><span class="s0">dtype</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'m8[h]'</span><span class="s2">))</span>
            <span class="s3"># m8 - int</span>
            <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">tdc </span><span class="s2">- </span><span class="s5">3</span><span class="s2">*</span><span class="s5">24</span><span class="s2">, -</span><span class="s0">tdb</span><span class="s2">)</span>
            <span class="s0">assert_equal</span><span class="s2">((</span><span class="s0">tdc </span><span class="s2">- </span><span class="s5">3</span><span class="s2">*</span><span class="s5">24</span><span class="s2">).</span><span class="s0">dtype</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'m8[h]'</span><span class="s2">))</span>
            <span class="s3"># int - m8</span>
            <span class="s0">assert_equal</span><span class="s2">(</span><span class="s1">False </span><span class="s2">- </span><span class="s0">tdb</span><span class="s2">, -</span><span class="s0">tdb</span><span class="s2">)</span>
            <span class="s0">assert_equal</span><span class="s2">((</span><span class="s1">False </span><span class="s2">- </span><span class="s0">tdb</span><span class="s2">).</span><span class="s0">dtype</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'m8[h]'</span><span class="s2">))</span>
            <span class="s3"># int - m8</span>
            <span class="s0">assert_equal</span><span class="s2">(</span><span class="s5">3</span><span class="s2">*</span><span class="s5">24 </span><span class="s2">- </span><span class="s0">tdb</span><span class="s2">, </span><span class="s0">tdc</span><span class="s2">)</span>
            <span class="s0">assert_equal</span><span class="s2">((</span><span class="s5">3</span><span class="s2">*</span><span class="s5">24 </span><span class="s2">- </span><span class="s0">tdb</span><span class="s2">).</span><span class="s0">dtype</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'m8[h]'</span><span class="s2">))</span>
            <span class="s3"># M8 - bool</span>
            <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">dtb </span><span class="s2">- </span><span class="s1">True</span><span class="s2">, </span><span class="s0">dtb </span><span class="s2">- </span><span class="s5">1</span><span class="s2">)</span>
            <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">dtnat </span><span class="s2">- </span><span class="s1">True</span><span class="s2">, </span><span class="s0">dtnat</span><span class="s2">)</span>
            <span class="s0">assert_equal</span><span class="s2">((</span><span class="s0">dtb </span><span class="s2">- </span><span class="s1">True</span><span class="s2">).</span><span class="s0">dtype</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[D]'</span><span class="s2">))</span>
            <span class="s3"># M8 - int</span>
            <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">dtb </span><span class="s2">- </span><span class="s5">3</span><span class="s2">, </span><span class="s0">dta</span><span class="s2">)</span>
            <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">dtnat </span><span class="s2">- </span><span class="s5">3</span><span class="s2">, </span><span class="s0">dtnat</span><span class="s2">)</span>
            <span class="s0">assert_equal</span><span class="s2">((</span><span class="s0">dtb </span><span class="s2">- </span><span class="s5">3</span><span class="s2">).</span><span class="s0">dtype</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[D]'</span><span class="s2">))</span>
            <span class="s3"># M8 - m8</span>
            <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">dtb </span><span class="s2">- </span><span class="s0">tda</span><span class="s2">, </span><span class="s0">dta</span><span class="s2">)</span>
            <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">dtnat </span><span class="s2">- </span><span class="s0">tda</span><span class="s2">, </span><span class="s0">dtnat</span><span class="s2">)</span>
            <span class="s0">assert_equal</span><span class="s2">((</span><span class="s0">dtb </span><span class="s2">- </span><span class="s0">tda</span><span class="s2">).</span><span class="s0">dtype</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[D]'</span><span class="s2">))</span>

            <span class="s3"># In M8 - m8, the result goes to higher precision</span>
            <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">subtract</span><span class="s2">(</span><span class="s0">dtc</span><span class="s2">, </span><span class="s0">tdb</span><span class="s2">, </span><span class="s0">casting</span><span class="s2">=</span><span class="s4">'unsafe'</span><span class="s2">), </span><span class="s0">dte</span><span class="s2">)</span>
            <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">subtract</span><span class="s2">(</span><span class="s0">dtc</span><span class="s2">, </span><span class="s0">tdb</span><span class="s2">, </span><span class="s0">casting</span><span class="s2">=</span><span class="s4">'unsafe'</span><span class="s2">).</span><span class="s0">dtype</span><span class="s2">,</span>
                         <span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[h]'</span><span class="s2">))</span>

            <span class="s3"># M8 - M8 with different goes to higher precision</span>
            <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">subtract</span><span class="s2">(</span><span class="s0">dtc</span><span class="s2">, </span><span class="s0">dtd</span><span class="s2">, </span><span class="s0">casting</span><span class="s2">=</span><span class="s4">'unsafe'</span><span class="s2">),</span>
                         <span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s4">'h'</span><span class="s2">))</span>
            <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">subtract</span><span class="s2">(</span><span class="s0">dtc</span><span class="s2">, </span><span class="s0">dtd</span><span class="s2">, </span><span class="s0">casting</span><span class="s2">=</span><span class="s4">'unsafe'</span><span class="s2">).</span><span class="s0">dtype</span><span class="s2">,</span>
                         <span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'m8[h]'</span><span class="s2">))</span>
            <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">subtract</span><span class="s2">(</span><span class="s0">dtd</span><span class="s2">, </span><span class="s0">dtc</span><span class="s2">, </span><span class="s0">casting</span><span class="s2">=</span><span class="s4">'unsafe'</span><span class="s2">),</span>
                         <span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s4">'h'</span><span class="s2">))</span>
            <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">subtract</span><span class="s2">(</span><span class="s0">dtd</span><span class="s2">, </span><span class="s0">dtc</span><span class="s2">, </span><span class="s0">casting</span><span class="s2">=</span><span class="s4">'unsafe'</span><span class="s2">).</span><span class="s0">dtype</span><span class="s2">,</span>
                         <span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'m8[h]'</span><span class="s2">))</span>

            <span class="s3"># m8 - M8</span>
            <span class="s0">assert_raises</span><span class="s2">(</span><span class="s0">TypeError</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">subtract</span><span class="s2">, </span><span class="s0">tda</span><span class="s2">, </span><span class="s0">dta</span><span class="s2">)</span>
            <span class="s3"># bool - M8</span>
            <span class="s0">assert_raises</span><span class="s2">(</span><span class="s0">TypeError</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">subtract</span><span class="s2">, </span><span class="s1">False</span><span class="s2">, </span><span class="s0">dta</span><span class="s2">)</span>
            <span class="s3"># int - M8</span>
            <span class="s0">assert_raises</span><span class="s2">(</span><span class="s0">TypeError</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">subtract</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s0">dta</span><span class="s2">)</span>

    <span class="s1">def </span><span class="s0">test_datetime_multiply</span><span class="s2">(</span><span class="s0">self</span><span class="s2">):</span>
        <span class="s1">for </span><span class="s0">dta</span><span class="s2">, </span><span class="s0">tda</span><span class="s2">, </span><span class="s0">tdb</span><span class="s2">, </span><span class="s0">tdc </span><span class="s1">in </span><span class="s0">\</span>
                    <span class="s2">[</span>
                     <span class="s3"># One-dimensional arrays</span>
                     <span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">([</span><span class="s4">'2012-12-21'</span><span class="s2">], </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'M8[D]'</span><span class="s2">),</span>
                      <span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">([</span><span class="s5">6</span><span class="s2">], </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'m8[h]'</span><span class="s2">),</span>
                      <span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">([</span><span class="s5">9</span><span class="s2">], </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'m8[h]'</span><span class="s2">),</span>
                      <span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">([</span><span class="s5">12</span><span class="s2">], </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'m8[h]'</span><span class="s2">)),</span>
                     <span class="s3"># NumPy scalars</span>
                     <span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'2012-12-21'</span><span class="s2">, </span><span class="s4">'[D]'</span><span class="s2">),</span>
                      <span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s5">6</span><span class="s2">, </span><span class="s4">'[h]'</span><span class="s2">),</span>
                      <span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s5">9</span><span class="s2">, </span><span class="s4">'[h]'</span><span class="s2">),</span>
                      <span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s5">12</span><span class="s2">, </span><span class="s4">'[h]'</span><span class="s2">))]:</span>
            <span class="s3"># m8 * int</span>
            <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">tda </span><span class="s2">* </span><span class="s5">2</span><span class="s2">, </span><span class="s0">tdc</span><span class="s2">)</span>
            <span class="s0">assert_equal</span><span class="s2">((</span><span class="s0">tda </span><span class="s2">* </span><span class="s5">2</span><span class="s2">).</span><span class="s0">dtype</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'m8[h]'</span><span class="s2">))</span>
            <span class="s3"># int * m8</span>
            <span class="s0">assert_equal</span><span class="s2">(</span><span class="s5">2 </span><span class="s2">* </span><span class="s0">tda</span><span class="s2">, </span><span class="s0">tdc</span><span class="s2">)</span>
            <span class="s0">assert_equal</span><span class="s2">((</span><span class="s5">2 </span><span class="s2">* </span><span class="s0">tda</span><span class="s2">).</span><span class="s0">dtype</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'m8[h]'</span><span class="s2">))</span>
            <span class="s3"># m8 * float</span>
            <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">tda </span><span class="s2">* </span><span class="s5">1.5</span><span class="s2">, </span><span class="s0">tdb</span><span class="s2">)</span>
            <span class="s0">assert_equal</span><span class="s2">((</span><span class="s0">tda </span><span class="s2">* </span><span class="s5">1.5</span><span class="s2">).</span><span class="s0">dtype</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'m8[h]'</span><span class="s2">))</span>
            <span class="s3"># float * m8</span>
            <span class="s0">assert_equal</span><span class="s2">(</span><span class="s5">1.5 </span><span class="s2">* </span><span class="s0">tda</span><span class="s2">, </span><span class="s0">tdb</span><span class="s2">)</span>
            <span class="s0">assert_equal</span><span class="s2">((</span><span class="s5">1.5 </span><span class="s2">* </span><span class="s0">tda</span><span class="s2">).</span><span class="s0">dtype</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'m8[h]'</span><span class="s2">))</span>

            <span class="s3"># m8 * m8</span>
            <span class="s0">assert_raises</span><span class="s2">(</span><span class="s0">TypeError</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">multiply</span><span class="s2">, </span><span class="s0">tda</span><span class="s2">, </span><span class="s0">tdb</span><span class="s2">)</span>
            <span class="s3"># m8 * M8</span>
            <span class="s0">assert_raises</span><span class="s2">(</span><span class="s0">TypeError</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">multiply</span><span class="s2">, </span><span class="s0">dta</span><span class="s2">, </span><span class="s0">tda</span><span class="s2">)</span>
            <span class="s3"># M8 * m8</span>
            <span class="s0">assert_raises</span><span class="s2">(</span><span class="s0">TypeError</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">multiply</span><span class="s2">, </span><span class="s0">tda</span><span class="s2">, </span><span class="s0">dta</span><span class="s2">)</span>
            <span class="s3"># M8 * int</span>
            <span class="s0">assert_raises</span><span class="s2">(</span><span class="s0">TypeError</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">multiply</span><span class="s2">, </span><span class="s0">dta</span><span class="s2">, </span><span class="s5">2</span><span class="s2">)</span>
            <span class="s3"># int * M8</span>
            <span class="s0">assert_raises</span><span class="s2">(</span><span class="s0">TypeError</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">multiply</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s0">dta</span><span class="s2">)</span>
            <span class="s3"># M8 * float</span>
            <span class="s0">assert_raises</span><span class="s2">(</span><span class="s0">TypeError</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">multiply</span><span class="s2">, </span><span class="s0">dta</span><span class="s2">, </span><span class="s5">1.5</span><span class="s2">)</span>
            <span class="s3"># float * M8</span>
            <span class="s0">assert_raises</span><span class="s2">(</span><span class="s0">TypeError</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">multiply</span><span class="s2">, </span><span class="s5">1.5</span><span class="s2">, </span><span class="s0">dta</span><span class="s2">)</span>

        <span class="s3"># NaTs</span>
        <span class="s1">with </span><span class="s0">suppress_warnings</span><span class="s2">() </span><span class="s1">as </span><span class="s0">sup</span><span class="s2">:</span>
            <span class="s0">sup</span><span class="s2">.</span><span class="s0">filter</span><span class="s2">(</span><span class="s0">RuntimeWarning</span><span class="s2">, </span><span class="s4">&quot;invalid value encountered in multiply&quot;</span><span class="s2">)</span>
            <span class="s0">nat </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s4">'NaT'</span><span class="s2">)</span>
            <span class="s1">def </span><span class="s0">check</span><span class="s2">(</span><span class="s0">a</span><span class="s2">, </span><span class="s0">b</span><span class="s2">, </span><span class="s0">res</span><span class="s2">):</span>
                <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">a </span><span class="s2">* </span><span class="s0">b</span><span class="s2">, </span><span class="s0">res</span><span class="s2">)</span>
                <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">b </span><span class="s2">* </span><span class="s0">a</span><span class="s2">, </span><span class="s0">res</span><span class="s2">)</span>
            <span class="s1">for </span><span class="s0">tp </span><span class="s1">in </span><span class="s2">(</span><span class="s0">int</span><span class="s2">, </span><span class="s0">float</span><span class="s2">):</span>
                <span class="s0">check</span><span class="s2">(</span><span class="s0">nat</span><span class="s2">, </span><span class="s0">tp</span><span class="s2">(</span><span class="s5">2</span><span class="s2">), </span><span class="s0">nat</span><span class="s2">)</span>
                <span class="s0">check</span><span class="s2">(</span><span class="s0">nat</span><span class="s2">, </span><span class="s0">tp</span><span class="s2">(</span><span class="s5">0</span><span class="s2">), </span><span class="s0">nat</span><span class="s2">)</span>
            <span class="s1">for </span><span class="s0">f </span><span class="s1">in </span><span class="s2">(</span><span class="s0">float</span><span class="s2">(</span><span class="s4">'inf'</span><span class="s2">), </span><span class="s0">float</span><span class="s2">(</span><span class="s4">'nan'</span><span class="s2">)):</span>
                <span class="s0">check</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s5">1</span><span class="s2">), </span><span class="s0">f</span><span class="s2">, </span><span class="s0">nat</span><span class="s2">)</span>
                <span class="s0">check</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s5">0</span><span class="s2">), </span><span class="s0">f</span><span class="s2">, </span><span class="s0">nat</span><span class="s2">)</span>
                <span class="s0">check</span><span class="s2">(</span><span class="s0">nat</span><span class="s2">, </span><span class="s0">f</span><span class="s2">, </span><span class="s0">nat</span><span class="s2">)</span>

    <span class="s2">@</span><span class="s0">pytest</span><span class="s2">.</span><span class="s0">mark</span><span class="s2">.</span><span class="s0">parametrize</span><span class="s2">(</span><span class="s4">&quot;op1, op2, exp&quot;</span><span class="s2">, [</span>
        <span class="s3"># m8 same units round down</span>
        <span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s5">7</span><span class="s2">, </span><span class="s4">'s'</span><span class="s2">),</span>
         <span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s5">4</span><span class="s2">, </span><span class="s4">'s'</span><span class="s2">),</span>
         <span class="s5">1</span><span class="s2">),</span>
        <span class="s3"># m8 same units round down with negative</span>
        <span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s5">7</span><span class="s2">, </span><span class="s4">'s'</span><span class="s2">),</span>
         <span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(-</span><span class="s5">4</span><span class="s2">, </span><span class="s4">'s'</span><span class="s2">),</span>
         <span class="s2">-</span><span class="s5">2</span><span class="s2">),</span>
        <span class="s3"># m8 same units negative no round down</span>
        <span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s5">8</span><span class="s2">, </span><span class="s4">'s'</span><span class="s2">),</span>
         <span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(-</span><span class="s5">4</span><span class="s2">, </span><span class="s4">'s'</span><span class="s2">),</span>
         <span class="s2">-</span><span class="s5">2</span><span class="s2">),</span>
        <span class="s3"># m8 different units</span>
        <span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s5">1</span><span class="s2">, </span><span class="s4">'m'</span><span class="s2">),</span>
         <span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s5">31</span><span class="s2">, </span><span class="s4">'s'</span><span class="s2">),</span>
         <span class="s5">1</span><span class="s2">),</span>
        <span class="s3"># m8 generic units</span>
        <span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s5">1890</span><span class="s2">),</span>
         <span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s5">31</span><span class="s2">),</span>
         <span class="s5">60</span><span class="s2">),</span>
        <span class="s3"># Y // M works</span>
        <span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s5">2</span><span class="s2">, </span><span class="s4">'Y'</span><span class="s2">),</span>
         <span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s4">'13'</span><span class="s2">, </span><span class="s4">'M'</span><span class="s2">),</span>
         <span class="s5">1</span><span class="s2">),</span>
        <span class="s3"># handle 1D arrays</span>
        <span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">([</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">], </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'m8'</span><span class="s2">),</span>
         <span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">([</span><span class="s5">2</span><span class="s2">], </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'m8'</span><span class="s2">),</span>
         <span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">([</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">], </span><span class="s0">dtype</span><span class="s2">=</span><span class="s0">np</span><span class="s2">.</span><span class="s0">int64</span><span class="s2">)),</span>
        <span class="s2">])</span>
    <span class="s1">def </span><span class="s0">test_timedelta_floor_divide</span><span class="s2">(</span><span class="s0">self</span><span class="s2">, </span><span class="s0">op1</span><span class="s2">, </span><span class="s0">op2</span><span class="s2">, </span><span class="s0">exp</span><span class="s2">):</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">op1 </span><span class="s2">// </span><span class="s0">op2</span><span class="s2">, </span><span class="s0">exp</span><span class="s2">)</span>

    <span class="s2">@</span><span class="s0">pytest</span><span class="s2">.</span><span class="s0">mark</span><span class="s2">.</span><span class="s0">skipif</span><span class="s2">(</span><span class="s0">IS_WASM</span><span class="s2">, </span><span class="s0">reason</span><span class="s2">=</span><span class="s4">&quot;fp errors don't work in wasm&quot;</span><span class="s2">)</span>
    <span class="s2">@</span><span class="s0">pytest</span><span class="s2">.</span><span class="s0">mark</span><span class="s2">.</span><span class="s0">parametrize</span><span class="s2">(</span><span class="s4">&quot;op1, op2&quot;</span><span class="s2">, [</span>
        <span class="s3"># div by 0</span>
        <span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s5">10</span><span class="s2">, </span><span class="s4">'us'</span><span class="s2">),</span>
         <span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s4">'us'</span><span class="s2">)),</span>
        <span class="s3"># div with NaT</span>
        <span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s4">'NaT'</span><span class="s2">),</span>
         <span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s5">50</span><span class="s2">, </span><span class="s4">'us'</span><span class="s2">)),</span>
        <span class="s3"># special case for int64 min</span>
        <span class="s3"># in integer floor division</span>
        <span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">iinfo</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">int64</span><span class="s2">).</span><span class="s0">min</span><span class="s2">),</span>
         <span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(-</span><span class="s5">1</span><span class="s2">)),</span>
        <span class="s2">])</span>
    <span class="s1">def </span><span class="s0">test_timedelta_floor_div_warnings</span><span class="s2">(</span><span class="s0">self</span><span class="s2">, </span><span class="s0">op1</span><span class="s2">, </span><span class="s0">op2</span><span class="s2">):</span>
        <span class="s1">with </span><span class="s0">assert_warns</span><span class="s2">(</span><span class="s0">RuntimeWarning</span><span class="s2">):</span>
            <span class="s0">actual </span><span class="s2">= </span><span class="s0">op1 </span><span class="s2">// </span><span class="s0">op2</span>
            <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">actual</span><span class="s2">, </span><span class="s5">0</span><span class="s2">)</span>
            <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">actual</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">int64</span><span class="s2">)</span>

    <span class="s2">@</span><span class="s0">pytest</span><span class="s2">.</span><span class="s0">mark</span><span class="s2">.</span><span class="s0">parametrize</span><span class="s2">(</span><span class="s4">&quot;val1, val2&quot;</span><span class="s2">, [</span>
        <span class="s3"># the smallest integer that can't be represented</span>
        <span class="s3"># exactly in a double should be preserved if we avoid</span>
        <span class="s3"># casting to double in floordiv operation</span>
        <span class="s2">(</span><span class="s5">9007199254740993</span><span class="s2">, </span><span class="s5">1</span><span class="s2">),</span>
        <span class="s3"># stress the alternate floordiv code path where</span>
        <span class="s3"># operand signs don't match and remainder isn't 0</span>
        <span class="s2">(</span><span class="s5">9007199254740999</span><span class="s2">, -</span><span class="s5">2</span><span class="s2">),</span>
        <span class="s2">])</span>
    <span class="s1">def </span><span class="s0">test_timedelta_floor_div_precision</span><span class="s2">(</span><span class="s0">self</span><span class="s2">, </span><span class="s0">val1</span><span class="s2">, </span><span class="s0">val2</span><span class="s2">):</span>
        <span class="s0">op1 </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s0">val1</span><span class="s2">)</span>
        <span class="s0">op2 </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s0">val2</span><span class="s2">)</span>
        <span class="s0">actual </span><span class="s2">= </span><span class="s0">op1 </span><span class="s2">// </span><span class="s0">op2</span>
        <span class="s3"># Python reference integer floor</span>
        <span class="s0">expected </span><span class="s2">= </span><span class="s0">val1 </span><span class="s2">// </span><span class="s0">val2</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">actual</span><span class="s2">, </span><span class="s0">expected</span><span class="s2">)</span>

    <span class="s2">@</span><span class="s0">pytest</span><span class="s2">.</span><span class="s0">mark</span><span class="s2">.</span><span class="s0">parametrize</span><span class="s2">(</span><span class="s4">&quot;val1, val2&quot;</span><span class="s2">, [</span>
        <span class="s3"># years and months sometimes can't be unambiguously</span>
        <span class="s3"># divided for floor division operation</span>
        <span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s5">7</span><span class="s2">, </span><span class="s4">'Y'</span><span class="s2">),</span>
         <span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s5">3</span><span class="s2">, </span><span class="s4">'s'</span><span class="s2">)),</span>
        <span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s5">7</span><span class="s2">, </span><span class="s4">'M'</span><span class="s2">),</span>
         <span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s5">1</span><span class="s2">, </span><span class="s4">'D'</span><span class="s2">)),</span>
        <span class="s2">])</span>
    <span class="s1">def </span><span class="s0">test_timedelta_floor_div_error</span><span class="s2">(</span><span class="s0">self</span><span class="s2">, </span><span class="s0">val1</span><span class="s2">, </span><span class="s0">val2</span><span class="s2">):</span>
        <span class="s1">with </span><span class="s0">assert_raises_regex</span><span class="s2">(</span><span class="s0">TypeError</span><span class="s2">, </span><span class="s4">&quot;common metadata divisor&quot;</span><span class="s2">):</span>
            <span class="s0">val1 </span><span class="s2">// </span><span class="s0">val2</span>

    <span class="s2">@</span><span class="s0">pytest</span><span class="s2">.</span><span class="s0">mark</span><span class="s2">.</span><span class="s0">parametrize</span><span class="s2">(</span><span class="s4">&quot;op1, op2&quot;</span><span class="s2">, [</span>
        <span class="s3"># reuse the test cases from floordiv</span>
        <span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s5">7</span><span class="s2">, </span><span class="s4">'s'</span><span class="s2">),</span>
         <span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s5">4</span><span class="s2">, </span><span class="s4">'s'</span><span class="s2">)),</span>
        <span class="s3"># m8 same units round down with negative</span>
        <span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s5">7</span><span class="s2">, </span><span class="s4">'s'</span><span class="s2">),</span>
         <span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(-</span><span class="s5">4</span><span class="s2">, </span><span class="s4">'s'</span><span class="s2">)),</span>
        <span class="s3"># m8 same units negative no round down</span>
        <span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s5">8</span><span class="s2">, </span><span class="s4">'s'</span><span class="s2">),</span>
         <span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(-</span><span class="s5">4</span><span class="s2">, </span><span class="s4">'s'</span><span class="s2">)),</span>
        <span class="s3"># m8 different units</span>
        <span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s5">1</span><span class="s2">, </span><span class="s4">'m'</span><span class="s2">),</span>
         <span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s5">31</span><span class="s2">, </span><span class="s4">'s'</span><span class="s2">)),</span>
        <span class="s3"># m8 generic units</span>
        <span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s5">1890</span><span class="s2">),</span>
         <span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s5">31</span><span class="s2">)),</span>
        <span class="s3"># Y // M works</span>
        <span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s5">2</span><span class="s2">, </span><span class="s4">'Y'</span><span class="s2">),</span>
         <span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s4">'13'</span><span class="s2">, </span><span class="s4">'M'</span><span class="s2">)),</span>
        <span class="s3"># handle 1D arrays</span>
        <span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">([</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">], </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'m8'</span><span class="s2">),</span>
         <span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">([</span><span class="s5">2</span><span class="s2">], </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'m8'</span><span class="s2">)),</span>
        <span class="s2">])</span>
    <span class="s1">def </span><span class="s0">test_timedelta_divmod</span><span class="s2">(</span><span class="s0">self</span><span class="s2">, </span><span class="s0">op1</span><span class="s2">, </span><span class="s0">op2</span><span class="s2">):</span>
        <span class="s0">expected </span><span class="s2">= (</span><span class="s0">op1 </span><span class="s2">// </span><span class="s0">op2</span><span class="s2">, </span><span class="s0">op1 </span><span class="s2">% </span><span class="s0">op2</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">divmod</span><span class="s2">(</span><span class="s0">op1</span><span class="s2">, </span><span class="s0">op2</span><span class="s2">), </span><span class="s0">expected</span><span class="s2">)</span>

    <span class="s2">@</span><span class="s0">pytest</span><span class="s2">.</span><span class="s0">mark</span><span class="s2">.</span><span class="s0">skipif</span><span class="s2">(</span><span class="s0">IS_WASM</span><span class="s2">, </span><span class="s0">reason</span><span class="s2">=</span><span class="s4">&quot;does not work in wasm&quot;</span><span class="s2">)</span>
    <span class="s2">@</span><span class="s0">pytest</span><span class="s2">.</span><span class="s0">mark</span><span class="s2">.</span><span class="s0">parametrize</span><span class="s2">(</span><span class="s4">&quot;op1, op2&quot;</span><span class="s2">, [</span>
        <span class="s3"># reuse cases from floordiv</span>
        <span class="s3"># div by 0</span>
        <span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s5">10</span><span class="s2">, </span><span class="s4">'us'</span><span class="s2">),</span>
         <span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s4">'us'</span><span class="s2">)),</span>
        <span class="s3"># div with NaT</span>
        <span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s4">'NaT'</span><span class="s2">),</span>
         <span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s5">50</span><span class="s2">, </span><span class="s4">'us'</span><span class="s2">)),</span>
        <span class="s3"># special case for int64 min</span>
        <span class="s3"># in integer floor division</span>
        <span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">iinfo</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">int64</span><span class="s2">).</span><span class="s0">min</span><span class="s2">),</span>
         <span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(-</span><span class="s5">1</span><span class="s2">)),</span>
        <span class="s2">])</span>
    <span class="s1">def </span><span class="s0">test_timedelta_divmod_warnings</span><span class="s2">(</span><span class="s0">self</span><span class="s2">, </span><span class="s0">op1</span><span class="s2">, </span><span class="s0">op2</span><span class="s2">):</span>
        <span class="s1">with </span><span class="s0">assert_warns</span><span class="s2">(</span><span class="s0">RuntimeWarning</span><span class="s2">):</span>
            <span class="s0">expected </span><span class="s2">= (</span><span class="s0">op1 </span><span class="s2">// </span><span class="s0">op2</span><span class="s2">, </span><span class="s0">op1 </span><span class="s2">% </span><span class="s0">op2</span><span class="s2">)</span>
        <span class="s1">with </span><span class="s0">assert_warns</span><span class="s2">(</span><span class="s0">RuntimeWarning</span><span class="s2">):</span>
            <span class="s0">actual </span><span class="s2">= </span><span class="s0">divmod</span><span class="s2">(</span><span class="s0">op1</span><span class="s2">, </span><span class="s0">op2</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">actual</span><span class="s2">, </span><span class="s0">expected</span><span class="s2">)</span>

    <span class="s1">def </span><span class="s0">test_datetime_divide</span><span class="s2">(</span><span class="s0">self</span><span class="s2">):</span>
        <span class="s1">for </span><span class="s0">dta</span><span class="s2">, </span><span class="s0">tda</span><span class="s2">, </span><span class="s0">tdb</span><span class="s2">, </span><span class="s0">tdc</span><span class="s2">, </span><span class="s0">tdd </span><span class="s1">in </span><span class="s0">\</span>
                    <span class="s2">[</span>
                     <span class="s3"># One-dimensional arrays</span>
                     <span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">([</span><span class="s4">'2012-12-21'</span><span class="s2">], </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'M8[D]'</span><span class="s2">),</span>
                      <span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">([</span><span class="s5">6</span><span class="s2">], </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'m8[h]'</span><span class="s2">),</span>
                      <span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">([</span><span class="s5">9</span><span class="s2">], </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'m8[h]'</span><span class="s2">),</span>
                      <span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">([</span><span class="s5">12</span><span class="s2">], </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'m8[h]'</span><span class="s2">),</span>
                      <span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">([</span><span class="s5">6</span><span class="s2">], </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'m8[m]'</span><span class="s2">)),</span>
                     <span class="s3"># NumPy scalars</span>
                     <span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'2012-12-21'</span><span class="s2">, </span><span class="s4">'[D]'</span><span class="s2">),</span>
                      <span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s5">6</span><span class="s2">, </span><span class="s4">'[h]'</span><span class="s2">),</span>
                      <span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s5">9</span><span class="s2">, </span><span class="s4">'[h]'</span><span class="s2">),</span>
                      <span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s5">12</span><span class="s2">, </span><span class="s4">'[h]'</span><span class="s2">),</span>
                      <span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s5">6</span><span class="s2">, </span><span class="s4">'[m]'</span><span class="s2">))]:</span>
            <span class="s3"># m8 / int</span>
            <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">tdc </span><span class="s2">/ </span><span class="s5">2</span><span class="s2">, </span><span class="s0">tda</span><span class="s2">)</span>
            <span class="s0">assert_equal</span><span class="s2">((</span><span class="s0">tdc </span><span class="s2">/ </span><span class="s5">2</span><span class="s2">).</span><span class="s0">dtype</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'m8[h]'</span><span class="s2">))</span>
            <span class="s3"># m8 / float</span>
            <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">tda </span><span class="s2">/ </span><span class="s5">0.5</span><span class="s2">, </span><span class="s0">tdc</span><span class="s2">)</span>
            <span class="s0">assert_equal</span><span class="s2">((</span><span class="s0">tda </span><span class="s2">/ </span><span class="s5">0.5</span><span class="s2">).</span><span class="s0">dtype</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'m8[h]'</span><span class="s2">))</span>
            <span class="s3"># m8 / m8</span>
            <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">tda </span><span class="s2">/ </span><span class="s0">tdb</span><span class="s2">, </span><span class="s5">6 </span><span class="s2">/ </span><span class="s5">9</span><span class="s2">)</span>
            <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">divide</span><span class="s2">(</span><span class="s0">tda</span><span class="s2">, </span><span class="s0">tdb</span><span class="s2">), </span><span class="s5">6 </span><span class="s2">/ </span><span class="s5">9</span><span class="s2">)</span>
            <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">true_divide</span><span class="s2">(</span><span class="s0">tda</span><span class="s2">, </span><span class="s0">tdb</span><span class="s2">), </span><span class="s5">6 </span><span class="s2">/ </span><span class="s5">9</span><span class="s2">)</span>
            <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">tdb </span><span class="s2">/ </span><span class="s0">tda</span><span class="s2">, </span><span class="s5">9 </span><span class="s2">/ </span><span class="s5">6</span><span class="s2">)</span>
            <span class="s0">assert_equal</span><span class="s2">((</span><span class="s0">tda </span><span class="s2">/ </span><span class="s0">tdb</span><span class="s2">).</span><span class="s0">dtype</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'f8'</span><span class="s2">))</span>
            <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">tda </span><span class="s2">/ </span><span class="s0">tdd</span><span class="s2">, </span><span class="s5">60</span><span class="s2">)</span>
            <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">tdd </span><span class="s2">/ </span><span class="s0">tda</span><span class="s2">, </span><span class="s5">1 </span><span class="s2">/ </span><span class="s5">60</span><span class="s2">)</span>

            <span class="s3"># int / m8</span>
            <span class="s0">assert_raises</span><span class="s2">(</span><span class="s0">TypeError</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">divide</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s0">tdb</span><span class="s2">)</span>
            <span class="s3"># float / m8</span>
            <span class="s0">assert_raises</span><span class="s2">(</span><span class="s0">TypeError</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">divide</span><span class="s2">, </span><span class="s5">0.5</span><span class="s2">, </span><span class="s0">tdb</span><span class="s2">)</span>
            <span class="s3"># m8 / M8</span>
            <span class="s0">assert_raises</span><span class="s2">(</span><span class="s0">TypeError</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">divide</span><span class="s2">, </span><span class="s0">dta</span><span class="s2">, </span><span class="s0">tda</span><span class="s2">)</span>
            <span class="s3"># M8 / m8</span>
            <span class="s0">assert_raises</span><span class="s2">(</span><span class="s0">TypeError</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">divide</span><span class="s2">, </span><span class="s0">tda</span><span class="s2">, </span><span class="s0">dta</span><span class="s2">)</span>
            <span class="s3"># M8 / int</span>
            <span class="s0">assert_raises</span><span class="s2">(</span><span class="s0">TypeError</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">divide</span><span class="s2">, </span><span class="s0">dta</span><span class="s2">, </span><span class="s5">2</span><span class="s2">)</span>
            <span class="s3"># int / M8</span>
            <span class="s0">assert_raises</span><span class="s2">(</span><span class="s0">TypeError</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">divide</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s0">dta</span><span class="s2">)</span>
            <span class="s3"># M8 / float</span>
            <span class="s0">assert_raises</span><span class="s2">(</span><span class="s0">TypeError</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">divide</span><span class="s2">, </span><span class="s0">dta</span><span class="s2">, </span><span class="s5">1.5</span><span class="s2">)</span>
            <span class="s3"># float / M8</span>
            <span class="s0">assert_raises</span><span class="s2">(</span><span class="s0">TypeError</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">divide</span><span class="s2">, </span><span class="s5">1.5</span><span class="s2">, </span><span class="s0">dta</span><span class="s2">)</span>

        <span class="s3"># NaTs</span>
        <span class="s1">with </span><span class="s0">suppress_warnings</span><span class="s2">() </span><span class="s1">as </span><span class="s0">sup</span><span class="s2">:</span>
            <span class="s0">sup</span><span class="s2">.</span><span class="s0">filter</span><span class="s2">(</span><span class="s0">RuntimeWarning</span><span class="s2">,  </span><span class="s4">r&quot;.*encountered in divide&quot;</span><span class="s2">)</span>
            <span class="s0">nat </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s4">'NaT'</span><span class="s2">)</span>
            <span class="s1">for </span><span class="s0">tp </span><span class="s1">in </span><span class="s2">(</span><span class="s0">int</span><span class="s2">, </span><span class="s0">float</span><span class="s2">):</span>
                <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s5">1</span><span class="s2">) / </span><span class="s0">tp</span><span class="s2">(</span><span class="s5">0</span><span class="s2">), </span><span class="s0">nat</span><span class="s2">)</span>
                <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s5">0</span><span class="s2">) / </span><span class="s0">tp</span><span class="s2">(</span><span class="s5">0</span><span class="s2">), </span><span class="s0">nat</span><span class="s2">)</span>
                <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">nat </span><span class="s2">/ </span><span class="s0">tp</span><span class="s2">(</span><span class="s5">0</span><span class="s2">), </span><span class="s0">nat</span><span class="s2">)</span>
                <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">nat </span><span class="s2">/ </span><span class="s0">tp</span><span class="s2">(</span><span class="s5">2</span><span class="s2">), </span><span class="s0">nat</span><span class="s2">)</span>
            <span class="s3"># Division by inf</span>
            <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s5">1</span><span class="s2">) / </span><span class="s0">float</span><span class="s2">(</span><span class="s4">'inf'</span><span class="s2">), </span><span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s5">0</span><span class="s2">))</span>
            <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s5">0</span><span class="s2">) / </span><span class="s0">float</span><span class="s2">(</span><span class="s4">'inf'</span><span class="s2">), </span><span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s5">0</span><span class="s2">))</span>
            <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">nat </span><span class="s2">/ </span><span class="s0">float</span><span class="s2">(</span><span class="s4">'inf'</span><span class="s2">), </span><span class="s0">nat</span><span class="s2">)</span>
            <span class="s3"># Division by nan</span>
            <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s5">1</span><span class="s2">) / </span><span class="s0">float</span><span class="s2">(</span><span class="s4">'nan'</span><span class="s2">), </span><span class="s0">nat</span><span class="s2">)</span>
            <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s5">0</span><span class="s2">) / </span><span class="s0">float</span><span class="s2">(</span><span class="s4">'nan'</span><span class="s2">), </span><span class="s0">nat</span><span class="s2">)</span>
            <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">nat </span><span class="s2">/ </span><span class="s0">float</span><span class="s2">(</span><span class="s4">'nan'</span><span class="s2">), </span><span class="s0">nat</span><span class="s2">)</span>

    <span class="s1">def </span><span class="s0">test_datetime_compare</span><span class="s2">(</span><span class="s0">self</span><span class="s2">):</span>
        <span class="s3"># Test all the comparison operators</span>
        <span class="s0">a </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'2000-03-12T18:00:00.000000'</span><span class="s2">)</span>
        <span class="s0">b </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">([</span><span class="s4">'2000-03-12T18:00:00.000000'</span><span class="s2">,</span>
                      <span class="s4">'2000-03-12T17:59:59.999999'</span><span class="s2">,</span>
                      <span class="s4">'2000-03-12T18:00:00.000001'</span><span class="s2">,</span>
                      <span class="s4">'1970-01-11T12:00:00.909090'</span><span class="s2">,</span>
                      <span class="s4">'2016-01-11T12:00:00.909090'</span><span class="s2">],</span>
                      <span class="s0">dtype</span><span class="s2">=</span><span class="s4">'datetime64[us]'</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">equal</span><span class="s2">(</span><span class="s0">a</span><span class="s2">, </span><span class="s0">b</span><span class="s2">), [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">])</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">not_equal</span><span class="s2">(</span><span class="s0">a</span><span class="s2">, </span><span class="s0">b</span><span class="s2">), [</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">])</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">less</span><span class="s2">(</span><span class="s0">a</span><span class="s2">, </span><span class="s0">b</span><span class="s2">), [</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">])</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">less_equal</span><span class="s2">(</span><span class="s0">a</span><span class="s2">, </span><span class="s0">b</span><span class="s2">), [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">])</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">greater</span><span class="s2">(</span><span class="s0">a</span><span class="s2">, </span><span class="s0">b</span><span class="s2">), [</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">])</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">greater_equal</span><span class="s2">(</span><span class="s0">a</span><span class="s2">, </span><span class="s0">b</span><span class="s2">), [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">])</span>

    <span class="s1">def </span><span class="s0">test_datetime_compare_nat</span><span class="s2">(</span><span class="s0">self</span><span class="s2">):</span>
        <span class="s0">dt_nat </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'NaT'</span><span class="s2">, </span><span class="s4">'D'</span><span class="s2">)</span>
        <span class="s0">dt_other </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'2000-01-01'</span><span class="s2">)</span>
        <span class="s0">td_nat </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s4">'NaT'</span><span class="s2">, </span><span class="s4">'h'</span><span class="s2">)</span>
        <span class="s0">td_other </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s5">1</span><span class="s2">, </span><span class="s4">'h'</span><span class="s2">)</span>

        <span class="s1">for </span><span class="s0">op </span><span class="s1">in </span><span class="s2">[</span><span class="s0">np</span><span class="s2">.</span><span class="s0">equal</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">less</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">less_equal</span><span class="s2">,</span>
                   <span class="s0">np</span><span class="s2">.</span><span class="s0">greater</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">greater_equal</span><span class="s2">]:</span>
            <span class="s0">assert_</span><span class="s2">(</span><span class="s1">not </span><span class="s0">op</span><span class="s2">(</span><span class="s0">dt_nat</span><span class="s2">, </span><span class="s0">dt_nat</span><span class="s2">))</span>
            <span class="s0">assert_</span><span class="s2">(</span><span class="s1">not </span><span class="s0">op</span><span class="s2">(</span><span class="s0">dt_nat</span><span class="s2">, </span><span class="s0">dt_other</span><span class="s2">))</span>
            <span class="s0">assert_</span><span class="s2">(</span><span class="s1">not </span><span class="s0">op</span><span class="s2">(</span><span class="s0">dt_other</span><span class="s2">, </span><span class="s0">dt_nat</span><span class="s2">))</span>

            <span class="s0">assert_</span><span class="s2">(</span><span class="s1">not </span><span class="s0">op</span><span class="s2">(</span><span class="s0">td_nat</span><span class="s2">, </span><span class="s0">td_nat</span><span class="s2">))</span>
            <span class="s0">assert_</span><span class="s2">(</span><span class="s1">not </span><span class="s0">op</span><span class="s2">(</span><span class="s0">td_nat</span><span class="s2">, </span><span class="s0">td_other</span><span class="s2">))</span>
            <span class="s0">assert_</span><span class="s2">(</span><span class="s1">not </span><span class="s0">op</span><span class="s2">(</span><span class="s0">td_other</span><span class="s2">, </span><span class="s0">td_nat</span><span class="s2">))</span>

        <span class="s0">assert_</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">not_equal</span><span class="s2">(</span><span class="s0">dt_nat</span><span class="s2">, </span><span class="s0">dt_nat</span><span class="s2">))</span>
        <span class="s0">assert_</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">not_equal</span><span class="s2">(</span><span class="s0">dt_nat</span><span class="s2">, </span><span class="s0">dt_other</span><span class="s2">))</span>
        <span class="s0">assert_</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">not_equal</span><span class="s2">(</span><span class="s0">dt_other</span><span class="s2">, </span><span class="s0">dt_nat</span><span class="s2">))</span>

        <span class="s0">assert_</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">not_equal</span><span class="s2">(</span><span class="s0">td_nat</span><span class="s2">, </span><span class="s0">td_nat</span><span class="s2">))</span>
        <span class="s0">assert_</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">not_equal</span><span class="s2">(</span><span class="s0">td_nat</span><span class="s2">, </span><span class="s0">td_other</span><span class="s2">))</span>
        <span class="s0">assert_</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">not_equal</span><span class="s2">(</span><span class="s0">td_other</span><span class="s2">, </span><span class="s0">td_nat</span><span class="s2">))</span>

    <span class="s1">def </span><span class="s0">test_datetime_minmax</span><span class="s2">(</span><span class="s0">self</span><span class="s2">):</span>
        <span class="s3"># The metadata of the result should become the GCD</span>
        <span class="s3"># of the operand metadata</span>
        <span class="s0">a </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">(</span><span class="s4">'1999-03-12T13'</span><span class="s2">, </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'M8[2m]'</span><span class="s2">)</span>
        <span class="s0">b </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">(</span><span class="s4">'1999-03-12T12'</span><span class="s2">, </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'M8[s]'</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">minimum</span><span class="s2">(</span><span class="s0">a</span><span class="s2">, </span><span class="s0">b</span><span class="s2">), </span><span class="s0">b</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">minimum</span><span class="s2">(</span><span class="s0">a</span><span class="s2">, </span><span class="s0">b</span><span class="s2">).</span><span class="s0">dtype</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[s]'</span><span class="s2">))</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">fmin</span><span class="s2">(</span><span class="s0">a</span><span class="s2">, </span><span class="s0">b</span><span class="s2">), </span><span class="s0">b</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">fmin</span><span class="s2">(</span><span class="s0">a</span><span class="s2">, </span><span class="s0">b</span><span class="s2">).</span><span class="s0">dtype</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[s]'</span><span class="s2">))</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">maximum</span><span class="s2">(</span><span class="s0">a</span><span class="s2">, </span><span class="s0">b</span><span class="s2">), </span><span class="s0">a</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">maximum</span><span class="s2">(</span><span class="s0">a</span><span class="s2">, </span><span class="s0">b</span><span class="s2">).</span><span class="s0">dtype</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[s]'</span><span class="s2">))</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">fmax</span><span class="s2">(</span><span class="s0">a</span><span class="s2">, </span><span class="s0">b</span><span class="s2">), </span><span class="s0">a</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">fmax</span><span class="s2">(</span><span class="s0">a</span><span class="s2">, </span><span class="s0">b</span><span class="s2">).</span><span class="s0">dtype</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[s]'</span><span class="s2">))</span>
        <span class="s3"># Viewed as integers, the comparison is opposite because</span>
        <span class="s3"># of the units chosen</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">minimum</span><span class="s2">(</span><span class="s0">a</span><span class="s2">.</span><span class="s0">view</span><span class="s2">(</span><span class="s4">'i8'</span><span class="s2">), </span><span class="s0">b</span><span class="s2">.</span><span class="s0">view</span><span class="s2">(</span><span class="s4">'i8'</span><span class="s2">)), </span><span class="s0">a</span><span class="s2">.</span><span class="s0">view</span><span class="s2">(</span><span class="s4">'i8'</span><span class="s2">))</span>

        <span class="s3"># Interaction with NaT</span>
        <span class="s0">a </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">(</span><span class="s4">'1999-03-12T13'</span><span class="s2">, </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'M8[2m]'</span><span class="s2">)</span>
        <span class="s0">dtnat </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">(</span><span class="s4">'NaT'</span><span class="s2">, </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'M8[h]'</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">minimum</span><span class="s2">(</span><span class="s0">a</span><span class="s2">, </span><span class="s0">dtnat</span><span class="s2">), </span><span class="s0">dtnat</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">minimum</span><span class="s2">(</span><span class="s0">dtnat</span><span class="s2">, </span><span class="s0">a</span><span class="s2">), </span><span class="s0">dtnat</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">maximum</span><span class="s2">(</span><span class="s0">a</span><span class="s2">, </span><span class="s0">dtnat</span><span class="s2">), </span><span class="s0">dtnat</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">maximum</span><span class="s2">(</span><span class="s0">dtnat</span><span class="s2">, </span><span class="s0">a</span><span class="s2">), </span><span class="s0">dtnat</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">fmin</span><span class="s2">(</span><span class="s0">dtnat</span><span class="s2">, </span><span class="s0">a</span><span class="s2">), </span><span class="s0">a</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">fmin</span><span class="s2">(</span><span class="s0">a</span><span class="s2">, </span><span class="s0">dtnat</span><span class="s2">), </span><span class="s0">a</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">fmax</span><span class="s2">(</span><span class="s0">dtnat</span><span class="s2">, </span><span class="s0">a</span><span class="s2">), </span><span class="s0">a</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">fmax</span><span class="s2">(</span><span class="s0">a</span><span class="s2">, </span><span class="s0">dtnat</span><span class="s2">), </span><span class="s0">a</span><span class="s2">)</span>

        <span class="s3"># Also do timedelta</span>
        <span class="s0">a </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">(</span><span class="s5">3</span><span class="s2">, </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'m8[h]'</span><span class="s2">)</span>
        <span class="s0">b </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">(</span><span class="s5">3</span><span class="s2">*</span><span class="s5">3600 </span><span class="s2">- </span><span class="s5">3</span><span class="s2">, </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'m8[s]'</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">minimum</span><span class="s2">(</span><span class="s0">a</span><span class="s2">, </span><span class="s0">b</span><span class="s2">), </span><span class="s0">b</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">minimum</span><span class="s2">(</span><span class="s0">a</span><span class="s2">, </span><span class="s0">b</span><span class="s2">).</span><span class="s0">dtype</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'m8[s]'</span><span class="s2">))</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">fmin</span><span class="s2">(</span><span class="s0">a</span><span class="s2">, </span><span class="s0">b</span><span class="s2">), </span><span class="s0">b</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">fmin</span><span class="s2">(</span><span class="s0">a</span><span class="s2">, </span><span class="s0">b</span><span class="s2">).</span><span class="s0">dtype</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'m8[s]'</span><span class="s2">))</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">maximum</span><span class="s2">(</span><span class="s0">a</span><span class="s2">, </span><span class="s0">b</span><span class="s2">), </span><span class="s0">a</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">maximum</span><span class="s2">(</span><span class="s0">a</span><span class="s2">, </span><span class="s0">b</span><span class="s2">).</span><span class="s0">dtype</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'m8[s]'</span><span class="s2">))</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">fmax</span><span class="s2">(</span><span class="s0">a</span><span class="s2">, </span><span class="s0">b</span><span class="s2">), </span><span class="s0">a</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">fmax</span><span class="s2">(</span><span class="s0">a</span><span class="s2">, </span><span class="s0">b</span><span class="s2">).</span><span class="s0">dtype</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'m8[s]'</span><span class="s2">))</span>
        <span class="s3"># Viewed as integers, the comparison is opposite because</span>
        <span class="s3"># of the units chosen</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">minimum</span><span class="s2">(</span><span class="s0">a</span><span class="s2">.</span><span class="s0">view</span><span class="s2">(</span><span class="s4">'i8'</span><span class="s2">), </span><span class="s0">b</span><span class="s2">.</span><span class="s0">view</span><span class="s2">(</span><span class="s4">'i8'</span><span class="s2">)), </span><span class="s0">a</span><span class="s2">.</span><span class="s0">view</span><span class="s2">(</span><span class="s4">'i8'</span><span class="s2">))</span>

        <span class="s3"># should raise between datetime and timedelta</span>
        <span class="s3">#</span>
        <span class="s3"># TODO: Allowing unsafe casting by</span>
        <span class="s3">#       default in ufuncs strikes again... :(</span>
        <span class="s0">a </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">(</span><span class="s5">3</span><span class="s2">, </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'m8[h]'</span><span class="s2">)</span>
        <span class="s0">b </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">(</span><span class="s4">'1999-03-12T12'</span><span class="s2">, </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'M8[s]'</span><span class="s2">)</span>
        <span class="s3">#assert_raises(TypeError, np.minimum, a, b)</span>
        <span class="s3">#assert_raises(TypeError, np.maximum, a, b)</span>
        <span class="s3">#assert_raises(TypeError, np.fmin, a, b)</span>
        <span class="s3">#assert_raises(TypeError, np.fmax, a, b)</span>
        <span class="s0">assert_raises</span><span class="s2">(</span><span class="s0">TypeError</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">minimum</span><span class="s2">, </span><span class="s0">a</span><span class="s2">, </span><span class="s0">b</span><span class="s2">, </span><span class="s0">casting</span><span class="s2">=</span><span class="s4">'same_kind'</span><span class="s2">)</span>
        <span class="s0">assert_raises</span><span class="s2">(</span><span class="s0">TypeError</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">maximum</span><span class="s2">, </span><span class="s0">a</span><span class="s2">, </span><span class="s0">b</span><span class="s2">, </span><span class="s0">casting</span><span class="s2">=</span><span class="s4">'same_kind'</span><span class="s2">)</span>
        <span class="s0">assert_raises</span><span class="s2">(</span><span class="s0">TypeError</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">fmin</span><span class="s2">, </span><span class="s0">a</span><span class="s2">, </span><span class="s0">b</span><span class="s2">, </span><span class="s0">casting</span><span class="s2">=</span><span class="s4">'same_kind'</span><span class="s2">)</span>
        <span class="s0">assert_raises</span><span class="s2">(</span><span class="s0">TypeError</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">fmax</span><span class="s2">, </span><span class="s0">a</span><span class="s2">, </span><span class="s0">b</span><span class="s2">, </span><span class="s0">casting</span><span class="s2">=</span><span class="s4">'same_kind'</span><span class="s2">)</span>

    <span class="s1">def </span><span class="s0">test_hours</span><span class="s2">(</span><span class="s0">self</span><span class="s2">):</span>
        <span class="s0">t </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">ones</span><span class="s2">(</span><span class="s5">3</span><span class="s2">, </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'M8[s]'</span><span class="s2">)</span>
        <span class="s0">t</span><span class="s2">[</span><span class="s5">0</span><span class="s2">] = </span><span class="s5">60</span><span class="s2">*</span><span class="s5">60</span><span class="s2">*</span><span class="s5">24 </span><span class="s2">+ </span><span class="s5">60</span><span class="s2">*</span><span class="s5">60</span><span class="s2">*</span><span class="s5">10</span>
        <span class="s0">assert_</span><span class="s2">(</span><span class="s0">t</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s0">item</span><span class="s2">().</span><span class="s0">hour </span><span class="s2">== </span><span class="s5">10</span><span class="s2">)</span>

    <span class="s1">def </span><span class="s0">test_divisor_conversion_year</span><span class="s2">(</span><span class="s0">self</span><span class="s2">):</span>
        <span class="s0">assert_</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[Y/4]'</span><span class="s2">) == </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[3M]'</span><span class="s2">))</span>
        <span class="s0">assert_</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[Y/13]'</span><span class="s2">) == </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[4W]'</span><span class="s2">))</span>
        <span class="s0">assert_</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[3Y/73]'</span><span class="s2">) == </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[15D]'</span><span class="s2">))</span>

    <span class="s1">def </span><span class="s0">test_divisor_conversion_month</span><span class="s2">(</span><span class="s0">self</span><span class="s2">):</span>
        <span class="s0">assert_</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[M/2]'</span><span class="s2">) == </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[2W]'</span><span class="s2">))</span>
        <span class="s0">assert_</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[M/15]'</span><span class="s2">) == </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[2D]'</span><span class="s2">))</span>
        <span class="s0">assert_</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[3M/40]'</span><span class="s2">) == </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[54h]'</span><span class="s2">))</span>

    <span class="s1">def </span><span class="s0">test_divisor_conversion_week</span><span class="s2">(</span><span class="s0">self</span><span class="s2">):</span>
        <span class="s0">assert_</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'m8[W/7]'</span><span class="s2">) == </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'m8[D]'</span><span class="s2">))</span>
        <span class="s0">assert_</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'m8[3W/14]'</span><span class="s2">) == </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'m8[36h]'</span><span class="s2">))</span>
        <span class="s0">assert_</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'m8[5W/140]'</span><span class="s2">) == </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'m8[360m]'</span><span class="s2">))</span>

    <span class="s1">def </span><span class="s0">test_divisor_conversion_day</span><span class="s2">(</span><span class="s0">self</span><span class="s2">):</span>
        <span class="s0">assert_</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[D/12]'</span><span class="s2">) == </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[2h]'</span><span class="s2">))</span>
        <span class="s0">assert_</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[D/120]'</span><span class="s2">) == </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[12m]'</span><span class="s2">))</span>
        <span class="s0">assert_</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[3D/960]'</span><span class="s2">) == </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[270s]'</span><span class="s2">))</span>

    <span class="s1">def </span><span class="s0">test_divisor_conversion_hour</span><span class="s2">(</span><span class="s0">self</span><span class="s2">):</span>
        <span class="s0">assert_</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'m8[h/30]'</span><span class="s2">) == </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'m8[2m]'</span><span class="s2">))</span>
        <span class="s0">assert_</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'m8[3h/300]'</span><span class="s2">) == </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'m8[36s]'</span><span class="s2">))</span>

    <span class="s1">def </span><span class="s0">test_divisor_conversion_minute</span><span class="s2">(</span><span class="s0">self</span><span class="s2">):</span>
        <span class="s0">assert_</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'m8[m/30]'</span><span class="s2">) == </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'m8[2s]'</span><span class="s2">))</span>
        <span class="s0">assert_</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'m8[3m/300]'</span><span class="s2">) == </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'m8[600ms]'</span><span class="s2">))</span>

    <span class="s1">def </span><span class="s0">test_divisor_conversion_second</span><span class="s2">(</span><span class="s0">self</span><span class="s2">):</span>
        <span class="s0">assert_</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'m8[s/100]'</span><span class="s2">) == </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'m8[10ms]'</span><span class="s2">))</span>
        <span class="s0">assert_</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'m8[3s/10000]'</span><span class="s2">) == </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'m8[300us]'</span><span class="s2">))</span>

    <span class="s1">def </span><span class="s0">test_divisor_conversion_fs</span><span class="s2">(</span><span class="s0">self</span><span class="s2">):</span>
        <span class="s0">assert_</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[fs/100]'</span><span class="s2">) == </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[10as]'</span><span class="s2">))</span>
        <span class="s0">assert_raises</span><span class="s2">(</span><span class="s0">ValueError</span><span class="s2">, </span><span class="s1">lambda</span><span class="s2">: </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[3fs/10000]'</span><span class="s2">))</span>

    <span class="s1">def </span><span class="s0">test_divisor_conversion_as</span><span class="s2">(</span><span class="s0">self</span><span class="s2">):</span>
        <span class="s0">assert_raises</span><span class="s2">(</span><span class="s0">ValueError</span><span class="s2">, </span><span class="s1">lambda</span><span class="s2">: </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[as/10]'</span><span class="s2">))</span>

    <span class="s1">def </span><span class="s0">test_string_parser_variants</span><span class="s2">(</span><span class="s0">self</span><span class="s2">):</span>
        <span class="s3"># Allow space instead of 'T' between date and time</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">([</span><span class="s4">'1980-02-29T01:02:03'</span><span class="s2">], </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[s]'</span><span class="s2">)),</span>
                     <span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">([</span><span class="s4">'1980-02-29 01:02:03'</span><span class="s2">], </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[s]'</span><span class="s2">)))</span>
        <span class="s3"># Allow positive years</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">([</span><span class="s4">'+1980-02-29T01:02:03'</span><span class="s2">], </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[s]'</span><span class="s2">)),</span>
                     <span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">([</span><span class="s4">'+1980-02-29 01:02:03'</span><span class="s2">], </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[s]'</span><span class="s2">)))</span>
        <span class="s3"># Allow negative years</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">([</span><span class="s4">'-1980-02-29T01:02:03'</span><span class="s2">], </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[s]'</span><span class="s2">)),</span>
                     <span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">([</span><span class="s4">'-1980-02-29 01:02:03'</span><span class="s2">], </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[s]'</span><span class="s2">)))</span>
        <span class="s3"># UTC specifier</span>
        <span class="s1">with </span><span class="s0">assert_warns</span><span class="s2">(</span><span class="s0">DeprecationWarning</span><span class="s2">):</span>
            <span class="s0">assert_equal</span><span class="s2">(</span>
                <span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">([</span><span class="s4">'+1980-02-29T01:02:03'</span><span class="s2">], </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[s]'</span><span class="s2">)),</span>
                <span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">([</span><span class="s4">'+1980-02-29 01:02:03Z'</span><span class="s2">], </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[s]'</span><span class="s2">)))</span>
        <span class="s1">with </span><span class="s0">assert_warns</span><span class="s2">(</span><span class="s0">DeprecationWarning</span><span class="s2">):</span>
            <span class="s0">assert_equal</span><span class="s2">(</span>
                <span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">([</span><span class="s4">'-1980-02-29T01:02:03'</span><span class="s2">], </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[s]'</span><span class="s2">)),</span>
                <span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">([</span><span class="s4">'-1980-02-29 01:02:03Z'</span><span class="s2">], </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[s]'</span><span class="s2">)))</span>
        <span class="s3"># Time zone offset</span>
        <span class="s1">with </span><span class="s0">assert_warns</span><span class="s2">(</span><span class="s0">DeprecationWarning</span><span class="s2">):</span>
            <span class="s0">assert_equal</span><span class="s2">(</span>
                <span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">([</span><span class="s4">'1980-02-29T02:02:03'</span><span class="s2">], </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[s]'</span><span class="s2">)),</span>
                <span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">([</span><span class="s4">'1980-02-29 00:32:03-0130'</span><span class="s2">], </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[s]'</span><span class="s2">)))</span>
        <span class="s1">with </span><span class="s0">assert_warns</span><span class="s2">(</span><span class="s0">DeprecationWarning</span><span class="s2">):</span>
            <span class="s0">assert_equal</span><span class="s2">(</span>
                <span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">([</span><span class="s4">'1980-02-28T22:32:03'</span><span class="s2">], </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[s]'</span><span class="s2">)),</span>
                <span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">([</span><span class="s4">'1980-02-29 00:02:03+01:30'</span><span class="s2">], </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[s]'</span><span class="s2">)))</span>
        <span class="s1">with </span><span class="s0">assert_warns</span><span class="s2">(</span><span class="s0">DeprecationWarning</span><span class="s2">):</span>
            <span class="s0">assert_equal</span><span class="s2">(</span>
                <span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">([</span><span class="s4">'1980-02-29T02:32:03.506'</span><span class="s2">], </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[s]'</span><span class="s2">)),</span>
                <span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">([</span><span class="s4">'1980-02-29 00:32:03.506-02'</span><span class="s2">], </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[s]'</span><span class="s2">)))</span>
        <span class="s1">with </span><span class="s0">assert_warns</span><span class="s2">(</span><span class="s0">DeprecationWarning</span><span class="s2">):</span>
            <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'1977-03-02T12:30-0230'</span><span class="s2">),</span>
                         <span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'1977-03-02T15:00'</span><span class="s2">))</span>

    <span class="s1">def </span><span class="s0">test_string_parser_error_check</span><span class="s2">(</span><span class="s0">self</span><span class="s2">):</span>
        <span class="s3"># Arbitrary bad string</span>
        <span class="s0">assert_raises</span><span class="s2">(</span><span class="s0">ValueError</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">, [</span><span class="s4">'badvalue'</span><span class="s2">], </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[us]'</span><span class="s2">))</span>
        <span class="s3"># Character after year must be '-'</span>
        <span class="s0">assert_raises</span><span class="s2">(</span><span class="s0">ValueError</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">, [</span><span class="s4">'1980X'</span><span class="s2">], </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[us]'</span><span class="s2">))</span>
        <span class="s3"># Cannot have trailing '-'</span>
        <span class="s0">assert_raises</span><span class="s2">(</span><span class="s0">ValueError</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">, [</span><span class="s4">'1980-'</span><span class="s2">], </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[us]'</span><span class="s2">))</span>
        <span class="s3"># Month must be in range [1,12]</span>
        <span class="s0">assert_raises</span><span class="s2">(</span><span class="s0">ValueError</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">, [</span><span class="s4">'1980-00'</span><span class="s2">], </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[us]'</span><span class="s2">))</span>
        <span class="s0">assert_raises</span><span class="s2">(</span><span class="s0">ValueError</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">, [</span><span class="s4">'1980-13'</span><span class="s2">], </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[us]'</span><span class="s2">))</span>
        <span class="s3"># Month must have two digits</span>
        <span class="s0">assert_raises</span><span class="s2">(</span><span class="s0">ValueError</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">, [</span><span class="s4">'1980-1'</span><span class="s2">], </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[us]'</span><span class="s2">))</span>
        <span class="s0">assert_raises</span><span class="s2">(</span><span class="s0">ValueError</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">, [</span><span class="s4">'1980-1-02'</span><span class="s2">], </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[us]'</span><span class="s2">))</span>
        <span class="s3"># 'Mor' is not a valid month</span>
        <span class="s0">assert_raises</span><span class="s2">(</span><span class="s0">ValueError</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">, [</span><span class="s4">'1980-Mor'</span><span class="s2">], </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[us]'</span><span class="s2">))</span>
        <span class="s3"># Cannot have trailing '-'</span>
        <span class="s0">assert_raises</span><span class="s2">(</span><span class="s0">ValueError</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">, [</span><span class="s4">'1980-01-'</span><span class="s2">], </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[us]'</span><span class="s2">))</span>
        <span class="s3"># Day must be in range [1,len(month)]</span>
        <span class="s0">assert_raises</span><span class="s2">(</span><span class="s0">ValueError</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">, [</span><span class="s4">'1980-01-0'</span><span class="s2">], </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[us]'</span><span class="s2">))</span>
        <span class="s0">assert_raises</span><span class="s2">(</span><span class="s0">ValueError</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">, [</span><span class="s4">'1980-01-00'</span><span class="s2">], </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[us]'</span><span class="s2">))</span>
        <span class="s0">assert_raises</span><span class="s2">(</span><span class="s0">ValueError</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">, [</span><span class="s4">'1980-01-32'</span><span class="s2">], </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[us]'</span><span class="s2">))</span>
        <span class="s0">assert_raises</span><span class="s2">(</span><span class="s0">ValueError</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">, [</span><span class="s4">'1979-02-29'</span><span class="s2">], </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[us]'</span><span class="s2">))</span>
        <span class="s0">assert_raises</span><span class="s2">(</span><span class="s0">ValueError</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">, [</span><span class="s4">'1980-02-30'</span><span class="s2">], </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[us]'</span><span class="s2">))</span>
        <span class="s0">assert_raises</span><span class="s2">(</span><span class="s0">ValueError</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">, [</span><span class="s4">'1980-03-32'</span><span class="s2">], </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[us]'</span><span class="s2">))</span>
        <span class="s0">assert_raises</span><span class="s2">(</span><span class="s0">ValueError</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">, [</span><span class="s4">'1980-04-31'</span><span class="s2">], </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[us]'</span><span class="s2">))</span>
        <span class="s0">assert_raises</span><span class="s2">(</span><span class="s0">ValueError</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">, [</span><span class="s4">'1980-05-32'</span><span class="s2">], </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[us]'</span><span class="s2">))</span>
        <span class="s0">assert_raises</span><span class="s2">(</span><span class="s0">ValueError</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">, [</span><span class="s4">'1980-06-31'</span><span class="s2">], </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[us]'</span><span class="s2">))</span>
        <span class="s0">assert_raises</span><span class="s2">(</span><span class="s0">ValueError</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">, [</span><span class="s4">'1980-07-32'</span><span class="s2">], </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[us]'</span><span class="s2">))</span>
        <span class="s0">assert_raises</span><span class="s2">(</span><span class="s0">ValueError</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">, [</span><span class="s4">'1980-08-32'</span><span class="s2">], </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[us]'</span><span class="s2">))</span>
        <span class="s0">assert_raises</span><span class="s2">(</span><span class="s0">ValueError</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">, [</span><span class="s4">'1980-09-31'</span><span class="s2">], </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[us]'</span><span class="s2">))</span>
        <span class="s0">assert_raises</span><span class="s2">(</span><span class="s0">ValueError</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">, [</span><span class="s4">'1980-10-32'</span><span class="s2">], </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[us]'</span><span class="s2">))</span>
        <span class="s0">assert_raises</span><span class="s2">(</span><span class="s0">ValueError</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">, [</span><span class="s4">'1980-11-31'</span><span class="s2">], </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[us]'</span><span class="s2">))</span>
        <span class="s0">assert_raises</span><span class="s2">(</span><span class="s0">ValueError</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">, [</span><span class="s4">'1980-12-32'</span><span class="s2">], </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[us]'</span><span class="s2">))</span>
        <span class="s3"># Cannot have trailing characters</span>
        <span class="s0">assert_raises</span><span class="s2">(</span><span class="s0">ValueError</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">, [</span><span class="s4">'1980-02-03%'</span><span class="s2">],</span>
                                                        <span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[us]'</span><span class="s2">))</span>
        <span class="s0">assert_raises</span><span class="s2">(</span><span class="s0">ValueError</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">, [</span><span class="s4">'1980-02-03 q'</span><span class="s2">],</span>
                                                        <span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[us]'</span><span class="s2">))</span>

        <span class="s3"># Hours must be in range [0, 23]</span>
        <span class="s0">assert_raises</span><span class="s2">(</span><span class="s0">ValueError</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">, [</span><span class="s4">'1980-02-03 25'</span><span class="s2">],</span>
                                                        <span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[us]'</span><span class="s2">))</span>
        <span class="s0">assert_raises</span><span class="s2">(</span><span class="s0">ValueError</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">, [</span><span class="s4">'1980-02-03T25'</span><span class="s2">],</span>
                                                        <span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[us]'</span><span class="s2">))</span>
        <span class="s0">assert_raises</span><span class="s2">(</span><span class="s0">ValueError</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">, [</span><span class="s4">'1980-02-03 24:01'</span><span class="s2">],</span>
                                                        <span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[us]'</span><span class="s2">))</span>
        <span class="s0">assert_raises</span><span class="s2">(</span><span class="s0">ValueError</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">, [</span><span class="s4">'1980-02-03T24:01'</span><span class="s2">],</span>
                                                        <span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[us]'</span><span class="s2">))</span>
        <span class="s0">assert_raises</span><span class="s2">(</span><span class="s0">ValueError</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">, [</span><span class="s4">'1980-02-03 -1'</span><span class="s2">],</span>
                                                        <span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[us]'</span><span class="s2">))</span>
        <span class="s3"># No trailing ':'</span>
        <span class="s0">assert_raises</span><span class="s2">(</span><span class="s0">ValueError</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">, [</span><span class="s4">'1980-02-03 01:'</span><span class="s2">],</span>
                                                        <span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[us]'</span><span class="s2">))</span>
        <span class="s3"># Minutes must be in range [0, 59]</span>
        <span class="s0">assert_raises</span><span class="s2">(</span><span class="s0">ValueError</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">, [</span><span class="s4">'1980-02-03 01:-1'</span><span class="s2">],</span>
                                                        <span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[us]'</span><span class="s2">))</span>
        <span class="s0">assert_raises</span><span class="s2">(</span><span class="s0">ValueError</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">, [</span><span class="s4">'1980-02-03 01:60'</span><span class="s2">],</span>
                                                        <span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[us]'</span><span class="s2">))</span>
        <span class="s3"># No trailing ':'</span>
        <span class="s0">assert_raises</span><span class="s2">(</span><span class="s0">ValueError</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">, [</span><span class="s4">'1980-02-03 01:60:'</span><span class="s2">],</span>
                                                        <span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[us]'</span><span class="s2">))</span>
        <span class="s3"># Seconds must be in range [0, 59]</span>
        <span class="s0">assert_raises</span><span class="s2">(</span><span class="s0">ValueError</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">, [</span><span class="s4">'1980-02-03 01:10:-1'</span><span class="s2">],</span>
                                                        <span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[us]'</span><span class="s2">))</span>
        <span class="s0">assert_raises</span><span class="s2">(</span><span class="s0">ValueError</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">, [</span><span class="s4">'1980-02-03 01:01:60'</span><span class="s2">],</span>
                                                        <span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[us]'</span><span class="s2">))</span>
        <span class="s3"># Timezone offset must within a reasonable range</span>
        <span class="s1">with </span><span class="s0">assert_warns</span><span class="s2">(</span><span class="s0">DeprecationWarning</span><span class="s2">):</span>
            <span class="s0">assert_raises</span><span class="s2">(</span><span class="s0">ValueError</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">, [</span><span class="s4">'1980-02-03 01:01:00+0661'</span><span class="s2">],</span>
                                                            <span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[us]'</span><span class="s2">))</span>
        <span class="s1">with </span><span class="s0">assert_warns</span><span class="s2">(</span><span class="s0">DeprecationWarning</span><span class="s2">):</span>
            <span class="s0">assert_raises</span><span class="s2">(</span><span class="s0">ValueError</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">, [</span><span class="s4">'1980-02-03 01:01:00+2500'</span><span class="s2">],</span>
                                                            <span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[us]'</span><span class="s2">))</span>
        <span class="s1">with </span><span class="s0">assert_warns</span><span class="s2">(</span><span class="s0">DeprecationWarning</span><span class="s2">):</span>
            <span class="s0">assert_raises</span><span class="s2">(</span><span class="s0">ValueError</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">, [</span><span class="s4">'1980-02-03 01:01:00-0070'</span><span class="s2">],</span>
                                                            <span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[us]'</span><span class="s2">))</span>
        <span class="s1">with </span><span class="s0">assert_warns</span><span class="s2">(</span><span class="s0">DeprecationWarning</span><span class="s2">):</span>
            <span class="s0">assert_raises</span><span class="s2">(</span><span class="s0">ValueError</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">, [</span><span class="s4">'1980-02-03 01:01:00-3000'</span><span class="s2">],</span>
                                                            <span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[us]'</span><span class="s2">))</span>
        <span class="s1">with </span><span class="s0">assert_warns</span><span class="s2">(</span><span class="s0">DeprecationWarning</span><span class="s2">):</span>
            <span class="s0">assert_raises</span><span class="s2">(</span><span class="s0">ValueError</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">, [</span><span class="s4">'1980-02-03 01:01:00-25:00'</span><span class="s2">],</span>
                                                            <span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[us]'</span><span class="s2">))</span>

    <span class="s1">def </span><span class="s0">test_creation_overflow</span><span class="s2">(</span><span class="s0">self</span><span class="s2">):</span>
        <span class="s0">date </span><span class="s2">= </span><span class="s4">'1980-03-23 20:00:00'</span>
        <span class="s0">timesteps </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">([</span><span class="s0">date</span><span class="s2">], </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'datetime64[s]'</span><span class="s2">)[</span><span class="s5">0</span><span class="s2">].</span><span class="s0">astype</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">int64</span><span class="s2">)</span>
        <span class="s1">for </span><span class="s0">unit </span><span class="s1">in </span><span class="s2">[</span><span class="s4">'ms'</span><span class="s2">, </span><span class="s4">'us'</span><span class="s2">, </span><span class="s4">'ns'</span><span class="s2">]:</span>
            <span class="s0">timesteps </span><span class="s2">*= </span><span class="s5">1000</span>
            <span class="s0">x </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">([</span><span class="s0">date</span><span class="s2">], </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'datetime64[%s]' </span><span class="s2">% </span><span class="s0">unit</span><span class="s2">)</span>

            <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">timesteps</span><span class="s2">, </span><span class="s0">x</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s0">astype</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">int64</span><span class="s2">),</span>
                         <span class="s0">err_msg</span><span class="s2">=</span><span class="s4">'Datetime conversion error for unit %s' </span><span class="s2">% </span><span class="s0">unit</span><span class="s2">)</span>

        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">x</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s0">astype</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">int64</span><span class="s2">), </span><span class="s5">322689600000000000</span><span class="s2">)</span>

        <span class="s3"># gh-13062</span>
        <span class="s1">with </span><span class="s0">pytest</span><span class="s2">.</span><span class="s0">raises</span><span class="s2">(</span><span class="s0">OverflowError</span><span class="s2">):</span>
            <span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s5">2</span><span class="s2">**</span><span class="s5">64</span><span class="s2">, </span><span class="s4">'D'</span><span class="s2">)</span>
        <span class="s1">with </span><span class="s0">pytest</span><span class="s2">.</span><span class="s0">raises</span><span class="s2">(</span><span class="s0">OverflowError</span><span class="s2">):</span>
            <span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s5">2</span><span class="s2">**</span><span class="s5">64</span><span class="s2">, </span><span class="s4">'D'</span><span class="s2">)</span>

    <span class="s1">def </span><span class="s0">test_datetime_as_string</span><span class="s2">(</span><span class="s0">self</span><span class="s2">):</span>
        <span class="s3"># Check all the units with default string conversion</span>
        <span class="s0">date </span><span class="s2">= </span><span class="s4">'1959-10-13'</span>
        <span class="s0">datetime </span><span class="s2">= </span><span class="s4">'1959-10-13T12:34:56.789012345678901234'</span>

        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime_as_string</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s0">date</span><span class="s2">, </span><span class="s4">'Y'</span><span class="s2">)),</span>
                     <span class="s4">'1959'</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime_as_string</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s0">date</span><span class="s2">, </span><span class="s4">'M'</span><span class="s2">)),</span>
                     <span class="s4">'1959-10'</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime_as_string</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s0">date</span><span class="s2">, </span><span class="s4">'D'</span><span class="s2">)),</span>
                     <span class="s4">'1959-10-13'</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime_as_string</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s0">datetime</span><span class="s2">, </span><span class="s4">'h'</span><span class="s2">)),</span>
                     <span class="s4">'1959-10-13T12'</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime_as_string</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s0">datetime</span><span class="s2">, </span><span class="s4">'m'</span><span class="s2">)),</span>
                     <span class="s4">'1959-10-13T12:34'</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime_as_string</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s0">datetime</span><span class="s2">, </span><span class="s4">'s'</span><span class="s2">)),</span>
                     <span class="s4">'1959-10-13T12:34:56'</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime_as_string</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s0">datetime</span><span class="s2">, </span><span class="s4">'ms'</span><span class="s2">)),</span>
                     <span class="s4">'1959-10-13T12:34:56.789'</span><span class="s2">)</span>
        <span class="s1">for </span><span class="s0">us </span><span class="s1">in </span><span class="s2">[</span><span class="s4">'us'</span><span class="s2">, </span><span class="s4">'Î¼s'</span><span class="s2">, </span><span class="s6">b'us'</span><span class="s2">]:  </span><span class="s3"># check non-ascii and bytes too</span>
            <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime_as_string</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s0">datetime</span><span class="s2">, </span><span class="s0">us</span><span class="s2">)),</span>
                         <span class="s4">'1959-10-13T12:34:56.789012'</span><span class="s2">)</span>

        <span class="s0">datetime </span><span class="s2">= </span><span class="s4">'1969-12-31T23:34:56.789012345678901234'</span>

        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime_as_string</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s0">datetime</span><span class="s2">, </span><span class="s4">'ns'</span><span class="s2">)),</span>
                     <span class="s4">'1969-12-31T23:34:56.789012345'</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime_as_string</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s0">datetime</span><span class="s2">, </span><span class="s4">'ps'</span><span class="s2">)),</span>
                     <span class="s4">'1969-12-31T23:34:56.789012345678'</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime_as_string</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s0">datetime</span><span class="s2">, </span><span class="s4">'fs'</span><span class="s2">)),</span>
                     <span class="s4">'1969-12-31T23:34:56.789012345678901'</span><span class="s2">)</span>

        <span class="s0">datetime </span><span class="s2">= </span><span class="s4">'1969-12-31T23:59:57.789012345678901234'</span>

        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime_as_string</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s0">datetime</span><span class="s2">, </span><span class="s4">'as'</span><span class="s2">)),</span>
                     <span class="s0">datetime</span><span class="s2">)</span>
        <span class="s0">datetime </span><span class="s2">= </span><span class="s4">'1970-01-01T00:34:56.789012345678901234'</span>

        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime_as_string</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s0">datetime</span><span class="s2">, </span><span class="s4">'ns'</span><span class="s2">)),</span>
                     <span class="s4">'1970-01-01T00:34:56.789012345'</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime_as_string</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s0">datetime</span><span class="s2">, </span><span class="s4">'ps'</span><span class="s2">)),</span>
                     <span class="s4">'1970-01-01T00:34:56.789012345678'</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime_as_string</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s0">datetime</span><span class="s2">, </span><span class="s4">'fs'</span><span class="s2">)),</span>
                     <span class="s4">'1970-01-01T00:34:56.789012345678901'</span><span class="s2">)</span>

        <span class="s0">datetime </span><span class="s2">= </span><span class="s4">'1970-01-01T00:00:05.789012345678901234'</span>

        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime_as_string</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s0">datetime</span><span class="s2">, </span><span class="s4">'as'</span><span class="s2">)),</span>
                     <span class="s0">datetime</span><span class="s2">)</span>

        <span class="s3"># String conversion with the unit= parameter</span>
        <span class="s0">a </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'2032-07-18T12:23:34.123456'</span><span class="s2">, </span><span class="s4">'us'</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime_as_string</span><span class="s2">(</span><span class="s0">a</span><span class="s2">, </span><span class="s0">unit</span><span class="s2">=</span><span class="s4">'Y'</span><span class="s2">, </span><span class="s0">casting</span><span class="s2">=</span><span class="s4">'unsafe'</span><span class="s2">),</span>
                            <span class="s4">'2032'</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime_as_string</span><span class="s2">(</span><span class="s0">a</span><span class="s2">, </span><span class="s0">unit</span><span class="s2">=</span><span class="s4">'M'</span><span class="s2">, </span><span class="s0">casting</span><span class="s2">=</span><span class="s4">'unsafe'</span><span class="s2">),</span>
                            <span class="s4">'2032-07'</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime_as_string</span><span class="s2">(</span><span class="s0">a</span><span class="s2">, </span><span class="s0">unit</span><span class="s2">=</span><span class="s4">'W'</span><span class="s2">, </span><span class="s0">casting</span><span class="s2">=</span><span class="s4">'unsafe'</span><span class="s2">),</span>
                            <span class="s4">'2032-07-18'</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime_as_string</span><span class="s2">(</span><span class="s0">a</span><span class="s2">, </span><span class="s0">unit</span><span class="s2">=</span><span class="s4">'D'</span><span class="s2">, </span><span class="s0">casting</span><span class="s2">=</span><span class="s4">'unsafe'</span><span class="s2">),</span>
                            <span class="s4">'2032-07-18'</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime_as_string</span><span class="s2">(</span><span class="s0">a</span><span class="s2">, </span><span class="s0">unit</span><span class="s2">=</span><span class="s4">'h'</span><span class="s2">), </span><span class="s4">'2032-07-18T12'</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime_as_string</span><span class="s2">(</span><span class="s0">a</span><span class="s2">, </span><span class="s0">unit</span><span class="s2">=</span><span class="s4">'m'</span><span class="s2">),</span>
                            <span class="s4">'2032-07-18T12:23'</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime_as_string</span><span class="s2">(</span><span class="s0">a</span><span class="s2">, </span><span class="s0">unit</span><span class="s2">=</span><span class="s4">'s'</span><span class="s2">),</span>
                            <span class="s4">'2032-07-18T12:23:34'</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime_as_string</span><span class="s2">(</span><span class="s0">a</span><span class="s2">, </span><span class="s0">unit</span><span class="s2">=</span><span class="s4">'ms'</span><span class="s2">),</span>
                            <span class="s4">'2032-07-18T12:23:34.123'</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime_as_string</span><span class="s2">(</span><span class="s0">a</span><span class="s2">, </span><span class="s0">unit</span><span class="s2">=</span><span class="s4">'us'</span><span class="s2">),</span>
                            <span class="s4">'2032-07-18T12:23:34.123456'</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime_as_string</span><span class="s2">(</span><span class="s0">a</span><span class="s2">, </span><span class="s0">unit</span><span class="s2">=</span><span class="s4">'ns'</span><span class="s2">),</span>
                            <span class="s4">'2032-07-18T12:23:34.123456000'</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime_as_string</span><span class="s2">(</span><span class="s0">a</span><span class="s2">, </span><span class="s0">unit</span><span class="s2">=</span><span class="s4">'ps'</span><span class="s2">),</span>
                            <span class="s4">'2032-07-18T12:23:34.123456000000'</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime_as_string</span><span class="s2">(</span><span class="s0">a</span><span class="s2">, </span><span class="s0">unit</span><span class="s2">=</span><span class="s4">'fs'</span><span class="s2">),</span>
                            <span class="s4">'2032-07-18T12:23:34.123456000000000'</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime_as_string</span><span class="s2">(</span><span class="s0">a</span><span class="s2">, </span><span class="s0">unit</span><span class="s2">=</span><span class="s4">'as'</span><span class="s2">),</span>
                            <span class="s4">'2032-07-18T12:23:34.123456000000000000'</span><span class="s2">)</span>

        <span class="s3"># unit='auto' parameter</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime_as_string</span><span class="s2">(</span>
                <span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'2032-07-18T12:23:34.123456'</span><span class="s2">, </span><span class="s4">'us'</span><span class="s2">), </span><span class="s0">unit</span><span class="s2">=</span><span class="s4">'auto'</span><span class="s2">),</span>
                <span class="s4">'2032-07-18T12:23:34.123456'</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime_as_string</span><span class="s2">(</span>
                <span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'2032-07-18T12:23:34.12'</span><span class="s2">, </span><span class="s4">'us'</span><span class="s2">), </span><span class="s0">unit</span><span class="s2">=</span><span class="s4">'auto'</span><span class="s2">),</span>
                <span class="s4">'2032-07-18T12:23:34.120'</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime_as_string</span><span class="s2">(</span>
                <span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'2032-07-18T12:23:34'</span><span class="s2">, </span><span class="s4">'us'</span><span class="s2">), </span><span class="s0">unit</span><span class="s2">=</span><span class="s4">'auto'</span><span class="s2">),</span>
                <span class="s4">'2032-07-18T12:23:34'</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime_as_string</span><span class="s2">(</span>
                <span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'2032-07-18T12:23:00'</span><span class="s2">, </span><span class="s4">'us'</span><span class="s2">), </span><span class="s0">unit</span><span class="s2">=</span><span class="s4">'auto'</span><span class="s2">),</span>
                <span class="s4">'2032-07-18T12:23'</span><span class="s2">)</span>
        <span class="s3"># 'auto' doesn't split up hour and minute</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime_as_string</span><span class="s2">(</span>
                <span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'2032-07-18T12:00:00'</span><span class="s2">, </span><span class="s4">'us'</span><span class="s2">), </span><span class="s0">unit</span><span class="s2">=</span><span class="s4">'auto'</span><span class="s2">),</span>
                <span class="s4">'2032-07-18T12:00'</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime_as_string</span><span class="s2">(</span>
                <span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'2032-07-18T00:00:00'</span><span class="s2">, </span><span class="s4">'us'</span><span class="s2">), </span><span class="s0">unit</span><span class="s2">=</span><span class="s4">'auto'</span><span class="s2">),</span>
                <span class="s4">'2032-07-18'</span><span class="s2">)</span>
        <span class="s3"># 'auto' doesn't split up the date</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime_as_string</span><span class="s2">(</span>
                <span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'2032-07-01T00:00:00'</span><span class="s2">, </span><span class="s4">'us'</span><span class="s2">), </span><span class="s0">unit</span><span class="s2">=</span><span class="s4">'auto'</span><span class="s2">),</span>
                <span class="s4">'2032-07-01'</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime_as_string</span><span class="s2">(</span>
                <span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'2032-01-01T00:00:00'</span><span class="s2">, </span><span class="s4">'us'</span><span class="s2">), </span><span class="s0">unit</span><span class="s2">=</span><span class="s4">'auto'</span><span class="s2">),</span>
                <span class="s4">'2032-01-01'</span><span class="s2">)</span>

    <span class="s2">@</span><span class="s0">pytest</span><span class="s2">.</span><span class="s0">mark</span><span class="s2">.</span><span class="s0">skipif</span><span class="s2">(</span><span class="s1">not </span><span class="s0">_has_pytz</span><span class="s2">, </span><span class="s0">reason</span><span class="s2">=</span><span class="s4">&quot;The pytz module is not available.&quot;</span><span class="s2">)</span>
    <span class="s1">def </span><span class="s0">test_datetime_as_string_timezone</span><span class="s2">(</span><span class="s0">self</span><span class="s2">):</span>
        <span class="s3"># timezone='local' vs 'UTC'</span>
        <span class="s0">a </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'2010-03-15T06:30'</span><span class="s2">, </span><span class="s4">'m'</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime_as_string</span><span class="s2">(</span><span class="s0">a</span><span class="s2">),</span>
                <span class="s4">'2010-03-15T06:30'</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime_as_string</span><span class="s2">(</span><span class="s0">a</span><span class="s2">, </span><span class="s0">timezone</span><span class="s2">=</span><span class="s4">'naive'</span><span class="s2">),</span>
                <span class="s4">'2010-03-15T06:30'</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime_as_string</span><span class="s2">(</span><span class="s0">a</span><span class="s2">, </span><span class="s0">timezone</span><span class="s2">=</span><span class="s4">'UTC'</span><span class="s2">),</span>
                <span class="s4">'2010-03-15T06:30Z'</span><span class="s2">)</span>
        <span class="s0">assert_</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime_as_string</span><span class="s2">(</span><span class="s0">a</span><span class="s2">, </span><span class="s0">timezone</span><span class="s2">=</span><span class="s4">'local'</span><span class="s2">) !=</span>
                <span class="s4">'2010-03-15T06:30'</span><span class="s2">)</span>

        <span class="s0">b </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'2010-02-15T06:30'</span><span class="s2">, </span><span class="s4">'m'</span><span class="s2">)</span>

        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime_as_string</span><span class="s2">(</span><span class="s0">a</span><span class="s2">, </span><span class="s0">timezone</span><span class="s2">=</span><span class="s0">tz</span><span class="s2">(</span><span class="s4">'US/Central'</span><span class="s2">)),</span>
                     <span class="s4">'2010-03-15T01:30-0500'</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime_as_string</span><span class="s2">(</span><span class="s0">a</span><span class="s2">, </span><span class="s0">timezone</span><span class="s2">=</span><span class="s0">tz</span><span class="s2">(</span><span class="s4">'US/Eastern'</span><span class="s2">)),</span>
                     <span class="s4">'2010-03-15T02:30-0400'</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime_as_string</span><span class="s2">(</span><span class="s0">a</span><span class="s2">, </span><span class="s0">timezone</span><span class="s2">=</span><span class="s0">tz</span><span class="s2">(</span><span class="s4">'US/Pacific'</span><span class="s2">)),</span>
                     <span class="s4">'2010-03-14T23:30-0700'</span><span class="s2">)</span>

        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime_as_string</span><span class="s2">(</span><span class="s0">b</span><span class="s2">, </span><span class="s0">timezone</span><span class="s2">=</span><span class="s0">tz</span><span class="s2">(</span><span class="s4">'US/Central'</span><span class="s2">)),</span>
                     <span class="s4">'2010-02-15T00:30-0600'</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime_as_string</span><span class="s2">(</span><span class="s0">b</span><span class="s2">, </span><span class="s0">timezone</span><span class="s2">=</span><span class="s0">tz</span><span class="s2">(</span><span class="s4">'US/Eastern'</span><span class="s2">)),</span>
                     <span class="s4">'2010-02-15T01:30-0500'</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime_as_string</span><span class="s2">(</span><span class="s0">b</span><span class="s2">, </span><span class="s0">timezone</span><span class="s2">=</span><span class="s0">tz</span><span class="s2">(</span><span class="s4">'US/Pacific'</span><span class="s2">)),</span>
                     <span class="s4">'2010-02-14T22:30-0800'</span><span class="s2">)</span>

        <span class="s3"># Dates to strings with a timezone attached is disabled by default</span>
        <span class="s0">assert_raises</span><span class="s2">(</span><span class="s0">TypeError</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime_as_string</span><span class="s2">, </span><span class="s0">a</span><span class="s2">, </span><span class="s0">unit</span><span class="s2">=</span><span class="s4">'D'</span><span class="s2">,</span>
                           <span class="s0">timezone</span><span class="s2">=</span><span class="s0">tz</span><span class="s2">(</span><span class="s4">'US/Pacific'</span><span class="s2">))</span>
        <span class="s3"># Check that we can print out the date in the specified time zone</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime_as_string</span><span class="s2">(</span><span class="s0">a</span><span class="s2">, </span><span class="s0">unit</span><span class="s2">=</span><span class="s4">'D'</span><span class="s2">,</span>
                           <span class="s0">timezone</span><span class="s2">=</span><span class="s0">tz</span><span class="s2">(</span><span class="s4">'US/Pacific'</span><span class="s2">), </span><span class="s0">casting</span><span class="s2">=</span><span class="s4">'unsafe'</span><span class="s2">),</span>
                     <span class="s4">'2010-03-14'</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime_as_string</span><span class="s2">(</span><span class="s0">b</span><span class="s2">, </span><span class="s0">unit</span><span class="s2">=</span><span class="s4">'D'</span><span class="s2">,</span>
                           <span class="s0">timezone</span><span class="s2">=</span><span class="s0">tz</span><span class="s2">(</span><span class="s4">'US/Central'</span><span class="s2">), </span><span class="s0">casting</span><span class="s2">=</span><span class="s4">'unsafe'</span><span class="s2">),</span>
                     <span class="s4">'2010-02-15'</span><span class="s2">)</span>

    <span class="s1">def </span><span class="s0">test_datetime_arange</span><span class="s2">(</span><span class="s0">self</span><span class="s2">):</span>
        <span class="s3"># With two datetimes provided as strings</span>
        <span class="s0">a </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">arange</span><span class="s2">(</span><span class="s4">'2010-01-05'</span><span class="s2">, </span><span class="s4">'2010-01-10'</span><span class="s2">, </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'M8[D]'</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">a</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[D]'</span><span class="s2">))</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">a</span><span class="s2">,</span>
            <span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">([</span><span class="s4">'2010-01-05'</span><span class="s2">, </span><span class="s4">'2010-01-06'</span><span class="s2">, </span><span class="s4">'2010-01-07'</span><span class="s2">,</span>
                      <span class="s4">'2010-01-08'</span><span class="s2">, </span><span class="s4">'2010-01-09'</span><span class="s2">], </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'M8[D]'</span><span class="s2">))</span>

        <span class="s0">a </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">arange</span><span class="s2">(</span><span class="s4">'1950-02-10'</span><span class="s2">, </span><span class="s4">'1950-02-06'</span><span class="s2">, -</span><span class="s5">1</span><span class="s2">, </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'M8[D]'</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">a</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[D]'</span><span class="s2">))</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">a</span><span class="s2">,</span>
            <span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">([</span><span class="s4">'1950-02-10'</span><span class="s2">, </span><span class="s4">'1950-02-09'</span><span class="s2">, </span><span class="s4">'1950-02-08'</span><span class="s2">,</span>
                      <span class="s4">'1950-02-07'</span><span class="s2">], </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'M8[D]'</span><span class="s2">))</span>

        <span class="s3"># Unit should be detected as months here</span>
        <span class="s0">a </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">arange</span><span class="s2">(</span><span class="s4">'1969-05'</span><span class="s2">, </span><span class="s4">'1970-05'</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'M8'</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">a</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[M]'</span><span class="s2">))</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">a</span><span class="s2">,</span>
            <span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'1969-05'</span><span class="s2">) + </span><span class="s0">np</span><span class="s2">.</span><span class="s0">arange</span><span class="s2">(</span><span class="s5">12</span><span class="s2">, </span><span class="s0">step</span><span class="s2">=</span><span class="s5">2</span><span class="s2">))</span>

        <span class="s3"># datetime, integer|timedelta works as well</span>
        <span class="s3"># produces arange (start, start + stop) in this case</span>
        <span class="s0">a </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">arange</span><span class="s2">(</span><span class="s4">'1969'</span><span class="s2">, </span><span class="s5">18</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'M8'</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">a</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[Y]'</span><span class="s2">))</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">a</span><span class="s2">,</span>
            <span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'1969'</span><span class="s2">) + </span><span class="s0">np</span><span class="s2">.</span><span class="s0">arange</span><span class="s2">(</span><span class="s5">18</span><span class="s2">, </span><span class="s0">step</span><span class="s2">=</span><span class="s5">3</span><span class="s2">))</span>
        <span class="s0">a </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">arange</span><span class="s2">(</span><span class="s4">'1969-12-19'</span><span class="s2">, </span><span class="s5">22</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s5">2</span><span class="s2">), </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'M8'</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">a</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[D]'</span><span class="s2">))</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">a</span><span class="s2">,</span>
            <span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'1969-12-19'</span><span class="s2">) + </span><span class="s0">np</span><span class="s2">.</span><span class="s0">arange</span><span class="s2">(</span><span class="s5">22</span><span class="s2">, </span><span class="s0">step</span><span class="s2">=</span><span class="s5">2</span><span class="s2">))</span>

        <span class="s3"># Step of 0 is disallowed</span>
        <span class="s0">assert_raises</span><span class="s2">(</span><span class="s0">ValueError</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">arange</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'today'</span><span class="s2">),</span>
                                <span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'today'</span><span class="s2">) + </span><span class="s5">3</span><span class="s2">, </span><span class="s5">0</span><span class="s2">)</span>
        <span class="s3"># Promotion across nonlinear unit boundaries is disallowed</span>
        <span class="s0">assert_raises</span><span class="s2">(</span><span class="s0">TypeError</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">arange</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'2011-03-01'</span><span class="s2">, </span><span class="s4">'D'</span><span class="s2">),</span>
                                <span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s5">5</span><span class="s2">, </span><span class="s4">'M'</span><span class="s2">))</span>
        <span class="s0">assert_raises</span><span class="s2">(</span><span class="s0">TypeError</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">arange</span><span class="s2">,</span>
                                <span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'2012-02-03T14'</span><span class="s2">, </span><span class="s4">'s'</span><span class="s2">),</span>
                                <span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s5">5</span><span class="s2">, </span><span class="s4">'Y'</span><span class="s2">))</span>

    <span class="s1">def </span><span class="s0">test_datetime_arange_no_dtype</span><span class="s2">(</span><span class="s0">self</span><span class="s2">):</span>
        <span class="s0">d </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">(</span><span class="s4">'2010-01-04'</span><span class="s2">, </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">&quot;M8[D]&quot;</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">arange</span><span class="s2">(</span><span class="s0">d</span><span class="s2">, </span><span class="s0">d </span><span class="s2">+ </span><span class="s5">1</span><span class="s2">), </span><span class="s0">d</span><span class="s2">)</span>
        <span class="s0">assert_raises</span><span class="s2">(</span><span class="s0">ValueError</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">arange</span><span class="s2">, </span><span class="s0">d</span><span class="s2">)</span>

    <span class="s1">def </span><span class="s0">test_timedelta_arange</span><span class="s2">(</span><span class="s0">self</span><span class="s2">):</span>
        <span class="s0">a </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">arange</span><span class="s2">(</span><span class="s5">3</span><span class="s2">, </span><span class="s5">10</span><span class="s2">, </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'m8'</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">a</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'m8'</span><span class="s2">))</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">a</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s5">0</span><span class="s2">) + </span><span class="s0">np</span><span class="s2">.</span><span class="s0">arange</span><span class="s2">(</span><span class="s5">3</span><span class="s2">, </span><span class="s5">10</span><span class="s2">))</span>

        <span class="s0">a </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">arange</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s5">3</span><span class="s2">, </span><span class="s4">'s'</span><span class="s2">), </span><span class="s5">10</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'m8'</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">a</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'m8[s]'</span><span class="s2">))</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">a</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s4">'s'</span><span class="s2">) + </span><span class="s0">np</span><span class="s2">.</span><span class="s0">arange</span><span class="s2">(</span><span class="s5">3</span><span class="s2">, </span><span class="s5">10</span><span class="s2">, </span><span class="s5">2</span><span class="s2">))</span>

        <span class="s3"># Step of 0 is disallowed</span>
        <span class="s0">assert_raises</span><span class="s2">(</span><span class="s0">ValueError</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">arange</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s5">0</span><span class="s2">),</span>
                                <span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s5">5</span><span class="s2">), </span><span class="s5">0</span><span class="s2">)</span>
        <span class="s3"># Promotion across nonlinear unit boundaries is disallowed</span>
        <span class="s0">assert_raises</span><span class="s2">(</span><span class="s0">TypeError</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">arange</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s4">'D'</span><span class="s2">),</span>
                                <span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s5">5</span><span class="s2">, </span><span class="s4">'M'</span><span class="s2">))</span>
        <span class="s0">assert_raises</span><span class="s2">(</span><span class="s0">TypeError</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">arange</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s4">'Y'</span><span class="s2">),</span>
                                <span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s5">5</span><span class="s2">, </span><span class="s4">'D'</span><span class="s2">))</span>

    <span class="s2">@</span><span class="s0">pytest</span><span class="s2">.</span><span class="s0">mark</span><span class="s2">.</span><span class="s0">parametrize</span><span class="s2">(</span><span class="s4">&quot;val1, val2, expected&quot;</span><span class="s2">, [</span>
        <span class="s3"># case from gh-12092</span>
        <span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s5">7</span><span class="s2">, </span><span class="s4">'s'</span><span class="s2">),</span>
         <span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s5">3</span><span class="s2">, </span><span class="s4">'s'</span><span class="s2">),</span>
         <span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s5">1</span><span class="s2">, </span><span class="s4">'s'</span><span class="s2">)),</span>
        <span class="s3"># negative value cases</span>
        <span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s5">3</span><span class="s2">, </span><span class="s4">'s'</span><span class="s2">),</span>
         <span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(-</span><span class="s5">2</span><span class="s2">, </span><span class="s4">'s'</span><span class="s2">),</span>
         <span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(-</span><span class="s5">1</span><span class="s2">, </span><span class="s4">'s'</span><span class="s2">)),</span>
        <span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(-</span><span class="s5">3</span><span class="s2">, </span><span class="s4">'s'</span><span class="s2">),</span>
         <span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s5">2</span><span class="s2">, </span><span class="s4">'s'</span><span class="s2">),</span>
         <span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s5">1</span><span class="s2">, </span><span class="s4">'s'</span><span class="s2">)),</span>
        <span class="s3"># larger value cases</span>
        <span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s5">17</span><span class="s2">, </span><span class="s4">'s'</span><span class="s2">),</span>
         <span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s5">22</span><span class="s2">, </span><span class="s4">'s'</span><span class="s2">),</span>
         <span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s5">17</span><span class="s2">, </span><span class="s4">'s'</span><span class="s2">)),</span>
        <span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s5">22</span><span class="s2">, </span><span class="s4">'s'</span><span class="s2">),</span>
         <span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s5">17</span><span class="s2">, </span><span class="s4">'s'</span><span class="s2">),</span>
         <span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s5">5</span><span class="s2">, </span><span class="s4">'s'</span><span class="s2">)),</span>
        <span class="s3"># different units</span>
        <span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s5">1</span><span class="s2">, </span><span class="s4">'m'</span><span class="s2">),</span>
         <span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s5">57</span><span class="s2">, </span><span class="s4">'s'</span><span class="s2">),</span>
         <span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s5">3</span><span class="s2">, </span><span class="s4">'s'</span><span class="s2">)),</span>
        <span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s5">1</span><span class="s2">, </span><span class="s4">'us'</span><span class="s2">),</span>
         <span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s5">727</span><span class="s2">, </span><span class="s4">'ns'</span><span class="s2">),</span>
         <span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s5">273</span><span class="s2">, </span><span class="s4">'ns'</span><span class="s2">)),</span>
        <span class="s3"># NaT is propagated</span>
        <span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s4">'NaT'</span><span class="s2">),</span>
         <span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s5">50</span><span class="s2">, </span><span class="s4">'ns'</span><span class="s2">),</span>
         <span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s4">'NaT'</span><span class="s2">)),</span>
        <span class="s3"># Y % M works</span>
        <span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s5">2</span><span class="s2">, </span><span class="s4">'Y'</span><span class="s2">),</span>
         <span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s5">22</span><span class="s2">, </span><span class="s4">'M'</span><span class="s2">),</span>
         <span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s5">2</span><span class="s2">, </span><span class="s4">'M'</span><span class="s2">)),</span>
        <span class="s2">])</span>
    <span class="s1">def </span><span class="s0">test_timedelta_modulus</span><span class="s2">(</span><span class="s0">self</span><span class="s2">, </span><span class="s0">val1</span><span class="s2">, </span><span class="s0">val2</span><span class="s2">, </span><span class="s0">expected</span><span class="s2">):</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">val1 </span><span class="s2">% </span><span class="s0">val2</span><span class="s2">, </span><span class="s0">expected</span><span class="s2">)</span>

    <span class="s2">@</span><span class="s0">pytest</span><span class="s2">.</span><span class="s0">mark</span><span class="s2">.</span><span class="s0">parametrize</span><span class="s2">(</span><span class="s4">&quot;val1, val2&quot;</span><span class="s2">, [</span>
        <span class="s3"># years and months sometimes can't be unambiguously</span>
        <span class="s3"># divided for modulus operation</span>
        <span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s5">7</span><span class="s2">, </span><span class="s4">'Y'</span><span class="s2">),</span>
         <span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s5">3</span><span class="s2">, </span><span class="s4">'s'</span><span class="s2">)),</span>
        <span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s5">7</span><span class="s2">, </span><span class="s4">'M'</span><span class="s2">),</span>
         <span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s5">1</span><span class="s2">, </span><span class="s4">'D'</span><span class="s2">)),</span>
        <span class="s2">])</span>
    <span class="s1">def </span><span class="s0">test_timedelta_modulus_error</span><span class="s2">(</span><span class="s0">self</span><span class="s2">, </span><span class="s0">val1</span><span class="s2">, </span><span class="s0">val2</span><span class="s2">):</span>
        <span class="s1">with </span><span class="s0">assert_raises_regex</span><span class="s2">(</span><span class="s0">TypeError</span><span class="s2">, </span><span class="s4">&quot;common metadata divisor&quot;</span><span class="s2">):</span>
            <span class="s0">val1 </span><span class="s2">% </span><span class="s0">val2</span>

    <span class="s2">@</span><span class="s0">pytest</span><span class="s2">.</span><span class="s0">mark</span><span class="s2">.</span><span class="s0">skipif</span><span class="s2">(</span><span class="s0">IS_WASM</span><span class="s2">, </span><span class="s0">reason</span><span class="s2">=</span><span class="s4">&quot;fp errors don't work in wasm&quot;</span><span class="s2">)</span>
    <span class="s1">def </span><span class="s0">test_timedelta_modulus_div_by_zero</span><span class="s2">(</span><span class="s0">self</span><span class="s2">):</span>
        <span class="s1">with </span><span class="s0">assert_warns</span><span class="s2">(</span><span class="s0">RuntimeWarning</span><span class="s2">):</span>
            <span class="s0">actual </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s5">10</span><span class="s2">, </span><span class="s4">'s'</span><span class="s2">) % </span><span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s4">'s'</span><span class="s2">)</span>
            <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">actual</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s4">'NaT'</span><span class="s2">))</span>

    <span class="s2">@</span><span class="s0">pytest</span><span class="s2">.</span><span class="s0">mark</span><span class="s2">.</span><span class="s0">parametrize</span><span class="s2">(</span><span class="s4">&quot;val1, val2&quot;</span><span class="s2">, [</span>
        <span class="s3"># cases where one operand is not</span>
        <span class="s3"># timedelta64</span>
        <span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s5">7</span><span class="s2">, </span><span class="s4">'Y'</span><span class="s2">),</span>
         <span class="s5">15</span><span class="s2">,),</span>
        <span class="s2">(</span><span class="s5">7.5</span><span class="s2">,</span>
         <span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s5">1</span><span class="s2">, </span><span class="s4">'D'</span><span class="s2">)),</span>
        <span class="s2">])</span>
    <span class="s1">def </span><span class="s0">test_timedelta_modulus_type_resolution</span><span class="s2">(</span><span class="s0">self</span><span class="s2">, </span><span class="s0">val1</span><span class="s2">, </span><span class="s0">val2</span><span class="s2">):</span>
        <span class="s3"># NOTE: some of the operations may be supported</span>
        <span class="s3"># in the future</span>
        <span class="s1">with </span><span class="s0">assert_raises_regex</span><span class="s2">(</span><span class="s0">TypeError</span><span class="s2">,</span>
                                 <span class="s4">&quot;'remainder' cannot use operands with types&quot;</span><span class="s2">):</span>
            <span class="s0">val1 </span><span class="s2">% </span><span class="s0">val2</span>

    <span class="s1">def </span><span class="s0">test_timedelta_arange_no_dtype</span><span class="s2">(</span><span class="s0">self</span><span class="s2">):</span>
        <span class="s0">d </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">(</span><span class="s5">5</span><span class="s2">, </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">&quot;m8[D]&quot;</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">arange</span><span class="s2">(</span><span class="s0">d</span><span class="s2">, </span><span class="s0">d </span><span class="s2">+ </span><span class="s5">1</span><span class="s2">), </span><span class="s0">d</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">arange</span><span class="s2">(</span><span class="s0">d</span><span class="s2">), </span><span class="s0">np</span><span class="s2">.</span><span class="s0">arange</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s0">d</span><span class="s2">))</span>

    <span class="s1">def </span><span class="s0">test_datetime_maximum_reduce</span><span class="s2">(</span><span class="s0">self</span><span class="s2">):</span>
        <span class="s0">a </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">([</span><span class="s4">'2010-01-02'</span><span class="s2">, </span><span class="s4">'1999-03-14'</span><span class="s2">, </span><span class="s4">'1833-03'</span><span class="s2">], </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'M8[D]'</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">maximum</span><span class="s2">.</span><span class="s0">reduce</span><span class="s2">(</span><span class="s0">a</span><span class="s2">).</span><span class="s0">dtype</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'M8[D]'</span><span class="s2">))</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">maximum</span><span class="s2">.</span><span class="s0">reduce</span><span class="s2">(</span><span class="s0">a</span><span class="s2">),</span>
                     <span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'2010-01-02'</span><span class="s2">))</span>

        <span class="s0">a </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">([</span><span class="s5">1</span><span class="s2">, </span><span class="s5">4</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">7</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'m8[s]'</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">maximum</span><span class="s2">.</span><span class="s0">reduce</span><span class="s2">(</span><span class="s0">a</span><span class="s2">).</span><span class="s0">dtype</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">'m8[s]'</span><span class="s2">))</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">maximum</span><span class="s2">.</span><span class="s0">reduce</span><span class="s2">(</span><span class="s0">a</span><span class="s2">),</span>
                     <span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s5">7</span><span class="s2">, </span><span class="s4">'s'</span><span class="s2">))</span>

    <span class="s1">def </span><span class="s0">test_timedelta_correct_mean</span><span class="s2">(</span><span class="s0">self</span><span class="s2">):</span>
        <span class="s3"># test mainly because it worked only via a bug in that allowed:</span>
        <span class="s3"># `timedelta.sum(dtype=&quot;f8&quot;)` to ignore the dtype request.</span>
        <span class="s0">a </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">arange</span><span class="s2">(</span><span class="s5">1000</span><span class="s2">, </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">&quot;m8[s]&quot;</span><span class="s2">)</span>
        <span class="s0">assert_array_equal</span><span class="s2">(</span><span class="s0">a</span><span class="s2">.</span><span class="s0">mean</span><span class="s2">(), </span><span class="s0">a</span><span class="s2">.</span><span class="s0">sum</span><span class="s2">() / </span><span class="s0">len</span><span class="s2">(</span><span class="s0">a</span><span class="s2">))</span>

    <span class="s1">def </span><span class="s0">test_datetime_no_subtract_reducelike</span><span class="s2">(</span><span class="s0">self</span><span class="s2">):</span>
        <span class="s3"># subtracting two datetime64 works, but we cannot reduce it, since</span>
        <span class="s3"># the result of that subtraction will have a different dtype.</span>
        <span class="s0">arr </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">([</span><span class="s4">&quot;2021-12-02&quot;</span><span class="s2">, </span><span class="s4">&quot;2019-05-12&quot;</span><span class="s2">], </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">&quot;M8[ms]&quot;</span><span class="s2">)</span>
        <span class="s0">msg </span><span class="s2">= </span><span class="s4">r&quot;the resolved dtypes are not compatible&quot;</span>

        <span class="s1">with </span><span class="s0">pytest</span><span class="s2">.</span><span class="s0">raises</span><span class="s2">(</span><span class="s0">TypeError</span><span class="s2">, </span><span class="s0">match</span><span class="s2">=</span><span class="s0">msg</span><span class="s2">):</span>
            <span class="s0">np</span><span class="s2">.</span><span class="s0">subtract</span><span class="s2">.</span><span class="s0">reduce</span><span class="s2">(</span><span class="s0">arr</span><span class="s2">)</span>

        <span class="s1">with </span><span class="s0">pytest</span><span class="s2">.</span><span class="s0">raises</span><span class="s2">(</span><span class="s0">TypeError</span><span class="s2">, </span><span class="s0">match</span><span class="s2">=</span><span class="s0">msg</span><span class="s2">):</span>
            <span class="s0">np</span><span class="s2">.</span><span class="s0">subtract</span><span class="s2">.</span><span class="s0">accumulate</span><span class="s2">(</span><span class="s0">arr</span><span class="s2">)</span>

        <span class="s1">with </span><span class="s0">pytest</span><span class="s2">.</span><span class="s0">raises</span><span class="s2">(</span><span class="s0">TypeError</span><span class="s2">, </span><span class="s0">match</span><span class="s2">=</span><span class="s0">msg</span><span class="s2">):</span>
            <span class="s0">np</span><span class="s2">.</span><span class="s0">subtract</span><span class="s2">.</span><span class="s0">reduceat</span><span class="s2">(</span><span class="s0">arr</span><span class="s2">, [</span><span class="s5">0</span><span class="s2">])</span>

    <span class="s1">def </span><span class="s0">test_datetime_busday_offset</span><span class="s2">(</span><span class="s0">self</span><span class="s2">):</span>
        <span class="s3"># First Monday in June</span>
        <span class="s0">assert_equal</span><span class="s2">(</span>
            <span class="s0">np</span><span class="s2">.</span><span class="s0">busday_offset</span><span class="s2">(</span><span class="s4">'2011-06'</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s0">roll</span><span class="s2">=</span><span class="s4">'forward'</span><span class="s2">, </span><span class="s0">weekmask</span><span class="s2">=</span><span class="s4">'Mon'</span><span class="s2">),</span>
            <span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'2011-06-06'</span><span class="s2">))</span>
        <span class="s3"># Last Monday in June</span>
        <span class="s0">assert_equal</span><span class="s2">(</span>
            <span class="s0">np</span><span class="s2">.</span><span class="s0">busday_offset</span><span class="s2">(</span><span class="s4">'2011-07'</span><span class="s2">, -</span><span class="s5">1</span><span class="s2">, </span><span class="s0">roll</span><span class="s2">=</span><span class="s4">'forward'</span><span class="s2">, </span><span class="s0">weekmask</span><span class="s2">=</span><span class="s4">'Mon'</span><span class="s2">),</span>
            <span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'2011-06-27'</span><span class="s2">))</span>
        <span class="s0">assert_equal</span><span class="s2">(</span>
            <span class="s0">np</span><span class="s2">.</span><span class="s0">busday_offset</span><span class="s2">(</span><span class="s4">'2011-07'</span><span class="s2">, -</span><span class="s5">1</span><span class="s2">, </span><span class="s0">roll</span><span class="s2">=</span><span class="s4">'forward'</span><span class="s2">, </span><span class="s0">weekmask</span><span class="s2">=</span><span class="s4">'Mon'</span><span class="s2">),</span>
            <span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'2011-06-27'</span><span class="s2">))</span>

        <span class="s3"># Default M-F business days, different roll modes</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">busday_offset</span><span class="s2">(</span><span class="s4">'2010-08'</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s0">roll</span><span class="s2">=</span><span class="s4">'backward'</span><span class="s2">),</span>
                     <span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'2010-07-30'</span><span class="s2">))</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">busday_offset</span><span class="s2">(</span><span class="s4">'2010-08'</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s0">roll</span><span class="s2">=</span><span class="s4">'preceding'</span><span class="s2">),</span>
                     <span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'2010-07-30'</span><span class="s2">))</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">busday_offset</span><span class="s2">(</span><span class="s4">'2010-08'</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s0">roll</span><span class="s2">=</span><span class="s4">'modifiedpreceding'</span><span class="s2">),</span>
                     <span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'2010-08-02'</span><span class="s2">))</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">busday_offset</span><span class="s2">(</span><span class="s4">'2010-08'</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s0">roll</span><span class="s2">=</span><span class="s4">'modifiedfollowing'</span><span class="s2">),</span>
                     <span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'2010-08-02'</span><span class="s2">))</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">busday_offset</span><span class="s2">(</span><span class="s4">'2010-08'</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s0">roll</span><span class="s2">=</span><span class="s4">'forward'</span><span class="s2">),</span>
                     <span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'2010-08-02'</span><span class="s2">))</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">busday_offset</span><span class="s2">(</span><span class="s4">'2010-08'</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s0">roll</span><span class="s2">=</span><span class="s4">'following'</span><span class="s2">),</span>
                     <span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'2010-08-02'</span><span class="s2">))</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">busday_offset</span><span class="s2">(</span><span class="s4">'2010-10-30'</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s0">roll</span><span class="s2">=</span><span class="s4">'following'</span><span class="s2">),</span>
                     <span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'2010-11-01'</span><span class="s2">))</span>
        <span class="s0">assert_equal</span><span class="s2">(</span>
                <span class="s0">np</span><span class="s2">.</span><span class="s0">busday_offset</span><span class="s2">(</span><span class="s4">'2010-10-30'</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s0">roll</span><span class="s2">=</span><span class="s4">'modifiedfollowing'</span><span class="s2">),</span>
                <span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'2010-10-29'</span><span class="s2">))</span>
        <span class="s0">assert_equal</span><span class="s2">(</span>
                <span class="s0">np</span><span class="s2">.</span><span class="s0">busday_offset</span><span class="s2">(</span><span class="s4">'2010-10-30'</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s0">roll</span><span class="s2">=</span><span class="s4">'modifiedpreceding'</span><span class="s2">),</span>
                <span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'2010-10-29'</span><span class="s2">))</span>
        <span class="s0">assert_equal</span><span class="s2">(</span>
                <span class="s0">np</span><span class="s2">.</span><span class="s0">busday_offset</span><span class="s2">(</span><span class="s4">'2010-10-16'</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s0">roll</span><span class="s2">=</span><span class="s4">'modifiedfollowing'</span><span class="s2">),</span>
                <span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'2010-10-18'</span><span class="s2">))</span>
        <span class="s0">assert_equal</span><span class="s2">(</span>
                <span class="s0">np</span><span class="s2">.</span><span class="s0">busday_offset</span><span class="s2">(</span><span class="s4">'2010-10-16'</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s0">roll</span><span class="s2">=</span><span class="s4">'modifiedpreceding'</span><span class="s2">),</span>
                <span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'2010-10-15'</span><span class="s2">))</span>
        <span class="s3"># roll='raise' by default</span>
        <span class="s0">assert_raises</span><span class="s2">(</span><span class="s0">ValueError</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">busday_offset</span><span class="s2">, </span><span class="s4">'2011-06-04'</span><span class="s2">, </span><span class="s5">0</span><span class="s2">)</span>

        <span class="s3"># Bigger offset values</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">busday_offset</span><span class="s2">(</span><span class="s4">'2006-02-01'</span><span class="s2">, </span><span class="s5">25</span><span class="s2">),</span>
                     <span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'2006-03-08'</span><span class="s2">))</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">busday_offset</span><span class="s2">(</span><span class="s4">'2006-03-08'</span><span class="s2">, -</span><span class="s5">25</span><span class="s2">),</span>
                     <span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'2006-02-01'</span><span class="s2">))</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">busday_offset</span><span class="s2">(</span><span class="s4">'2007-02-25'</span><span class="s2">, </span><span class="s5">11</span><span class="s2">, </span><span class="s0">weekmask</span><span class="s2">=</span><span class="s4">'SatSun'</span><span class="s2">),</span>
                     <span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'2007-04-07'</span><span class="s2">))</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">busday_offset</span><span class="s2">(</span><span class="s4">'2007-04-07'</span><span class="s2">, -</span><span class="s5">11</span><span class="s2">, </span><span class="s0">weekmask</span><span class="s2">=</span><span class="s4">'SatSun'</span><span class="s2">),</span>
                     <span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'2007-02-25'</span><span class="s2">))</span>

        <span class="s3"># NaT values when roll is not raise</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">busday_offset</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'NaT'</span><span class="s2">), </span><span class="s5">1</span><span class="s2">, </span><span class="s0">roll</span><span class="s2">=</span><span class="s4">'nat'</span><span class="s2">),</span>
                     <span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'NaT'</span><span class="s2">))</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">busday_offset</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'NaT'</span><span class="s2">), </span><span class="s5">1</span><span class="s2">, </span><span class="s0">roll</span><span class="s2">=</span><span class="s4">'following'</span><span class="s2">),</span>
                     <span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'NaT'</span><span class="s2">))</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">busday_offset</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'NaT'</span><span class="s2">), </span><span class="s5">1</span><span class="s2">, </span><span class="s0">roll</span><span class="s2">=</span><span class="s4">'preceding'</span><span class="s2">),</span>
                     <span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'NaT'</span><span class="s2">))</span>

    <span class="s1">def </span><span class="s0">test_datetime_busdaycalendar</span><span class="s2">(</span><span class="s0">self</span><span class="s2">):</span>
        <span class="s3"># Check that it removes NaT, duplicates, and weekends</span>
        <span class="s3"># and sorts the result.</span>
        <span class="s0">bdd </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">busdaycalendar</span><span class="s2">(</span>
            <span class="s0">holidays</span><span class="s2">=[</span><span class="s4">'NaT'</span><span class="s2">, </span><span class="s4">'2011-01-17'</span><span class="s2">, </span><span class="s4">'2011-03-06'</span><span class="s2">, </span><span class="s4">'NaT'</span><span class="s2">,</span>
                       <span class="s4">'2011-12-26'</span><span class="s2">, </span><span class="s4">'2011-05-30'</span><span class="s2">, </span><span class="s4">'2011-01-17'</span><span class="s2">])</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">bdd</span><span class="s2">.</span><span class="s0">holidays</span><span class="s2">,</span>
            <span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">([</span><span class="s4">'2011-01-17'</span><span class="s2">, </span><span class="s4">'2011-05-30'</span><span class="s2">, </span><span class="s4">'2011-12-26'</span><span class="s2">], </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'M8'</span><span class="s2">))</span>
        <span class="s3"># Default M-F weekmask</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">bdd</span><span class="s2">.</span><span class="s0">weekmask</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">([</span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">], </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'?'</span><span class="s2">))</span>

        <span class="s3"># Check string weekmask with varying whitespace.</span>
        <span class="s0">bdd </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">busdaycalendar</span><span class="s2">(</span><span class="s0">weekmask</span><span class="s2">=</span><span class="s4">&quot;Sun TueWed  Thu</span><span class="s1">\t</span><span class="s4">Fri&quot;</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">bdd</span><span class="s2">.</span><span class="s0">weekmask</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">([</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">], </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'?'</span><span class="s2">))</span>

        <span class="s3"># Check length 7 0/1 string</span>
        <span class="s0">bdd </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">busdaycalendar</span><span class="s2">(</span><span class="s0">weekmask</span><span class="s2">=</span><span class="s4">&quot;0011001&quot;</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">bdd</span><span class="s2">.</span><span class="s0">weekmask</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">([</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">], </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'?'</span><span class="s2">))</span>

        <span class="s3"># Check length 7 string weekmask.</span>
        <span class="s0">bdd </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">busdaycalendar</span><span class="s2">(</span><span class="s0">weekmask</span><span class="s2">=</span><span class="s4">&quot;Mon Tue&quot;</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">bdd</span><span class="s2">.</span><span class="s0">weekmask</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">([</span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">], </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'?'</span><span class="s2">))</span>

        <span class="s3"># All-zeros weekmask should raise</span>
        <span class="s0">assert_raises</span><span class="s2">(</span><span class="s0">ValueError</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">busdaycalendar</span><span class="s2">, </span><span class="s0">weekmask</span><span class="s2">=[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">])</span>
        <span class="s3"># weekday names must be correct case</span>
        <span class="s0">assert_raises</span><span class="s2">(</span><span class="s0">ValueError</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">busdaycalendar</span><span class="s2">, </span><span class="s0">weekmask</span><span class="s2">=</span><span class="s4">&quot;satsun&quot;</span><span class="s2">)</span>
        <span class="s3"># All-zeros weekmask should raise</span>
        <span class="s0">assert_raises</span><span class="s2">(</span><span class="s0">ValueError</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">busdaycalendar</span><span class="s2">, </span><span class="s0">weekmask</span><span class="s2">=</span><span class="s4">&quot;&quot;</span><span class="s2">)</span>
        <span class="s3"># Invalid weekday name codes should raise</span>
        <span class="s0">assert_raises</span><span class="s2">(</span><span class="s0">ValueError</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">busdaycalendar</span><span class="s2">, </span><span class="s0">weekmask</span><span class="s2">=</span><span class="s4">&quot;Mon Tue We&quot;</span><span class="s2">)</span>
        <span class="s0">assert_raises</span><span class="s2">(</span><span class="s0">ValueError</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">busdaycalendar</span><span class="s2">, </span><span class="s0">weekmask</span><span class="s2">=</span><span class="s4">&quot;Max&quot;</span><span class="s2">)</span>
        <span class="s0">assert_raises</span><span class="s2">(</span><span class="s0">ValueError</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">busdaycalendar</span><span class="s2">, </span><span class="s0">weekmask</span><span class="s2">=</span><span class="s4">&quot;Monday Tue&quot;</span><span class="s2">)</span>

    <span class="s1">def </span><span class="s0">test_datetime_busday_holidays_offset</span><span class="s2">(</span><span class="s0">self</span><span class="s2">):</span>
        <span class="s3"># With exactly one holiday</span>
        <span class="s0">assert_equal</span><span class="s2">(</span>
            <span class="s0">np</span><span class="s2">.</span><span class="s0">busday_offset</span><span class="s2">(</span><span class="s4">'2011-11-10'</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s0">holidays</span><span class="s2">=[</span><span class="s4">'2011-11-11'</span><span class="s2">]),</span>
            <span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'2011-11-14'</span><span class="s2">))</span>
        <span class="s0">assert_equal</span><span class="s2">(</span>
            <span class="s0">np</span><span class="s2">.</span><span class="s0">busday_offset</span><span class="s2">(</span><span class="s4">'2011-11-04'</span><span class="s2">, </span><span class="s5">5</span><span class="s2">, </span><span class="s0">holidays</span><span class="s2">=[</span><span class="s4">'2011-11-11'</span><span class="s2">]),</span>
            <span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'2011-11-14'</span><span class="s2">))</span>
        <span class="s0">assert_equal</span><span class="s2">(</span>
            <span class="s0">np</span><span class="s2">.</span><span class="s0">busday_offset</span><span class="s2">(</span><span class="s4">'2011-11-10'</span><span class="s2">, </span><span class="s5">5</span><span class="s2">, </span><span class="s0">holidays</span><span class="s2">=[</span><span class="s4">'2011-11-11'</span><span class="s2">]),</span>
            <span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'2011-11-18'</span><span class="s2">))</span>
        <span class="s0">assert_equal</span><span class="s2">(</span>
            <span class="s0">np</span><span class="s2">.</span><span class="s0">busday_offset</span><span class="s2">(</span><span class="s4">'2011-11-14'</span><span class="s2">, -</span><span class="s5">1</span><span class="s2">, </span><span class="s0">holidays</span><span class="s2">=[</span><span class="s4">'2011-11-11'</span><span class="s2">]),</span>
            <span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'2011-11-10'</span><span class="s2">))</span>
        <span class="s0">assert_equal</span><span class="s2">(</span>
            <span class="s0">np</span><span class="s2">.</span><span class="s0">busday_offset</span><span class="s2">(</span><span class="s4">'2011-11-18'</span><span class="s2">, -</span><span class="s5">5</span><span class="s2">, </span><span class="s0">holidays</span><span class="s2">=[</span><span class="s4">'2011-11-11'</span><span class="s2">]),</span>
            <span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'2011-11-10'</span><span class="s2">))</span>
        <span class="s0">assert_equal</span><span class="s2">(</span>
            <span class="s0">np</span><span class="s2">.</span><span class="s0">busday_offset</span><span class="s2">(</span><span class="s4">'2011-11-14'</span><span class="s2">, -</span><span class="s5">5</span><span class="s2">, </span><span class="s0">holidays</span><span class="s2">=[</span><span class="s4">'2011-11-11'</span><span class="s2">]),</span>
            <span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'2011-11-04'</span><span class="s2">))</span>
        <span class="s3"># With the holiday appearing twice</span>
        <span class="s0">assert_equal</span><span class="s2">(</span>
            <span class="s0">np</span><span class="s2">.</span><span class="s0">busday_offset</span><span class="s2">(</span><span class="s4">'2011-11-10'</span><span class="s2">, </span><span class="s5">1</span><span class="s2">,</span>
                <span class="s0">holidays</span><span class="s2">=[</span><span class="s4">'2011-11-11'</span><span class="s2">, </span><span class="s4">'2011-11-11'</span><span class="s2">]),</span>
            <span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'2011-11-14'</span><span class="s2">))</span>
        <span class="s0">assert_equal</span><span class="s2">(</span>
            <span class="s0">np</span><span class="s2">.</span><span class="s0">busday_offset</span><span class="s2">(</span><span class="s4">'2011-11-14'</span><span class="s2">, -</span><span class="s5">1</span><span class="s2">,</span>
                <span class="s0">holidays</span><span class="s2">=[</span><span class="s4">'2011-11-11'</span><span class="s2">, </span><span class="s4">'2011-11-11'</span><span class="s2">]),</span>
            <span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'2011-11-10'</span><span class="s2">))</span>
        <span class="s3"># With a NaT holiday</span>
        <span class="s0">assert_equal</span><span class="s2">(</span>
            <span class="s0">np</span><span class="s2">.</span><span class="s0">busday_offset</span><span class="s2">(</span><span class="s4">'2011-11-10'</span><span class="s2">, </span><span class="s5">1</span><span class="s2">,</span>
                <span class="s0">holidays</span><span class="s2">=[</span><span class="s4">'2011-11-11'</span><span class="s2">, </span><span class="s4">'NaT'</span><span class="s2">]),</span>
            <span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'2011-11-14'</span><span class="s2">))</span>
        <span class="s0">assert_equal</span><span class="s2">(</span>
            <span class="s0">np</span><span class="s2">.</span><span class="s0">busday_offset</span><span class="s2">(</span><span class="s4">'2011-11-14'</span><span class="s2">, -</span><span class="s5">1</span><span class="s2">,</span>
                <span class="s0">holidays</span><span class="s2">=[</span><span class="s4">'NaT'</span><span class="s2">, </span><span class="s4">'2011-11-11'</span><span class="s2">]),</span>
            <span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'2011-11-10'</span><span class="s2">))</span>
        <span class="s3"># With another holiday after</span>
        <span class="s0">assert_equal</span><span class="s2">(</span>
            <span class="s0">np</span><span class="s2">.</span><span class="s0">busday_offset</span><span class="s2">(</span><span class="s4">'2011-11-10'</span><span class="s2">, </span><span class="s5">1</span><span class="s2">,</span>
                <span class="s0">holidays</span><span class="s2">=[</span><span class="s4">'2011-11-11'</span><span class="s2">, </span><span class="s4">'2011-11-24'</span><span class="s2">]),</span>
            <span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'2011-11-14'</span><span class="s2">))</span>
        <span class="s0">assert_equal</span><span class="s2">(</span>
            <span class="s0">np</span><span class="s2">.</span><span class="s0">busday_offset</span><span class="s2">(</span><span class="s4">'2011-11-14'</span><span class="s2">, -</span><span class="s5">1</span><span class="s2">,</span>
                <span class="s0">holidays</span><span class="s2">=[</span><span class="s4">'2011-11-11'</span><span class="s2">, </span><span class="s4">'2011-11-24'</span><span class="s2">]),</span>
            <span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'2011-11-10'</span><span class="s2">))</span>
        <span class="s3"># With another holiday before</span>
        <span class="s0">assert_equal</span><span class="s2">(</span>
            <span class="s0">np</span><span class="s2">.</span><span class="s0">busday_offset</span><span class="s2">(</span><span class="s4">'2011-11-10'</span><span class="s2">, </span><span class="s5">1</span><span class="s2">,</span>
                <span class="s0">holidays</span><span class="s2">=[</span><span class="s4">'2011-10-10'</span><span class="s2">, </span><span class="s4">'2011-11-11'</span><span class="s2">]),</span>
            <span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'2011-11-14'</span><span class="s2">))</span>
        <span class="s0">assert_equal</span><span class="s2">(</span>
            <span class="s0">np</span><span class="s2">.</span><span class="s0">busday_offset</span><span class="s2">(</span><span class="s4">'2011-11-14'</span><span class="s2">, -</span><span class="s5">1</span><span class="s2">,</span>
                <span class="s0">holidays</span><span class="s2">=[</span><span class="s4">'2011-10-10'</span><span class="s2">, </span><span class="s4">'2011-11-11'</span><span class="s2">]),</span>
            <span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'2011-11-10'</span><span class="s2">))</span>
        <span class="s3"># With another holiday before and after</span>
        <span class="s0">assert_equal</span><span class="s2">(</span>
            <span class="s0">np</span><span class="s2">.</span><span class="s0">busday_offset</span><span class="s2">(</span><span class="s4">'2011-11-10'</span><span class="s2">, </span><span class="s5">1</span><span class="s2">,</span>
                <span class="s0">holidays</span><span class="s2">=[</span><span class="s4">'2011-10-10'</span><span class="s2">, </span><span class="s4">'2011-11-11'</span><span class="s2">, </span><span class="s4">'2011-11-24'</span><span class="s2">]),</span>
            <span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'2011-11-14'</span><span class="s2">))</span>
        <span class="s0">assert_equal</span><span class="s2">(</span>
            <span class="s0">np</span><span class="s2">.</span><span class="s0">busday_offset</span><span class="s2">(</span><span class="s4">'2011-11-14'</span><span class="s2">, -</span><span class="s5">1</span><span class="s2">,</span>
                <span class="s0">holidays</span><span class="s2">=[</span><span class="s4">'2011-10-10'</span><span class="s2">, </span><span class="s4">'2011-11-11'</span><span class="s2">, </span><span class="s4">'2011-11-24'</span><span class="s2">]),</span>
            <span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'2011-11-10'</span><span class="s2">))</span>

        <span class="s3"># A bigger forward jump across more than one week/holiday</span>
        <span class="s0">holidays </span><span class="s2">= [</span><span class="s4">'2011-10-10'</span><span class="s2">, </span><span class="s4">'2011-11-11'</span><span class="s2">, </span><span class="s4">'2011-11-24'</span><span class="s2">,</span>
                  <span class="s4">'2011-12-25'</span><span class="s2">, </span><span class="s4">'2011-05-30'</span><span class="s2">, </span><span class="s4">'2011-02-21'</span><span class="s2">,</span>
                  <span class="s4">'2011-12-26'</span><span class="s2">, </span><span class="s4">'2012-01-02'</span><span class="s2">]</span>
        <span class="s0">bdd </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">busdaycalendar</span><span class="s2">(</span><span class="s0">weekmask</span><span class="s2">=</span><span class="s4">'1111100'</span><span class="s2">, </span><span class="s0">holidays</span><span class="s2">=</span><span class="s0">holidays</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span>
            <span class="s0">np</span><span class="s2">.</span><span class="s0">busday_offset</span><span class="s2">(</span><span class="s4">'2011-10-03'</span><span class="s2">, </span><span class="s5">4</span><span class="s2">, </span><span class="s0">holidays</span><span class="s2">=</span><span class="s0">holidays</span><span class="s2">),</span>
            <span class="s0">np</span><span class="s2">.</span><span class="s0">busday_offset</span><span class="s2">(</span><span class="s4">'2011-10-03'</span><span class="s2">, </span><span class="s5">4</span><span class="s2">))</span>
        <span class="s0">assert_equal</span><span class="s2">(</span>
            <span class="s0">np</span><span class="s2">.</span><span class="s0">busday_offset</span><span class="s2">(</span><span class="s4">'2011-10-03'</span><span class="s2">, </span><span class="s5">5</span><span class="s2">, </span><span class="s0">holidays</span><span class="s2">=</span><span class="s0">holidays</span><span class="s2">),</span>
            <span class="s0">np</span><span class="s2">.</span><span class="s0">busday_offset</span><span class="s2">(</span><span class="s4">'2011-10-03'</span><span class="s2">, </span><span class="s5">5 </span><span class="s2">+ </span><span class="s5">1</span><span class="s2">))</span>
        <span class="s0">assert_equal</span><span class="s2">(</span>
            <span class="s0">np</span><span class="s2">.</span><span class="s0">busday_offset</span><span class="s2">(</span><span class="s4">'2011-10-03'</span><span class="s2">, </span><span class="s5">27</span><span class="s2">, </span><span class="s0">holidays</span><span class="s2">=</span><span class="s0">holidays</span><span class="s2">),</span>
            <span class="s0">np</span><span class="s2">.</span><span class="s0">busday_offset</span><span class="s2">(</span><span class="s4">'2011-10-03'</span><span class="s2">, </span><span class="s5">27 </span><span class="s2">+ </span><span class="s5">1</span><span class="s2">))</span>
        <span class="s0">assert_equal</span><span class="s2">(</span>
            <span class="s0">np</span><span class="s2">.</span><span class="s0">busday_offset</span><span class="s2">(</span><span class="s4">'2011-10-03'</span><span class="s2">, </span><span class="s5">28</span><span class="s2">, </span><span class="s0">holidays</span><span class="s2">=</span><span class="s0">holidays</span><span class="s2">),</span>
            <span class="s0">np</span><span class="s2">.</span><span class="s0">busday_offset</span><span class="s2">(</span><span class="s4">'2011-10-03'</span><span class="s2">, </span><span class="s5">28 </span><span class="s2">+ </span><span class="s5">2</span><span class="s2">))</span>
        <span class="s0">assert_equal</span><span class="s2">(</span>
            <span class="s0">np</span><span class="s2">.</span><span class="s0">busday_offset</span><span class="s2">(</span><span class="s4">'2011-10-03'</span><span class="s2">, </span><span class="s5">35</span><span class="s2">, </span><span class="s0">holidays</span><span class="s2">=</span><span class="s0">holidays</span><span class="s2">),</span>
            <span class="s0">np</span><span class="s2">.</span><span class="s0">busday_offset</span><span class="s2">(</span><span class="s4">'2011-10-03'</span><span class="s2">, </span><span class="s5">35 </span><span class="s2">+ </span><span class="s5">2</span><span class="s2">))</span>
        <span class="s0">assert_equal</span><span class="s2">(</span>
            <span class="s0">np</span><span class="s2">.</span><span class="s0">busday_offset</span><span class="s2">(</span><span class="s4">'2011-10-03'</span><span class="s2">, </span><span class="s5">36</span><span class="s2">, </span><span class="s0">holidays</span><span class="s2">=</span><span class="s0">holidays</span><span class="s2">),</span>
            <span class="s0">np</span><span class="s2">.</span><span class="s0">busday_offset</span><span class="s2">(</span><span class="s4">'2011-10-03'</span><span class="s2">, </span><span class="s5">36 </span><span class="s2">+ </span><span class="s5">3</span><span class="s2">))</span>
        <span class="s0">assert_equal</span><span class="s2">(</span>
            <span class="s0">np</span><span class="s2">.</span><span class="s0">busday_offset</span><span class="s2">(</span><span class="s4">'2011-10-03'</span><span class="s2">, </span><span class="s5">56</span><span class="s2">, </span><span class="s0">holidays</span><span class="s2">=</span><span class="s0">holidays</span><span class="s2">),</span>
            <span class="s0">np</span><span class="s2">.</span><span class="s0">busday_offset</span><span class="s2">(</span><span class="s4">'2011-10-03'</span><span class="s2">, </span><span class="s5">56 </span><span class="s2">+ </span><span class="s5">3</span><span class="s2">))</span>
        <span class="s0">assert_equal</span><span class="s2">(</span>
            <span class="s0">np</span><span class="s2">.</span><span class="s0">busday_offset</span><span class="s2">(</span><span class="s4">'2011-10-03'</span><span class="s2">, </span><span class="s5">57</span><span class="s2">, </span><span class="s0">holidays</span><span class="s2">=</span><span class="s0">holidays</span><span class="s2">),</span>
            <span class="s0">np</span><span class="s2">.</span><span class="s0">busday_offset</span><span class="s2">(</span><span class="s4">'2011-10-03'</span><span class="s2">, </span><span class="s5">57 </span><span class="s2">+ </span><span class="s5">4</span><span class="s2">))</span>
        <span class="s0">assert_equal</span><span class="s2">(</span>
            <span class="s0">np</span><span class="s2">.</span><span class="s0">busday_offset</span><span class="s2">(</span><span class="s4">'2011-10-03'</span><span class="s2">, </span><span class="s5">60</span><span class="s2">, </span><span class="s0">holidays</span><span class="s2">=</span><span class="s0">holidays</span><span class="s2">),</span>
            <span class="s0">np</span><span class="s2">.</span><span class="s0">busday_offset</span><span class="s2">(</span><span class="s4">'2011-10-03'</span><span class="s2">, </span><span class="s5">60 </span><span class="s2">+ </span><span class="s5">4</span><span class="s2">))</span>
        <span class="s0">assert_equal</span><span class="s2">(</span>
            <span class="s0">np</span><span class="s2">.</span><span class="s0">busday_offset</span><span class="s2">(</span><span class="s4">'2011-10-03'</span><span class="s2">, </span><span class="s5">61</span><span class="s2">, </span><span class="s0">holidays</span><span class="s2">=</span><span class="s0">holidays</span><span class="s2">),</span>
            <span class="s0">np</span><span class="s2">.</span><span class="s0">busday_offset</span><span class="s2">(</span><span class="s4">'2011-10-03'</span><span class="s2">, </span><span class="s5">61 </span><span class="s2">+ </span><span class="s5">5</span><span class="s2">))</span>
        <span class="s0">assert_equal</span><span class="s2">(</span>
            <span class="s0">np</span><span class="s2">.</span><span class="s0">busday_offset</span><span class="s2">(</span><span class="s4">'2011-10-03'</span><span class="s2">, </span><span class="s5">61</span><span class="s2">, </span><span class="s0">busdaycal</span><span class="s2">=</span><span class="s0">bdd</span><span class="s2">),</span>
            <span class="s0">np</span><span class="s2">.</span><span class="s0">busday_offset</span><span class="s2">(</span><span class="s4">'2011-10-03'</span><span class="s2">, </span><span class="s5">61 </span><span class="s2">+ </span><span class="s5">5</span><span class="s2">))</span>
        <span class="s3"># A bigger backward jump across more than one week/holiday</span>
        <span class="s0">assert_equal</span><span class="s2">(</span>
            <span class="s0">np</span><span class="s2">.</span><span class="s0">busday_offset</span><span class="s2">(</span><span class="s4">'2012-01-03'</span><span class="s2">, -</span><span class="s5">1</span><span class="s2">, </span><span class="s0">holidays</span><span class="s2">=</span><span class="s0">holidays</span><span class="s2">),</span>
            <span class="s0">np</span><span class="s2">.</span><span class="s0">busday_offset</span><span class="s2">(</span><span class="s4">'2012-01-03'</span><span class="s2">, -</span><span class="s5">1 </span><span class="s2">- </span><span class="s5">1</span><span class="s2">))</span>
        <span class="s0">assert_equal</span><span class="s2">(</span>
            <span class="s0">np</span><span class="s2">.</span><span class="s0">busday_offset</span><span class="s2">(</span><span class="s4">'2012-01-03'</span><span class="s2">, -</span><span class="s5">4</span><span class="s2">, </span><span class="s0">holidays</span><span class="s2">=</span><span class="s0">holidays</span><span class="s2">),</span>
            <span class="s0">np</span><span class="s2">.</span><span class="s0">busday_offset</span><span class="s2">(</span><span class="s4">'2012-01-03'</span><span class="s2">, -</span><span class="s5">4 </span><span class="s2">- </span><span class="s5">1</span><span class="s2">))</span>
        <span class="s0">assert_equal</span><span class="s2">(</span>
            <span class="s0">np</span><span class="s2">.</span><span class="s0">busday_offset</span><span class="s2">(</span><span class="s4">'2012-01-03'</span><span class="s2">, -</span><span class="s5">5</span><span class="s2">, </span><span class="s0">holidays</span><span class="s2">=</span><span class="s0">holidays</span><span class="s2">),</span>
            <span class="s0">np</span><span class="s2">.</span><span class="s0">busday_offset</span><span class="s2">(</span><span class="s4">'2012-01-03'</span><span class="s2">, -</span><span class="s5">5 </span><span class="s2">- </span><span class="s5">2</span><span class="s2">))</span>
        <span class="s0">assert_equal</span><span class="s2">(</span>
            <span class="s0">np</span><span class="s2">.</span><span class="s0">busday_offset</span><span class="s2">(</span><span class="s4">'2012-01-03'</span><span class="s2">, -</span><span class="s5">25</span><span class="s2">, </span><span class="s0">holidays</span><span class="s2">=</span><span class="s0">holidays</span><span class="s2">),</span>
            <span class="s0">np</span><span class="s2">.</span><span class="s0">busday_offset</span><span class="s2">(</span><span class="s4">'2012-01-03'</span><span class="s2">, -</span><span class="s5">25 </span><span class="s2">- </span><span class="s5">2</span><span class="s2">))</span>
        <span class="s0">assert_equal</span><span class="s2">(</span>
            <span class="s0">np</span><span class="s2">.</span><span class="s0">busday_offset</span><span class="s2">(</span><span class="s4">'2012-01-03'</span><span class="s2">, -</span><span class="s5">26</span><span class="s2">, </span><span class="s0">holidays</span><span class="s2">=</span><span class="s0">holidays</span><span class="s2">),</span>
            <span class="s0">np</span><span class="s2">.</span><span class="s0">busday_offset</span><span class="s2">(</span><span class="s4">'2012-01-03'</span><span class="s2">, -</span><span class="s5">26 </span><span class="s2">- </span><span class="s5">3</span><span class="s2">))</span>
        <span class="s0">assert_equal</span><span class="s2">(</span>
            <span class="s0">np</span><span class="s2">.</span><span class="s0">busday_offset</span><span class="s2">(</span><span class="s4">'2012-01-03'</span><span class="s2">, -</span><span class="s5">33</span><span class="s2">, </span><span class="s0">holidays</span><span class="s2">=</span><span class="s0">holidays</span><span class="s2">),</span>
            <span class="s0">np</span><span class="s2">.</span><span class="s0">busday_offset</span><span class="s2">(</span><span class="s4">'2012-01-03'</span><span class="s2">, -</span><span class="s5">33 </span><span class="s2">- </span><span class="s5">3</span><span class="s2">))</span>
        <span class="s0">assert_equal</span><span class="s2">(</span>
            <span class="s0">np</span><span class="s2">.</span><span class="s0">busday_offset</span><span class="s2">(</span><span class="s4">'2012-01-03'</span><span class="s2">, -</span><span class="s5">34</span><span class="s2">, </span><span class="s0">holidays</span><span class="s2">=</span><span class="s0">holidays</span><span class="s2">),</span>
            <span class="s0">np</span><span class="s2">.</span><span class="s0">busday_offset</span><span class="s2">(</span><span class="s4">'2012-01-03'</span><span class="s2">, -</span><span class="s5">34 </span><span class="s2">- </span><span class="s5">4</span><span class="s2">))</span>
        <span class="s0">assert_equal</span><span class="s2">(</span>
            <span class="s0">np</span><span class="s2">.</span><span class="s0">busday_offset</span><span class="s2">(</span><span class="s4">'2012-01-03'</span><span class="s2">, -</span><span class="s5">56</span><span class="s2">, </span><span class="s0">holidays</span><span class="s2">=</span><span class="s0">holidays</span><span class="s2">),</span>
            <span class="s0">np</span><span class="s2">.</span><span class="s0">busday_offset</span><span class="s2">(</span><span class="s4">'2012-01-03'</span><span class="s2">, -</span><span class="s5">56 </span><span class="s2">- </span><span class="s5">4</span><span class="s2">))</span>
        <span class="s0">assert_equal</span><span class="s2">(</span>
            <span class="s0">np</span><span class="s2">.</span><span class="s0">busday_offset</span><span class="s2">(</span><span class="s4">'2012-01-03'</span><span class="s2">, -</span><span class="s5">57</span><span class="s2">, </span><span class="s0">holidays</span><span class="s2">=</span><span class="s0">holidays</span><span class="s2">),</span>
            <span class="s0">np</span><span class="s2">.</span><span class="s0">busday_offset</span><span class="s2">(</span><span class="s4">'2012-01-03'</span><span class="s2">, -</span><span class="s5">57 </span><span class="s2">- </span><span class="s5">5</span><span class="s2">))</span>
        <span class="s0">assert_equal</span><span class="s2">(</span>
            <span class="s0">np</span><span class="s2">.</span><span class="s0">busday_offset</span><span class="s2">(</span><span class="s4">'2012-01-03'</span><span class="s2">, -</span><span class="s5">57</span><span class="s2">, </span><span class="s0">busdaycal</span><span class="s2">=</span><span class="s0">bdd</span><span class="s2">),</span>
            <span class="s0">np</span><span class="s2">.</span><span class="s0">busday_offset</span><span class="s2">(</span><span class="s4">'2012-01-03'</span><span class="s2">, -</span><span class="s5">57 </span><span class="s2">- </span><span class="s5">5</span><span class="s2">))</span>

        <span class="s3"># Can't supply both a weekmask/holidays and busdaycal</span>
        <span class="s0">assert_raises</span><span class="s2">(</span><span class="s0">ValueError</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">busday_offset</span><span class="s2">, </span><span class="s4">'2012-01-03'</span><span class="s2">, -</span><span class="s5">15</span><span class="s2">,</span>
                        <span class="s0">weekmask</span><span class="s2">=</span><span class="s4">'1111100'</span><span class="s2">, </span><span class="s0">busdaycal</span><span class="s2">=</span><span class="s0">bdd</span><span class="s2">)</span>
        <span class="s0">assert_raises</span><span class="s2">(</span><span class="s0">ValueError</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">busday_offset</span><span class="s2">, </span><span class="s4">'2012-01-03'</span><span class="s2">, -</span><span class="s5">15</span><span class="s2">,</span>
                        <span class="s0">holidays</span><span class="s2">=</span><span class="s0">holidays</span><span class="s2">, </span><span class="s0">busdaycal</span><span class="s2">=</span><span class="s0">bdd</span><span class="s2">)</span>

        <span class="s3"># Roll with the holidays</span>
        <span class="s0">assert_equal</span><span class="s2">(</span>
            <span class="s0">np</span><span class="s2">.</span><span class="s0">busday_offset</span><span class="s2">(</span><span class="s4">'2011-12-25'</span><span class="s2">, </span><span class="s5">0</span><span class="s2">,</span>
                <span class="s0">roll</span><span class="s2">=</span><span class="s4">'forward'</span><span class="s2">, </span><span class="s0">holidays</span><span class="s2">=</span><span class="s0">holidays</span><span class="s2">),</span>
            <span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'2011-12-27'</span><span class="s2">))</span>
        <span class="s0">assert_equal</span><span class="s2">(</span>
            <span class="s0">np</span><span class="s2">.</span><span class="s0">busday_offset</span><span class="s2">(</span><span class="s4">'2011-12-26'</span><span class="s2">, </span><span class="s5">0</span><span class="s2">,</span>
                <span class="s0">roll</span><span class="s2">=</span><span class="s4">'forward'</span><span class="s2">, </span><span class="s0">holidays</span><span class="s2">=</span><span class="s0">holidays</span><span class="s2">),</span>
            <span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'2011-12-27'</span><span class="s2">))</span>
        <span class="s0">assert_equal</span><span class="s2">(</span>
            <span class="s0">np</span><span class="s2">.</span><span class="s0">busday_offset</span><span class="s2">(</span><span class="s4">'2011-12-26'</span><span class="s2">, </span><span class="s5">0</span><span class="s2">,</span>
                <span class="s0">roll</span><span class="s2">=</span><span class="s4">'backward'</span><span class="s2">, </span><span class="s0">holidays</span><span class="s2">=</span><span class="s0">holidays</span><span class="s2">),</span>
            <span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'2011-12-23'</span><span class="s2">))</span>
        <span class="s0">assert_equal</span><span class="s2">(</span>
            <span class="s0">np</span><span class="s2">.</span><span class="s0">busday_offset</span><span class="s2">(</span><span class="s4">'2012-02-27'</span><span class="s2">, </span><span class="s5">0</span><span class="s2">,</span>
                <span class="s0">roll</span><span class="s2">=</span><span class="s4">'modifiedfollowing'</span><span class="s2">,</span>
                <span class="s0">holidays</span><span class="s2">=[</span><span class="s4">'2012-02-27'</span><span class="s2">, </span><span class="s4">'2012-02-26'</span><span class="s2">, </span><span class="s4">'2012-02-28'</span><span class="s2">,</span>
                          <span class="s4">'2012-03-01'</span><span class="s2">, </span><span class="s4">'2012-02-29'</span><span class="s2">]),</span>
            <span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'2012-02-24'</span><span class="s2">))</span>
        <span class="s0">assert_equal</span><span class="s2">(</span>
            <span class="s0">np</span><span class="s2">.</span><span class="s0">busday_offset</span><span class="s2">(</span><span class="s4">'2012-03-06'</span><span class="s2">, </span><span class="s5">0</span><span class="s2">,</span>
                <span class="s0">roll</span><span class="s2">=</span><span class="s4">'modifiedpreceding'</span><span class="s2">,</span>
                <span class="s0">holidays</span><span class="s2">=[</span><span class="s4">'2012-03-02'</span><span class="s2">, </span><span class="s4">'2012-03-03'</span><span class="s2">, </span><span class="s4">'2012-03-01'</span><span class="s2">,</span>
                          <span class="s4">'2012-03-05'</span><span class="s2">, </span><span class="s4">'2012-03-07'</span><span class="s2">, </span><span class="s4">'2012-03-06'</span><span class="s2">]),</span>
            <span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'2012-03-08'</span><span class="s2">))</span>

    <span class="s1">def </span><span class="s0">test_datetime_busday_holidays_count</span><span class="s2">(</span><span class="s0">self</span><span class="s2">):</span>
        <span class="s0">holidays </span><span class="s2">= [</span><span class="s4">'2011-01-01'</span><span class="s2">, </span><span class="s4">'2011-10-10'</span><span class="s2">, </span><span class="s4">'2011-11-11'</span><span class="s2">, </span><span class="s4">'2011-11-24'</span><span class="s2">,</span>
                    <span class="s4">'2011-12-25'</span><span class="s2">, </span><span class="s4">'2011-05-30'</span><span class="s2">, </span><span class="s4">'2011-02-21'</span><span class="s2">, </span><span class="s4">'2011-01-17'</span><span class="s2">,</span>
                    <span class="s4">'2011-12-26'</span><span class="s2">, </span><span class="s4">'2012-01-02'</span><span class="s2">, </span><span class="s4">'2011-02-21'</span><span class="s2">, </span><span class="s4">'2011-05-30'</span><span class="s2">,</span>
                    <span class="s4">'2011-07-01'</span><span class="s2">, </span><span class="s4">'2011-07-04'</span><span class="s2">, </span><span class="s4">'2011-09-05'</span><span class="s2">, </span><span class="s4">'2011-10-10'</span><span class="s2">]</span>
        <span class="s0">bdd </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">busdaycalendar</span><span class="s2">(</span><span class="s0">weekmask</span><span class="s2">=</span><span class="s4">'1111100'</span><span class="s2">, </span><span class="s0">holidays</span><span class="s2">=</span><span class="s0">holidays</span><span class="s2">)</span>

        <span class="s3"># Validate against busday_offset broadcast against</span>
        <span class="s3"># a range of offsets</span>
        <span class="s0">dates </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">busday_offset</span><span class="s2">(</span><span class="s4">'2011-01-01'</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">arange</span><span class="s2">(</span><span class="s5">366</span><span class="s2">),</span>
                        <span class="s0">roll</span><span class="s2">=</span><span class="s4">'forward'</span><span class="s2">, </span><span class="s0">busdaycal</span><span class="s2">=</span><span class="s0">bdd</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">busday_count</span><span class="s2">(</span><span class="s4">'2011-01-01'</span><span class="s2">, </span><span class="s0">dates</span><span class="s2">, </span><span class="s0">busdaycal</span><span class="s2">=</span><span class="s0">bdd</span><span class="s2">),</span>
                     <span class="s0">np</span><span class="s2">.</span><span class="s0">arange</span><span class="s2">(</span><span class="s5">366</span><span class="s2">))</span>
        <span class="s3"># Returns negative value when reversed</span>
        <span class="s3"># -1 since the '2011-01-01' is not a busday</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">busday_count</span><span class="s2">(</span><span class="s0">dates</span><span class="s2">, </span><span class="s4">'2011-01-01'</span><span class="s2">, </span><span class="s0">busdaycal</span><span class="s2">=</span><span class="s0">bdd</span><span class="s2">),</span>
                     <span class="s2">-</span><span class="s0">np</span><span class="s2">.</span><span class="s0">arange</span><span class="s2">(</span><span class="s5">366</span><span class="s2">) - </span><span class="s5">1</span><span class="s2">)</span>

        <span class="s3"># 2011-12-31 is a saturday</span>
        <span class="s0">dates </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">busday_offset</span><span class="s2">(</span><span class="s4">'2011-12-31'</span><span class="s2">, -</span><span class="s0">np</span><span class="s2">.</span><span class="s0">arange</span><span class="s2">(</span><span class="s5">366</span><span class="s2">),</span>
                        <span class="s0">roll</span><span class="s2">=</span><span class="s4">'forward'</span><span class="s2">, </span><span class="s0">busdaycal</span><span class="s2">=</span><span class="s0">bdd</span><span class="s2">)</span>
        <span class="s3"># only the first generated date is in the future of 2011-12-31</span>
        <span class="s0">expected </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">arange</span><span class="s2">(</span><span class="s5">366</span><span class="s2">)</span>
        <span class="s0">expected</span><span class="s2">[</span><span class="s5">0</span><span class="s2">] = -</span><span class="s5">1</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">busday_count</span><span class="s2">(</span><span class="s0">dates</span><span class="s2">, </span><span class="s4">'2011-12-31'</span><span class="s2">, </span><span class="s0">busdaycal</span><span class="s2">=</span><span class="s0">bdd</span><span class="s2">),</span>
                     <span class="s0">expected</span><span class="s2">)</span>
        <span class="s3"># Returns negative value when reversed</span>
        <span class="s0">expected </span><span class="s2">= -</span><span class="s0">np</span><span class="s2">.</span><span class="s0">arange</span><span class="s2">(</span><span class="s5">366</span><span class="s2">)+</span><span class="s5">1</span>
        <span class="s0">expected</span><span class="s2">[</span><span class="s5">0</span><span class="s2">] = </span><span class="s5">0</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">busday_count</span><span class="s2">(</span><span class="s4">'2011-12-31'</span><span class="s2">, </span><span class="s0">dates</span><span class="s2">, </span><span class="s0">busdaycal</span><span class="s2">=</span><span class="s0">bdd</span><span class="s2">),</span>
                     <span class="s0">expected</span><span class="s2">)</span>

        <span class="s3"># Can't supply both a weekmask/holidays and busdaycal</span>
        <span class="s0">assert_raises</span><span class="s2">(</span><span class="s0">ValueError</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">busday_offset</span><span class="s2">, </span><span class="s4">'2012-01-03'</span><span class="s2">, </span><span class="s4">'2012-02-03'</span><span class="s2">,</span>
                        <span class="s0">weekmask</span><span class="s2">=</span><span class="s4">'1111100'</span><span class="s2">, </span><span class="s0">busdaycal</span><span class="s2">=</span><span class="s0">bdd</span><span class="s2">)</span>
        <span class="s0">assert_raises</span><span class="s2">(</span><span class="s0">ValueError</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">busday_offset</span><span class="s2">, </span><span class="s4">'2012-01-03'</span><span class="s2">, </span><span class="s4">'2012-02-03'</span><span class="s2">,</span>
                        <span class="s0">holidays</span><span class="s2">=</span><span class="s0">holidays</span><span class="s2">, </span><span class="s0">busdaycal</span><span class="s2">=</span><span class="s0">bdd</span><span class="s2">)</span>

        <span class="s3"># Number of Mondays in March 2011</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">busday_count</span><span class="s2">(</span><span class="s4">'2011-03'</span><span class="s2">, </span><span class="s4">'2011-04'</span><span class="s2">, </span><span class="s0">weekmask</span><span class="s2">=</span><span class="s4">'Mon'</span><span class="s2">), </span><span class="s5">4</span><span class="s2">)</span>
        <span class="s3"># Returns negative value when reversed</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">busday_count</span><span class="s2">(</span><span class="s4">'2011-04'</span><span class="s2">, </span><span class="s4">'2011-03'</span><span class="s2">, </span><span class="s0">weekmask</span><span class="s2">=</span><span class="s4">'Mon'</span><span class="s2">), -</span><span class="s5">4</span><span class="s2">)</span>

        <span class="s0">sunday </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'2023-03-05'</span><span class="s2">)</span>
        <span class="s0">monday </span><span class="s2">= </span><span class="s0">sunday </span><span class="s2">+ </span><span class="s5">1</span>
        <span class="s0">friday </span><span class="s2">= </span><span class="s0">sunday </span><span class="s2">+ </span><span class="s5">5</span>
        <span class="s0">saturday </span><span class="s2">= </span><span class="s0">sunday </span><span class="s2">+ </span><span class="s5">6</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">busday_count</span><span class="s2">(</span><span class="s0">sunday</span><span class="s2">, </span><span class="s0">monday</span><span class="s2">), </span><span class="s5">0</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">busday_count</span><span class="s2">(</span><span class="s0">monday</span><span class="s2">, </span><span class="s0">sunday</span><span class="s2">), -</span><span class="s5">1</span><span class="s2">)</span>

        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">busday_count</span><span class="s2">(</span><span class="s0">friday</span><span class="s2">, </span><span class="s0">saturday</span><span class="s2">), </span><span class="s5">1</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">busday_count</span><span class="s2">(</span><span class="s0">saturday</span><span class="s2">, </span><span class="s0">friday</span><span class="s2">), </span><span class="s5">0</span><span class="s2">)</span>


    <span class="s1">def </span><span class="s0">test_datetime_is_busday</span><span class="s2">(</span><span class="s0">self</span><span class="s2">):</span>
        <span class="s0">holidays </span><span class="s2">= [</span><span class="s4">'2011-01-01'</span><span class="s2">, </span><span class="s4">'2011-10-10'</span><span class="s2">, </span><span class="s4">'2011-11-11'</span><span class="s2">, </span><span class="s4">'2011-11-24'</span><span class="s2">,</span>
                    <span class="s4">'2011-12-25'</span><span class="s2">, </span><span class="s4">'2011-05-30'</span><span class="s2">, </span><span class="s4">'2011-02-21'</span><span class="s2">, </span><span class="s4">'2011-01-17'</span><span class="s2">,</span>
                    <span class="s4">'2011-12-26'</span><span class="s2">, </span><span class="s4">'2012-01-02'</span><span class="s2">, </span><span class="s4">'2011-02-21'</span><span class="s2">, </span><span class="s4">'2011-05-30'</span><span class="s2">,</span>
                    <span class="s4">'2011-07-01'</span><span class="s2">, </span><span class="s4">'2011-07-04'</span><span class="s2">, </span><span class="s4">'2011-09-05'</span><span class="s2">, </span><span class="s4">'2011-10-10'</span><span class="s2">,</span>
                    <span class="s4">'NaT'</span><span class="s2">]</span>
        <span class="s0">bdd </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">busdaycalendar</span><span class="s2">(</span><span class="s0">weekmask</span><span class="s2">=</span><span class="s4">'1111100'</span><span class="s2">, </span><span class="s0">holidays</span><span class="s2">=</span><span class="s0">holidays</span><span class="s2">)</span>

        <span class="s3"># Weekend/weekday tests</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">is_busday</span><span class="s2">(</span><span class="s4">'2011-01-01'</span><span class="s2">), </span><span class="s1">False</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">is_busday</span><span class="s2">(</span><span class="s4">'2011-01-02'</span><span class="s2">), </span><span class="s1">False</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">is_busday</span><span class="s2">(</span><span class="s4">'2011-01-03'</span><span class="s2">), </span><span class="s1">True</span><span class="s2">)</span>

        <span class="s3"># All the holidays are not business days</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">is_busday</span><span class="s2">(</span><span class="s0">holidays</span><span class="s2">, </span><span class="s0">busdaycal</span><span class="s2">=</span><span class="s0">bdd</span><span class="s2">),</span>
                     <span class="s0">np</span><span class="s2">.</span><span class="s0">zeros</span><span class="s2">(</span><span class="s0">len</span><span class="s2">(</span><span class="s0">holidays</span><span class="s2">), </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'?'</span><span class="s2">))</span>

    <span class="s1">def </span><span class="s0">test_datetime_y2038</span><span class="s2">(</span><span class="s0">self</span><span class="s2">):</span>
        <span class="s3"># Test parsing on either side of the Y2038 boundary</span>
        <span class="s0">a </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'2038-01-19T03:14:07'</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">a</span><span class="s2">.</span><span class="s0">view</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">int64</span><span class="s2">), </span><span class="s5">2</span><span class="s2">**</span><span class="s5">31 </span><span class="s2">- </span><span class="s5">1</span><span class="s2">)</span>
        <span class="s0">a </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'2038-01-19T03:14:08'</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">a</span><span class="s2">.</span><span class="s0">view</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">int64</span><span class="s2">), </span><span class="s5">2</span><span class="s2">**</span><span class="s5">31</span><span class="s2">)</span>

        <span class="s3"># Test parsing on either side of the Y2038 boundary with</span>
        <span class="s3"># a manually specified timezone offset</span>
        <span class="s1">with </span><span class="s0">assert_warns</span><span class="s2">(</span><span class="s0">DeprecationWarning</span><span class="s2">):</span>
            <span class="s0">a </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'2038-01-19T04:14:07+0100'</span><span class="s2">)</span>
            <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">a</span><span class="s2">.</span><span class="s0">view</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">int64</span><span class="s2">), </span><span class="s5">2</span><span class="s2">**</span><span class="s5">31 </span><span class="s2">- </span><span class="s5">1</span><span class="s2">)</span>
        <span class="s1">with </span><span class="s0">assert_warns</span><span class="s2">(</span><span class="s0">DeprecationWarning</span><span class="s2">):</span>
            <span class="s0">a </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'2038-01-19T04:14:08+0100'</span><span class="s2">)</span>
            <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">a</span><span class="s2">.</span><span class="s0">view</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">int64</span><span class="s2">), </span><span class="s5">2</span><span class="s2">**</span><span class="s5">31</span><span class="s2">)</span>

        <span class="s3"># Test parsing a date after Y2038</span>
        <span class="s0">a </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'2038-01-20T13:21:14'</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">str</span><span class="s2">(</span><span class="s0">a</span><span class="s2">), </span><span class="s4">'2038-01-20T13:21:14'</span><span class="s2">)</span>

    <span class="s1">def </span><span class="s0">test_isnat</span><span class="s2">(</span><span class="s0">self</span><span class="s2">):</span>
        <span class="s0">assert_</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">isnat</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'NaT'</span><span class="s2">, </span><span class="s4">'ms'</span><span class="s2">)))</span>
        <span class="s0">assert_</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">isnat</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'NaT'</span><span class="s2">, </span><span class="s4">'ns'</span><span class="s2">)))</span>
        <span class="s0">assert_</span><span class="s2">(</span><span class="s1">not </span><span class="s0">np</span><span class="s2">.</span><span class="s0">isnat</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'2038-01-19T03:14:07'</span><span class="s2">)))</span>

        <span class="s0">assert_</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">isnat</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s4">'NaT'</span><span class="s2">, </span><span class="s4">&quot;ms&quot;</span><span class="s2">)))</span>
        <span class="s0">assert_</span><span class="s2">(</span><span class="s1">not </span><span class="s0">np</span><span class="s2">.</span><span class="s0">isnat</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s5">34</span><span class="s2">, </span><span class="s4">&quot;ms&quot;</span><span class="s2">)))</span>

        <span class="s0">res </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">([</span><span class="s1">False</span><span class="s2">, </span><span class="s1">False</span><span class="s2">, </span><span class="s1">True</span><span class="s2">])</span>
        <span class="s1">for </span><span class="s0">unit </span><span class="s1">in </span><span class="s2">[</span><span class="s4">'Y'</span><span class="s2">, </span><span class="s4">'M'</span><span class="s2">, </span><span class="s4">'W'</span><span class="s2">, </span><span class="s4">'D'</span><span class="s2">,</span>
                     <span class="s4">'h'</span><span class="s2">, </span><span class="s4">'m'</span><span class="s2">, </span><span class="s4">'s'</span><span class="s2">, </span><span class="s4">'ms'</span><span class="s2">, </span><span class="s4">'us'</span><span class="s2">,</span>
                     <span class="s4">'ns'</span><span class="s2">, </span><span class="s4">'ps'</span><span class="s2">, </span><span class="s4">'fs'</span><span class="s2">, </span><span class="s4">'as'</span><span class="s2">]:</span>
            <span class="s0">arr </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">([</span><span class="s5">123</span><span class="s2">, -</span><span class="s5">321</span><span class="s2">, </span><span class="s4">&quot;NaT&quot;</span><span class="s2">], </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'&lt;datetime64[%s]' </span><span class="s2">% </span><span class="s0">unit</span><span class="s2">)</span>
            <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">isnat</span><span class="s2">(</span><span class="s0">arr</span><span class="s2">), </span><span class="s0">res</span><span class="s2">)</span>
            <span class="s0">arr </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">([</span><span class="s5">123</span><span class="s2">, -</span><span class="s5">321</span><span class="s2">, </span><span class="s4">&quot;NaT&quot;</span><span class="s2">], </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'&gt;datetime64[%s]' </span><span class="s2">% </span><span class="s0">unit</span><span class="s2">)</span>
            <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">isnat</span><span class="s2">(</span><span class="s0">arr</span><span class="s2">), </span><span class="s0">res</span><span class="s2">)</span>
            <span class="s0">arr </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">([</span><span class="s5">123</span><span class="s2">, -</span><span class="s5">321</span><span class="s2">, </span><span class="s4">&quot;NaT&quot;</span><span class="s2">], </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'&lt;timedelta64[%s]' </span><span class="s2">% </span><span class="s0">unit</span><span class="s2">)</span>
            <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">isnat</span><span class="s2">(</span><span class="s0">arr</span><span class="s2">), </span><span class="s0">res</span><span class="s2">)</span>
            <span class="s0">arr </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">([</span><span class="s5">123</span><span class="s2">, -</span><span class="s5">321</span><span class="s2">, </span><span class="s4">&quot;NaT&quot;</span><span class="s2">], </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">'&gt;timedelta64[%s]' </span><span class="s2">% </span><span class="s0">unit</span><span class="s2">)</span>
            <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">isnat</span><span class="s2">(</span><span class="s0">arr</span><span class="s2">), </span><span class="s0">res</span><span class="s2">)</span>

    <span class="s1">def </span><span class="s0">test_isnat_error</span><span class="s2">(</span><span class="s0">self</span><span class="s2">):</span>
        <span class="s3"># Test that only datetime dtype arrays are accepted</span>
        <span class="s1">for </span><span class="s0">t </span><span class="s1">in </span><span class="s0">np</span><span class="s2">.</span><span class="s0">typecodes</span><span class="s2">[</span><span class="s4">&quot;All&quot;</span><span class="s2">]:</span>
            <span class="s1">if </span><span class="s0">t </span><span class="s1">in </span><span class="s0">np</span><span class="s2">.</span><span class="s0">typecodes</span><span class="s2">[</span><span class="s4">&quot;Datetime&quot;</span><span class="s2">]:</span>
                <span class="s1">continue</span>
            <span class="s0">assert_raises</span><span class="s2">(</span><span class="s0">TypeError</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">isnat</span><span class="s2">, </span><span class="s0">np</span><span class="s2">.</span><span class="s0">zeros</span><span class="s2">(</span><span class="s5">10</span><span class="s2">, </span><span class="s0">t</span><span class="s2">))</span>

    <span class="s1">def </span><span class="s0">test_isfinite_scalar</span><span class="s2">(</span><span class="s0">self</span><span class="s2">):</span>
        <span class="s0">assert_</span><span class="s2">(</span><span class="s1">not </span><span class="s0">np</span><span class="s2">.</span><span class="s0">isfinite</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'NaT'</span><span class="s2">, </span><span class="s4">'ms'</span><span class="s2">)))</span>
        <span class="s0">assert_</span><span class="s2">(</span><span class="s1">not </span><span class="s0">np</span><span class="s2">.</span><span class="s0">isfinite</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'NaT'</span><span class="s2">, </span><span class="s4">'ns'</span><span class="s2">)))</span>
        <span class="s0">assert_</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">isfinite</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'2038-01-19T03:14:07'</span><span class="s2">)))</span>

        <span class="s0">assert_</span><span class="s2">(</span><span class="s1">not </span><span class="s0">np</span><span class="s2">.</span><span class="s0">isfinite</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s4">'NaT'</span><span class="s2">, </span><span class="s4">&quot;ms&quot;</span><span class="s2">)))</span>
        <span class="s0">assert_</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">isfinite</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s5">34</span><span class="s2">, </span><span class="s4">&quot;ms&quot;</span><span class="s2">)))</span>

    <span class="s2">@</span><span class="s0">pytest</span><span class="s2">.</span><span class="s0">mark</span><span class="s2">.</span><span class="s0">parametrize</span><span class="s2">(</span><span class="s4">'unit'</span><span class="s2">, [</span><span class="s4">'Y'</span><span class="s2">, </span><span class="s4">'M'</span><span class="s2">, </span><span class="s4">'W'</span><span class="s2">, </span><span class="s4">'D'</span><span class="s2">, </span><span class="s4">'h'</span><span class="s2">, </span><span class="s4">'m'</span><span class="s2">, </span><span class="s4">'s'</span><span class="s2">, </span><span class="s4">'ms'</span><span class="s2">,</span>
                                      <span class="s4">'us'</span><span class="s2">, </span><span class="s4">'ns'</span><span class="s2">, </span><span class="s4">'ps'</span><span class="s2">, </span><span class="s4">'fs'</span><span class="s2">, </span><span class="s4">'as'</span><span class="s2">])</span>
    <span class="s2">@</span><span class="s0">pytest</span><span class="s2">.</span><span class="s0">mark</span><span class="s2">.</span><span class="s0">parametrize</span><span class="s2">(</span><span class="s4">'dstr'</span><span class="s2">, [</span><span class="s4">'&lt;datetime64[%s]'</span><span class="s2">, </span><span class="s4">'&gt;datetime64[%s]'</span><span class="s2">,</span>
                                      <span class="s4">'&lt;timedelta64[%s]'</span><span class="s2">, </span><span class="s4">'&gt;timedelta64[%s]'</span><span class="s2">])</span>
    <span class="s1">def </span><span class="s0">test_isfinite_isinf_isnan_units</span><span class="s2">(</span><span class="s0">self</span><span class="s2">, </span><span class="s0">unit</span><span class="s2">, </span><span class="s0">dstr</span><span class="s2">):</span>
        <span class="s7">'''check isfinite, isinf, isnan for all units of &lt;M, &gt;M, &lt;m, &gt;m dtypes 
        '''</span>
        <span class="s0">arr_val </span><span class="s2">= [</span><span class="s5">123</span><span class="s2">, -</span><span class="s5">321</span><span class="s2">, </span><span class="s4">&quot;NaT&quot;</span><span class="s2">]</span>
        <span class="s0">arr </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">(</span><span class="s0">arr_val</span><span class="s2">,  </span><span class="s0">dtype</span><span class="s2">= </span><span class="s0">dstr </span><span class="s2">% </span><span class="s0">unit</span><span class="s2">)</span>
        <span class="s0">pos </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">([</span><span class="s1">True</span><span class="s2">, </span><span class="s1">True</span><span class="s2">,  </span><span class="s1">False</span><span class="s2">])</span>
        <span class="s0">neg </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">([</span><span class="s1">False</span><span class="s2">, </span><span class="s1">False</span><span class="s2">,  </span><span class="s1">True</span><span class="s2">])</span>
        <span class="s0">false </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">([</span><span class="s1">False</span><span class="s2">, </span><span class="s1">False</span><span class="s2">,  </span><span class="s1">False</span><span class="s2">])</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">isfinite</span><span class="s2">(</span><span class="s0">arr</span><span class="s2">), </span><span class="s0">pos</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">isinf</span><span class="s2">(</span><span class="s0">arr</span><span class="s2">), </span><span class="s0">false</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">isnan</span><span class="s2">(</span><span class="s0">arr</span><span class="s2">), </span><span class="s0">neg</span><span class="s2">)</span>

    <span class="s1">def </span><span class="s0">test_assert_equal</span><span class="s2">(</span><span class="s0">self</span><span class="s2">):</span>
        <span class="s0">assert_raises</span><span class="s2">(</span><span class="s0">AssertionError</span><span class="s2">, </span><span class="s0">assert_equal</span><span class="s2">,</span>
                <span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'nat'</span><span class="s2">), </span><span class="s0">np</span><span class="s2">.</span><span class="s0">timedelta64</span><span class="s2">(</span><span class="s4">'nat'</span><span class="s2">))</span>

    <span class="s1">def </span><span class="s0">test_corecursive_input</span><span class="s2">(</span><span class="s0">self</span><span class="s2">):</span>
        <span class="s3"># construct a co-recursive list</span>
        <span class="s0">a</span><span class="s2">, </span><span class="s0">b </span><span class="s2">= [], []</span>
        <span class="s0">a</span><span class="s2">.</span><span class="s0">append</span><span class="s2">(</span><span class="s0">b</span><span class="s2">)</span>
        <span class="s0">b</span><span class="s2">.</span><span class="s0">append</span><span class="s2">(</span><span class="s0">a</span><span class="s2">)</span>
        <span class="s0">obj_arr </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">([</span><span class="s1">None</span><span class="s2">])</span>
        <span class="s0">obj_arr</span><span class="s2">[</span><span class="s5">0</span><span class="s2">] = </span><span class="s0">a</span>

        <span class="s3"># At some point this caused a stack overflow (gh-11154). Now raises</span>
        <span class="s3"># ValueError since the nested list cannot be converted to a datetime.</span>
        <span class="s0">assert_raises</span><span class="s2">(</span><span class="s0">ValueError</span><span class="s2">, </span><span class="s0">obj_arr</span><span class="s2">.</span><span class="s0">astype</span><span class="s2">, </span><span class="s4">'M8'</span><span class="s2">)</span>
        <span class="s0">assert_raises</span><span class="s2">(</span><span class="s0">ValueError</span><span class="s2">, </span><span class="s0">obj_arr</span><span class="s2">.</span><span class="s0">astype</span><span class="s2">, </span><span class="s4">'m8'</span><span class="s2">)</span>

    <span class="s2">@</span><span class="s0">pytest</span><span class="s2">.</span><span class="s0">mark</span><span class="s2">.</span><span class="s0">parametrize</span><span class="s2">(</span><span class="s4">&quot;shape&quot;</span><span class="s2">, [(), (</span><span class="s5">1</span><span class="s2">,)])</span>
    <span class="s1">def </span><span class="s0">test_discovery_from_object_array</span><span class="s2">(</span><span class="s0">self</span><span class="s2">, </span><span class="s0">shape</span><span class="s2">):</span>
        <span class="s0">arr </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">(</span><span class="s4">&quot;2020-10-10&quot;</span><span class="s2">, </span><span class="s0">dtype</span><span class="s2">=</span><span class="s0">object</span><span class="s2">).</span><span class="s0">reshape</span><span class="s2">(</span><span class="s0">shape</span><span class="s2">)</span>
        <span class="s0">res </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">(</span><span class="s4">&quot;2020-10-10&quot;</span><span class="s2">, </span><span class="s0">dtype</span><span class="s2">=</span><span class="s4">&quot;M8&quot;</span><span class="s2">).</span><span class="s0">reshape</span><span class="s2">(</span><span class="s0">shape</span><span class="s2">)</span>
        <span class="s1">assert </span><span class="s0">res</span><span class="s2">.</span><span class="s0">dtype </span><span class="s2">== </span><span class="s0">np</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">(</span><span class="s4">&quot;M8[D]&quot;</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">arr</span><span class="s2">.</span><span class="s0">astype</span><span class="s2">(</span><span class="s4">&quot;M8&quot;</span><span class="s2">), </span><span class="s0">res</span><span class="s2">)</span>
        <span class="s0">arr</span><span class="s2">[...] = </span><span class="s0">np</span><span class="s2">.</span><span class="s0">bytes_</span><span class="s2">(</span><span class="s4">&quot;2020-10-10&quot;</span><span class="s2">)  </span><span class="s3"># try a numpy string type</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">arr</span><span class="s2">.</span><span class="s0">astype</span><span class="s2">(</span><span class="s4">&quot;M8&quot;</span><span class="s2">), </span><span class="s0">res</span><span class="s2">)</span>
        <span class="s0">arr </span><span class="s2">= </span><span class="s0">arr</span><span class="s2">.</span><span class="s0">astype</span><span class="s2">(</span><span class="s4">&quot;S&quot;</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">arr</span><span class="s2">.</span><span class="s0">astype</span><span class="s2">(</span><span class="s4">&quot;S&quot;</span><span class="s2">).</span><span class="s0">astype</span><span class="s2">(</span><span class="s4">&quot;M8&quot;</span><span class="s2">), </span><span class="s0">res</span><span class="s2">)</span>

    <span class="s2">@</span><span class="s0">pytest</span><span class="s2">.</span><span class="s0">mark</span><span class="s2">.</span><span class="s0">parametrize</span><span class="s2">(</span><span class="s4">&quot;time_unit&quot;</span><span class="s2">, [</span>
        <span class="s4">&quot;Y&quot;</span><span class="s2">, </span><span class="s4">&quot;M&quot;</span><span class="s2">, </span><span class="s4">&quot;W&quot;</span><span class="s2">, </span><span class="s4">&quot;D&quot;</span><span class="s2">, </span><span class="s4">&quot;h&quot;</span><span class="s2">, </span><span class="s4">&quot;m&quot;</span><span class="s2">, </span><span class="s4">&quot;s&quot;</span><span class="s2">, </span><span class="s4">&quot;ms&quot;</span><span class="s2">, </span><span class="s4">&quot;us&quot;</span><span class="s2">, </span><span class="s4">&quot;ns&quot;</span><span class="s2">, </span><span class="s4">&quot;ps&quot;</span><span class="s2">, </span><span class="s4">&quot;fs&quot;</span><span class="s2">, </span><span class="s4">&quot;as&quot;</span><span class="s2">,</span>
        <span class="s3"># compound units</span>
        <span class="s4">&quot;10D&quot;</span><span class="s2">, </span><span class="s4">&quot;2M&quot;</span><span class="s2">,</span>
    <span class="s2">])</span>
    <span class="s1">def </span><span class="s0">test_limit_symmetry</span><span class="s2">(</span><span class="s0">self</span><span class="s2">, </span><span class="s0">time_unit</span><span class="s2">):</span>
        <span class="s7">&quot;&quot;&quot; 
        Dates should have symmetric limits around the unix epoch at +/-np.int64 
        &quot;&quot;&quot;</span>
        <span class="s0">epoch </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s0">time_unit</span><span class="s2">)</span>
        <span class="s0">latest </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">iinfo</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">int64</span><span class="s2">).</span><span class="s0">max</span><span class="s2">, </span><span class="s0">time_unit</span><span class="s2">)</span>
        <span class="s0">earliest </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(-</span><span class="s0">np</span><span class="s2">.</span><span class="s0">iinfo</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">int64</span><span class="s2">).</span><span class="s0">max</span><span class="s2">, </span><span class="s0">time_unit</span><span class="s2">)</span>

        <span class="s3"># above should not have overflowed</span>
        <span class="s1">assert </span><span class="s0">earliest </span><span class="s2">&lt; </span><span class="s0">epoch </span><span class="s2">&lt; </span><span class="s0">latest</span>

    <span class="s2">@</span><span class="s0">pytest</span><span class="s2">.</span><span class="s0">mark</span><span class="s2">.</span><span class="s0">parametrize</span><span class="s2">(</span><span class="s4">&quot;time_unit&quot;</span><span class="s2">, [</span>
        <span class="s4">&quot;Y&quot;</span><span class="s2">, </span><span class="s4">&quot;M&quot;</span><span class="s2">,</span>
        <span class="s0">pytest</span><span class="s2">.</span><span class="s0">param</span><span class="s2">(</span><span class="s4">&quot;W&quot;</span><span class="s2">, </span><span class="s0">marks</span><span class="s2">=</span><span class="s0">pytest</span><span class="s2">.</span><span class="s0">mark</span><span class="s2">.</span><span class="s0">xfail</span><span class="s2">(</span><span class="s0">reason</span><span class="s2">=</span><span class="s4">&quot;gh-13197&quot;</span><span class="s2">)),</span>
        <span class="s4">&quot;D&quot;</span><span class="s2">, </span><span class="s4">&quot;h&quot;</span><span class="s2">, </span><span class="s4">&quot;m&quot;</span><span class="s2">,</span>
        <span class="s4">&quot;s&quot;</span><span class="s2">, </span><span class="s4">&quot;ms&quot;</span><span class="s2">, </span><span class="s4">&quot;us&quot;</span><span class="s2">, </span><span class="s4">&quot;ns&quot;</span><span class="s2">, </span><span class="s4">&quot;ps&quot;</span><span class="s2">, </span><span class="s4">&quot;fs&quot;</span><span class="s2">, </span><span class="s4">&quot;as&quot;</span><span class="s2">,</span>
        <span class="s0">pytest</span><span class="s2">.</span><span class="s0">param</span><span class="s2">(</span><span class="s4">&quot;10D&quot;</span><span class="s2">, </span><span class="s0">marks</span><span class="s2">=</span><span class="s0">pytest</span><span class="s2">.</span><span class="s0">mark</span><span class="s2">.</span><span class="s0">xfail</span><span class="s2">(</span><span class="s0">reason</span><span class="s2">=</span><span class="s4">&quot;similar to gh-13197&quot;</span><span class="s2">)),</span>
    <span class="s2">])</span>
    <span class="s2">@</span><span class="s0">pytest</span><span class="s2">.</span><span class="s0">mark</span><span class="s2">.</span><span class="s0">parametrize</span><span class="s2">(</span><span class="s4">&quot;sign&quot;</span><span class="s2">, [-</span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">])</span>
    <span class="s1">def </span><span class="s0">test_limit_str_roundtrip</span><span class="s2">(</span><span class="s0">self</span><span class="s2">, </span><span class="s0">time_unit</span><span class="s2">, </span><span class="s0">sign</span><span class="s2">):</span>
        <span class="s7">&quot;&quot;&quot; 
        Limits should roundtrip when converted to strings. 
 
        This tests the conversion to and from npy_datetimestruct. 
        &quot;&quot;&quot;</span>
        <span class="s3"># TODO: add absolute (gold standard) time span limit strings</span>
        <span class="s0">limit </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">iinfo</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">int64</span><span class="s2">).</span><span class="s0">max </span><span class="s2">* </span><span class="s0">sign</span><span class="s2">, </span><span class="s0">time_unit</span><span class="s2">)</span>

        <span class="s3"># Convert to string and back. Explicit unit needed since the day and</span>
        <span class="s3"># week reprs are not distinguishable.</span>
        <span class="s0">limit_via_str </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s0">str</span><span class="s2">(</span><span class="s0">limit</span><span class="s2">), </span><span class="s0">time_unit</span><span class="s2">)</span>
        <span class="s1">assert </span><span class="s0">limit_via_str </span><span class="s2">== </span><span class="s0">limit</span>


<span class="s1">class </span><span class="s0">TestDateTimeData</span><span class="s2">:</span>

    <span class="s1">def </span><span class="s0">test_basic</span><span class="s2">(</span><span class="s0">self</span><span class="s2">):</span>
        <span class="s0">a </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">([</span><span class="s4">'1980-03-23'</span><span class="s2">], </span><span class="s0">dtype</span><span class="s2">=</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">)</span>
        <span class="s0">assert_equal</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime_data</span><span class="s2">(</span><span class="s0">a</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">), (</span><span class="s4">'D'</span><span class="s2">, </span><span class="s5">1</span><span class="s2">))</span>

    <span class="s1">def </span><span class="s0">test_bytes</span><span class="s2">(</span><span class="s0">self</span><span class="s2">):</span>
        <span class="s3"># byte units are converted to unicode</span>
        <span class="s0">dt </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'2000'</span><span class="s2">, (</span><span class="s6">b'ms'</span><span class="s2">, </span><span class="s5">5</span><span class="s2">))</span>
        <span class="s1">assert </span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime_data</span><span class="s2">(</span><span class="s0">dt</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">) == (</span><span class="s4">'ms'</span><span class="s2">, </span><span class="s5">5</span><span class="s2">)</span>

        <span class="s0">dt </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'2000'</span><span class="s2">, </span><span class="s6">b'5ms'</span><span class="s2">)</span>
        <span class="s1">assert </span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime_data</span><span class="s2">(</span><span class="s0">dt</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">) == (</span><span class="s4">'ms'</span><span class="s2">, </span><span class="s5">5</span><span class="s2">)</span>

    <span class="s1">def </span><span class="s0">test_non_ascii</span><span class="s2">(</span><span class="s0">self</span><span class="s2">):</span>
        <span class="s3"># Î¼s is normalized to Î¼</span>
        <span class="s0">dt </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'2000'</span><span class="s2">, (</span><span class="s4">'Î¼s'</span><span class="s2">, </span><span class="s5">5</span><span class="s2">))</span>
        <span class="s1">assert </span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime_data</span><span class="s2">(</span><span class="s0">dt</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">) == (</span><span class="s4">'us'</span><span class="s2">, </span><span class="s5">5</span><span class="s2">)</span>

        <span class="s0">dt </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'2000'</span><span class="s2">, </span><span class="s4">'5Î¼s'</span><span class="s2">)</span>
        <span class="s1">assert </span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime_data</span><span class="s2">(</span><span class="s0">dt</span><span class="s2">.</span><span class="s0">dtype</span><span class="s2">) == (</span><span class="s4">'us'</span><span class="s2">, </span><span class="s5">5</span><span class="s2">)</span>


<span class="s1">def </span><span class="s0">test_comparisons_return_not_implemented</span><span class="s2">():</span>
    <span class="s3"># GH#17017</span>

    <span class="s1">class </span><span class="s0">custom</span><span class="s2">:</span>
        <span class="s0">__array_priority__ </span><span class="s2">= </span><span class="s5">10000</span>

    <span class="s0">obj </span><span class="s2">= </span><span class="s0">custom</span><span class="s2">()</span>

    <span class="s0">dt </span><span class="s2">= </span><span class="s0">np</span><span class="s2">.</span><span class="s0">datetime64</span><span class="s2">(</span><span class="s4">'2000'</span><span class="s2">, </span><span class="s4">'ns'</span><span class="s2">)</span>
    <span class="s0">td </span><span class="s2">= </span><span class="s0">dt </span><span class="s2">- </span><span class="s0">dt</span>

    <span class="s1">for </span><span class="s0">item </span><span class="s1">in </span><span class="s2">[</span><span class="s0">dt</span><span class="s2">, </span><span class="s0">td</span><span class="s2">]:</span>
        <span class="s1">assert </span><span class="s0">item</span><span class="s2">.</span><span class="s0">__eq__</span><span class="s2">(</span><span class="s0">obj</span><span class="s2">) </span><span class="s1">is </span><span class="s0">NotImplemented</span>
        <span class="s1">assert </span><span class="s0">item</span><span class="s2">.</span><span class="s0">__ne__</span><span class="s2">(</span><span class="s0">obj</span><span class="s2">) </span><span class="s1">is </span><span class="s0">NotImplemented</span>
        <span class="s1">assert </span><span class="s0">item</span><span class="s2">.</span><span class="s0">__le__</span><span class="s2">(</span><span class="s0">obj</span><span class="s2">) </span><span class="s1">is </span><span class="s0">NotImplemented</span>
        <span class="s1">assert </span><span class="s0">item</span><span class="s2">.</span><span class="s0">__lt__</span><span class="s2">(</span><span class="s0">obj</span><span class="s2">) </span><span class="s1">is </span><span class="s0">NotImplemented</span>
        <span class="s1">assert </span><span class="s0">item</span><span class="s2">.</span><span class="s0">__ge__</span><span class="s2">(</span><span class="s0">obj</span><span class="s2">) </span><span class="s1">is </span><span class="s0">NotImplemented</span>
        <span class="s1">assert </span><span class="s0">item</span><span class="s2">.</span><span class="s0">__gt__</span><span class="s2">(</span><span class="s0">obj</span><span class="s2">) </span><span class="s1">is </span><span class="s0">NotImplemented</span>
</pre>
</body>
</html>