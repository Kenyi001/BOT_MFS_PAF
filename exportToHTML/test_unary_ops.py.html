<html>
<head>
<title>test_unary_ops.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cf8e6d;}
.s1 { color: #bcbec4;}
.s2 { color: #bcbec4;}
.s3 { color: #7a7e85;}
.s4 { color: #6aab73;}
.s5 { color: #2aacb8;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_unary_ops.py</font>
</center></td></tr></table>
<pre><span class="s0">from </span><span class="s1">datetime </span><span class="s0">import </span><span class="s1">datetime</span>

<span class="s0">from </span><span class="s1">dateutil</span><span class="s2">.</span><span class="s1">tz </span><span class="s0">import </span><span class="s1">gettz</span>
<span class="s0">from </span><span class="s1">hypothesis </span><span class="s0">import </span><span class="s2">(</span>
    <span class="s1">given</span><span class="s2">,</span>
    <span class="s1">strategies </span><span class="s0">as </span><span class="s1">st</span><span class="s2">,</span>
<span class="s2">)</span>
<span class="s0">import </span><span class="s1">numpy </span><span class="s0">as </span><span class="s1">np</span>
<span class="s0">import </span><span class="s1">pytest</span>
<span class="s0">import </span><span class="s1">pytz</span>
<span class="s0">from </span><span class="s1">pytz </span><span class="s0">import </span><span class="s1">utc</span>

<span class="s0">from </span><span class="s1">pandas</span><span class="s2">.</span><span class="s1">_libs </span><span class="s0">import </span><span class="s1">lib</span>
<span class="s0">from </span><span class="s1">pandas</span><span class="s2">.</span><span class="s1">_libs</span><span class="s2">.</span><span class="s1">tslibs </span><span class="s0">import </span><span class="s2">(</span>
    <span class="s1">NaT</span><span class="s2">,</span>
    <span class="s1">OutOfBoundsDatetime</span><span class="s2">,</span>
    <span class="s1">Timedelta</span><span class="s2">,</span>
    <span class="s1">Timestamp</span><span class="s2">,</span>
    <span class="s1">conversion</span><span class="s2">,</span>
    <span class="s1">iNaT</span><span class="s2">,</span>
    <span class="s1">to_offset</span><span class="s2">,</span>
<span class="s2">)</span>
<span class="s0">from </span><span class="s1">pandas</span><span class="s2">.</span><span class="s1">_libs</span><span class="s2">.</span><span class="s1">tslibs</span><span class="s2">.</span><span class="s1">dtypes </span><span class="s0">import </span><span class="s1">NpyDatetimeUnit</span>
<span class="s0">from </span><span class="s1">pandas</span><span class="s2">.</span><span class="s1">_libs</span><span class="s2">.</span><span class="s1">tslibs</span><span class="s2">.</span><span class="s1">period </span><span class="s0">import </span><span class="s1">INVALID_FREQ_ERR_MSG</span>
<span class="s0">import </span><span class="s1">pandas</span><span class="s2">.</span><span class="s1">util</span><span class="s2">.</span><span class="s1">_test_decorators </span><span class="s0">as </span><span class="s1">td</span>

<span class="s0">import </span><span class="s1">pandas</span><span class="s2">.</span><span class="s1">_testing </span><span class="s0">as </span><span class="s1">tm</span>


<span class="s0">class </span><span class="s1">TestTimestampUnaryOps</span><span class="s2">:</span>
    <span class="s3"># --------------------------------------------------------------</span>
    <span class="s0">def </span><span class="s1">test_round_division_by_zero_raises</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">ts </span><span class="s2">= </span><span class="s1">Timestamp</span><span class="s2">(</span><span class="s4">&quot;2016-01-01&quot;</span><span class="s2">)</span>

        <span class="s1">msg </span><span class="s2">= </span><span class="s4">&quot;Division by zero in rounding&quot;</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
            <span class="s1">ts</span><span class="s2">.</span><span class="s1">round</span><span class="s2">(</span><span class="s4">&quot;0ns&quot;</span><span class="s2">)</span>

    <span class="s3"># Timestamp.round</span>
    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span>
        <span class="s4">&quot;timestamp, freq, expected&quot;</span><span class="s2">,</span>
        <span class="s2">[</span>
            <span class="s2">(</span><span class="s4">&quot;20130101 09:10:11&quot;</span><span class="s2">, </span><span class="s4">&quot;D&quot;</span><span class="s2">, </span><span class="s4">&quot;20130101&quot;</span><span class="s2">),</span>
            <span class="s2">(</span><span class="s4">&quot;20130101 19:10:11&quot;</span><span class="s2">, </span><span class="s4">&quot;D&quot;</span><span class="s2">, </span><span class="s4">&quot;20130102&quot;</span><span class="s2">),</span>
            <span class="s2">(</span><span class="s4">&quot;20130201 12:00:00&quot;</span><span class="s2">, </span><span class="s4">&quot;D&quot;</span><span class="s2">, </span><span class="s4">&quot;20130202&quot;</span><span class="s2">),</span>
            <span class="s2">(</span><span class="s4">&quot;20130104 12:00:00&quot;</span><span class="s2">, </span><span class="s4">&quot;D&quot;</span><span class="s2">, </span><span class="s4">&quot;20130105&quot;</span><span class="s2">),</span>
            <span class="s2">(</span><span class="s4">&quot;2000-01-05 05:09:15.13&quot;</span><span class="s2">, </span><span class="s4">&quot;D&quot;</span><span class="s2">, </span><span class="s4">&quot;2000-01-05 00:00:00&quot;</span><span class="s2">),</span>
            <span class="s2">(</span><span class="s4">&quot;2000-01-05 05:09:15.13&quot;</span><span class="s2">, </span><span class="s4">&quot;H&quot;</span><span class="s2">, </span><span class="s4">&quot;2000-01-05 05:00:00&quot;</span><span class="s2">),</span>
            <span class="s2">(</span><span class="s4">&quot;2000-01-05 05:09:15.13&quot;</span><span class="s2">, </span><span class="s4">&quot;S&quot;</span><span class="s2">, </span><span class="s4">&quot;2000-01-05 05:09:15&quot;</span><span class="s2">),</span>
        <span class="s2">],</span>
    <span class="s2">)</span>
    <span class="s0">def </span><span class="s1">test_round_frequencies</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">timestamp</span><span class="s2">, </span><span class="s1">freq</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">):</span>
        <span class="s1">dt </span><span class="s2">= </span><span class="s1">Timestamp</span><span class="s2">(</span><span class="s1">timestamp</span><span class="s2">)</span>
        <span class="s1">result </span><span class="s2">= </span><span class="s1">dt</span><span class="s2">.</span><span class="s1">round</span><span class="s2">(</span><span class="s1">freq</span><span class="s2">)</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">Timestamp</span><span class="s2">(</span><span class="s1">expected</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">result </span><span class="s2">== </span><span class="s1">expected</span>

    <span class="s0">def </span><span class="s1">test_round_tzaware</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">dt </span><span class="s2">= </span><span class="s1">Timestamp</span><span class="s2">(</span><span class="s4">&quot;20130101 09:10:11&quot;</span><span class="s2">, </span><span class="s1">tz</span><span class="s2">=</span><span class="s4">&quot;US/Eastern&quot;</span><span class="s2">)</span>
        <span class="s1">result </span><span class="s2">= </span><span class="s1">dt</span><span class="s2">.</span><span class="s1">round</span><span class="s2">(</span><span class="s4">&quot;D&quot;</span><span class="s2">)</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">Timestamp</span><span class="s2">(</span><span class="s4">&quot;20130101&quot;</span><span class="s2">, </span><span class="s1">tz</span><span class="s2">=</span><span class="s4">&quot;US/Eastern&quot;</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">result </span><span class="s2">== </span><span class="s1">expected</span>

        <span class="s1">dt </span><span class="s2">= </span><span class="s1">Timestamp</span><span class="s2">(</span><span class="s4">&quot;20130101 09:10:11&quot;</span><span class="s2">, </span><span class="s1">tz</span><span class="s2">=</span><span class="s4">&quot;US/Eastern&quot;</span><span class="s2">)</span>
        <span class="s1">result </span><span class="s2">= </span><span class="s1">dt</span><span class="s2">.</span><span class="s1">round</span><span class="s2">(</span><span class="s4">&quot;s&quot;</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">result </span><span class="s2">== </span><span class="s1">dt</span>

    <span class="s0">def </span><span class="s1">test_round_30min</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s3"># round</span>
        <span class="s1">dt </span><span class="s2">= </span><span class="s1">Timestamp</span><span class="s2">(</span><span class="s4">&quot;20130104 12:32:00&quot;</span><span class="s2">)</span>
        <span class="s1">result </span><span class="s2">= </span><span class="s1">dt</span><span class="s2">.</span><span class="s1">round</span><span class="s2">(</span><span class="s4">&quot;30Min&quot;</span><span class="s2">)</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">Timestamp</span><span class="s2">(</span><span class="s4">&quot;20130104 12:30:00&quot;</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">result </span><span class="s2">== </span><span class="s1">expected</span>

    <span class="s0">def </span><span class="s1">test_round_subsecond</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s3"># GH#14440 &amp; GH#15578</span>
        <span class="s1">result </span><span class="s2">= </span><span class="s1">Timestamp</span><span class="s2">(</span><span class="s4">&quot;2016-10-17 12:00:00.0015&quot;</span><span class="s2">).</span><span class="s1">round</span><span class="s2">(</span><span class="s4">&quot;ms&quot;</span><span class="s2">)</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">Timestamp</span><span class="s2">(</span><span class="s4">&quot;2016-10-17 12:00:00.002000&quot;</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">result </span><span class="s2">== </span><span class="s1">expected</span>

        <span class="s1">result </span><span class="s2">= </span><span class="s1">Timestamp</span><span class="s2">(</span><span class="s4">&quot;2016-10-17 12:00:00.00149&quot;</span><span class="s2">).</span><span class="s1">round</span><span class="s2">(</span><span class="s4">&quot;ms&quot;</span><span class="s2">)</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">Timestamp</span><span class="s2">(</span><span class="s4">&quot;2016-10-17 12:00:00.001000&quot;</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">result </span><span class="s2">== </span><span class="s1">expected</span>

        <span class="s1">ts </span><span class="s2">= </span><span class="s1">Timestamp</span><span class="s2">(</span><span class="s4">&quot;2016-10-17 12:00:00.0015&quot;</span><span class="s2">)</span>
        <span class="s0">for </span><span class="s1">freq </span><span class="s0">in </span><span class="s2">[</span><span class="s4">&quot;us&quot;</span><span class="s2">, </span><span class="s4">&quot;ns&quot;</span><span class="s2">]:</span>
            <span class="s0">assert </span><span class="s1">ts </span><span class="s2">== </span><span class="s1">ts</span><span class="s2">.</span><span class="s1">round</span><span class="s2">(</span><span class="s1">freq</span><span class="s2">)</span>

        <span class="s1">result </span><span class="s2">= </span><span class="s1">Timestamp</span><span class="s2">(</span><span class="s4">&quot;2016-10-17 12:00:00.001501031&quot;</span><span class="s2">).</span><span class="s1">round</span><span class="s2">(</span><span class="s4">&quot;10ns&quot;</span><span class="s2">)</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">Timestamp</span><span class="s2">(</span><span class="s4">&quot;2016-10-17 12:00:00.001501030&quot;</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">result </span><span class="s2">== </span><span class="s1">expected</span>

    <span class="s0">def </span><span class="s1">test_round_nonstandard_freq</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">with </span><span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_produces_warning</span><span class="s2">(</span><span class="s0">False</span><span class="s2">):</span>
            <span class="s1">Timestamp</span><span class="s2">(</span><span class="s4">&quot;2016-10-17 12:00:00.001501031&quot;</span><span class="s2">).</span><span class="s1">round</span><span class="s2">(</span><span class="s4">&quot;1010ns&quot;</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_round_invalid_arg</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">stamp </span><span class="s2">= </span><span class="s1">Timestamp</span><span class="s2">(</span><span class="s4">&quot;2000-01-05 05:09:15.13&quot;</span><span class="s2">)</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">INVALID_FREQ_ERR_MSG</span><span class="s2">):</span>
            <span class="s1">stamp</span><span class="s2">.</span><span class="s1">round</span><span class="s2">(</span><span class="s4">&quot;foo&quot;</span><span class="s2">)</span>

    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span>
        <span class="s4">&quot;test_input, rounder, freq, expected&quot;</span><span class="s2">,</span>
        <span class="s2">[</span>
            <span class="s2">(</span><span class="s4">&quot;2117-01-01 00:00:45&quot;</span><span class="s2">, </span><span class="s4">&quot;floor&quot;</span><span class="s2">, </span><span class="s4">&quot;15s&quot;</span><span class="s2">, </span><span class="s4">&quot;2117-01-01 00:00:45&quot;</span><span class="s2">),</span>
            <span class="s2">(</span><span class="s4">&quot;2117-01-01 00:00:45&quot;</span><span class="s2">, </span><span class="s4">&quot;ceil&quot;</span><span class="s2">, </span><span class="s4">&quot;15s&quot;</span><span class="s2">, </span><span class="s4">&quot;2117-01-01 00:00:45&quot;</span><span class="s2">),</span>
            <span class="s2">(</span>
                <span class="s4">&quot;2117-01-01 00:00:45.000000012&quot;</span><span class="s2">,</span>
                <span class="s4">&quot;floor&quot;</span><span class="s2">,</span>
                <span class="s4">&quot;10ns&quot;</span><span class="s2">,</span>
                <span class="s4">&quot;2117-01-01 00:00:45.000000010&quot;</span><span class="s2">,</span>
            <span class="s2">),</span>
            <span class="s2">(</span>
                <span class="s4">&quot;1823-01-01 00:00:01.000000012&quot;</span><span class="s2">,</span>
                <span class="s4">&quot;ceil&quot;</span><span class="s2">,</span>
                <span class="s4">&quot;10ns&quot;</span><span class="s2">,</span>
                <span class="s4">&quot;1823-01-01 00:00:01.000000020&quot;</span><span class="s2">,</span>
            <span class="s2">),</span>
            <span class="s2">(</span><span class="s4">&quot;1823-01-01 00:00:01&quot;</span><span class="s2">, </span><span class="s4">&quot;floor&quot;</span><span class="s2">, </span><span class="s4">&quot;1s&quot;</span><span class="s2">, </span><span class="s4">&quot;1823-01-01 00:00:01&quot;</span><span class="s2">),</span>
            <span class="s2">(</span><span class="s4">&quot;1823-01-01 00:00:01&quot;</span><span class="s2">, </span><span class="s4">&quot;ceil&quot;</span><span class="s2">, </span><span class="s4">&quot;1s&quot;</span><span class="s2">, </span><span class="s4">&quot;1823-01-01 00:00:01&quot;</span><span class="s2">),</span>
            <span class="s2">(</span><span class="s4">&quot;NaT&quot;</span><span class="s2">, </span><span class="s4">&quot;floor&quot;</span><span class="s2">, </span><span class="s4">&quot;1s&quot;</span><span class="s2">, </span><span class="s4">&quot;NaT&quot;</span><span class="s2">),</span>
            <span class="s2">(</span><span class="s4">&quot;NaT&quot;</span><span class="s2">, </span><span class="s4">&quot;ceil&quot;</span><span class="s2">, </span><span class="s4">&quot;1s&quot;</span><span class="s2">, </span><span class="s4">&quot;NaT&quot;</span><span class="s2">),</span>
        <span class="s2">],</span>
    <span class="s2">)</span>
    <span class="s0">def </span><span class="s1">test_ceil_floor_edge</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">test_input</span><span class="s2">, </span><span class="s1">rounder</span><span class="s2">, </span><span class="s1">freq</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">):</span>
        <span class="s1">dt </span><span class="s2">= </span><span class="s1">Timestamp</span><span class="s2">(</span><span class="s1">test_input</span><span class="s2">)</span>
        <span class="s1">func </span><span class="s2">= </span><span class="s1">getattr</span><span class="s2">(</span><span class="s1">dt</span><span class="s2">, </span><span class="s1">rounder</span><span class="s2">)</span>
        <span class="s1">result </span><span class="s2">= </span><span class="s1">func</span><span class="s2">(</span><span class="s1">freq</span><span class="s2">)</span>

        <span class="s0">if </span><span class="s1">dt </span><span class="s0">is </span><span class="s1">NaT</span><span class="s2">:</span>
            <span class="s0">assert </span><span class="s1">result </span><span class="s0">is </span><span class="s1">NaT</span>
        <span class="s0">else</span><span class="s2">:</span>
            <span class="s1">expected </span><span class="s2">= </span><span class="s1">Timestamp</span><span class="s2">(</span><span class="s1">expected</span><span class="s2">)</span>
            <span class="s0">assert </span><span class="s1">result </span><span class="s2">== </span><span class="s1">expected</span>

    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span>
        <span class="s4">&quot;test_input, freq, expected&quot;</span><span class="s2">,</span>
        <span class="s2">[</span>
            <span class="s2">(</span><span class="s4">&quot;2018-01-01 00:02:06&quot;</span><span class="s2">, </span><span class="s4">&quot;2s&quot;</span><span class="s2">, </span><span class="s4">&quot;2018-01-01 00:02:06&quot;</span><span class="s2">),</span>
            <span class="s2">(</span><span class="s4">&quot;2018-01-01 00:02:00&quot;</span><span class="s2">, </span><span class="s4">&quot;2T&quot;</span><span class="s2">, </span><span class="s4">&quot;2018-01-01 00:02:00&quot;</span><span class="s2">),</span>
            <span class="s2">(</span><span class="s4">&quot;2018-01-01 00:04:00&quot;</span><span class="s2">, </span><span class="s4">&quot;4T&quot;</span><span class="s2">, </span><span class="s4">&quot;2018-01-01 00:04:00&quot;</span><span class="s2">),</span>
            <span class="s2">(</span><span class="s4">&quot;2018-01-01 00:15:00&quot;</span><span class="s2">, </span><span class="s4">&quot;15T&quot;</span><span class="s2">, </span><span class="s4">&quot;2018-01-01 00:15:00&quot;</span><span class="s2">),</span>
            <span class="s2">(</span><span class="s4">&quot;2018-01-01 00:20:00&quot;</span><span class="s2">, </span><span class="s4">&quot;20T&quot;</span><span class="s2">, </span><span class="s4">&quot;2018-01-01 00:20:00&quot;</span><span class="s2">),</span>
            <span class="s2">(</span><span class="s4">&quot;2018-01-01 03:00:00&quot;</span><span class="s2">, </span><span class="s4">&quot;3H&quot;</span><span class="s2">, </span><span class="s4">&quot;2018-01-01 03:00:00&quot;</span><span class="s2">),</span>
        <span class="s2">],</span>
    <span class="s2">)</span>
    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s4">&quot;rounder&quot;</span><span class="s2">, [</span><span class="s4">&quot;ceil&quot;</span><span class="s2">, </span><span class="s4">&quot;floor&quot;</span><span class="s2">, </span><span class="s4">&quot;round&quot;</span><span class="s2">])</span>
    <span class="s0">def </span><span class="s1">test_round_minute_freq</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">test_input</span><span class="s2">, </span><span class="s1">freq</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">, </span><span class="s1">rounder</span><span class="s2">):</span>
        <span class="s3"># Ensure timestamps that shouldn't round dont!</span>
        <span class="s3"># GH#21262</span>

        <span class="s1">dt </span><span class="s2">= </span><span class="s1">Timestamp</span><span class="s2">(</span><span class="s1">test_input</span><span class="s2">)</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">Timestamp</span><span class="s2">(</span><span class="s1">expected</span><span class="s2">)</span>
        <span class="s1">func </span><span class="s2">= </span><span class="s1">getattr</span><span class="s2">(</span><span class="s1">dt</span><span class="s2">, </span><span class="s1">rounder</span><span class="s2">)</span>
        <span class="s1">result </span><span class="s2">= </span><span class="s1">func</span><span class="s2">(</span><span class="s1">freq</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">result </span><span class="s2">== </span><span class="s1">expected</span>

    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s4">&quot;unit&quot;</span><span class="s2">, [</span><span class="s4">&quot;ns&quot;</span><span class="s2">, </span><span class="s4">&quot;us&quot;</span><span class="s2">, </span><span class="s4">&quot;ms&quot;</span><span class="s2">, </span><span class="s4">&quot;s&quot;</span><span class="s2">])</span>
    <span class="s0">def </span><span class="s1">test_ceil</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">unit</span><span class="s2">):</span>
        <span class="s1">dt </span><span class="s2">= </span><span class="s1">Timestamp</span><span class="s2">(</span><span class="s4">&quot;20130101 09:10:11&quot;</span><span class="s2">).</span><span class="s1">as_unit</span><span class="s2">(</span><span class="s1">unit</span><span class="s2">)</span>
        <span class="s1">result </span><span class="s2">= </span><span class="s1">dt</span><span class="s2">.</span><span class="s1">ceil</span><span class="s2">(</span><span class="s4">&quot;D&quot;</span><span class="s2">)</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">Timestamp</span><span class="s2">(</span><span class="s4">&quot;20130102&quot;</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">result </span><span class="s2">== </span><span class="s1">expected</span>
        <span class="s0">assert </span><span class="s1">result</span><span class="s2">.</span><span class="s1">_creso </span><span class="s2">== </span><span class="s1">dt</span><span class="s2">.</span><span class="s1">_creso</span>

    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s4">&quot;unit&quot;</span><span class="s2">, [</span><span class="s4">&quot;ns&quot;</span><span class="s2">, </span><span class="s4">&quot;us&quot;</span><span class="s2">, </span><span class="s4">&quot;ms&quot;</span><span class="s2">, </span><span class="s4">&quot;s&quot;</span><span class="s2">])</span>
    <span class="s0">def </span><span class="s1">test_floor</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">unit</span><span class="s2">):</span>
        <span class="s1">dt </span><span class="s2">= </span><span class="s1">Timestamp</span><span class="s2">(</span><span class="s4">&quot;20130101 09:10:11&quot;</span><span class="s2">).</span><span class="s1">as_unit</span><span class="s2">(</span><span class="s1">unit</span><span class="s2">)</span>
        <span class="s1">result </span><span class="s2">= </span><span class="s1">dt</span><span class="s2">.</span><span class="s1">floor</span><span class="s2">(</span><span class="s4">&quot;D&quot;</span><span class="s2">)</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">Timestamp</span><span class="s2">(</span><span class="s4">&quot;20130101&quot;</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">result </span><span class="s2">== </span><span class="s1">expected</span>
        <span class="s0">assert </span><span class="s1">result</span><span class="s2">.</span><span class="s1">_creso </span><span class="s2">== </span><span class="s1">dt</span><span class="s2">.</span><span class="s1">_creso</span>

    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s4">&quot;method&quot;</span><span class="s2">, [</span><span class="s4">&quot;ceil&quot;</span><span class="s2">, </span><span class="s4">&quot;round&quot;</span><span class="s2">, </span><span class="s4">&quot;floor&quot;</span><span class="s2">])</span>
    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span>
        <span class="s4">&quot;unit&quot;</span><span class="s2">,</span>
        <span class="s2">[</span><span class="s4">&quot;ns&quot;</span><span class="s2">, </span><span class="s4">&quot;us&quot;</span><span class="s2">, </span><span class="s4">&quot;ms&quot;</span><span class="s2">, </span><span class="s4">&quot;s&quot;</span><span class="s2">],</span>
    <span class="s2">)</span>
    <span class="s0">def </span><span class="s1">test_round_dst_border_ambiguous</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">method</span><span class="s2">, </span><span class="s1">unit</span><span class="s2">):</span>
        <span class="s3"># GH 18946 round near &quot;fall back&quot; DST</span>
        <span class="s1">ts </span><span class="s2">= </span><span class="s1">Timestamp</span><span class="s2">(</span><span class="s4">&quot;2017-10-29 00:00:00&quot;</span><span class="s2">, </span><span class="s1">tz</span><span class="s2">=</span><span class="s4">&quot;UTC&quot;</span><span class="s2">).</span><span class="s1">tz_convert</span><span class="s2">(</span><span class="s4">&quot;Europe/Madrid&quot;</span><span class="s2">)</span>
        <span class="s1">ts </span><span class="s2">= </span><span class="s1">ts</span><span class="s2">.</span><span class="s1">as_unit</span><span class="s2">(</span><span class="s1">unit</span><span class="s2">)</span>
        <span class="s3">#</span>
        <span class="s1">result </span><span class="s2">= </span><span class="s1">getattr</span><span class="s2">(</span><span class="s1">ts</span><span class="s2">, </span><span class="s1">method</span><span class="s2">)(</span><span class="s4">&quot;H&quot;</span><span class="s2">, </span><span class="s1">ambiguous</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">result </span><span class="s2">== </span><span class="s1">ts</span>
        <span class="s0">assert </span><span class="s1">result</span><span class="s2">.</span><span class="s1">_creso </span><span class="s2">== </span><span class="s1">getattr</span><span class="s2">(</span><span class="s1">NpyDatetimeUnit</span><span class="s2">, </span><span class="s4">f&quot;NPY_FR_</span><span class="s0">{</span><span class="s1">unit</span><span class="s0">}</span><span class="s4">&quot;</span><span class="s2">).</span><span class="s1">value</span>

        <span class="s1">result </span><span class="s2">= </span><span class="s1">getattr</span><span class="s2">(</span><span class="s1">ts</span><span class="s2">, </span><span class="s1">method</span><span class="s2">)(</span><span class="s4">&quot;H&quot;</span><span class="s2">, </span><span class="s1">ambiguous</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">Timestamp</span><span class="s2">(</span><span class="s4">&quot;2017-10-29 01:00:00&quot;</span><span class="s2">, </span><span class="s1">tz</span><span class="s2">=</span><span class="s4">&quot;UTC&quot;</span><span class="s2">).</span><span class="s1">tz_convert</span><span class="s2">(</span>
            <span class="s4">&quot;Europe/Madrid&quot;</span>
        <span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">result </span><span class="s2">== </span><span class="s1">expected</span>
        <span class="s0">assert </span><span class="s1">result</span><span class="s2">.</span><span class="s1">_creso </span><span class="s2">== </span><span class="s1">getattr</span><span class="s2">(</span><span class="s1">NpyDatetimeUnit</span><span class="s2">, </span><span class="s4">f&quot;NPY_FR_</span><span class="s0">{</span><span class="s1">unit</span><span class="s0">}</span><span class="s4">&quot;</span><span class="s2">).</span><span class="s1">value</span>

        <span class="s1">result </span><span class="s2">= </span><span class="s1">getattr</span><span class="s2">(</span><span class="s1">ts</span><span class="s2">, </span><span class="s1">method</span><span class="s2">)(</span><span class="s4">&quot;H&quot;</span><span class="s2">, </span><span class="s1">ambiguous</span><span class="s2">=</span><span class="s4">&quot;NaT&quot;</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">result </span><span class="s0">is </span><span class="s1">NaT</span>

        <span class="s1">msg </span><span class="s2">= </span><span class="s4">&quot;Cannot infer dst time&quot;</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">pytz</span><span class="s2">.</span><span class="s1">AmbiguousTimeError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
            <span class="s1">getattr</span><span class="s2">(</span><span class="s1">ts</span><span class="s2">, </span><span class="s1">method</span><span class="s2">)(</span><span class="s4">&quot;H&quot;</span><span class="s2">, </span><span class="s1">ambiguous</span><span class="s2">=</span><span class="s4">&quot;raise&quot;</span><span class="s2">)</span>

    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span>
        <span class="s4">&quot;method, ts_str, freq&quot;</span><span class="s2">,</span>
        <span class="s2">[</span>
            <span class="s2">[</span><span class="s4">&quot;ceil&quot;</span><span class="s2">, </span><span class="s4">&quot;2018-03-11 01:59:00-0600&quot;</span><span class="s2">, </span><span class="s4">&quot;5min&quot;</span><span class="s2">],</span>
            <span class="s2">[</span><span class="s4">&quot;round&quot;</span><span class="s2">, </span><span class="s4">&quot;2018-03-11 01:59:00-0600&quot;</span><span class="s2">, </span><span class="s4">&quot;5min&quot;</span><span class="s2">],</span>
            <span class="s2">[</span><span class="s4">&quot;floor&quot;</span><span class="s2">, </span><span class="s4">&quot;2018-03-11 03:01:00-0500&quot;</span><span class="s2">, </span><span class="s4">&quot;2H&quot;</span><span class="s2">],</span>
        <span class="s2">],</span>
    <span class="s2">)</span>
    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span>
        <span class="s4">&quot;unit&quot;</span><span class="s2">,</span>
        <span class="s2">[</span><span class="s4">&quot;ns&quot;</span><span class="s2">, </span><span class="s4">&quot;us&quot;</span><span class="s2">, </span><span class="s4">&quot;ms&quot;</span><span class="s2">, </span><span class="s4">&quot;s&quot;</span><span class="s2">],</span>
    <span class="s2">)</span>
    <span class="s0">def </span><span class="s1">test_round_dst_border_nonexistent</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">method</span><span class="s2">, </span><span class="s1">ts_str</span><span class="s2">, </span><span class="s1">freq</span><span class="s2">, </span><span class="s1">unit</span><span class="s2">):</span>
        <span class="s3"># GH 23324 round near &quot;spring forward&quot; DST</span>
        <span class="s1">ts </span><span class="s2">= </span><span class="s1">Timestamp</span><span class="s2">(</span><span class="s1">ts_str</span><span class="s2">, </span><span class="s1">tz</span><span class="s2">=</span><span class="s4">&quot;America/Chicago&quot;</span><span class="s2">).</span><span class="s1">as_unit</span><span class="s2">(</span><span class="s1">unit</span><span class="s2">)</span>
        <span class="s1">result </span><span class="s2">= </span><span class="s1">getattr</span><span class="s2">(</span><span class="s1">ts</span><span class="s2">, </span><span class="s1">method</span><span class="s2">)(</span><span class="s1">freq</span><span class="s2">, </span><span class="s1">nonexistent</span><span class="s2">=</span><span class="s4">&quot;shift_forward&quot;</span><span class="s2">)</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">Timestamp</span><span class="s2">(</span><span class="s4">&quot;2018-03-11 03:00:00&quot;</span><span class="s2">, </span><span class="s1">tz</span><span class="s2">=</span><span class="s4">&quot;America/Chicago&quot;</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">result </span><span class="s2">== </span><span class="s1">expected</span>
        <span class="s0">assert </span><span class="s1">result</span><span class="s2">.</span><span class="s1">_creso </span><span class="s2">== </span><span class="s1">getattr</span><span class="s2">(</span><span class="s1">NpyDatetimeUnit</span><span class="s2">, </span><span class="s4">f&quot;NPY_FR_</span><span class="s0">{</span><span class="s1">unit</span><span class="s0">}</span><span class="s4">&quot;</span><span class="s2">).</span><span class="s1">value</span>

        <span class="s1">result </span><span class="s2">= </span><span class="s1">getattr</span><span class="s2">(</span><span class="s1">ts</span><span class="s2">, </span><span class="s1">method</span><span class="s2">)(</span><span class="s1">freq</span><span class="s2">, </span><span class="s1">nonexistent</span><span class="s2">=</span><span class="s4">&quot;NaT&quot;</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">result </span><span class="s0">is </span><span class="s1">NaT</span>

        <span class="s1">msg </span><span class="s2">= </span><span class="s4">&quot;2018-03-11 02:00:00&quot;</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">pytz</span><span class="s2">.</span><span class="s1">NonExistentTimeError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
            <span class="s1">getattr</span><span class="s2">(</span><span class="s1">ts</span><span class="s2">, </span><span class="s1">method</span><span class="s2">)(</span><span class="s1">freq</span><span class="s2">, </span><span class="s1">nonexistent</span><span class="s2">=</span><span class="s4">&quot;raise&quot;</span><span class="s2">)</span>

    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span>
        <span class="s4">&quot;timestamp&quot;</span><span class="s2">,</span>
        <span class="s2">[</span>
            <span class="s4">&quot;2018-01-01 0:0:0.124999360&quot;</span><span class="s2">,</span>
            <span class="s4">&quot;2018-01-01 0:0:0.125000367&quot;</span><span class="s2">,</span>
            <span class="s4">&quot;2018-01-01 0:0:0.125500&quot;</span><span class="s2">,</span>
            <span class="s4">&quot;2018-01-01 0:0:0.126500&quot;</span><span class="s2">,</span>
            <span class="s4">&quot;2018-01-01 12:00:00&quot;</span><span class="s2">,</span>
            <span class="s4">&quot;2019-01-01 12:00:00&quot;</span><span class="s2">,</span>
        <span class="s2">],</span>
    <span class="s2">)</span>
    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span>
        <span class="s4">&quot;freq&quot;</span><span class="s2">,</span>
        <span class="s2">[</span>
            <span class="s4">&quot;2ns&quot;</span><span class="s2">,</span>
            <span class="s4">&quot;3ns&quot;</span><span class="s2">,</span>
            <span class="s4">&quot;4ns&quot;</span><span class="s2">,</span>
            <span class="s4">&quot;5ns&quot;</span><span class="s2">,</span>
            <span class="s4">&quot;6ns&quot;</span><span class="s2">,</span>
            <span class="s4">&quot;7ns&quot;</span><span class="s2">,</span>
            <span class="s4">&quot;250ns&quot;</span><span class="s2">,</span>
            <span class="s4">&quot;500ns&quot;</span><span class="s2">,</span>
            <span class="s4">&quot;750ns&quot;</span><span class="s2">,</span>
            <span class="s4">&quot;1us&quot;</span><span class="s2">,</span>
            <span class="s4">&quot;19us&quot;</span><span class="s2">,</span>
            <span class="s4">&quot;250us&quot;</span><span class="s2">,</span>
            <span class="s4">&quot;500us&quot;</span><span class="s2">,</span>
            <span class="s4">&quot;750us&quot;</span><span class="s2">,</span>
            <span class="s4">&quot;1s&quot;</span><span class="s2">,</span>
            <span class="s4">&quot;2s&quot;</span><span class="s2">,</span>
            <span class="s4">&quot;3s&quot;</span><span class="s2">,</span>
            <span class="s4">&quot;1D&quot;</span><span class="s2">,</span>
        <span class="s2">],</span>
    <span class="s2">)</span>
    <span class="s0">def </span><span class="s1">test_round_int64</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">timestamp</span><span class="s2">, </span><span class="s1">freq</span><span class="s2">):</span>
        <span class="s3"># check that all rounding modes are accurate to int64 precision</span>
        <span class="s3"># see GH#22591</span>
        <span class="s1">dt </span><span class="s2">= </span><span class="s1">Timestamp</span><span class="s2">(</span><span class="s1">timestamp</span><span class="s2">).</span><span class="s1">as_unit</span><span class="s2">(</span><span class="s4">&quot;ns&quot;</span><span class="s2">)</span>
        <span class="s1">unit </span><span class="s2">= </span><span class="s1">to_offset</span><span class="s2">(</span><span class="s1">freq</span><span class="s2">).</span><span class="s1">nanos</span>

        <span class="s3"># test floor</span>
        <span class="s1">result </span><span class="s2">= </span><span class="s1">dt</span><span class="s2">.</span><span class="s1">floor</span><span class="s2">(</span><span class="s1">freq</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">result</span><span class="s2">.</span><span class="s1">_value </span><span class="s2">% </span><span class="s1">unit </span><span class="s2">== </span><span class="s5">0</span><span class="s2">, </span><span class="s4">f&quot;floor not a </span><span class="s0">{</span><span class="s1">freq</span><span class="s0">} </span><span class="s4">multiple&quot;</span>
        <span class="s0">assert </span><span class="s5">0 </span><span class="s2">&lt;= </span><span class="s1">dt</span><span class="s2">.</span><span class="s1">_value </span><span class="s2">- </span><span class="s1">result</span><span class="s2">.</span><span class="s1">_value </span><span class="s2">&lt; </span><span class="s1">unit</span><span class="s2">, </span><span class="s4">&quot;floor error&quot;</span>

        <span class="s3"># test ceil</span>
        <span class="s1">result </span><span class="s2">= </span><span class="s1">dt</span><span class="s2">.</span><span class="s1">ceil</span><span class="s2">(</span><span class="s1">freq</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">result</span><span class="s2">.</span><span class="s1">_value </span><span class="s2">% </span><span class="s1">unit </span><span class="s2">== </span><span class="s5">0</span><span class="s2">, </span><span class="s4">f&quot;ceil not a </span><span class="s0">{</span><span class="s1">freq</span><span class="s0">} </span><span class="s4">multiple&quot;</span>
        <span class="s0">assert </span><span class="s5">0 </span><span class="s2">&lt;= </span><span class="s1">result</span><span class="s2">.</span><span class="s1">_value </span><span class="s2">- </span><span class="s1">dt</span><span class="s2">.</span><span class="s1">_value </span><span class="s2">&lt; </span><span class="s1">unit</span><span class="s2">, </span><span class="s4">&quot;ceil error&quot;</span>

        <span class="s3"># test round</span>
        <span class="s1">result </span><span class="s2">= </span><span class="s1">dt</span><span class="s2">.</span><span class="s1">round</span><span class="s2">(</span><span class="s1">freq</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">result</span><span class="s2">.</span><span class="s1">_value </span><span class="s2">% </span><span class="s1">unit </span><span class="s2">== </span><span class="s5">0</span><span class="s2">, </span><span class="s4">f&quot;round not a </span><span class="s0">{</span><span class="s1">freq</span><span class="s0">} </span><span class="s4">multiple&quot;</span>
        <span class="s0">assert </span><span class="s1">abs</span><span class="s2">(</span><span class="s1">result</span><span class="s2">.</span><span class="s1">_value </span><span class="s2">- </span><span class="s1">dt</span><span class="s2">.</span><span class="s1">_value</span><span class="s2">) &lt;= </span><span class="s1">unit </span><span class="s2">// </span><span class="s5">2</span><span class="s2">, </span><span class="s4">&quot;round error&quot;</span>
        <span class="s0">if </span><span class="s1">unit </span><span class="s2">% </span><span class="s5">2 </span><span class="s2">== </span><span class="s5">0 </span><span class="s0">and </span><span class="s1">abs</span><span class="s2">(</span><span class="s1">result</span><span class="s2">.</span><span class="s1">_value </span><span class="s2">- </span><span class="s1">dt</span><span class="s2">.</span><span class="s1">_value</span><span class="s2">) == </span><span class="s1">unit </span><span class="s2">// </span><span class="s5">2</span><span class="s2">:</span>
            <span class="s3"># round half to even</span>
            <span class="s0">assert </span><span class="s1">result</span><span class="s2">.</span><span class="s1">_value </span><span class="s2">// </span><span class="s1">unit </span><span class="s2">% </span><span class="s5">2 </span><span class="s2">== </span><span class="s5">0</span><span class="s2">, </span><span class="s4">&quot;round half to even error&quot;</span>

    <span class="s0">def </span><span class="s1">test_round_implementation_bounds</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s3"># See also: analogous test for Timedelta</span>
        <span class="s1">result </span><span class="s2">= </span><span class="s1">Timestamp</span><span class="s2">.</span><span class="s1">min</span><span class="s2">.</span><span class="s1">ceil</span><span class="s2">(</span><span class="s4">&quot;s&quot;</span><span class="s2">)</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">Timestamp</span><span class="s2">(</span><span class="s5">1677</span><span class="s2">, </span><span class="s5">9</span><span class="s2">, </span><span class="s5">21</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">12</span><span class="s2">, </span><span class="s5">44</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">result </span><span class="s2">== </span><span class="s1">expected</span>

        <span class="s1">result </span><span class="s2">= </span><span class="s1">Timestamp</span><span class="s2">.</span><span class="s1">max</span><span class="s2">.</span><span class="s1">floor</span><span class="s2">(</span><span class="s4">&quot;s&quot;</span><span class="s2">)</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">Timestamp</span><span class="s2">.</span><span class="s1">max </span><span class="s2">- </span><span class="s1">Timedelta</span><span class="s2">(</span><span class="s5">854775807</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">result </span><span class="s2">== </span><span class="s1">expected</span>

        <span class="s1">msg </span><span class="s2">= </span><span class="s4">&quot;Cannot round 1677-09-21 00:12:43.145224193 to freq=&lt;Second&gt;&quot;</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">OutOfBoundsDatetime</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
            <span class="s1">Timestamp</span><span class="s2">.</span><span class="s1">min</span><span class="s2">.</span><span class="s1">floor</span><span class="s2">(</span><span class="s4">&quot;s&quot;</span><span class="s2">)</span>

        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">OutOfBoundsDatetime</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
            <span class="s1">Timestamp</span><span class="s2">.</span><span class="s1">min</span><span class="s2">.</span><span class="s1">round</span><span class="s2">(</span><span class="s4">&quot;s&quot;</span><span class="s2">)</span>

        <span class="s1">msg </span><span class="s2">= </span><span class="s4">&quot;Cannot round 2262-04-11 23:47:16.854775807 to freq=&lt;Second&gt;&quot;</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">OutOfBoundsDatetime</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
            <span class="s1">Timestamp</span><span class="s2">.</span><span class="s1">max</span><span class="s2">.</span><span class="s1">ceil</span><span class="s2">(</span><span class="s4">&quot;s&quot;</span><span class="s2">)</span>

        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">OutOfBoundsDatetime</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
            <span class="s1">Timestamp</span><span class="s2">.</span><span class="s1">max</span><span class="s2">.</span><span class="s1">round</span><span class="s2">(</span><span class="s4">&quot;s&quot;</span><span class="s2">)</span>

    <span class="s2">@</span><span class="s1">given</span><span class="s2">(</span><span class="s1">val</span><span class="s2">=</span><span class="s1">st</span><span class="s2">.</span><span class="s1">integers</span><span class="s2">(</span><span class="s1">iNaT </span><span class="s2">+ </span><span class="s5">1</span><span class="s2">, </span><span class="s1">lib</span><span class="s2">.</span><span class="s1">i8max</span><span class="s2">))</span>
    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span>
        <span class="s4">&quot;method&quot;</span><span class="s2">, [</span><span class="s1">Timestamp</span><span class="s2">.</span><span class="s1">round</span><span class="s2">, </span><span class="s1">Timestamp</span><span class="s2">.</span><span class="s1">floor</span><span class="s2">, </span><span class="s1">Timestamp</span><span class="s2">.</span><span class="s1">ceil</span><span class="s2">]</span>
    <span class="s2">)</span>
    <span class="s0">def </span><span class="s1">test_round_sanity</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">val</span><span class="s2">, </span><span class="s1">method</span><span class="s2">):</span>
        <span class="s1">cls </span><span class="s2">= </span><span class="s1">Timestamp</span>
        <span class="s1">err_cls </span><span class="s2">= </span><span class="s1">OutOfBoundsDatetime</span>

        <span class="s1">val </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">int64</span><span class="s2">(</span><span class="s1">val</span><span class="s2">)</span>
        <span class="s1">ts </span><span class="s2">= </span><span class="s1">cls</span><span class="s2">(</span><span class="s1">val</span><span class="s2">)</span>

        <span class="s0">def </span><span class="s1">checker</span><span class="s2">(</span><span class="s1">ts</span><span class="s2">, </span><span class="s1">nanos</span><span class="s2">, </span><span class="s1">unit</span><span class="s2">):</span>
            <span class="s3"># First check that we do raise in cases where we should</span>
            <span class="s0">if </span><span class="s1">nanos </span><span class="s2">== </span><span class="s5">1</span><span class="s2">:</span>
                <span class="s0">pass</span>
            <span class="s0">else</span><span class="s2">:</span>
                <span class="s1">div</span><span class="s2">, </span><span class="s1">mod </span><span class="s2">= </span><span class="s1">divmod</span><span class="s2">(</span><span class="s1">ts</span><span class="s2">.</span><span class="s1">_value</span><span class="s2">, </span><span class="s1">nanos</span><span class="s2">)</span>
                <span class="s1">diff </span><span class="s2">= </span><span class="s1">int</span><span class="s2">(</span><span class="s1">nanos </span><span class="s2">- </span><span class="s1">mod</span><span class="s2">)</span>
                <span class="s1">lb </span><span class="s2">= </span><span class="s1">ts</span><span class="s2">.</span><span class="s1">_value </span><span class="s2">- </span><span class="s1">mod</span>
                <span class="s0">assert </span><span class="s1">lb </span><span class="s2">&lt;= </span><span class="s1">ts</span><span class="s2">.</span><span class="s1">_value  </span><span class="s3"># i.e. no overflows with python ints</span>
                <span class="s1">ub </span><span class="s2">= </span><span class="s1">ts</span><span class="s2">.</span><span class="s1">_value </span><span class="s2">+ </span><span class="s1">diff</span>
                <span class="s0">assert </span><span class="s1">ub </span><span class="s2">&gt; </span><span class="s1">ts</span><span class="s2">.</span><span class="s1">_value  </span><span class="s3"># i.e. no overflows with python ints</span>

                <span class="s1">msg </span><span class="s2">= </span><span class="s4">&quot;without overflow&quot;</span>
                <span class="s0">if </span><span class="s1">mod </span><span class="s2">== </span><span class="s5">0</span><span class="s2">:</span>
                    <span class="s3"># We should never be raising in this</span>
                    <span class="s0">pass</span>
                <span class="s0">elif </span><span class="s1">method </span><span class="s0">is </span><span class="s1">cls</span><span class="s2">.</span><span class="s1">ceil</span><span class="s2">:</span>
                    <span class="s0">if </span><span class="s1">ub </span><span class="s2">&gt; </span><span class="s1">cls</span><span class="s2">.</span><span class="s1">max</span><span class="s2">.</span><span class="s1">_value</span><span class="s2">:</span>
                        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">err_cls</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
                            <span class="s1">method</span><span class="s2">(</span><span class="s1">ts</span><span class="s2">, </span><span class="s1">unit</span><span class="s2">)</span>
                        <span class="s0">return</span>
                <span class="s0">elif </span><span class="s1">method </span><span class="s0">is </span><span class="s1">cls</span><span class="s2">.</span><span class="s1">floor</span><span class="s2">:</span>
                    <span class="s0">if </span><span class="s1">lb </span><span class="s2">&lt; </span><span class="s1">cls</span><span class="s2">.</span><span class="s1">min</span><span class="s2">.</span><span class="s1">_value</span><span class="s2">:</span>
                        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">err_cls</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
                            <span class="s1">method</span><span class="s2">(</span><span class="s1">ts</span><span class="s2">, </span><span class="s1">unit</span><span class="s2">)</span>
                        <span class="s0">return</span>
                <span class="s0">elif </span><span class="s1">mod </span><span class="s2">&gt;= </span><span class="s1">diff</span><span class="s2">:</span>
                    <span class="s0">if </span><span class="s1">ub </span><span class="s2">&gt; </span><span class="s1">cls</span><span class="s2">.</span><span class="s1">max</span><span class="s2">.</span><span class="s1">_value</span><span class="s2">:</span>
                        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">err_cls</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
                            <span class="s1">method</span><span class="s2">(</span><span class="s1">ts</span><span class="s2">, </span><span class="s1">unit</span><span class="s2">)</span>
                        <span class="s0">return</span>
                <span class="s0">elif </span><span class="s1">lb </span><span class="s2">&lt; </span><span class="s1">cls</span><span class="s2">.</span><span class="s1">min</span><span class="s2">.</span><span class="s1">_value</span><span class="s2">:</span>
                    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">err_cls</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
                        <span class="s1">method</span><span class="s2">(</span><span class="s1">ts</span><span class="s2">, </span><span class="s1">unit</span><span class="s2">)</span>
                    <span class="s0">return</span>

            <span class="s1">res </span><span class="s2">= </span><span class="s1">method</span><span class="s2">(</span><span class="s1">ts</span><span class="s2">, </span><span class="s1">unit</span><span class="s2">)</span>

            <span class="s1">td </span><span class="s2">= </span><span class="s1">res </span><span class="s2">- </span><span class="s1">ts</span>
            <span class="s1">diff </span><span class="s2">= </span><span class="s1">abs</span><span class="s2">(</span><span class="s1">td</span><span class="s2">.</span><span class="s1">_value</span><span class="s2">)</span>
            <span class="s0">assert </span><span class="s1">diff </span><span class="s2">&lt; </span><span class="s1">nanos</span>
            <span class="s0">assert </span><span class="s1">res</span><span class="s2">.</span><span class="s1">_value </span><span class="s2">% </span><span class="s1">nanos </span><span class="s2">== </span><span class="s5">0</span>

            <span class="s0">if </span><span class="s1">method </span><span class="s0">is </span><span class="s1">cls</span><span class="s2">.</span><span class="s1">round</span><span class="s2">:</span>
                <span class="s0">assert </span><span class="s1">diff </span><span class="s2">&lt;= </span><span class="s1">nanos </span><span class="s2">/ </span><span class="s5">2</span>
            <span class="s0">elif </span><span class="s1">method </span><span class="s0">is </span><span class="s1">cls</span><span class="s2">.</span><span class="s1">floor</span><span class="s2">:</span>
                <span class="s0">assert </span><span class="s1">res </span><span class="s2">&lt;= </span><span class="s1">ts</span>
            <span class="s0">elif </span><span class="s1">method </span><span class="s0">is </span><span class="s1">cls</span><span class="s2">.</span><span class="s1">ceil</span><span class="s2">:</span>
                <span class="s0">assert </span><span class="s1">res </span><span class="s2">&gt;= </span><span class="s1">ts</span>

        <span class="s1">nanos </span><span class="s2">= </span><span class="s5">1</span>
        <span class="s1">checker</span><span class="s2">(</span><span class="s1">ts</span><span class="s2">, </span><span class="s1">nanos</span><span class="s2">, </span><span class="s4">&quot;ns&quot;</span><span class="s2">)</span>

        <span class="s1">nanos </span><span class="s2">= </span><span class="s5">1000</span>
        <span class="s1">checker</span><span class="s2">(</span><span class="s1">ts</span><span class="s2">, </span><span class="s1">nanos</span><span class="s2">, </span><span class="s4">&quot;us&quot;</span><span class="s2">)</span>

        <span class="s1">nanos </span><span class="s2">= </span><span class="s5">1_000_000</span>
        <span class="s1">checker</span><span class="s2">(</span><span class="s1">ts</span><span class="s2">, </span><span class="s1">nanos</span><span class="s2">, </span><span class="s4">&quot;ms&quot;</span><span class="s2">)</span>

        <span class="s1">nanos </span><span class="s2">= </span><span class="s5">1_000_000_000</span>
        <span class="s1">checker</span><span class="s2">(</span><span class="s1">ts</span><span class="s2">, </span><span class="s1">nanos</span><span class="s2">, </span><span class="s4">&quot;s&quot;</span><span class="s2">)</span>

        <span class="s1">nanos </span><span class="s2">= </span><span class="s5">60 </span><span class="s2">* </span><span class="s5">1_000_000_000</span>
        <span class="s1">checker</span><span class="s2">(</span><span class="s1">ts</span><span class="s2">, </span><span class="s1">nanos</span><span class="s2">, </span><span class="s4">&quot;min&quot;</span><span class="s2">)</span>

        <span class="s1">nanos </span><span class="s2">= </span><span class="s5">60 </span><span class="s2">* </span><span class="s5">60 </span><span class="s2">* </span><span class="s5">1_000_000_000</span>
        <span class="s1">checker</span><span class="s2">(</span><span class="s1">ts</span><span class="s2">, </span><span class="s1">nanos</span><span class="s2">, </span><span class="s4">&quot;h&quot;</span><span class="s2">)</span>

        <span class="s1">nanos </span><span class="s2">= </span><span class="s5">24 </span><span class="s2">* </span><span class="s5">60 </span><span class="s2">* </span><span class="s5">60 </span><span class="s2">* </span><span class="s5">1_000_000_000</span>
        <span class="s1">checker</span><span class="s2">(</span><span class="s1">ts</span><span class="s2">, </span><span class="s1">nanos</span><span class="s2">, </span><span class="s4">&quot;D&quot;</span><span class="s2">)</span>

    <span class="s3"># --------------------------------------------------------------</span>
    <span class="s3"># Timestamp.replace</span>

    <span class="s0">def </span><span class="s1">test_replace_out_of_pydatetime_bounds</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s3"># GH#50348</span>
        <span class="s1">ts </span><span class="s2">= </span><span class="s1">Timestamp</span><span class="s2">(</span><span class="s4">&quot;2016-01-01&quot;</span><span class="s2">).</span><span class="s1">as_unit</span><span class="s2">(</span><span class="s4">&quot;ns&quot;</span><span class="s2">)</span>

        <span class="s1">msg </span><span class="s2">= </span><span class="s4">&quot;Out of bounds nanosecond timestamp: 99999-01-01 00:00:00&quot;</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">OutOfBoundsDatetime</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
            <span class="s1">ts</span><span class="s2">.</span><span class="s1">replace</span><span class="s2">(</span><span class="s1">year</span><span class="s2">=</span><span class="s5">99_999</span><span class="s2">)</span>

        <span class="s1">ts </span><span class="s2">= </span><span class="s1">ts</span><span class="s2">.</span><span class="s1">as_unit</span><span class="s2">(</span><span class="s4">&quot;ms&quot;</span><span class="s2">)</span>
        <span class="s1">result </span><span class="s2">= </span><span class="s1">ts</span><span class="s2">.</span><span class="s1">replace</span><span class="s2">(</span><span class="s1">year</span><span class="s2">=</span><span class="s5">99_999</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">result</span><span class="s2">.</span><span class="s1">year </span><span class="s2">== </span><span class="s5">99_999</span>
        <span class="s0">assert </span><span class="s1">result</span><span class="s2">.</span><span class="s1">_value </span><span class="s2">== </span><span class="s1">Timestamp</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">datetime64</span><span class="s2">(</span><span class="s4">&quot;99999-01-01&quot;</span><span class="s2">, </span><span class="s4">&quot;ms&quot;</span><span class="s2">)).</span><span class="s1">_value</span>

    <span class="s0">def </span><span class="s1">test_replace_non_nano</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">ts </span><span class="s2">= </span><span class="s1">Timestamp</span><span class="s2">.</span><span class="s1">_from_value_and_reso</span><span class="s2">(</span>
            <span class="s5">91514880000000000</span><span class="s2">, </span><span class="s1">NpyDatetimeUnit</span><span class="s2">.</span><span class="s1">NPY_FR_us</span><span class="s2">.</span><span class="s1">value</span><span class="s2">, </span><span class="s0">None</span>
        <span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">ts</span><span class="s2">.</span><span class="s1">to_pydatetime</span><span class="s2">() == </span><span class="s1">datetime</span><span class="s2">(</span><span class="s5">4869</span><span class="s2">, </span><span class="s5">12</span><span class="s2">, </span><span class="s5">28</span><span class="s2">)</span>

        <span class="s1">result </span><span class="s2">= </span><span class="s1">ts</span><span class="s2">.</span><span class="s1">replace</span><span class="s2">(</span><span class="s1">year</span><span class="s2">=</span><span class="s5">4900</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">result</span><span class="s2">.</span><span class="s1">_creso </span><span class="s2">== </span><span class="s1">ts</span><span class="s2">.</span><span class="s1">_creso</span>
        <span class="s0">assert </span><span class="s1">result</span><span class="s2">.</span><span class="s1">to_pydatetime</span><span class="s2">() == </span><span class="s1">datetime</span><span class="s2">(</span><span class="s5">4900</span><span class="s2">, </span><span class="s5">12</span><span class="s2">, </span><span class="s5">28</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_replace_naive</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s3"># GH#14621, GH#7825</span>
        <span class="s1">ts </span><span class="s2">= </span><span class="s1">Timestamp</span><span class="s2">(</span><span class="s4">&quot;2016-01-01 09:00:00&quot;</span><span class="s2">)</span>
        <span class="s1">result </span><span class="s2">= </span><span class="s1">ts</span><span class="s2">.</span><span class="s1">replace</span><span class="s2">(</span><span class="s1">hour</span><span class="s2">=</span><span class="s5">0</span><span class="s2">)</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">Timestamp</span><span class="s2">(</span><span class="s4">&quot;2016-01-01 00:00:00&quot;</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">result </span><span class="s2">== </span><span class="s1">expected</span>

    <span class="s0">def </span><span class="s1">test_replace_aware</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">tz_aware_fixture</span><span class="s2">):</span>
        <span class="s1">tz </span><span class="s2">= </span><span class="s1">tz_aware_fixture</span>
        <span class="s3"># GH#14621, GH#7825</span>
        <span class="s3"># replacing datetime components with and w/o presence of a timezone</span>
        <span class="s1">ts </span><span class="s2">= </span><span class="s1">Timestamp</span><span class="s2">(</span><span class="s4">&quot;2016-01-01 09:00:00&quot;</span><span class="s2">, </span><span class="s1">tz</span><span class="s2">=</span><span class="s1">tz</span><span class="s2">)</span>
        <span class="s1">result </span><span class="s2">= </span><span class="s1">ts</span><span class="s2">.</span><span class="s1">replace</span><span class="s2">(</span><span class="s1">hour</span><span class="s2">=</span><span class="s5">0</span><span class="s2">)</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">Timestamp</span><span class="s2">(</span><span class="s4">&quot;2016-01-01 00:00:00&quot;</span><span class="s2">, </span><span class="s1">tz</span><span class="s2">=</span><span class="s1">tz</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">result </span><span class="s2">== </span><span class="s1">expected</span>

    <span class="s0">def </span><span class="s1">test_replace_preserves_nanos</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">tz_aware_fixture</span><span class="s2">):</span>
        <span class="s1">tz </span><span class="s2">= </span><span class="s1">tz_aware_fixture</span>
        <span class="s3"># GH#14621, GH#7825</span>
        <span class="s1">ts </span><span class="s2">= </span><span class="s1">Timestamp</span><span class="s2">(</span><span class="s4">&quot;2016-01-01 09:00:00.000000123&quot;</span><span class="s2">, </span><span class="s1">tz</span><span class="s2">=</span><span class="s1">tz</span><span class="s2">)</span>
        <span class="s1">result </span><span class="s2">= </span><span class="s1">ts</span><span class="s2">.</span><span class="s1">replace</span><span class="s2">(</span><span class="s1">hour</span><span class="s2">=</span><span class="s5">0</span><span class="s2">)</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">Timestamp</span><span class="s2">(</span><span class="s4">&quot;2016-01-01 00:00:00.000000123&quot;</span><span class="s2">, </span><span class="s1">tz</span><span class="s2">=</span><span class="s1">tz</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">result </span><span class="s2">== </span><span class="s1">expected</span>

    <span class="s0">def </span><span class="s1">test_replace_multiple</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">tz_aware_fixture</span><span class="s2">):</span>
        <span class="s1">tz </span><span class="s2">= </span><span class="s1">tz_aware_fixture</span>
        <span class="s3"># GH#14621, GH#7825</span>
        <span class="s3"># replacing datetime components with and w/o presence of a timezone</span>
        <span class="s3"># test all</span>
        <span class="s1">ts </span><span class="s2">= </span><span class="s1">Timestamp</span><span class="s2">(</span><span class="s4">&quot;2016-01-01 09:00:00.000000123&quot;</span><span class="s2">, </span><span class="s1">tz</span><span class="s2">=</span><span class="s1">tz</span><span class="s2">)</span>
        <span class="s1">result </span><span class="s2">= </span><span class="s1">ts</span><span class="s2">.</span><span class="s1">replace</span><span class="s2">(</span>
            <span class="s1">year</span><span class="s2">=</span><span class="s5">2015</span><span class="s2">,</span>
            <span class="s1">month</span><span class="s2">=</span><span class="s5">2</span><span class="s2">,</span>
            <span class="s1">day</span><span class="s2">=</span><span class="s5">2</span><span class="s2">,</span>
            <span class="s1">hour</span><span class="s2">=</span><span class="s5">0</span><span class="s2">,</span>
            <span class="s1">minute</span><span class="s2">=</span><span class="s5">5</span><span class="s2">,</span>
            <span class="s1">second</span><span class="s2">=</span><span class="s5">5</span><span class="s2">,</span>
            <span class="s1">microsecond</span><span class="s2">=</span><span class="s5">5</span><span class="s2">,</span>
            <span class="s1">nanosecond</span><span class="s2">=</span><span class="s5">5</span><span class="s2">,</span>
        <span class="s2">)</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">Timestamp</span><span class="s2">(</span><span class="s4">&quot;2015-02-02 00:05:05.000005005&quot;</span><span class="s2">, </span><span class="s1">tz</span><span class="s2">=</span><span class="s1">tz</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">result </span><span class="s2">== </span><span class="s1">expected</span>

    <span class="s0">def </span><span class="s1">test_replace_invalid_kwarg</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">tz_aware_fixture</span><span class="s2">):</span>
        <span class="s1">tz </span><span class="s2">= </span><span class="s1">tz_aware_fixture</span>
        <span class="s3"># GH#14621, GH#7825</span>
        <span class="s1">ts </span><span class="s2">= </span><span class="s1">Timestamp</span><span class="s2">(</span><span class="s4">&quot;2016-01-01 09:00:00.000000123&quot;</span><span class="s2">, </span><span class="s1">tz</span><span class="s2">=</span><span class="s1">tz</span><span class="s2">)</span>
        <span class="s1">msg </span><span class="s2">= </span><span class="s4">r&quot;replace\(\) got an unexpected keyword argument&quot;</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">TypeError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
            <span class="s1">ts</span><span class="s2">.</span><span class="s1">replace</span><span class="s2">(</span><span class="s1">foo</span><span class="s2">=</span><span class="s5">5</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_replace_integer_args</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">tz_aware_fixture</span><span class="s2">):</span>
        <span class="s1">tz </span><span class="s2">= </span><span class="s1">tz_aware_fixture</span>
        <span class="s3"># GH#14621, GH#7825</span>
        <span class="s1">ts </span><span class="s2">= </span><span class="s1">Timestamp</span><span class="s2">(</span><span class="s4">&quot;2016-01-01 09:00:00.000000123&quot;</span><span class="s2">, </span><span class="s1">tz</span><span class="s2">=</span><span class="s1">tz</span><span class="s2">)</span>
        <span class="s1">msg </span><span class="s2">= </span><span class="s4">&quot;value must be an integer, received &lt;class 'float'&gt; for hour&quot;</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
            <span class="s1">ts</span><span class="s2">.</span><span class="s1">replace</span><span class="s2">(</span><span class="s1">hour</span><span class="s2">=</span><span class="s5">0.1</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_replace_tzinfo_equiv_tz_localize_none</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s3"># GH#14621, GH#7825</span>
        <span class="s3"># assert conversion to naive is the same as replacing tzinfo with None</span>
        <span class="s1">ts </span><span class="s2">= </span><span class="s1">Timestamp</span><span class="s2">(</span><span class="s4">&quot;2013-11-03 01:59:59.999999-0400&quot;</span><span class="s2">, </span><span class="s1">tz</span><span class="s2">=</span><span class="s4">&quot;US/Eastern&quot;</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">ts</span><span class="s2">.</span><span class="s1">tz_localize</span><span class="s2">(</span><span class="s0">None</span><span class="s2">) == </span><span class="s1">ts</span><span class="s2">.</span><span class="s1">replace</span><span class="s2">(</span><span class="s1">tzinfo</span><span class="s2">=</span><span class="s0">None</span><span class="s2">)</span>

    <span class="s2">@</span><span class="s1">td</span><span class="s2">.</span><span class="s1">skip_if_windows</span>
    <span class="s0">def </span><span class="s1">test_replace_tzinfo</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s3"># GH#15683</span>
        <span class="s1">dt </span><span class="s2">= </span><span class="s1">datetime</span><span class="s2">(</span><span class="s5">2016</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s5">27</span><span class="s2">, </span><span class="s5">1</span><span class="s2">)</span>
        <span class="s1">tzinfo </span><span class="s2">= </span><span class="s1">pytz</span><span class="s2">.</span><span class="s1">timezone</span><span class="s2">(</span><span class="s4">&quot;CET&quot;</span><span class="s2">).</span><span class="s1">localize</span><span class="s2">(</span><span class="s1">dt</span><span class="s2">, </span><span class="s1">is_dst</span><span class="s2">=</span><span class="s0">False</span><span class="s2">).</span><span class="s1">tzinfo</span>

        <span class="s1">result_dt </span><span class="s2">= </span><span class="s1">dt</span><span class="s2">.</span><span class="s1">replace</span><span class="s2">(</span><span class="s1">tzinfo</span><span class="s2">=</span><span class="s1">tzinfo</span><span class="s2">)</span>
        <span class="s1">result_pd </span><span class="s2">= </span><span class="s1">Timestamp</span><span class="s2">(</span><span class="s1">dt</span><span class="s2">).</span><span class="s1">replace</span><span class="s2">(</span><span class="s1">tzinfo</span><span class="s2">=</span><span class="s1">tzinfo</span><span class="s2">)</span>

        <span class="s3"># datetime.timestamp() converts in the local timezone</span>
        <span class="s0">with </span><span class="s1">tm</span><span class="s2">.</span><span class="s1">set_timezone</span><span class="s2">(</span><span class="s4">&quot;UTC&quot;</span><span class="s2">):</span>
            <span class="s0">assert </span><span class="s1">result_dt</span><span class="s2">.</span><span class="s1">timestamp</span><span class="s2">() == </span><span class="s1">result_pd</span><span class="s2">.</span><span class="s1">timestamp</span><span class="s2">()</span>

        <span class="s0">assert </span><span class="s1">result_dt </span><span class="s2">== </span><span class="s1">result_pd</span>
        <span class="s0">assert </span><span class="s1">result_dt </span><span class="s2">== </span><span class="s1">result_pd</span><span class="s2">.</span><span class="s1">to_pydatetime</span><span class="s2">()</span>

        <span class="s1">result_dt </span><span class="s2">= </span><span class="s1">dt</span><span class="s2">.</span><span class="s1">replace</span><span class="s2">(</span><span class="s1">tzinfo</span><span class="s2">=</span><span class="s1">tzinfo</span><span class="s2">).</span><span class="s1">replace</span><span class="s2">(</span><span class="s1">tzinfo</span><span class="s2">=</span><span class="s0">None</span><span class="s2">)</span>
        <span class="s1">result_pd </span><span class="s2">= </span><span class="s1">Timestamp</span><span class="s2">(</span><span class="s1">dt</span><span class="s2">).</span><span class="s1">replace</span><span class="s2">(</span><span class="s1">tzinfo</span><span class="s2">=</span><span class="s1">tzinfo</span><span class="s2">).</span><span class="s1">replace</span><span class="s2">(</span><span class="s1">tzinfo</span><span class="s2">=</span><span class="s0">None</span><span class="s2">)</span>

        <span class="s3"># datetime.timestamp() converts in the local timezone</span>
        <span class="s0">with </span><span class="s1">tm</span><span class="s2">.</span><span class="s1">set_timezone</span><span class="s2">(</span><span class="s4">&quot;UTC&quot;</span><span class="s2">):</span>
            <span class="s0">assert </span><span class="s1">result_dt</span><span class="s2">.</span><span class="s1">timestamp</span><span class="s2">() == </span><span class="s1">result_pd</span><span class="s2">.</span><span class="s1">timestamp</span><span class="s2">()</span>

        <span class="s0">assert </span><span class="s1">result_dt </span><span class="s2">== </span><span class="s1">result_pd</span>
        <span class="s0">assert </span><span class="s1">result_dt </span><span class="s2">== </span><span class="s1">result_pd</span><span class="s2">.</span><span class="s1">to_pydatetime</span><span class="s2">()</span>

    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span>
        <span class="s4">&quot;tz, normalize&quot;</span><span class="s2">,</span>
        <span class="s2">[</span>
            <span class="s2">(</span><span class="s1">pytz</span><span class="s2">.</span><span class="s1">timezone</span><span class="s2">(</span><span class="s4">&quot;US/Eastern&quot;</span><span class="s2">), </span><span class="s0">lambda </span><span class="s1">x</span><span class="s2">: </span><span class="s1">x</span><span class="s2">.</span><span class="s1">tzinfo</span><span class="s2">.</span><span class="s1">normalize</span><span class="s2">(</span><span class="s1">x</span><span class="s2">)),</span>
            <span class="s2">(</span><span class="s1">gettz</span><span class="s2">(</span><span class="s4">&quot;US/Eastern&quot;</span><span class="s2">), </span><span class="s0">lambda </span><span class="s1">x</span><span class="s2">: </span><span class="s1">x</span><span class="s2">),</span>
        <span class="s2">],</span>
    <span class="s2">)</span>
    <span class="s0">def </span><span class="s1">test_replace_across_dst</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">tz</span><span class="s2">, </span><span class="s1">normalize</span><span class="s2">):</span>
        <span class="s3"># GH#18319 check that 1) timezone is correctly normalized and</span>
        <span class="s3"># 2) that hour is not incorrectly changed by this normalization</span>
        <span class="s1">ts_naive </span><span class="s2">= </span><span class="s1">Timestamp</span><span class="s2">(</span><span class="s4">&quot;2017-12-03 16:03:30&quot;</span><span class="s2">)</span>
        <span class="s1">ts_aware </span><span class="s2">= </span><span class="s1">conversion</span><span class="s2">.</span><span class="s1">localize_pydatetime</span><span class="s2">(</span><span class="s1">ts_naive</span><span class="s2">, </span><span class="s1">tz</span><span class="s2">)</span>

        <span class="s3"># Preliminary sanity-check</span>
        <span class="s0">assert </span><span class="s1">ts_aware </span><span class="s2">== </span><span class="s1">normalize</span><span class="s2">(</span><span class="s1">ts_aware</span><span class="s2">)</span>

        <span class="s3"># Replace across DST boundary</span>
        <span class="s1">ts2 </span><span class="s2">= </span><span class="s1">ts_aware</span><span class="s2">.</span><span class="s1">replace</span><span class="s2">(</span><span class="s1">month</span><span class="s2">=</span><span class="s5">6</span><span class="s2">)</span>

        <span class="s3"># Check that `replace` preserves hour literal</span>
        <span class="s0">assert </span><span class="s2">(</span><span class="s1">ts2</span><span class="s2">.</span><span class="s1">hour</span><span class="s2">, </span><span class="s1">ts2</span><span class="s2">.</span><span class="s1">minute</span><span class="s2">) == (</span><span class="s1">ts_aware</span><span class="s2">.</span><span class="s1">hour</span><span class="s2">, </span><span class="s1">ts_aware</span><span class="s2">.</span><span class="s1">minute</span><span class="s2">)</span>

        <span class="s3"># Check that post-replace object is appropriately normalized</span>
        <span class="s1">ts2b </span><span class="s2">= </span><span class="s1">normalize</span><span class="s2">(</span><span class="s1">ts2</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">ts2 </span><span class="s2">== </span><span class="s1">ts2b</span>

    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s4">&quot;unit&quot;</span><span class="s2">, [</span><span class="s4">&quot;ns&quot;</span><span class="s2">, </span><span class="s4">&quot;us&quot;</span><span class="s2">, </span><span class="s4">&quot;ms&quot;</span><span class="s2">, </span><span class="s4">&quot;s&quot;</span><span class="s2">])</span>
    <span class="s0">def </span><span class="s1">test_replace_dst_border</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">unit</span><span class="s2">):</span>
        <span class="s3"># Gh 7825</span>
        <span class="s1">t </span><span class="s2">= </span><span class="s1">Timestamp</span><span class="s2">(</span><span class="s4">&quot;2013-11-3&quot;</span><span class="s2">, </span><span class="s1">tz</span><span class="s2">=</span><span class="s4">&quot;America/Chicago&quot;</span><span class="s2">).</span><span class="s1">as_unit</span><span class="s2">(</span><span class="s1">unit</span><span class="s2">)</span>
        <span class="s1">result </span><span class="s2">= </span><span class="s1">t</span><span class="s2">.</span><span class="s1">replace</span><span class="s2">(</span><span class="s1">hour</span><span class="s2">=</span><span class="s5">3</span><span class="s2">)</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">Timestamp</span><span class="s2">(</span><span class="s4">&quot;2013-11-3 03:00:00&quot;</span><span class="s2">, </span><span class="s1">tz</span><span class="s2">=</span><span class="s4">&quot;America/Chicago&quot;</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">result </span><span class="s2">== </span><span class="s1">expected</span>
        <span class="s0">assert </span><span class="s1">result</span><span class="s2">.</span><span class="s1">_creso </span><span class="s2">== </span><span class="s1">getattr</span><span class="s2">(</span><span class="s1">NpyDatetimeUnit</span><span class="s2">, </span><span class="s4">f&quot;NPY_FR_</span><span class="s0">{</span><span class="s1">unit</span><span class="s0">}</span><span class="s4">&quot;</span><span class="s2">).</span><span class="s1">value</span>

    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s4">&quot;fold&quot;</span><span class="s2">, [</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">])</span>
    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s4">&quot;tz&quot;</span><span class="s2">, [</span><span class="s4">&quot;dateutil/Europe/London&quot;</span><span class="s2">, </span><span class="s4">&quot;Europe/London&quot;</span><span class="s2">])</span>
    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s4">&quot;unit&quot;</span><span class="s2">, [</span><span class="s4">&quot;ns&quot;</span><span class="s2">, </span><span class="s4">&quot;us&quot;</span><span class="s2">, </span><span class="s4">&quot;ms&quot;</span><span class="s2">, </span><span class="s4">&quot;s&quot;</span><span class="s2">])</span>
    <span class="s0">def </span><span class="s1">test_replace_dst_fold</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">fold</span><span class="s2">, </span><span class="s1">tz</span><span class="s2">, </span><span class="s1">unit</span><span class="s2">):</span>
        <span class="s3"># GH 25017</span>
        <span class="s1">d </span><span class="s2">= </span><span class="s1">datetime</span><span class="s2">(</span><span class="s5">2019</span><span class="s2">, </span><span class="s5">10</span><span class="s2">, </span><span class="s5">27</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">30</span><span class="s2">)</span>
        <span class="s1">ts </span><span class="s2">= </span><span class="s1">Timestamp</span><span class="s2">(</span><span class="s1">d</span><span class="s2">, </span><span class="s1">tz</span><span class="s2">=</span><span class="s1">tz</span><span class="s2">).</span><span class="s1">as_unit</span><span class="s2">(</span><span class="s1">unit</span><span class="s2">)</span>
        <span class="s1">result </span><span class="s2">= </span><span class="s1">ts</span><span class="s2">.</span><span class="s1">replace</span><span class="s2">(</span><span class="s1">hour</span><span class="s2">=</span><span class="s5">1</span><span class="s2">, </span><span class="s1">fold</span><span class="s2">=</span><span class="s1">fold</span><span class="s2">)</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">Timestamp</span><span class="s2">(</span><span class="s1">datetime</span><span class="s2">(</span><span class="s5">2019</span><span class="s2">, </span><span class="s5">10</span><span class="s2">, </span><span class="s5">27</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">30</span><span class="s2">)).</span><span class="s1">tz_localize</span><span class="s2">(</span>
            <span class="s1">tz</span><span class="s2">, </span><span class="s1">ambiguous</span><span class="s2">=</span><span class="s0">not </span><span class="s1">fold</span>
        <span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">result </span><span class="s2">== </span><span class="s1">expected</span>
        <span class="s0">assert </span><span class="s1">result</span><span class="s2">.</span><span class="s1">_creso </span><span class="s2">== </span><span class="s1">getattr</span><span class="s2">(</span><span class="s1">NpyDatetimeUnit</span><span class="s2">, </span><span class="s4">f&quot;NPY_FR_</span><span class="s0">{</span><span class="s1">unit</span><span class="s0">}</span><span class="s4">&quot;</span><span class="s2">).</span><span class="s1">value</span>

    <span class="s3"># --------------------------------------------------------------</span>
    <span class="s3"># Timestamp.normalize</span>

    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s4">&quot;arg&quot;</span><span class="s2">, [</span><span class="s4">&quot;2013-11-30&quot;</span><span class="s2">, </span><span class="s4">&quot;2013-11-30 12:00:00&quot;</span><span class="s2">])</span>
    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s4">&quot;unit&quot;</span><span class="s2">, [</span><span class="s4">&quot;ns&quot;</span><span class="s2">, </span><span class="s4">&quot;us&quot;</span><span class="s2">, </span><span class="s4">&quot;ms&quot;</span><span class="s2">, </span><span class="s4">&quot;s&quot;</span><span class="s2">])</span>
    <span class="s0">def </span><span class="s1">test_normalize</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">tz_naive_fixture</span><span class="s2">, </span><span class="s1">arg</span><span class="s2">, </span><span class="s1">unit</span><span class="s2">):</span>
        <span class="s1">tz </span><span class="s2">= </span><span class="s1">tz_naive_fixture</span>
        <span class="s1">ts </span><span class="s2">= </span><span class="s1">Timestamp</span><span class="s2">(</span><span class="s1">arg</span><span class="s2">, </span><span class="s1">tz</span><span class="s2">=</span><span class="s1">tz</span><span class="s2">).</span><span class="s1">as_unit</span><span class="s2">(</span><span class="s1">unit</span><span class="s2">)</span>
        <span class="s1">result </span><span class="s2">= </span><span class="s1">ts</span><span class="s2">.</span><span class="s1">normalize</span><span class="s2">()</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">Timestamp</span><span class="s2">(</span><span class="s4">&quot;2013-11-30&quot;</span><span class="s2">, </span><span class="s1">tz</span><span class="s2">=</span><span class="s1">tz</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">result </span><span class="s2">== </span><span class="s1">expected</span>
        <span class="s0">assert </span><span class="s1">result</span><span class="s2">.</span><span class="s1">_creso </span><span class="s2">== </span><span class="s1">getattr</span><span class="s2">(</span><span class="s1">NpyDatetimeUnit</span><span class="s2">, </span><span class="s4">f&quot;NPY_FR_</span><span class="s0">{</span><span class="s1">unit</span><span class="s0">}</span><span class="s4">&quot;</span><span class="s2">).</span><span class="s1">value</span>

    <span class="s0">def </span><span class="s1">test_normalize_pre_epoch_dates</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s3"># GH: 36294</span>
        <span class="s1">result </span><span class="s2">= </span><span class="s1">Timestamp</span><span class="s2">(</span><span class="s4">&quot;1969-01-01 09:00:00&quot;</span><span class="s2">).</span><span class="s1">normalize</span><span class="s2">()</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">Timestamp</span><span class="s2">(</span><span class="s4">&quot;1969-01-01 00:00:00&quot;</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">result </span><span class="s2">== </span><span class="s1">expected</span>

    <span class="s3"># --------------------------------------------------------------</span>

    <span class="s2">@</span><span class="s1">td</span><span class="s2">.</span><span class="s1">skip_if_windows</span>
    <span class="s0">def </span><span class="s1">test_timestamp</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">fixed_now_ts</span><span class="s2">):</span>
        <span class="s3"># GH#17329</span>
        <span class="s3"># tz-naive --&gt; treat it as if it were UTC for purposes of timestamp()</span>
        <span class="s1">ts </span><span class="s2">= </span><span class="s1">fixed_now_ts</span>
        <span class="s1">uts </span><span class="s2">= </span><span class="s1">ts</span><span class="s2">.</span><span class="s1">replace</span><span class="s2">(</span><span class="s1">tzinfo</span><span class="s2">=</span><span class="s1">utc</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">ts</span><span class="s2">.</span><span class="s1">timestamp</span><span class="s2">() == </span><span class="s1">uts</span><span class="s2">.</span><span class="s1">timestamp</span><span class="s2">()</span>

        <span class="s1">tsc </span><span class="s2">= </span><span class="s1">Timestamp</span><span class="s2">(</span><span class="s4">&quot;2014-10-11 11:00:01.12345678&quot;</span><span class="s2">, </span><span class="s1">tz</span><span class="s2">=</span><span class="s4">&quot;US/Central&quot;</span><span class="s2">)</span>
        <span class="s1">utsc </span><span class="s2">= </span><span class="s1">tsc</span><span class="s2">.</span><span class="s1">tz_convert</span><span class="s2">(</span><span class="s4">&quot;UTC&quot;</span><span class="s2">)</span>

        <span class="s3"># utsc is a different representation of the same time</span>
        <span class="s0">assert </span><span class="s1">tsc</span><span class="s2">.</span><span class="s1">timestamp</span><span class="s2">() == </span><span class="s1">utsc</span><span class="s2">.</span><span class="s1">timestamp</span><span class="s2">()</span>

        <span class="s3"># datetime.timestamp() converts in the local timezone</span>
        <span class="s0">with </span><span class="s1">tm</span><span class="s2">.</span><span class="s1">set_timezone</span><span class="s2">(</span><span class="s4">&quot;UTC&quot;</span><span class="s2">):</span>
            <span class="s3"># should agree with datetime.timestamp method</span>
            <span class="s1">dt </span><span class="s2">= </span><span class="s1">ts</span><span class="s2">.</span><span class="s1">to_pydatetime</span><span class="s2">()</span>
            <span class="s0">assert </span><span class="s1">dt</span><span class="s2">.</span><span class="s1">timestamp</span><span class="s2">() == </span><span class="s1">ts</span><span class="s2">.</span><span class="s1">timestamp</span><span class="s2">()</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s4">&quot;fold&quot;</span><span class="s2">, [</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_replace_preserves_fold</span><span class="s2">(</span><span class="s1">fold</span><span class="s2">):</span>
    <span class="s3"># GH 37610. Check that replace preserves Timestamp fold property</span>
    <span class="s1">tz </span><span class="s2">= </span><span class="s1">gettz</span><span class="s2">(</span><span class="s4">&quot;Europe/Moscow&quot;</span><span class="s2">)</span>

    <span class="s1">ts </span><span class="s2">= </span><span class="s1">Timestamp</span><span class="s2">(</span><span class="s1">year</span><span class="s2">=</span><span class="s5">2009</span><span class="s2">, </span><span class="s1">month</span><span class="s2">=</span><span class="s5">10</span><span class="s2">, </span><span class="s1">day</span><span class="s2">=</span><span class="s5">25</span><span class="s2">, </span><span class="s1">hour</span><span class="s2">=</span><span class="s5">2</span><span class="s2">, </span><span class="s1">minute</span><span class="s2">=</span><span class="s5">30</span><span class="s2">, </span><span class="s1">fold</span><span class="s2">=</span><span class="s1">fold</span><span class="s2">, </span><span class="s1">tzinfo</span><span class="s2">=</span><span class="s1">tz</span><span class="s2">)</span>
    <span class="s1">ts_replaced </span><span class="s2">= </span><span class="s1">ts</span><span class="s2">.</span><span class="s1">replace</span><span class="s2">(</span><span class="s1">second</span><span class="s2">=</span><span class="s5">1</span><span class="s2">)</span>

    <span class="s0">assert </span><span class="s1">ts_replaced</span><span class="s2">.</span><span class="s1">fold </span><span class="s2">== </span><span class="s1">fold</span>
</pre>
</body>
</html>